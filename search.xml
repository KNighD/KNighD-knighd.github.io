<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>å…³äºæˆ‘å°† FCP ç¼©çŸ­ 60% è¿™ä»¶äº‹</title>
      <link href="/2022/09/06/%E5%85%B3%E4%BA%8E%E6%88%91%E5%B0%86-fcp-%E7%BC%A9%E7%9F%AD-60-%E8%BF%99%E4%BB%B6%E4%BA%8B/"/>
      <url>/2022/09/06/%E5%85%B3%E4%BA%8E%E6%88%91%E5%B0%86-fcp-%E7%BC%A9%E7%9F%AD-60-%E8%BF%99%E4%BB%B6%E4%BA%8B/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘éœ€è¦æ­å»ºä¸€ä¸ªåå°é¡¹ç›®ï¼Œåœ¨å®Œæˆå¼€å‘åï¼Œæˆ‘å°†å…¶é‡æ„ï¼Œå°† [FCP](<a href="https://developer.mozilla.org/en-US/docs/Glossary/First_contentful_paint">First contentful paint - MDN Web Docs Glossary: Definitions of Web-related terms | MDN</a>) ä»å¹³å‡ 3.5 s ç¼©çŸ­åˆ°å¹³å‡ 1 sã€‚</p><a id="more"></a><h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>è¿™ä¸ªåå°é¡¹ç›®æœ‰ç‚¹ç‰¹æ®Šä¹‹å¤„åœ¨äºä»–çš„æ¯ä¸ªé¡µé¢éƒ½å°†åœ¨å¦ä¸ªä¸€é¡¹ç›®é‡Œä»¥ iframe çš„å½¢å¼åµŒå…¥ã€‚å¾ˆå¿«å°±æå®šäº†ï¼ŒæŠ€æœ¯æ ˆå°±æ˜¯ vite + react ç­‰ã€‚ä¸è¿‡äº§å“åœ¨å¼€å‘ä¹‹åæäº†ä¸€ä¸ªéœ€æ±‚ï¼Œåœ¨å…¶ä¸­ä¸€ä¸ªé¡µé¢éœ€è¦æ”¯æŒå±•ç¤º pag æ ¼å¼çš„æ–‡ä»¶ã€‚<a href="https://pag.io/">pag</a> å°±æ˜¯è…¾è®¯å‡ºä¸ªä¸€ä¸ªç±»ä¼¼ lottie çš„åŠ¨æ•ˆæ¡†æ¶ï¼Œè¿™é‡Œä¸å±•å¼€ã€‚</p><p>åœ¨å¼•å…¥äº† pag åï¼Œæˆ‘å‘ç°é¡µé¢çš„åŠ è½½é€Ÿåº¦å˜æ…¢äº†äº›ï¼Œå½“ç„¶è¿™å¯¹äºåå°é¡¹ç›®æ¥è¯´å€’ä¹Ÿä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ï¼ˆåˆä¸æ˜¯ä¸èƒ½ç”¨ï¼‰ã€‚ä¸è¿‡åˆšå¥½æœ‰æ—¶é—´ç ”ç©¶ï¼Œè°ƒå‡º performance é¢æ¿ä¸€çœ‹ï¼Œå¥½å®¶ä¼™ï¼Œå·²ç» fcp åˆ°äº† 3.5 s å·¦å³ã€‚</p><p>pag æ¨èçš„åŠ è½½æ–¹å¼æ˜¯åœ¨ html é‡Œæ’å…¥ scriptï¼Œç”±æ­¤æˆ‘åœ¨æƒ³æˆ‘ä»…ä»…æ˜¯å…¶ä¸­ä¸€ä¸ªé¡µé¢è¦ä½¿ç”¨åˆ° pagï¼Œç„¶è€Œæ‹–æ…¢äº†æ‰€æœ‰é¡µé¢ï¼Œè¿™åˆç†å—ï¼Ÿç”±äº vite + spa çš„æ–¹å¼å…¥å£ä»…ä¸€ä¸ª htmlï¼Œè¿™ä¸ªé—®é¢˜æ— æ³•é¿å…</p><h3 id="astro"><a href="#astro" class="headerlink" title="astro"></a>astro</h3><p>è¿™æ—¶å€™æˆ‘æƒ³åˆ° [astro](<a href="https://docs.astro.build/en/getting-started/">Getting Started ğŸš€ Astro Documentation</a>) çš„æ¶æ„ï¼Œæ­£æ˜¯ mpaï¼Œå¹¶ä¸”è¿˜è¯¦ç»†è®¨è®ºäº†[ spa ä¸ mpa ä¹‹é—´çš„å¯¹æ¯”](<a href="https://docs.astro.build/en/concepts/mpa-vs-spa/">MPAs vs. SPAs ğŸš€ Astro Documentation</a>)ï¼Œé‚£ä¹ˆæˆ‘å°±å¯ä»¥åœ¨æœ‰éœ€è¦çš„é¡µé¢å¼•å…¥ pag è„šæœ¬ï¼Œè¿™æ ·å¤§æ¦‚ç‡æ˜¯èƒ½ä¼˜åŒ–ä¸Šè¿°é—®é¢˜çš„ã€‚</p><p>è‡³æ­¤æˆ‘æ‰“ç®—ç”¨ astro å†™ä¸€ä¸ª demo æ¥ç®€å•æµ‹è¯•ä¸‹é¡µé¢çš„æ€§èƒ½ï¼Œä¸è¿‡åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ç®€å•è¿‡äº†ä¸€ä¸‹ astro çš„æ–‡æ¡£ï¼Œå¹¶ç½—åˆ—äº†ä¸€ astro å¥‘åˆå½“å‰é¡¹ç›®çš„å‡ ä¸ªç‚¹</p><ol><li><p>å½“å‰é¡¹ç›®ä½¿ç”¨ vite å¼€å‘ï¼Œastro åˆšå¥½ä¹Ÿæ˜¯ viteï¼Œé‚£ä¹ˆå°±æ‰“åŒ…æ¥è¯´è¿ç§»æˆæœ¬ä¸é«˜</p></li><li><p>å½“å‰é¡¹ç›®çš„é¡µé¢å¤šä¸ºç‹¬ç«‹é¡µé¢ï¼Œæ¯ä¸ªé¡µé¢éƒ½å°†åœ¨å¦ä¸€ä¸ªé¡µé¢é‡Œä½œä¸º iframe ä½¿ç”¨ï¼Œè¿™ç‚¹ä¹Ÿå¥‘åˆ mpa</p></li><li><p>astro æ”¯æŒ react ç­‰ä¸åŒçš„ ui æ¡†æ¶ï¼Œå½“å‰é¡¹ç›®ä¹Ÿæ˜¯åŸºäº reactï¼Œå°±ä¸šåŠ¡ä»£ç è€Œè¨€è¿ç§»æˆæœ¬ä¹Ÿä¸é«˜</p></li><li><p>astro æ”¯æŒ ssr ä¸ ssgï¼Œå½“å‰é¡¹ç›®ä¸ºçº¯å‰ç«¯ï¼Œåªéœ€è¦æ„å»ºå‡ºé™æ€èµ„æºå¹¶éƒ¨ç½²åˆ°æœåŠ¡ç«¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸å¼€å¯ ssr å³å¯ï¼Œæ„å»ºéƒ¨ç½²æ–¹é¢è¿ç§»æˆæœ¬ä¸é«˜</p></li><li><p>astro è¯­æ³•æœ¬èº«æ¥è¿‘ vueï¼Œé‚£ä¹ˆä¸Šæ‰‹æˆæœ¬ä¹Ÿä¸é«˜</p></li></ol><p>é‚£ä¹ˆæœ‰äº†ä¸Šè¿°å‡ ç‚¹ï¼Œæˆ‘è§‰å¾—è¿™ä¸ªæ–¹æ¡ˆæ˜¯å¤§æ¦‚ç‡å¯è¡Œçš„</p><h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><p>é¦–å…ˆå†™ä¸€ä¸ªç®€å•çš„ demo éªŒè¯ä¸‹ï¼Œè¿ç§»çš„ç»†èŠ‚ä¸å¤šè¯´</p><ol><li><p>astro åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®</p></li><li><p>å°†åŸå…ˆ react-router ç®¡ç†çš„é¡µé¢è¿ç§»ä¸€ä¸ªåˆ° src/pages ä¸‹</p></li><li><p>åˆ›å»º index.astro ï¼Œå…¶ä¸­å†…å®¹ä¸º</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">---import App from &#39;.&#x2F;App&#39;;---&lt;html lang&#x3D;&quot;en&quot;&gt;  &lt;head&gt;    &lt;meta charset&#x3D;&quot;UTF-8&quot; &#x2F;&gt;    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width&quot; &#x2F;&gt;    &lt;title&gt;Astro Demo&lt;&#x2F;title&gt;  &lt;&#x2F;head&gt;  &lt;body&gt;    &lt;App client:visible &#x2F;&gt;  &lt;&#x2F;body&gt;&lt;&#x2F;html&gt;</code></pre><p><code>App</code> å³ä¸ºåŸé¡µé¢çš„ç»„ä»¶</p></li></ol><p>é€šè¿‡ä¸Šè¿°ä¸€ç•ªè…¾æŒªåï¼Œé¡¹ç›®æˆåŠŸè¿è¡Œèµ·æ¥ï¼ŒFCP æ—¶é—´é™åˆ° 1.2sï¼Œæ•ˆæœå–œäººã€‚</p><p>è§£é‡Šä¸€ä¸‹ ``client:visible  è¡¨ç¤ºå½“ç»„ä»¶å¯è§æ—¶ï¼Œå¼€å§‹åŠ è½½è¯¥ç»„ä»¶çš„ jsï¼Œä¹Ÿå°±æ˜¯ astro çš„å²›å±¿æ¶æ„ï¼Œè¯¦ç»†ä¸å±•å¼€ï¼Œå¯å‚è€ƒ[æ–‡æ¡£](<a href="https://docs.astro.build/en/concepts/islands/">Astro Islands ğŸš€ Astro Documentation</a>)</p><h3 id="é‡æ„"><a href="#é‡æ„" class="headerlink" title="é‡æ„"></a>é‡æ„</h3><p>æ—¢ç„¶éªŒè¯æ˜¯å¯è¡Œçš„ï¼Œé‚£ä¹ˆå°±å°†è¿™ä¸ªæ–¹æ¡ˆæŠ›å‡ºæ¥çœ‹çœ‹æ˜¯å¦èƒ½é€šè¿‡ï¼ˆç”±äºæ˜¯å…¬å…±çš„é¡¹ç›®ï¼‰ï¼Œåœ¨å¾—åˆ°äº†è‚¯å®šçš„ç­”å¤ä¹‹åå¼€å§‹åŠ¨æ‰‹é‡æ„</p><p>é¡ºå¸¦ä¸€æï¼Œé¡¹ç›®ä½¿ç”¨ @nxtensions/astro åˆå§‹åŒ–ï¼Œè¿™æ˜¯å› ä¸ºå…¶ä»–ä¸šåŠ¡ä¹Ÿå°†åœ¨è¿™ä¸ªé¡¹ç›®é‡Œå¼€å‘ï¼Œå› æ­¤ç”¨ nx ä½œä¸º monorepo æ¡†æ¶ã€‚</p><p>æœŸé—´è¿˜åŠ å…¥äº† plop / tailwindcss / jss / react-query ç­‰ï¼Œåœ¨æ­¤å°±ä¸å±•å¼€</p><p>æœ€ååœ¨å¤šæ¬¡æµ‹è¯•ä¸‹ï¼Œé¡µé¢å¹³å‡ FCP é™ä½åˆ° 1s å·¦å³ï¼Œæ¯”åŸå…ˆçš„ 3.5 s å‡å°‘äº† 60% ä»¥ä¸Šã€‚</p><h3 id="è¸©è¿‡çš„å‘"><a href="#è¸©è¿‡çš„å‘" class="headerlink" title="è¸©è¿‡çš„å‘"></a>è¸©è¿‡çš„å‘</h3><ol><li><p>astro  ä¸æ”¯æŒ vite è‡ªå®šä¹‰ mode <a href="https://github.com/withastro/astro/issues/3311">https://github.com/withastro/astro/issues/3311</a>  ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼šåˆ›å»ºå¤šä¸ª astro configï¼Œä¸åŒå‘½ä»¤åŠ è½½ä¸åŒ config</p></li><li><p>æ— æ³•åœ¨ astro é…ç½®æ–‡ä»¶é‡Œè·å–ç¯å¢ƒå‚æ•°ã€‚è§£å†³æ–¹æ¡ˆåŒ 1ï¼Œæ ¹æ®ä¸åŒå‘½ä»¤åˆ¤æ–­ç¯å¢ƒ</p></li><li><p>æ— æ³•æŒ‡å®š base <a href="https://github.com/withastro/astro/issues/4007">https://github.com/withastro/astro/issues/4007</a> astro ä¼šå¼ºè¡Œå°† base æ›¿æ¢æˆ <code>/</code> å¼€å¤´</p><p>è§£å†³æ–¹æ¡ˆï¼šé¡¹ç›®ä¸­ä½¿ç”¨åˆ° base çš„ä»…åœ¨æ„å»ºæ—¶ï¼Œä½œç”¨ç±»ä¼¼äº <code>public path</code>ï¼Œé‚£ä¹ˆæˆ‘å†™äº†ä¸€ä¸ªæ’ä»¶ï¼Œåœ¨ astro æ„å»ºå®Œæˆåï¼Œå°† <code>/</code>  å¼€å¤´çš„é™æ€èµ„æºæ›¿æ¢å›å»å³å¯ã€‚</p></li></ol><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä¹‹æ‰€ä»¥èƒ½ç¼©çŸ­ FCP æ—¶é—´ï¼Œæˆ‘è®¤ä¸ºä¸»è¦æ˜¯ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li><p>astro å°†å•é¡µæ‹†åˆ†ä¸ºå¤šé¡µï¼Œå‡å°‘äº†ä¸å¿…è¦çš„å…¶ä»–é¡µé¢èµ„æºçš„åŠ è½½æ—¶é—´ï¼ˆå¦‚ pagï¼‰</p></li><li><p>astro çš„å²›å±¿æ¶æ„ï¼Œä½¿å¾—ç»„ä»¶åœ¨å±•ç¤ºä¹‹åæ‰å¼€å§‹åŠ è½½ js</p></li><li><p>astro çš„ ssgï¼Œå°† react çš„æ¨¡æ¿åœ¨æ„å»ºæ—¶å°±å†™å…¥ html</p></li></ol><p>ç„¶è€Œ astro æ˜¯å¦é€‚åˆï¼Œè¿˜éœ€è¦æ ¹æ®å…·ä½“é¡¹ç›®æ¥åˆ¤æ–­ï¼Œæ­¤æ¬¡å°è¯•éªŒè¯äº†è¯¥æ–¹æ¡ˆæ—¶å¯è¡Œçš„ï¼Œä¹Ÿä¸ºå°†æ¥ä¼˜åŒ–ç§»åŠ¨ç«¯é¡µé¢æä¾›äº†ä¸€ä¸ªæ€è·¯ä¸æ–¹å‘ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> å‰ç«¯å·¥ç¨‹åŒ– </tag>
            
            <tag> astro </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022 å¹´ React æŠ€æœ¯æ ˆ</title>
      <link href="/2022/08/21/2022-React-%E6%8A%80%E6%9C%AF%E6%A0%88/"/>
      <url>/2022/08/21/2022-React-%E6%8A%80%E6%9C%AF%E6%A0%88/</url>
      
        <content type="html"><![CDATA[<p>2022 å¹´, å‰ç«¯æ¡†æ¶ä¾ç„¶åœ¨æ—¥æ–°æœˆå¼‚åœ°å˜åŒ–ï¼Œè¿‘æœŸæœ‰ä¸ªåå°çš„ PC é¡¹ç›®ï¼Œåˆšå¥½æ€»ç»“ä¸‹ 2022 å¹´æˆ‘å¼€å‘èµ·æ¥æ¯”è¾ƒèˆ’é€‚çš„æŠ€æœ¯æ ˆï¼ˆè¿™é‡Œç‰¹æŒ‡çš„ PCï¼‰ï¼Œä¸”éå¸¸åœ°æœ‰ä¸»è§‚å€¾å‘ï¼Œä»…ä½œå‚è€ƒã€‚</p><a id="more"></a><h4 id="react"><a href="#react" class="headerlink" title="react"></a>react</h4><p>åœ¨æµ…å°äº† vue3 ä¹‹åï¼Œreact åœ¨ ts çš„æ”¯æŒä¸Šè¿˜æ˜¯è®©æˆ‘æœ€ä¸ºæ»¡æ„çš„ï¼Œä»…è¿™ä¸€ç‚¹å°±è¶³ä»¥è®©æˆ‘åœ¨ä¿©è€…ä¸­åšå‡ºé€‰æ‹©ã€‚è‡³äº solidjs æœ‰ç§èåˆäº† react / vue / svelte çš„æ„Ÿè§‰ï¼Œä¸ç”¨å†™ dependence ç¡®å®å¸å¼•äººï¼Œè¿˜æœ‰å¾…è§‚æœ›ã€‚</p><h4 id="vite"><a href="#vite" class="headerlink" title="vite"></a>vite</h4><p>ç›¸æ¯”è¾ƒ webpackï¼Œvite å¼€å§‹æ—¶å¯åŠ¨é€Ÿåº¦çš„ç¡®æ˜¯èˆ’æœï¼Œçƒ­æ›´æ–°æ›´æ˜¯å¦‚æ­¤</p><h4 id="antd"><a href="#antd" class="headerlink" title="antd"></a>antd</h4><p>mui è®©æˆ‘æ¯”è¾ƒå–œæ¬¢çš„æ˜¯ jss çš„è®¾è®¡ï¼Œç„¶è€Œå›½å†…å›¢é˜Ÿå¤§å¤šä»¥ antd è®¾è®¡åŸå‹ï¼Œå¦‚æœæ˜¯ä¸ªäººé¡¹ç›®åº”è¯¥è¿˜æ˜¯ä¼šä½¿ç”¨ muiã€‚</p><h4 id="tailwindcss"><a href="#tailwindcss" class="headerlink" title="tailwindcss"></a>tailwindcss</h4><p>tailwind å¯ä»¥é¿å…å†™ä¸€äº›é‡å¤çš„æ ·å¼ï¼Œæ¯”å¦‚ flexã€‚</p><h4 id="jss"><a href="#jss" class="headerlink" title="jss"></a>jss</h4><p>å½“ tailwind æ— æ³•è¦†ç›–çš„åœºæ™¯ï¼Œå¦‚è¦†ç›– antd æ ·å¼ç­‰ä½¿ç”¨ jssã€‚ç›¸å¯¹æ¯” styled componentï¼Œjss æ¯”è¾ƒç®€å•ï¼Œå¯¹æˆ‘è€Œè¨€å°±æ˜¯ä¸ª css module çš„æ›¿ä»£å“</p><h4 id="react-query"><a href="#react-query" class="headerlink" title="react query"></a>react query</h4><p>è¿™ä¸ªåº“å‰é˜µå­æ”¹åæˆ tan queryï¼Œç±»ä¼¼çš„åº“è¿˜æœ‰ swrã€‚ä½¿ç”¨è¿™ä¸ªåº“å¯ä»¥ä¸ç”¨è‡ªå·±ç»´æŠ¤è¯·æ±‚çš„ loading æ€ï¼Œä»¥åŠå¯ä»¥æ–¹ä¾¿åœ°ç®¡ç†æ¥å£ä¸‹å‘çš„æ•°æ®çŠ¶æ€ï¼Œä½†éœ€è¦è½¬å˜ä¸€äº›ä»¥å¾€å‘½ä»¤å¼çš„æ€ç»´ã€‚</p><h4 id="zustand"><a href="#zustand" class="headerlink" title="zustand"></a>zustand</h4><p>ç›®å‰ç”¨è¿‡æœ€é¡ºæ‰‹çš„ react çŠ¶æ€ç®¡ç†åº“ï¼Œæ¯” redux ç®€å•ã€‚</p><h4 id="plop"><a href="#plop" class="headerlink" title="plop"></a>plop</h4><p>åœ¨é¡¹ç›®ä¸­æ—¶å¸¸ä¼šå†™ä¸€äº›æ¨¡æ¿åŒ–çš„ä»£ç ï¼Œä¾‹å¦‚æ·»åŠ è·¯ç”±ï¼Œæ·»åŠ  service ç­‰ï¼Œplop ç›¸å½“äºé¡¹ç›®ä¸­çš„è„šæ‰‹æ¶ï¼Œå¯ä»¥é€šè¿‡æ¨¡æ¿ç”Ÿæˆä»£ç ã€‚</p><h4 id="zx"><a href="#zx" class="headerlink" title="zx"></a>zx</h4><p>node å†™è„šæœ¬æ—¶ä½¿ç”¨ shell å‘½ä»¤å¹¶ä¸å¤ªæ–¹ä¾¿ï¼Œé€šè¿‡ zx ç¼–å†™ä¼šç®€å•å¾ˆå¤š</p>]]></content>
      
      
      <categories>
          
          <category> web å‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NX é‡æ„ RN é¡¹ç›®</title>
      <link href="/2022/07/08/NX-%E9%87%8D%E6%9E%84-RN-%E9%A1%B9%E7%9B%AE/"/>
      <url>/2022/07/08/NX-%E9%87%8D%E6%9E%84-RN-%E9%A1%B9%E7%9B%AE/</url>
      
        <content type="html"><![CDATA[<h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>æ‰€è´Ÿè´£çš„ä¸€ä¸ª rn é¡¹ç›®ï¼Œåˆ†ä¸ºç”¨æˆ·ç«¯å’ŒåŒ»ç”Ÿç«¯ï¼Œè¿™ä¸¤ä¸ªç«¯æœ‰å¾ˆå¤šå¯å¤ç”¨çš„åœ°æ–¹ï¼Œæ¯”å¦‚ç›¸ä¼¼çš„ç•Œé¢ï¼Œç›¸ä¼¼çš„ç»„ä»¶ï¼Œç›¸ä¼¼çš„é€»è¾‘ã€‚</p><a id="more"></a><p>åœ¨æ­¤å‰çš„æ¶æ„è®¾è®¡å¯èƒ½æ˜¯å‰æœŸå·¥æœŸæ¯”è¾ƒç´§å¼ çš„åŸå› ï¼Œç®€å•ç²—æš´åœ°å°†å°†ä¸¤ä¸ªç«¯æ”¾ç½®åœ¨åŒä¸€ä¸ªä»“åº“å½“ä¸­ï¼Œä»…é€šè¿‡æ–‡ä»¶å¤¹ä½œä¸ºåŒºåˆ†</p><pre class="line-numbers language-none"><code class="language-none">â”œâ”€â”€ srcâ”‚   â”œâ”€â”€ assetsâ”‚   â”œâ”€â”€ componentsâ”‚   â”œâ”€â”€ hooksâ”‚   â”œâ”€â”€ clientâ”‚   â”œâ”€â”€ doctorâ”‚   â””â”€â”€ index.tsâ”œâ”€â”€ package.jsonâ””â”€â”€ README.md</code></pre><p>å¤§æ¦‚å°±æ˜¯ç±»ä¼¼è¿™æ ·çš„ä¸€ä¸ªç»“æ„ã€‚</p><p>è¿™å¸¦æ¥äº†ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p><ol><li>ç»Ÿä¸€å…¥å£ä¸º index.ts, æ‰€æœ‰çš„ client å’Œ doctor çš„é¡µé¢éƒ½åœ¨è¿™é‡Œæ³¨å†Œï¼Œå¯¼è‡´æœ€ç»ˆ bundle å‡ºæ¥çš„ åŒ…éå¸¸å¤§ï¼Œå¯¹ç”¨æˆ·ç«¯æ¥è¯´å¤šäº†å¾ˆå¤šåŒ»ç”Ÿç«¯çš„ä»£ç ï¼ŒåŒç†å¯¹åŒ»ç”Ÿç«¯æ¥è¯´ï¼Œå¤šäº†å¾ˆå¤šç”¨æˆ·ç«¯çš„ä»£ç ã€‚</li><li>æ— æ³•è¯„ä¼°å½±å“ç‚¹ï¼Œä¾‹å¦‚ä»…ä¿®æ”¹åŒ»ç”Ÿç«¯çš„ä»£ç ï¼Œæ„å»ºçš„æ—¶å€™ä¼šæŠŠç”¨æˆ·ç«¯çš„éƒ¨åˆ†ä¹Ÿé‡æ–°æ„å»ºã€‚å¹¶ä¸”ä½œä¸ºå¼€å‘è€…è€Œè¨€ï¼Œæˆ‘ä»¬ä¹Ÿä¸å¥½è¯„ä¼°ä¿®æ”¹æŸäº›ä»£ç æ—¶ä¼šå½±å“åˆ°å“ªä¸€ç«¯ã€‚</li><li>ä¸€æ—¦æ„å»ºå°±æ˜¯ä¸¤ç«¯åŒæ—¶æ„å»ºï¼Œè¿™å¯¼è‡´æ„å»ºæ—¶é—´å˜é•¿ã€‚</li></ol><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>å…¶å®ä¸Šé¢çš„é—®é¢˜æœ¬è´¨ä¸Šéƒ½æ˜¯å› ä¸ºå…¥å£å•ä¸€ï¼Œéƒ½é€šè¿‡ index.ts ä½œä¸ºæ³¨å†Œé¡µé¢çš„å…¥å£ã€‚æ¯”è¾ƒå®¹æ˜“æƒ³åˆ°çš„æ˜¯ï¼ŒæŠŠå…¥å£æ‹†åˆ†æˆ client-index.ts ä¸ doctor-index.ts ç±»ä¼¼è¿™æ ·çš„ã€‚<br>ä½†è¿™ä»ç„¶å­˜åœ¨é—®é¢˜ï¼š<br>é¡¹ç›®æ˜¯é€šè¿‡ gitlab ci æŒç»­é›†æˆæ„å»ºçš„ï¼Œå½“æœ‰ä»£ç å˜æ›´çš„æ—¶å€™ï¼Œå°±ä¼šæ‰§è¡Œæ„å»ºè„šæœ¬ã€‚ä½† gitlab æ˜¾ç„¶æ— æ³•å¾—çŸ¥éœ€è¦æ„å»ºçš„æ˜¯ client è¿˜æ˜¯ doctorï¼Œå¦‚æœä¸ç®¡ä¸‰ä¸ƒäºŒåä¸€ï¼Œæˆ‘éƒ½æ„å»ºï¼Œé‚£ä¹ˆæ˜¾ç„¶ä¸Šè¿° 2 å’Œ 3 çš„é—®é¢˜æ˜¯æ— æ³•è§£å†³çš„ã€‚<br>ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œå³å¦‚ä½•èƒ½è·çŸ¥ä»£ç å˜æ›´é€ æˆçš„å½±å“ç‚¹ï¼Œæˆ‘é€æ¸æŠŠç›®å…‰æ”¾åˆ°äº† monorepo ä¸Šã€‚</p><h3 id="monorepo"><a href="#monorepo" class="headerlink" title="monorepo"></a>monorepo</h3><p>æåˆ° monorepoï¼Œç¬¬ä¸€ä¸ªååº”åº”å½“æ˜¯ lernaï¼Œä½†å½“æ—¶çš„ lerna è¿˜æ˜¯ä¸èƒ½æ»¡è¶³ä¸Šé¢çš„éœ€æ±‚ã€‚ç„¶åæˆ‘åˆçœ‹äº†ä¸€äº›ç›®å‰æ¯”è¾ƒçƒ­é—¨çš„ monorepo æ¡†æ¶ï¼Œå¦‚ nx / rush ç­‰ã€‚æ­¤æ—¶æˆ‘å‘ç°ä¸€ä¸ª issue <a href="https://github.com/lerna/lerna/issues/3121">https://github.com/lerna/lerna/issues/3121</a> æ²¡é”™ï¼Œåœ¨è¿™ä¸ª issue é‡Œæåˆ°ï¼Œlerna å°†è½¬ç»™ nx æ¥ç»´æŠ¤ï¼Œç”±æ­¤æˆ‘æ‰“ç®—ä»”ç»†ç ”ç©¶ä¸€ä¸‹ nxã€‚</p><h3 id="nx"><a href="#nx" class="headerlink" title="nx"></a>nx</h3><p>ç¿»é˜…æ–‡æ¡£å¯ä»¥çœ‹åˆ° <a href="https://nx.dev/getting-started/intro">nx</a> å¯¹æ¯” lerna</p><blockquote><ul><li><strong>Parallelization and task dependencies -</strong> Nx automatically <a href="https://nx.dev/structure/dependency-graph">knows how your projects relate to each other</a>. As a result, if <code>project-a</code> depends on <code>project-b</code> and you run the build command for <code>project-a</code>, Nx first runs the builds for all of <code>project-a</code>â€˜s dependencies and then the invoked project itself. Nx sorts these tasks to maximize parallelism.</li><li><strong>Only run what changed -</strong> Using <a href="https://nx.dev/using-nx/affected">Nx affected commands</a> you only really execute tasks on the projects that changed, compared to a given baseline (usually the main branch).</li><li><strong>Caching -</strong> You get Nxâ€™s <a href="https://nx.dev/using-nx/caching">computation caching</a> for free. All operations, including artifacts and terminal output are restored from the cache (if present) in a completely transparent way without disrupting your DX. No configuration needed. Obviously this results in an incredible speed improvement.</li></ul></blockquote><p>nx å¯¹æ¯” lerna å¼ºåœ¨äºä»»åŠ¡ç¼–æ’</p><ol><li>nx å¯ä»¥è‡ªåŠ¨åˆ†æé¡¹ç›®ä¾èµ–ï¼Œåœ¨æ‰§è¡Œä»»åŠ¡æ—¶å¯ä»¥å°†å‰ç½®ä¾èµ–çš„package æ„å»º</li><li>é€šè¿‡ nx affected å‘½ä»¤ï¼Œnx å¯ä»¥ä»…è¿è¡Œæœ‰å˜æ›´çš„é¡¹ç›®</li><li>nx å¯ä»¥ç¼“å­˜æ„å»ºç»“æœ<br>ä»ä¸Šè¿°çœ‹å‡ºï¼Œnx å®Œç¾ç¬¦åˆæˆ‘çš„éœ€æ±‚ï¼Œå› æ­¤æ‰“ç®—å°†é¡¹ç›®é€šè¿‡ nx è¿›è¡Œé‡æ„ã€‚</li></ol><h3 id="é‡æ„çš„è¿‡ç¨‹åŠè¸©å‘"><a href="#é‡æ„çš„è¿‡ç¨‹åŠè¸©å‘" class="headerlink" title="é‡æ„çš„è¿‡ç¨‹åŠè¸©å‘"></a>é‡æ„çš„è¿‡ç¨‹åŠè¸©å‘</h3><p>é‡æ„çš„æ­¥éª¤æ¯”è¾ƒç®€å•ï¼š</p><ol><li>ç”±äºç»“æ„å˜åŠ¨æ¯”è¾ƒå¤§ï¼Œå› æ­¤ç›´æ¥åˆå§‹åŒ–ä¸€ä¸ª react native é¡¹ç›®<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">npx create-nx-workspace your-workspace-name \--preset&#x3D;react-native \--appName&#x3D;your-app-namenpm install @nrwl&#x2F;react-native --save-devnx g @nrwl&#x2F;react-native:app doctornx g @nrwl&#x2F;react-native:app client</code></pre></li><li>å°†å…¬å…±çš„ä»£ç æŠ½æˆ libs<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nx g @nrwl&#x2F;react-native:library shared-hooksnx g @nrwl&#x2F;react-native:library shared-componentsnx g @nrwl&#x2F;react-native:library shared-assets</code></pre></li><li>ä¿®æ”¹å¼•ç”¨ï¼Œä¹‹å‰å¼•ç”¨å…¬å…±ä»£ç ç±»ä¼¼ <code>import SomeComponent from &#39;@components&#39;</code>ï¼Œç°åœ¨åˆ™æ›´æ–°ä¸º <code>import SomeComponent from &#39;your-workspace-name/shared-component&#39;</code>ã€‚æ³¨æ„è¿™é‡Œè¿˜éœ€è¦ä¿®æ”¹ä¸€ä¸‹ tsconfig é‡Œçš„åˆ«åï¼Œä»¥æ–¹ä¾¿ <code>import SomeImage from &#39;your-workspace-name/shared-assets&#39;</code><pre class="line-numbers language-none"><code class="language-none">&quot;your-workspace-name&#x2F;shared-assets&#x2F;*&quot;: [&quot;libs&#x2F;shared-assets&#x2F;src&#x2F;*&quot;]</code></pre></li><li>é‡ç‚¹åœ¨ package çš„è„šæœ¬ï¼Œæ„å»ºè„šæœ¬è°ƒæ•´ä¸º<pre class="line-numbers language-none"><code class="language-none">&quot;release&quot;: &quot;nx affected --target&#x3D;release --base&#x3D;origin&#x2F;main~1 --head&#x3D;origin&#x2F;main&quot;,</code></pre>å½“ gitlab ci è¿è¡Œæ—¶ï¼Œæ‰§è¡Œ <code>npm run release</code> è¿™ä¸ªè„šæœ¬ï¼Œæ­¤æ—¶ <code>nx affected</code> ä¼šæ£€æµ‹åˆ° origin/main~1 ä¸ origin/main ä¸åŒçš„åœ°æ–¹ï¼Œæ‰¾åˆ°å—å½±å“çš„é¡¹ç›®ï¼Œå¹¶ä¸”æ‰§è¡Œè¿™äº›é¡¹ç›®çš„ release å‘½ä»¤</li><li>ä¸Šé¢æåˆ°çš„ <code>--target=release</code> ä¸­çš„ release æ˜¯è‡ªå®šä¹‰çš„ excutorï¼Œå³ nx çš„æ‰§è¡Œè„šæœ¬ï¼Œå…³äºè¿™éƒ¨åˆ†å¯ä»¥å‚è€ƒ <a href="https://nx.dev/executors/run-commands-builder">https://nx.dev/executors/run-commands-builder</a> å®é™…ä¸Šæœ€ä¸»è¦çš„åŠŸèƒ½å°±æ˜¯æ‰§è¡Œ react-native-cli çš„ bundleï¼ˆå½“ç„¶ nx ä¹Ÿå†…ç½®äº† bundle çš„ excutorï¼‰</li></ol><h4 id="è¸©å‘"><a href="#è¸©å‘" class="headerlink" title="è¸©å‘"></a>è¸©å‘</h4><p> ä»¥ä¸Šéƒ½æ¯”è¾ƒé¡ºåˆ©ï¼Œå”¯ä¸€çš„å‘ç‚¹åœ¨äºï¼Œå¯¼å…¥ shared-assets çš„å›¾ç‰‡åœ¨ app ä¸­å¹¶ä¸ä¼šåŠ è½½å‡ºæ¥ã€‚ä¸€å¼€å§‹æˆ‘ä»¥ä¸ºæ˜¯ nx çš„é—®é¢˜ï¼Œåæ¥ç»è¿‡æ¢ç´¢å‘ç°å®é™…ä¸Šæ˜¯ metro çš„é—®é¢˜ï¼ˆreact-native-cli åº•å±‚æ‰“åŒ…å·¥å…·ï¼‰ã€‚å…·ä½“å¯ä»¥æŸ¥çœ‹è¿™ä¸ª issue <a href="https://github.com/facebook/metro/issues/290#issuecomment-543746458">https://github.com/facebook/metro/issues/290#issuecomment-543746458</a> å¤§æ¦‚çš„åŸå› æ˜¯å› ä¸º metro åœ¨æ‰“åŒ…èµ„æºçš„æ—¶å€™ï¼Œä¼šå°†èµ„æºçš„ç›¸å¯¹è·¯å¾„ä¹Ÿç¼–è¯‘è¿›å»ï¼Œå¼•ç”¨å¤–å±‚çš„èµ„æºæ—¶ï¼Œè·¯å¾„ä¸­å°±ä¼šåŒ…å« <code>../</code> ç„¶è€Œæœ€ç»ˆç”Ÿæˆçš„ä»£ç ç›®å½•æ˜¾ç„¶æ‰¾ä¸åˆ°è¿™æ ·çš„è·¯å¾„ï¼Œç”±æ­¤åŠ è½½ä¼šå¤±è´¥ã€‚æ€ä¹ˆåŠå‘¢ï¼Œè¿™ä¸ª issue é‡Œæœ‰äººæå‡ºç”¨ç±»ä¼¼ <code>dir</code> è¿™æ ·çš„ç‰¹æ®Šå­—ç¬¦æ¥æ›¿æ¢ <code>../</code></p><p>æˆ‘åœ¨å°è¯•äº†ä¸Šè¿° <a href="https://github.com/facebook/metro/issues/290#issuecomment-917695784">https://github.com/facebook/metro/issues/290#issuecomment-917695784</a> çš„æ–¹æ¡ˆåï¼Œå¼€å‘æ—¶æ­£å¸¸ï¼Œä½†æ˜¯åœ¨æœ€ç»ˆæ„å»ºä¹‹åä¾ç„¶æ— æ³•æ˜¾ç¤ºå‡ºæ¥ï¼ˆæ—¶é—´æœ‰ç‚¹ä¹…äº†ï¼Œå¿˜è®°å…·ä½“åŸå› äº†ï¼Œå¤§æ¦‚åŸå› è¿˜æ˜¯æ‰“åŒ…åçš„è·¯å¾„ä¾ç„¶ä¸æ­£ç¡®å¯¼è‡´çš„ï¼‰ã€‚<br>æœ€ç»ˆç»“åˆäº† issue é‡Œçš„æ–¹æ¡ˆï¼Œè°ƒæ•´äº†ä¸ªç›®å‰è¿è¡Œèµ·æ¥æ²¡é—®é¢˜çš„æ–¹æ¡ˆï¼ˆä¸å¾—ä¸åæ§½ä¸‹ metro çš„æ–‡æ¡£ï¼Œæœ‰ä¸€äº› api å°±ä¸€ç¬”å¸¦è¿‡ï¼Œåªèƒ½ç¿» issue çœ‹ç”¨æ³•ï¼‰</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">&#x2F;&#x2F; metro.config.jsconst &#123; withNxMetro &#125; &#x3D; require(&#39;@nrwl&#x2F;react-native&#39;);const &#123; getDefaultConfig &#125; &#x3D; require(&#39;metro-config&#39;);const exclusionList &#x3D; require(&#39;metro-config&#x2F;src&#x2F;defaults&#x2F;exclusionList&#39;);module.exports &#x3D; (async () &#x3D;&gt; &#123;  const &#123;    resolver: &#123; sourceExts, assetExts &#125;,  &#125; &#x3D; await getDefaultConfig();  return withNxMetro(    &#123;    &#x2F;&#x2F; ...        &#x2F;&#x2F; å°†è¯·æ±‚èµ„æºçš„è·¯å¾„ ..&#x2F; æ›¿æ¢æˆ dir&#x2F;        assetPlugins: [require.resolve(&#39;.&#x2F;metro-asset-plugin&#39;)],      &#125;,      server: &#123;        &#x2F;&#x2F; å¼€å‘ç¯å¢ƒæ›¿æ¢å›¾ç‰‡èµ„æºå¼•ç”¨è·¯å¾„,å¦åˆ™æ— æ³•æ‰¾åˆ°æ­£ç¡®çš„è·¯å¾„        enhanceMiddleware: (middleware) &#x3D;&gt; &#123;          return (req, res, next) &#x3D;&gt; &#123;            if (req.url.indexOf(&#39;&#x2F;dir&#39;) !&#x3D;&#x3D; -1) &#123;              req.url &#x3D; req.url.replace(&#x2F;dir\&#x2F;&#x2F;g, &#39;..&#x2F;&#39;);            &#125;            return middleware(req, res, next);          &#125;;        &#125;,      &#125;,      &#x2F;&#x2F; ...    &#125;,    &#x2F;&#x2F; ...  );&#125;)();&#x2F;&#x2F; metro-asset-plugin.jsmodule.exports &#x3D; function (assetData) &#123;  if (assetData.httpServerLocation.indexOf(&#39;..&#x2F;&#39;) !&#x3D;&#x3D; -1) &#123;    assetData.httpServerLocation &#x3D; assetData.httpServerLocation.replace(      &#x2F;\.\.\&#x2F;&#x2F;g,      &#39;dir&#x2F;&#39;    );  &#125;  return assetData;&#125;;</code></pre><p>æ ¸å¿ƒå°±åœ¨äº server.enhanceMiddleware ä¸ transformer.assetPlugins æ›¿æ¢å›¾ç‰‡èµ„æºå¼•ç”¨è·¯å¾„ã€‚</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä¸Šè¿°ä»…ç®€å•æ¦‚è¿°äº†ä¸€ä¸‹é€šè¿‡ monorepo é‡æ„ RN é¡¹ç›®çš„è¿‡ç¨‹ï¼Œéšå»äº†ä¸å°‘ç»†èŠ‚ï¼Œä½†é€šè¿‡é˜…è¯»æ–‡æ¡£åº”å½“ä¹Ÿèƒ½æ‘¸ç´¢å‡ºå…·ä½“æ“ä½œï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚<br>é€šè¿‡ä¸Šè¿°çš„é‡æ„ä¹‹åï¼Œæ„å»ºåç”¨æˆ·ç«¯ä½“ç§¯å‡å°‘è‡³åŸæ¥çš„ 30%ï¼Œè€ŒåŒ»ç”Ÿç«¯åˆ™é™ä½åˆ°åŸæ¥çš„ 80%ï¼Œæ•ˆæœè¿˜æ˜¯æ¯”è¾ƒæ˜¾è‘—çš„ã€‚<br>å½“ç„¶ nx çš„ä½œç”¨ä¸ä»…äºæ­¤ï¼Œå› ä¸ºä¸æ˜¯é‡ç‚¹ï¼Œå› æ­¤ä¹Ÿä¸æ‰“ç®—å±•å¼€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ReactNative </tag>
            
            <tag> å‰ç«¯å·¥ç¨‹åŒ– </tag>
            
            <tag> monorepo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ koa æ­å»ºç®€æ˜“ mock server</title>
      <link href="/2022/03/14/%E4%BD%BF%E7%94%A8-koa-%E6%90%AD%E5%BB%BA%E7%AE%80%E6%98%93-mock-server/"/>
      <url>/2022/03/14/%E4%BD%BF%E7%94%A8-koa-%E6%90%AD%E5%BB%BA%E7%AE%80%E6%98%93-mock-server/</url>
      
        <content type="html"><![CDATA[<p>ç›®å‰é¡¹ç›®ç»„é‡Œçš„é¡¹ç›®ï¼Œè¦ä¹ˆæ²¡æœ‰ mockï¼Œè¦ä¹ˆ mock æ•°æ®çš„æ–¹å¼å°±æ˜¯å°†å‡æ•°æ®å†™åˆ°ä¸šåŠ¡ä»£ç ä¸­ï¼Œä¸æ–¹ä¾¿å¼€å‘ã€‚è¿‘æ¥åˆšå¥½æœ‰æ—¶é—´ï¼Œå› æ­¤æŠ½ç©ºå¯¹åŸé¡¹ç›®è¿›è¡Œä¸€äº›æ”¹é€ ï¼Œè®©å…¶æ”¯æŒæ•°æ®çš„ mockã€‚</p><a id="more"></a><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>å¼€å‘æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡ devServer ä»£ç†åˆ°æµ‹è¯•ç¯å¢ƒï¼Œæµ‹è¯•ç¯å¢ƒè¿”å›å¯¹åº”çš„æµ‹è¯•æ•°æ®ï¼Œåœ¨ mock æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦å°†æ¥å£ä»£ç†åˆ°æˆ‘ä»¬è‡ªå·±çš„ mock æœåŠ¡å™¨ï¼Œé‚£ä¹ˆè¿”å›çš„æ•°æ®å°±å¯ä»¥è‡ªè¡Œå®šä¹‰ï¼Œæœ¬æ–‡ä»¥ webpack ä¸ºä¾‹ï¼Œå…¶ä»–çš„æ„å»ºå·¥å…·å¤§è‡´ä¸Šæ€è·¯æ˜¯ä¸€æ ·çš„ã€‚</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><h3 id="scripts"><a href="#scripts" class="headerlink" title="scripts"></a>scripts</h3><p>é¦–å…ˆæˆ‘ä»¬è¦åŒºåˆ†å¼€æ™®é€šçš„å¼€å‘æ¨¡å¼ä¸ mock çš„å¼€å‘æ¨¡å¼ï¼Œå› æ­¤åœ¨ package.json ä¸­æ·»åŠ ä¸€äº› script</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">&#123;&#x2F;&#x2F; ...  scripts: &#123;    &quot;dev&quot;: &quot;run some script for develop&quot;,    &quot;mock-server&quot;: &quot;nodemon mock&#x2F;index.js&quot;,    &quot;dev:mock&quot;: &quot;cross-env MOCK&#x3D;1 run some script for develop&quot;,    &quot;mock&quot;: &quot;npm-run-all -p -r mock-server dev:mock&quot;  &#125;&#125;</code></pre><p><code>mock-server</code> å‘½ä»¤ç”¨äºå¯åŠ¨ä¸€ä¸ª mock æœåŠ¡, å¯åŠ¨çš„è„šæœ¬åœ¨ mock/index.js (åé¢å°†è¡¥å……è¯¦ç»†çš„è¯´æ˜)</p><p><code>dev:mock</code>å‘½ä»¤ä¸æ™®é€šå¼€å‘æ¨¡å¼ dev çš„åŒºåˆ«åœ¨äºæ³¨å…¥ä¸€ä¸ª <code>MOCK=1</code>, è¿™ä¸ª å˜é‡çš„ä½œç”¨æ˜¯é…ç½® webpack çš„ devServer ä¸­çš„ proxyï¼Œå½“ <code>process.env.MOCK === &#39;1&#39;</code> æ—¶ï¼Œå°†æ¥å£ä»£ç†åˆ° mock serverã€‚</p><p><code>mock</code> å‘½ä»¤å°±æ˜¯é€šè¿‡ <code>npm-run-all</code>å°†<code>mock-server</code>ä¸<code>dev:mock</code>å‘½ä»¤ä¸²è¡Œæ‰§è¡Œã€‚</p><h3 id="dev-mock"><a href="#dev-mock" class="headerlink" title="dev:mock"></a>dev:mock</h3><p>åœ¨ dev æ¨¡å¼çš„é…ç½®æ–‡ä»¶é‡Œï¼ˆå¦‚  webpack.dev.conf.js )ï¼Œä¿®æ”¹ devServer.proxy</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">&#123;&#x2F;&#x2F; ...  devServer: &#123;    &#x2F;&#x2F; ...    proxy: &#123;      &#39;&#x2F;api&#39;: &#123;        &#x2F;&#x2F; å‡è®¾æˆ‘ä»¬çš„ mocker server ç«¯å£åœ¨ 8009        process.env.MOCK &#x3D;&#x3D;&#x3D; &#39;1&#39; ? &#39;http:&#x2F;&#x2F;localhost:8009&#39; : &#39;http:&#x2F;&#x2F;your-test-domain&#39;,        changeOrigin: true,      &#125;    &#125;  &#125;&#125;</code></pre><p>è¿™æ ·æˆ‘ä»¬åœ¨ mock çš„æ—¶å€™ï¼Œä»¥ <code>/api</code> å¼€å¤´çš„æ¥å£å°±èƒ½è½¬å‘åˆ° <code>http://localhost:8009</code> äº†ï¼Œä¸‹é¢è®©æˆ‘ä»¬å®Œæˆ mock server çš„éƒ¨åˆ†</p><h3 id="mock-server"><a href="#mock-server" class="headerlink" title="mock-server"></a>mock-server</h3><p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª mock ç›®å½•ï¼Œåœ¨ä¸‹é¢åˆ›å»ºä¸€ä¸ª index.js æ–‡ä»¶ä½œä¸ºå¯åŠ¨è„šæœ¬ã€‚</p><p>å½“æˆ‘ä»¬åœ¨ mock ç›®å½•ä¸‹æ–°å»º *.mock.jsï¼Œ å¦‚ test.mock.js </p><pre class="line-numbers language-js" data-language="js"><code class="language-js">module.exports &#x3D; &#123;  &#39;get &#x2F;api&#x2F;test&#39;: ctx &#x3D;&gt; &#123;    ctx.body &#x3D; &#123;      code: 0,      message: &quot;my mock data&quot;    &#125;  &#125;,  &#39;post &#x2F;api&#x2F;test2&#39;: &#123;      code: 0,      message: &quot;my mock data2&quot;   &#125;&#125;;</code></pre><p>ä¸Šé¢çš„é…ç½®å¯ä»¥çœ‹å‡ºå…¶å®å’Œå†™ koa çš„æ¥å£æ˜¯ä¸€æ ·çš„ï¼Œä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬è¿˜æ”¯æŒç›´æ¥è¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚</p><p>mock/index çš„å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">const Koa &#x3D; require(&#39;koa&#39;);const app &#x3D; new Koa();const glob &#x3D; require(&#39;glob&#39;);const Router &#x3D; require(&#39;koa-router&#39;);const chalk &#x3D; require(&#39;chalk&#39;);const proxy &#x3D; require(&#39;koa-proxies&#39;);const router &#x3D; new Router();glob.sync(&#39;**&#x2F;*.mock.js&#39;, &#123;    cwd: __dirname,    ignore: [&#39;index.js&#39;],&#125;).forEach(file &#x3D;&gt; &#123;  &#x2F;&#x2F; è¯»å–æ‰€æœ‰ *.mock.js æ–‡ä»¶  const apis &#x3D; require(&#96;.&#x2F;$&#123;file&#125;&#96;);  &#x2F;&#x2F; æ³¨å†Œè·¯ç”±  Object.keys(apis).forEach(api &#x3D;&gt; &#123;    const [method, url] &#x3D; api.split(&#x2F;\s+&#x2F;);    router[method](      url,      &#x2F;&#x2F; å¦‚æœæ˜¯æ–¹æ³•ï¼Œåˆ™æ‰§è¡Œæ–¹æ³•ï¼Œå¦åˆ™ç›´æ¥è¿”å›å¯¹è±¡      typeof apis[api] &#x3D;&#x3D;&#x3D; &#39;function&#39;      ? apis[api]      : ctx &#x3D;&gt; &#123;        ctx.body &#x3D; apis[api];      &#125;,    );  &#125;);&#125;);app.use(async (ctx, next) &#x3D;&gt; &#123;  await next();  &#x2F;&#x2F; æ‰“ä¸ªæ—¥å¿—  console.log(&#96;$&#123;chalk.blue(&#39;mock è¯·æ±‚:&#39;)&#125; $&#123;ctx.method&#125; $&#123;ctx.url&#125;&#96;);&#125;)&#x2F;&#x2F; æ³¨å†Œè·¯ç”±  .use(router.routes())  .use(router.allowedMethods());&#x2F;&#x2F; bypassï¼Œå¦‚æœæ²¡æœ‰å¯¹åº”çš„ mock api çš„è¯å°±è¿˜æ˜¯è½¬å‘åˆ°æµ‹è¯•ç¯å¢ƒ  .use(    &#x2F;&#x2F; ä»£ç†    proxy(&#96;&#x2F;api&#96;, &#123;      target: &#39;http:&#x2F;&#x2F;your-test-domain&#39;,      changeOrigin: true,    &#125;),  )&#x2F;&#x2F; ç›‘å¬ 8090 ç«¯å£  .listen(8009, () &#x3D;&gt; &#123;  console.log(chalk.green(&#39;mock server is running at port 8009&#39;));&#125;);</code></pre><p>è‡³æ­¤ï¼Œ é€šè¿‡ koa å®Œæˆäº†ä¸€ä¸ªå¾ˆç®€å•çš„ mock æœåŠ¡ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> NodeJs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‰ç«¯å·¥ç¨‹åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RN çº¿ä¸Šé”™è¯¯æœé›†</title>
      <link href="/2022/03/03/RN-%E7%BA%BF%E4%B8%8A%E9%94%99%E8%AF%AF%E6%90%9C%E9%9B%86/"/>
      <url>/2022/03/03/RN-%E7%BA%BF%E4%B8%8A%E9%94%99%E8%AF%AF%E6%90%9C%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘é¡¹ç›®ç»„æ”¶åˆ°ç”¨æˆ·åé¦ˆæ— æ³•è¿›å…¥æ”¶åˆ°ä¸€ä¸ª RN é¡µé¢ï¼Œæ€€ç–‘æ˜¯å®¢æˆ·ç«¯åŠ è½½é¡µé¢æ—¶å‘ç”Ÿå¼‚å¸¸ï¼Œä½†ä¹Ÿä¸æ’é™¤æ˜¯å‰ç«¯ä»£ç å¼‚å¸¸å¯¼è‡´çš„ã€‚</p><p>ä¸ºæ­¤æ‰“ç®—æ¥å…¥æ—©å…ˆåˆ«ç»„åŒå­¦æ­å»ºçš„ Sentryï¼Œä»¥ä¾¿äºè§‚æµ‹ä¸æœé›†å‰ç«¯å¼‚å¸¸ã€‚ä¸è¿‡ç°æœ‰çš„ sdk æ˜¯åŸºäº h5 ä¸ node çš„ï¼Œrn è¿™æ–¹é¢æ²¡æœ‰å¯¹åº”çš„ sdkã€‚sentry æ˜¯æœ‰å¼€æºçš„ rn sdkï¼Œä½†ç”±äºé¡¹ç›®ç‰¹æ®Šæ€§ï¼Œä¸å®¢æˆ·ç«¯è€¦åˆè¾ƒå¤šï¼Œå› æ­¤ç®€å•è‡ªè¡Œå°è£…ä¸€ä¸ª sdk ä½œä¸ºè¿‡æ¸¡ï¼Œç­‰åç»­è´Ÿè´£ sentry çš„åŒå­¦æä¾›ç»Ÿä¸€çš„ RN sdk å†æ›¿æ¢æ‰ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹å°è£…çš„æ€è·¯ã€‚</p><a id="more"></a><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>å…¬å¸çš„ sentry é¡¹ç›®ä¸æ˜¯æˆ‘è¿™é‡Œè´Ÿè´£çš„ï¼Œä¸è¿‡å¤§æ¦‚çš„åŸç†åœ¨å°è£… sdk çš„è¿‡ç¨‹ä¸­ä¹ŸçŒœçš„å·®ä¸å¤šäº†ã€‚</p><ol><li>client æ•è·åˆ°å¼‚å¸¸</li><li>client é€šè¿‡è¯·æ±‚ / å›¾ç‰‡å°†å¼‚å¸¸ä¿¡æ¯å‘é€åˆ°æ—¥è®°ç»Ÿè®¡å¹³å°</li><li>å®šæ—¶ä»æ—¥å¿—å¹³å°æ‹‰å– sentry å¼‚å¸¸ç›¸å…³çš„æ—¥å¿—</li><li>å°†æ—¥å¿—æ•´ç†æˆ sentry è¯†åˆ«çš„å­—æ®µï¼Œå­˜å…¥æ•°æ®åº“</li><li>ç”¨æˆ·åœ¨ sentry çš„å¹³å°æŸ¥çœ‹ issue å³å¯</li></ol><h2 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h2><ol><li><p>æä¾›ä¸€ä¸ª HOC ç”¨äºæ•è·æœªå¤„ç†çš„å¼‚å¸¸ï¼Œå°±å« withErrorBoundary å§ï¼Œè¿™ä¸ªä¸ React æ•è·å¼‚å¸¸å…¶å®éƒ½å·®ä¸å¤š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import React from &#39;react&#39;;import &#123; report &#125; from &#39;@hooks&#x2F;useSentry&#39;;&#x2F;** æ•è·é¡µé¢å¼‚å¸¸å¹¶ä¸ŠæŠ¥åˆ° sentry *&#x2F;class ErrorBoundary extends React.Component &#123;    state: &#123; error?: any &#125; &#x3D; &#123;&#125;;    static getDerivedStateFromError(error: any) &#123;        return &#123; error &#125;;    &#125;    componentDidCatch(error: any) &#123;        report(error);    &#125;    render() &#123;        return this.state.error ? (          &lt;div&gt;oops!&lt;&#x2F;div&gt;        ) : (            this.props.children        );    &#125;&#125;export const withErrorBoundary &#x3D;(WrappedComponent) &#x3D;&gt; (props) &#x3D;&gt; (&lt;ErrorBoundary &#123;...props&#125;&gt;&lt;WrappedComponent &#123;...props&#125; &#x2F;&gt;&lt;&#x2F;ErrorBoundary&gt;)export default ErrorBoundary;</code></pre><p>ç»™éœ€è¦çš„é¡µé¢åŒ…è£¹ä¸Š <code>withErrorBoundary(Page)</code> å³å¯</p></li><li><p>å®ç° reportï¼Œå®é™…ä¸Š report æ— éå°±æ˜¯å°†ä¿¡æ¯æ•´ç†æˆéœ€è¦çš„æ ¼å¼ï¼Œç„¶åå‘é€åˆ°æ—¥å¿—å¹³å°ã€‚</p><p>é‚£ä¹ˆéœ€è¦çš„ä¿¡æ¯åŒ…æ‹¬ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>é¦–å…ˆè‚¯å®šæ˜¯é”™è¯¯æ ˆï¼Œè¿™é‡Œé€šè¿‡ ErrorBoundary é‡Œçš„ error èƒ½è·å– error.message ä»¥åŠé”™è¯¯æ ˆ</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">&#123;  column: 2410,   line: 1100,   componentStack:       in p     &#x2F;&#x2F; ...  isComponentError: True,   sourceURL: ...&#125;</code></pre><p>å…¶æ¬¡æ˜¯é”™è¯¯å‘ç”Ÿçš„æ—¶é—´ / ç‰ˆæœ¬ä¿¡æ¯ / æœºå‹ ç­‰è¾…åŠ©ä¿¡æ¯</p><p>æœ€åæ˜¯ä¸šåŠ¡ç›¸å…³çš„ä¿¡æ¯ï¼Œé€šå¸¸åŒ…æ‹¬ ç”¨æˆ· / é¡µé¢è·¯å¾„</p><p>sentry ç®¡è¿™ä¸ªå« event ï¼Œå…·ä½“çš„å‚æ•°å¯ä»¥å‚è€ƒsentry çš„<a href="https://develop.sentry.dev/sdk/event-payloads/">å¼€å‘æ–‡æ¡£</a>ã€‚</p><p>é‚£ä¹ˆå½“æˆ‘ä»¬æ•´ç†å¥½æ‰€éœ€çš„ä¿¡æ¯å°±éœ€è¦ä¸ŠæŠ¥ä¸Šå»ï¼Œé¡ºå¸¦è¯´ä¸€ä¸‹å‰ç«¯å¸¸ç”¨çš„æ‰‹æ®µæ˜¯ç”¨ 1x1 åƒç´ çš„é€æ˜ gif å›¾ç‰‡ï¼Œä¹Ÿå« image beaconã€‚é€šè¿‡ new Image æ„é€ ä¸€ä¸ªå›¾ç‰‡è¯·æ±‚ï¼Œä¸»è¦åŸå› æ˜¯</p><pre><code>1. å¯¹æ¯” ajaxï¼Œä¸ä¼šæœ‰è·¨åŸŸé—®é¢˜1. å¯¹æ¯” js æ ‡ç­¾ï¼Œä¸é˜»å¡é¡µé¢åŠ è½½1. å¯¹æ¯” png / jpgï¼Œè¿™ç§å›¾ç‰‡ä½“ç§¯æœ€å°</code></pre></li><li><p>source mapï¼Œçº¿ä¸Šçš„ä»£ç éƒ½æ˜¯å‹ç¼©è¿‡çš„ï¼ŒæŠ¥é”™çš„ä¿¡æ¯å°±å¾ˆæ¨¡ç³Šï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦å€ŸåŠ© source map æ¥è¿˜åŸæºç çš„æŠ¥é”™ä½ç½®ã€‚rn ä¹Ÿæ˜¯æœ‰æä¾› source map çš„ï¼Œåœ¨æ‰§è¡Œ react-native bundle çš„æ—¶å€™æ·»åŠ å‚æ•° <code>--bundle-output [sourcemap-name].map</code> å³å¯è¾“å‡ºå¯¹åº”å¹³å°çš„ source mapï¼Œé€šè¿‡ä¸‹è¿°ä»£ç å³å¯å®šä½æºç æŠ¥é”™ä½ç½®</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">const sourceMap &#x3D; require(&#39;source-map&#39;)const fs &#x3D; require(&#39;fs-extra&#39;)&#x2F;&#x2F; è¯»å– source map ä¸º jsonconst rawSourceMapJsonData &#x3D; await fs.readJson(&#39;[sourcemap-name].map&#39;)const consumer &#x3D; await new sourceMap.SourceMapConsumer(rawSourceMapJsonData);&#x2F;&#x2F; line ä¸ column æŒ‡å‹ç¼©åçš„æŠ¥é”™ä½ç½®console.log(consumer.originalPositionFor(&#123; line, column &#125;));</code></pre><p>å½“ç„¶ sentry ä¹Ÿæä¾›äº† source map çš„é…ç½®ï¼Œè¿™å—è¿˜æ²¡å°è¯•ï¼Œå¯è‡ªè¡ŒæŸ¥çœ‹æ–‡æ¡£ <a href="https://docs.sentry.io/platforms/react-native/sourcemaps/">https://docs.sentry.io/platforms/react-native/sourcemaps/</a></p><p>ä¸è¿‡é—æ†¾çš„æ˜¯ component stack ä¼¼ä¹æ˜¯æ²¡æœ‰åŠæ³•è¿˜åŸå‡ºæŠ¥é”™æ‰€åœ¨ç»„ä»¶çš„ä½ç½®ï¼Œå‚è€ƒ <a href="https://github.com/facebook/create-react-app/issues/3753">https://github.com/facebook/create-react-app/issues/3753</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ReactNative </tag>
            
            <tag> å‰ç«¯å·¥ç¨‹åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äº Tree Shaking çš„æ¢ç´¢</title>
      <link href="/2022/01/27/%E5%85%B3%E4%BA%8E-Tree-Shaking-%E7%9A%84%E6%8E%A2%E7%B4%A2/"/>
      <url>/2022/01/27/%E5%85%B3%E4%BA%8E-Tree-Shaking-%E7%9A%84%E6%8E%A2%E7%B4%A2/</url>
      
        <content type="html"><![CDATA[<p>è¿‘æœŸé¡¹ç›®ç»„çš„ç»„ä»¶åº“éœ€è¦ç»´æŠ¤ï¼Œå…¶ä¸­æœ‰å…³äºç»„ä»¶æŒ‰éœ€åŠ è½½é‡‡ç”¨ antd ç»„ä»¶åº“çš„æ–¹æ¡ˆï¼Œæ˜¯é€šè¿‡ <a href="https://github.com/umijs">umijs</a>/<strong><a href="https://github.com/umijs/babel-plugin-import">babel-plugin-import</a></strong> æ¥å®ç°çš„ã€‚</p><p>è¿™ä¸ªæ–¹æ¡ˆå®é™…ä¸Šæ˜¯é€šè¿‡åˆ†æè¯­æ³•ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µå°†æ¨¡å—å¼•ç”¨è½¬æˆé€šè¿‡ç›¸å¯¹è·¯å¾„æ¥å®ç°çš„ã€‚å³</p><pre class="line-numbers language-none"><code class="language-none">import &#123; Button &#125; from &#39;antd&#39;;ReactDOM.render(&lt;Button&gt;xxxx&lt;&#x2F;Button&gt;);      â†“ â†“ â†“ â†“ â†“ â†“var _button &#x3D; require(&#39;antd&#x2F;lib&#x2F;button&#39;);ReactDOM.render(&lt;_button&gt;xxxx&lt;&#x2F;_button&gt;);</code></pre><p>ç„¶è€Œè¿™ä¸ªæ–¹æ¡ˆå®é™…ä¸Šæ—©åœ¨å¾ˆä¹…ä¹‹å‰å·²ç»è¢« antd å®˜æ–¹æŠ›å¼ƒäº†ï¼Œantd ç›®å‰çš„æ˜¯é€šè¿‡ tree shaking å®ç° <em>JS</em> éƒ¨åˆ†çš„æŒ‰éœ€åŠ è½½è€Œï¼Œ css æ–¹é¢åˆ™è®¤ä¸ºæ€§ä»·æ¯”ä¸é«˜ç­‰åŸå› æ²¡æœ‰é¢å¤–å¤„ç†ï¼Œç•¥æœ‰äº‰è®®ï¼Œè¯¦ç»†å¯ä»¥å‚è€ƒ <a href="https://github.com/ant-design/ant-design/issues/23988">https://github.com/ant-design/ant-design/issues/23988</a> è¿™ä¸ª issue é‡Œçš„ç›¸å…³è®¨è®ºã€‚</p><p>é‰´äº webpack æ–‡æ¡£é‡Œå…³äº <a href="https://webpack.docschina.org/guides/tree-shaking/">tree shaking</a> çš„ç¯‡ç« å†™çš„æ¯”è¾ƒæ™¦æ¶©ã€‚åœ¨æ—©äº›æ—¶å€™æœ‰åšè¿‡ä¸€äº›[æµ‹è¯•ä»¥åŠæ€»ç»“]( <a href="https://knighd.github.io/2021/05/27/å…³äº-webpack-çš„-tree-shaking/#more">å…³äº webpack çš„ tree shaking</a>)ï¼Œä½†å½“æ—¶çš„ç†è§£æ¯”è¾ƒä¸å¤Ÿåˆ°ä½ã€‚</p><p>æœ¬æ¬¡å€Ÿç€é‡æ–°æ¢³ç†ç»„ä»¶åº“çš„æœºä¼šï¼Œåœ¨è¿™ä¸ª test-webpack-tree-shaking-demo ä¸­å†æ¬¡æ›´ä¸ºå…¨é¢åœ°æµ‹è¯•å¹¶æ•´ç† webpack tree shaking ç›¸å…³å†…å®¹ï¼Œç›®å‰ä¸»è¦åº”ç”¨ webpack çš„ç‰ˆæœ¬ä»ç„¶å¤„äº webpack4ï¼Œå› æ­¤æœ¬é¡¹ç›®ä¹Ÿéƒ½æ˜¯åŸºäº webpack4ï¼Œå¦‚æœ‰ç†è§£ä¸åˆ°ä½çš„åœ°æ–¹è¿˜æœ›æŒ‡å‡ºæ¢è®¨ã€‚</p><a id="more"></a><p>webpack èƒ½æ ‡è¯†å‡º dead code çš„<strong>å‰æ</strong>æ˜¯ä½¿ç”¨ esm è§„èŒƒæ¥ç¼–å†™ä»£ç ï¼ˆ<a href="https://webpack.js.org/blog/2020-10-10-webpack-5-release/#commonjs-tree-shaking">åœ¨ webpack5 æ˜¯æ–°å¢äº†éƒ¨åˆ† commonjs çš„æ”¯æŒ</a>ï¼‰ã€‚</p><p>è€Œæ ‡è¯† dead code ä¸»è¦é€šè¿‡ä¸€ä¸‹ä¸‰ç§æ–¹å¼ï¼š</p><ol><li>é€šè¿‡ usedExports æ ‡è¯†</li><li>é€šè¿‡ sideEffects æ ‡è¯†</li><li>é€šè¿‡ /<em>#<strong>PURE</strong></em>/ æ ‡è¯†</li></ol><p>webpack æ ‡è¯†å‡º dead code ä¹‹åï¼Œå†é€šè¿‡ terser ç­‰å‹ç¼©å·¥å…·ï¼Œå°†è¿™äº›ä»£ç ç§»é™¤ï¼Œä»è€Œå®ç° tree shakingã€‚</p><p>å¯¹äºä¸Šè¿°ç»“è®ºçš„éªŒè¯ï¼Œä¸“é—¨å†™äº†ä¸ªæµ‹è¯•çš„é¡¹ç›® <a href="https://github.com/KNighD/test-webpack-tree-shaking-demoï¼Œè¯·ç§»æ­¥">https://github.com/KNighD/test-webpack-tree-shaking-demoï¼Œè¯·ç§»æ­¥</a> GitHub ç»§ç»­é˜…è¯»ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‰ç«¯å·¥ç¨‹åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>React Class ä¸­å³å°†æ¶ˆå¤±çš„ç”Ÿå‘½å‘¨æœŸ</title>
      <link href="/2022/01/18/React-Class-%E4%B8%AD%E5%8D%B3%E5%B0%86%E6%B6%88%E5%A4%B1%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"/>
      <url>/2022/01/18/React-Class-%E4%B8%AD%E5%8D%B3%E5%B0%86%E6%B6%88%E5%A4%B1%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/</url>
      
        <content type="html"><![CDATA[<p>è¿™ä¸ªä¸»é¢˜æ˜¯æ—©å‰åœ¨å…¬å¸åˆ†äº«çš„ï¼Œä¸»è¦è®²çš„æ˜¯ React Class Component ä¸­çš„ç”Ÿå‘½å‘¨æœŸçš„å˜è¿ã€‚ä½†æ˜¯ä¸€ç›´æ²¡æœ‰æ—¶é—´æ•´ç†ï¼Œè¿‘æ¥å·¥ä½œèŠ‚å¥é€æ¸æ¢å¤ç¨³å®šï¼Œå› æ­¤è…¾å‡ºæ—¶é—´æ¥æ•´ç†ä¸€ä¸‹ã€‚è¿™ä¸ªæœŸé—´çœ‹åˆ° React Conf 2021 ä¸Šé»„ç„è¿˜åˆ†äº«äº† React Forgetï¼Œæœ‰ä¸€äº›æƒ³æ³•å¯èƒ½å’Œå½“æ—¶åˆ†äº«çš„æ—¶å€™æœ‰æ‰€å‡ºå…¥ï¼Œä½†åŸºæœ¬ä¸Šè¿˜æ˜¯ä¸€è‡´çš„ã€‚</p><p>åˆ†äº«è¿™ä¸ªä¸»é¢˜çš„èƒŒæ™¯æ˜¯å› ä¸ºå½“æ—¶æœ‰ä¸å°‘æ–°æ¥çš„å°ä¼™ä¼´æ˜¯ä» vue åˆšè½¬å…¥ react çš„ï¼Œä¸€ä¸Šæ¥å°±æ¥è§¦çš„æ˜¯ hooksï¼Œåè€Œå¯¹ react ä¼ ç»Ÿçš„ Class Components ä¸ç†Ÿæ‚‰ï¼Œé‘è®ºç”Ÿå‘½å‘¨æœŸçš„å˜æ›´å†å²ï¼Œå› æ­¤å°±å½“åšä¸€ä¸ªç®€å•çš„ç§‘æ™®ã€‚</p><a id="more"></a><h4 id="å¼•å­"><a href="#å¼•å­" class="headerlink" title="å¼•å­"></a>å¼•å­</h4><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">function App() &#123;const [state, setState] &#x3D; useState(false)  const otherState &#x3D; (() &#x3D;&gt; &#123;    &#x2F;&#x2F; ....some compute  &#125;)()  return &lt;button onClick&#x3D;&#123;() &#x3D;&gt; setState(true)&#125;&gt;    click &#123;state&#125; &#123;otherState&#125;  &lt;&#x2F;button&gt;&#125;</code></pre><p>è¿™é‡Œç‚¹å‡»æŒ‰é’®ï¼Œæƒ³è¦é¿å… otherState é‡æ–°è®¡ç®—ï¼Œå¤§å®¶éƒ½çŸ¥é“å¯ä»¥é€šè¿‡ useMemo æ¥åŒ…è£¹ä¸€ä¸‹å³å¯ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const otherState &#x3D; useMemo(() &#x3D;&gt; &#123;    &#x2F;&#x2F; ....some compute  &#125;, []);</code></pre><p>å½“æ—¶åœ¨åˆ†äº«çš„æ—¶å€™æŠ›å‡ºçš„ä¸€ä¸ªé—®é¢˜ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆ react ä¸å°† memo çš„è¡Œä¸ºä½œä¸ºé»˜è®¤çš„è¡Œä¸ºï¼Ÿ</p><p>é‚£æ—¶å€™æˆ‘è¯´çš„æ˜¯å› ä¸º memo å®é™…ä¸Šæ˜¯æœ‰æˆæœ¬çš„ï¼Œä¸åº”æ»¥ç”¨ï¼ˆä¸è¿‡åæ¥ React Forget è¡¨æ˜ä¼¼ä¹å®˜æ–¹ä¹Ÿæƒ³å°† memo ä½œä¸ºé»˜è®¤çš„è¡Œä¸ºï¼Œæ‰“è„¸ã€‚ã€‚ã€‚ï¼‰ä¸è¿‡ memo å®é™…ä¸Šæ˜¯æœ‰æˆæœ¬çš„è¿™ä¸ªç¡®å®æ˜¯æ²¡é—®é¢˜çš„ï¼Œæˆ‘ä»¬éœ€è¦éå† memo çš„ä¾èµ–ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰å˜æ›´ç­‰ç­‰ã€‚</p><p>æŒ‰é»„ç„çš„è¯´æ³•å°±æ˜¯å¼€å‘ä½“éªŒå’Œç”¨æˆ·ä½“éªŒåœ¨å½“å‰æœ‰æ—¶å€™ä¸èƒ½å…¼é¡¾ã€‚</p><p>ä½†å…¶å®ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒæŸäº›è¯­å¥çš„é‡å¤æ‰§è¡Œå¼€é”€å¹¶ä¸ä¼šå¾ˆå¤§ï¼Œæˆ‘ä»¬çš„é¡µé¢å‘ç”Ÿä¸¥é‡å¡é¡¿ï¼Œé€šå¸¸æ˜¯ dom å±‚é¢ä¸Šçš„åŸå› ã€‚æˆ‘å°†é€šè¿‡ React ç”Ÿå‘½å‘¨æœŸçš„å˜æ›´æ¥è®ºè¯è¿™ä¸€ç‚¹ï¼Œé‚£ä¹ˆå¼€å§‹æˆ‘ä»Šå¤©çš„åˆ†äº«ã€‚</p><h4 id="ç®€å•å›é¡¾ç”Ÿå‘½å‘¨æœŸ"><a href="#ç®€å•å›é¡¾ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç®€å•å›é¡¾ç”Ÿå‘½å‘¨æœŸ"></a>ç®€å•å›é¡¾ç”Ÿå‘½å‘¨æœŸ</h4><p>ç›®å‰æˆ‘ä»¬ä½¿ç”¨çš„ React åªè¦æ˜¯ 17ï¼Œè¿‡äºè¿œå¤çš„ç‰ˆæœ¬æš‚ä¸”ä¸è°ˆï¼Œæˆ‘ä»¬ä»¥ 16.3 è¿™ä¸ªé‡è¦çš„åˆ†æ°´å²­è®²èµ·ã€‚</p><p>æˆ‘å°è¯•ç”»äº†å¼ æµç¨‹å›¾ï¼Œå®åœ¨ç”»çš„ä¸å¥½çœ‹ï¼Œå°±ç›´æ¥åœ¨æ˜é‡‘ä¸Šæ‰¾äº†å¼ å›¾ï¼Œåœ¨ 16.3 ä¹‹å‰</p><p><img src="https://s2.loli.net/2022/01/18/BM7UgxERPJ5VyKX.jpg" alt="a27fy-pvcrd.jpeg"></p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ <a href="https://codesandbox.io/s/v16-1-tik5l?file=/src/App.js">https://codesandbox.io/s/v16-1-tik5l?file=/src/App.js</a></p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæŒ‚è½½æœŸé—´çš„ç”Ÿå‘½å‘¨æœŸè¾“å‡º log å¦‚ä¸‹</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">parent will mount parent rendering child will mount child rendering child did mount parent did mount</code></pre><p>éšåæˆ‘ä»¬ç‚¹å‡»æŒ‰é’®æ”¹å˜çˆ¶ç»„ä»¶çŠ¶æ€ï¼Œlog è¾“å‡ºå¦‚ä¸‹</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">parent should update parent will update parent rendering child will receive props child should update child will update child rendering child did update parent did update </code></pre><p>åœ¨ 16.3 æ—¶,   å¦‚æœæˆ‘ä»¬å¼€å¯äº†ä¸¥æ ¼æ¨¡å¼ï¼Œä¾ç„¶æ‰§è¡Œä¸Šè¿°ä»£ç  <a href="https://codesandbox.io/s/v16-3-1-2ixbx?file=/src/index.jsï¼Œä½ ä¼šå‘ç°ç°åœ¨è¾“å‡ºçš„æ—¥å¿—ä¸­å¤šäº†ä¸€äº›è­¦å‘Š">https://codesandbox.io/s/v16-3-1-2ixbx?file=/src/index.jsï¼Œä½ ä¼šå‘ç°ç°åœ¨è¾“å‡ºçš„æ—¥å¿—ä¸­å¤šäº†ä¸€äº›è­¦å‘Š</a></p><pre class="line-numbers language-none"><code class="language-none">Warning: Unsafe lifecycle methods were found within a strict-mode tree:componentWillMount: Please update the following components to use componentDidMount instead: Child, ParentcomponentWillReceiveProps: Please update the following components to use static getDerivedStateFromProps instead: Child, ParentcomponentWillUpdate: Please update the following components to use componentDidUpdate instead: Child, ParentLearn more about this warning here:https:&#x2F;&#x2F;fb.me&#x2F;react-strict-mode-warnings</code></pre><p>æ„æ€å°±æ˜¯è¯´ componentWillMount / componentWillReceiveProps / componentWillUpdate è¿™ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸæ˜¯ä¸å®‰å…¨çš„ï¼Œè¦æ›¿æ¢æˆåˆ«çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><p>ä¸ºä»€ä¹ˆè¯´è¿™äº›ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸å®‰å…¨çš„å‘¢ï¼ŸåŒæ—¶æœ‰çš„åŒå­¦å¯èƒ½å‘ç° parent redering å’Œ child rendering è¾“å‡ºäº†æ•°æ¬¡ï¼Œè¿™æ˜¯ä»€ä¹ˆï¼Ÿè¿™é‡Œæš‚ä¸”æŒ‰ä¸‹ä¸è¡¨ã€‚</p><p>é‚£ä¹ˆ 16.3 çš„ç”Ÿå‘½å‘¨æœŸæ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ<img src="https://s2.loli.net/2022/01/18/9nfPCxGrVyZhKE8.jpg" alt="ç”Ÿå‘½å‘¨æœŸ2.jpg"></p><p>è¿™é‡Œæ³¨æ„ getDerivedStateFromProps æ˜¯é™æ€çš„æ–¹æ³•ï¼Œè¿™ä¹ˆè®¾è®¡çš„ç”¨æ„æ˜¯ä»€ä¹ˆï¼Ÿè¿™é‡ŒåŒæ ·æŒ‰ä¸‹ä¸è¡¨ã€‚</p><p>ä¾‹å­ <a href="https://codesandbox.io/s/v16-3-2-48ire?file=/src/Child.js">https://codesandbox.io/s/v16-3-2-48ire?file=/src/Child.js</a> log è¾“å‡ºå¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">parent get derived state from props and this&#x3D; nullparent rendering child get derived state from props and this&#x3D; nullchild rendering child did mount parent did mount </code></pre><p>ç‚¹å‡»å˜æ›´çˆ¶ç»„ä»¶çŠ¶æ€åè¾“å‡º</p><pre class="line-numbers language-none"><code class="language-none">parent should update parent rendering child get derived state from props and this&#x3D; nullchild should updatechild rendering child get snapshot before update parent get snapshot before update child did update parent did update </code></pre><p>åŒæ ·ï¼Œæˆ‘ä»¬å‘ç° getDerivedStateFromProps ä»¥åŠ rendering å¯èƒ½è¾“å‡ºå¤šæ¬¡</p><p>é‚£ä¹ˆ 16.3 ä¹‹åçš„ç”Ÿå‘½å‘¨æœŸæ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</p><p><img src="https://s2.loli.net/2022/01/18/uLlC6Sjfks1iyKZ.jpg" alt="ç”Ÿå‘½å‘¨æœŸ3.jpg"></p><p>å¯ä»¥å‘ç°æ— éæ˜¯ç°åœ¨ getDerivedStateFromProps ä¹Ÿå¯ä»¥é€šè¿‡ setState å’Œ forceUpdate è§¦å‘äº†ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°ã€‚</p><p>æ•´ç†ä¸€ä¸‹ï¼Œè‡³æ­¤æˆ‘ä»¬ä¸€å…±æœ‰ä¼šæœ‰ä»¥ä¸‹å‡ ä¸ªç–‘é—®ï¼š</p><ol><li>ä¸ºä»€ä¹ˆè¦ç§»é™¤ componentWillMount / componentWillReceiveProps /componentWillUpdateï¼Ÿä¸ºä»€ä¹ˆè¿™äº›ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸å®‰å…¨çš„ï¼Ÿ</li><li>ä¸ºä»€ä¹ˆ redering  / getDerivedStateFromProps  ä¼šè¾“å‡ºå¤šæ¬¡</li><li>ä¸ºä»€ä¹ˆ getDerivedStateFromProps  è¦è®¾è®¡æˆé™æ€çš„æ–¹æ³•ï¼Œè€Œ getSnapshotBeforeUpdate åˆ™ä¸æ˜¯é™æ€çš„æ–¹æ³•</li></ol><p>å…¶å®ç­”æ¡ˆéƒ½åœ¨ä¸Šé¢çš„ç”Ÿå‘½å‘¨æœŸå›¾ä¸­ã€‚</p><h4 id="Fiber"><a href="#Fiber" class="headerlink" title="Fiber"></a>Fiber</h4><p>é¦–å…ˆè®©æˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹React ä¸­çš„ Fiber</p><p>ä» 16.3 ä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸï¼Œæˆ‘ä»¬ä¸éš¾æƒ³åˆ° react çš„æ›´æ–°æœºåˆ¶ã€‚</p><p><img src="https://s2.loli.net/2022/01/18/coKdy3PWrxhsNlI.png" alt="React æ›´æ–°é¡ºåº.jpg"></p><p>è¿™æ˜¯ä¸€ä¸ªç±»ä¼¼æ·±åº¦éå†çš„è¿‡ç¨‹ï¼Œå½“è¿™é¢—æ ‘è¶Šå‘åºå¤§ï¼Œåˆ™è¿™ä¸ªè°ƒç”¨æ ˆå°±è¶Šæ·±ã€‚åªæœ‰æœ€åº•å±‚çš„è°ƒç”¨è¿”å›ï¼Œæ•´ä¸ªæ¸²æŸ“çš„è¿‡ç¨‹æ‰é€æ­¥è¿”å›ã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹ä¸å¯è¢«æ‰“æ–­ï¼Œå³å¤§é‡çš„åŒæ­¥è®¡ç®—é˜»å¡äº†æµè§ˆå™¨ï¼Œå¯¼è‡´æµè§ˆå™¨æ— æ³•å¤„ç†åˆ«çš„ä»»ä½•äº‹åŠ¡ï¼Œæ¯”å¦‚ç”¨æˆ·çš„äº¤äº’å°†æ— æ³•åŠæ—¶å“åº”ï¼Œç»™ç”¨æˆ·çš„ä½“éªŒæ˜¯é¡µé¢å¡é¡¿æˆ–å¡æ­»ã€‚</p><p>è¿™ç§æ›´æ–°æœºåˆ¶ï¼Œè¢«ç§°ä¸º Stack Reconciler</p><p><img src="https://s2.loli.net/2022/01/18/otvWZTIbpDVM7ry.png" alt="Stack.png"></p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒReact æå‡ºäº†æ–°çš„æ¶æ„ï¼Œ</p><ol><li>å°†æ›´æ–°åˆ‡åˆ†æˆå¤šä¸ªä»»åŠ¡æ¯æ¬¡æ‰§è¡Œå®Œä¸€æ¬¡å°ä»»åŠ¡å°±å°†æ§åˆ¶æƒäº¤ç»™æµè§ˆå™¨ï¼Œåœ¨æµè§ˆå™¨ç©ºé—²çš„æ—¶é—´é‡Œæ‰§è¡Œä¹‹å‰æœªå®Œæˆçš„ä»»åŠ¡ã€‚</li><li>ä»»åŠ¡æœ‰ä¼˜å…ˆçº§çš„åŒºåˆ†ï¼Œé«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡å¯ä»¥æ‰“æ–­ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œå¦‚ç”¨æˆ·é”®ç›˜è¾“å…¥è¿™æ ·çš„ä»»åŠ¡å°±ä¼šæ‰“æ–­ Diff è¿™æ ·çš„ä»»åŠ¡ï¼Œå…·ä½“çš„åˆ†çº§æ–¹å¼å°±ä¸åœ¨è¿™é‡Œå±•å¼€ã€‚</li></ol><p><img src="https://s2.loli.net/2022/01/18/wYAT7zdvE5mHJVl.png" alt="Fiber.png"></p><p>æ‰“æ–­çš„ä»»åŠ¡é‡æ–°æ‰§è¡Œä¸€è¾¹è¿˜æ˜¯ç»§ç»­ä¸Šæ¬¡çš„æ–­ç‚¹å‘¢ï¼Ÿå®é™…ä¸Š React æ˜¯è®©è¿™äº›è¢«ä¸­æ–­çš„ä»»åŠ¡é‡æ–°æ‰§è¡Œ</p><p>é‚£ä¹ˆæ˜¯å¦æ‰€æœ‰çš„ä»»åŠ¡éƒ½å¯ä»¥è¢«æ‰“æ–­ï¼ŸReact è®¤ä¸ºå¯ä»¥è¢«ç”¨æˆ·æ„ŸçŸ¥çš„ä»»åŠ¡æ˜¯ä¸å¯è¢«æ‰“æ–­çš„ï¼Œè€Œç”¨æˆ·æ„ŸçŸ¥ä¸åˆ°çš„ä»»åŠ¡åˆ™å¯è¢«æ‰“æ–­ã€‚</p><p>è®©æˆ‘ä»¬å›åˆ°ä¸Šé¢ç”Ÿå‘½å‘¨æœŸçš„è¿™å¼ å›¾</p><p>React å°†ç”Ÿå‘½å‘¨æœŸåˆ†ä¸º Render ä¸ Commit é˜¶æ®µï¼ŒRender é˜¶æ®µçš„ä»»åŠ¡å‡å¯æ‰“æ–­ï¼Œè€Œ Commit é˜¶æ®µåˆ™ä¸å¯ä»¥æ‰“æ–­ã€‚</p><p>ç”±æ­¤æˆ‘ä»¬æ¥å›ç­”ä¸Šè¿°å‡ ä¸ªé—®é¢˜</p><ol><li><p>ä¸ºä»€ä¹ˆç§»é™¤ componentWillMount / componentWillReceiveProps /componentWillUpdateï¼Œä¸ºä»€ä¹ˆä¸å®‰å…¨ï¼Ÿ</p><p>å› ä¸ºè¿™äº›ç”Ÿå‘½å‘¨æœŸå±äº render é˜¶æ®µï¼Œä½†ä»–ä»¬æ˜¯ä¸çº¯çš„ï¼Œæ‰“æ–­åé‡æ–°æ‰§è¡Œï¼Œä¼šé€ æˆä¸€äº› bugï¼Œä¸¾ä¸ªä¾‹å­ï¼šåœ¨ componentWillMount  å‘é€è¯·æ±‚ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½å°±ä¼šå¯¼è‡´è¯·æ±‚ä¸¤æ¬¡ã€‚</p></li><li><p>ä¸ºä»€ä¹ˆ redering / getDerivedStateFromProps ä¼šè¾“å‡ºå¤šæ¬¡ï¼Ÿ</p><p>å› ä¸ºè¿™äº›ç”Ÿå‘½å‘¨æœŸå¯è¢«æ‰“æ–­ï¼Œä¼šè¢«é‡æ–°æ‰§è¡Œ</p></li><li><p>ä¸ºä»€ä¹ˆ getDerivedStateFromProps è¦è®¾è®¡æˆé™æ€çš„æ–¹æ³•ï¼Œè€Œ getSnapshotBeforeUpdate åˆ™ä¸æ˜¯é™æ€çš„æ–¹æ³•</p><p>å› ä¸º getDerivedStateFromProps åœ¨ render é˜¶æ®µï¼Œéœ€è¦å°½é‡ä¿è¯å®ƒæ˜¯çº¯çš„ï¼Œé™æ€æ–¹æ³•æ²¡æœ‰ thisï¼Œä¹Ÿå°±ä¸ä¼šæœ‰å¦‚ this.setState è¿™æ ·çš„æ“ä½œäº†ï¼Œè€Œ getSnapshotBeforeUpdate åˆ™æ˜¯åœ¨ commit é˜¶æ®µï¼Œä¸ä¼šè¢«æ‰“æ–­é‡å¯ï¼Œä¸”éœ€è¦æä¾›ä¸€äº›å¯ä»¥è·å–åˆ° dom çš„æ–¹æ³•ï¼Œå¦‚ this.ref.xxxï¼Œæ‰€ä»¥æ— éœ€è®¾è®¡æˆé™æ€æ–¹æ³•ã€‚</p></li></ol><p>####ç»“å°¾</p><p>è‡³æ­¤é€šè¿‡ react fiber çš„è®¾è®¡éªŒè¯äº†å¼€ç¯‡æå‡ºçš„è§‚ç‚¹ï¼ŒReact å…¶å®ä¹Ÿä¸è®¤ä¸ºé‡æ–°æ‰§è¡Œä»£ç ä¼šæµªè´¹å¾ˆå¤šæ€§èƒ½ï¼Œç”šè‡³å…è®¸å¤šæ¬¡æ‰“æ–­é‡å¯ï¼Œå¯¹ä¸å‰ç«¯è€Œè¨€ï¼Œæ›´å¤šçš„ç“¶é¢ˆå…¶å®æ˜¯åœ¨ dom çš„æ¸²æŸ“ä¸Šï¼Œè€Œè¿™ä¸ªç¯èŠ‚ React ä¹Ÿç¡®å®ä¸å…è®¸å¤šæ¬¡æ‰§è¡Œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> react </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello 2022</title>
      <link href="/2022/01/02/Hello-2022/"/>
      <url>/2022/01/02/Hello-2022/</url>
      
        <content type="html"><![CDATA[<p>2021 çš„ç»å†çš„äº‹æƒ…å¤ªå¤šï¼Œç•™ä¸‹çš„é—æ†¾å¤ªå¤šï¼Œæ˜¯æ—¶å€™æ€»ç»“ä¸€ä¸‹ï¼Œå†ç«‹ä¸€ä¸‹ 2022 Flag</p><a id="more"></a><h3 id="æŠ€æœ¯æ€»ç»“"><a href="#æŠ€æœ¯æ€»ç»“" class="headerlink" title="æŠ€æœ¯æ€»ç»“"></a>æŠ€æœ¯æ€»ç»“</h3><h4 id="å°ç¨‹åº"><a href="#å°ç¨‹åº" class="headerlink" title="å°ç¨‹åº"></a>å°ç¨‹åº</h4><p>ä¸ŠåŠå¹´å°† RN é¡¹ç›®è¿ç§»åˆ°å°ç¨‹åºä¸Šï¼Œè¯´èµ·æ¥ç®—æ˜¯æˆ‘ä¸ªäººåŒæ—¶ä¹Ÿæ˜¯å…¬å¸ç¬¬ä¸€ä¸ªæ¯”è¾ƒå¤§å‹çš„å°ç¨‹åºäº†ã€‚åœ¨å®ç°çš„è¿‡ç¨‹ä¸­ä¹Ÿæ˜¯å°è¯•äº†ä¸€äº›æ–°æŠ€æœ¯ï¼Œä¹Ÿè¸©äº†ä¸€äº›å‘ã€‚</p><p>æœ¬æ¥æ˜¯æ‰“ç®—æœ‰æ—¶é—´äº§å‡ºè„šæ‰‹æ¶çš„ï¼Œå¯æƒœæœ€åå› ä¸ºä¸å¯æŠ—åŠ›ï¼ˆé¡¹ç›®è½¬äº¤ç»™åˆ«çš„éƒ¨é—¨ï¼‰è€Œè…°æ–©äº†ã€‚</p><h4 id="monorepo"><a href="#monorepo" class="headerlink" title="monorepo"></a>monorepo</h4><p>èƒŒæ™¯</p><p>ç”µå•†åœ¨å…¬å¸çš„ä¸åŒ APP / ä¸šåŠ¡ç»„å†…ç”±äºå„è‡ªçš„ä¸šåŠ¡å­˜åœ¨ä¸€äº›é€»è¾‘ / æ ·å¼ä¸Šçš„å·®å¼‚ã€‚</p><p>è§£å†³æ–¹æ¡ˆ</p><ol><li>æ–¹æ¡ˆä¸€ï¼šç”¨ç­–ç•¥æ¨¡å¼ï¼Œç»„ä»¶å†…æ ¹æ®ä¸åŒç¯å¢ƒï¼Œå†™å„è‡ªçš„é€»è¾‘ã€‚è¿™ä¸ªæ–¹æ¡ˆçš„é—®é¢˜åœ¨äºä¸åŒä¸šåŠ¡çš„åŒå­¦å¯èƒ½ä¼šä¸€èµ·ç»´æŠ¤åŒä¸€ä¸ªé¡¹ç›®ï¼Œä¸ä»…ä»…æ˜¯åä½œä¸Šä¼šæœ‰é—®é¢˜ï¼Œå¯èƒ½ä¼šç»å¸¸æœ‰å†²çªï¼Œä¸”ç»´æŠ¤ä¸æ˜“</li><li>æ–¹æ¡ˆäºŒï¼šä»åŸé¡¹ç›® fork å‡ºæ¥ï¼Œå„è‡ªç»´æŠ¤ä»£ç ä»“åº“ã€‚è¿™ä¸ªæ–¹æ¡ˆçš„é—®é¢˜åœ¨äºä¸€æ—¦æœ‰å…±åŒçš„ä¿®æ”¹ç‚¹ï¼Œéœ€è¦å„ä¸ªä¸šåŠ¡ç»„åŒå­¦é‡å¤å®ç°</li><li>æ–¹æ¡ˆä¸‰ï¼šæˆ‘è€ƒè™‘ä½¿ç”¨ lerna ç»´æŠ¤ï¼Œæ‰€æœ‰çš„ä¸šåŠ¡éƒ½åœ¨ä¸€ä¸ªé¡¹ç›®ä»“åº“ä¸­ï¼Œå¹¶ä¸”å°†å…¬å…±ç»„ä»¶æŠ½å‡ºæ¥å•ç‹¬ä½œä¸€ä¸ªç»„ä»¶åº“ã€‚ç”±æ­¤å¯ä»¥è§£å†³ä¸Šè¿°ä¸¤ä¸ªæ–¹æ¡ˆçš„é—®é¢˜</li></ol><p>ç†æƒ³å¾ˆç¾å¥½ï¼Œç°å®å¾ˆæ®‹é…·ã€‚åœ¨å®ç°çš„è¿‡ç¨‹ä¸­ä¹Ÿé‡åˆ° rn ç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡´æ— æ³•å¯åŠ¨ ç­‰ç­‰é—®é¢˜ï¼Œä½†æœ€ç»ˆç®—æ˜¯è§£å†³æ‰äº†ã€‚</p><p>å¯æƒœæœ€åè¿˜æ˜¯å› ä¸ºä¸å¯æŠ—åŠ›ï¼ˆé¡¹ç›®è½¬äº¤ç»™åˆ«çš„éƒ¨é—¨ï¼‰è€Œè…°æ–©äº†ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œæ–°é¡¹ç›®ç»„çš„ UI æ¡†æ¶æ˜¯ç”¨ dumi æ­å»ºçš„ï¼Œä¹Ÿé‡‡ç”¨ lerna æ¥ç®¡ç†ç»„ä»¶åº“ï¼Œè€ŒåŒæ ·ä½¿ç”¨äº† dumi çš„ä¸šåŠ¡ç»„ä»¶åº“è¿˜åœ¨èµ·æ­¥ä¸­ï¼Œåˆšå¥½å¯ä»¥ç”¨è¿™ä¸ªæœºä¼šæ¥è½åœ°ã€‚</p><h4 id="å¾®å‰ç«¯"><a href="#å¾®å‰ç«¯" class="headerlink" title="å¾®å‰ç«¯"></a>å¾®å‰ç«¯</h4><p>æƒ³å°è¯•å¾®å‰ç«¯å·²ç»å¾ˆä¹…äº†ï¼Œä»…åœ¨ä¸€ä¸ªæ–°åå°é¡¹ç›®ä¸­åŠ å…¥è¿‡ qiankun ï¼Œæœ¬ä»¥ä¸ºå¯ä»¥ç”¨çš„ä¸Šï¼Œå¯æƒœåæ¥å‘ç°æ²¡æœ‰é€‚ç”¨çš„åœºæ™¯ï¼Œå°±ç§»é™¤æ‰äº†ï¼Œç•¥å¾®é—æ†¾ã€‚</p><p>ä¸è¿‡åœ¨ç°åœ¨é¡¹ç›®ç»„çš„é¡¹ç›®ä¸­å€’æ˜¯æœ‰åŒå­¦ä½¿ç”¨äº†è¿™ä¸ªæŠ€æœ¯ï¼Œå°†æ¥åº”è¯¥è¿˜æ˜¯æœ‰æœºä¼šå»ä½¿ç”¨çš„ã€‚</p><h4 id="vite"><a href="#vite" class="headerlink" title="vite"></a>vite</h4><p>åœ¨ä¸€äº›é¡¹ç›®ä¸­å°è¯•å»ä½¿ç”¨äº†ä¸‹ï¼Œbundless çš„å¼€å‘æ¨¡å¼å¯åŠ¨é€Ÿåº¦ç¡®å®æ¯” webpack å¿«äº†ä¸å°‘ã€‚ä¸è¿‡æœ‰åŒå­¦åé¦ˆåœ¨æŸäº›æœºå‹ä¸Šä¼šæœ‰æ‰“ä¸å¼€çš„æƒ…å†µï¼Œè¿™ä¸ªæˆ‘è‡ªå·±å€’æ˜¯æ²¡æœ‰é‡åˆ°è¿‡ï¼Œå°†æ¥å‰ç«¯æ„å»ºæ–¹æ¡ˆåˆ°åº•ä¼šæ˜¯æ€ä¹ˆæ ·ä¸€ä¸ªè¶‹åŠ¿å‘¢ï¼Ÿ</p><h4 id="Rust"><a href="#Rust" class="headerlink" title="Rust"></a>Rust</h4><p>å‰ç«¯ä¸€äº›å·¥å…·é“¾æ­£åœ¨é€æ­¥ç”¨ rust é‡å†™ï¼Œè¿™ä¹Ÿå¼•èµ·äº†æˆ‘çš„å…´è¶£ï¼Œæ‰“ç®—äº†è§£ä¸‹è¿™é—¨è¯­è¨€ã€‚</p><p>è·Ÿç€ rust æ–‡æ¡£å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘å‘ç° rust å¸å–äº†å¾ˆå¤šè¯­è¨€çš„ä¼˜ç‚¹ã€‚æ¯”å¦‚ç›¸å¯¹äº js è€Œè¨€ï¼Œå¯¹å¼‚å¸¸çš„å¤„ç†ï¼Œä¸æ˜¯ä½¿ç”¨ try catch è¿™æ ·ï¼Œè€Œæ˜¯ match ï¼Œè¿™ç‚¹ï¼ˆç¢äºçœ¼ç•Œï¼‰æˆ‘ç¡®å®æœ‰è¢«æƒŠè‰³åˆ°ã€‚åˆæ¯”å¦‚è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£è¿™æ ·çš„è®¾è®¡ï¼Œæˆ‘è§‰å¾—å¯¹å¼€å‘è€…è€Œè¨€ä½“éªŒä¹Ÿæ˜¯éå¸¸å¥½çš„ã€‚</p><p>ä¸è¿‡ä¸Šæ‰‹ä¸Šç¡®å®æœ‰éš¾åº¦ï¼Œç‰¹åˆ«æ˜¯æ‰€æœ‰æƒï¼Œæˆ‘å¸¸å¸¸é™·å…¥æ˜¯å¦éœ€è¦åŠ ä¸ª &amp; çš„ç–‘é—®ä¸­ï¼ŒçŸ¥ä¹ä¸Šç§°ä¹‹ä¸º <em>&amp; é…å¹³</em> æˆ‘è§‰å¾—é¢‡ä¸ºæ°å½“ã€‚</p><h4 id="React-åŸç†"><a href="#React-åŸç†" class="headerlink" title="React åŸç†"></a>React åŸç†</h4><p>2021 è¿˜åœ¨å•ƒ React åŸç†ï¼Œå¹¶ä¸”è¿˜æœªå•ƒå®Œï¼Œæ¯æ¬¡é‡æ–°å•ƒéƒ½æœ‰æ–°çš„æ„Ÿæ‚Ÿï¼Œæœ‰æ—¶å€™åœ¨å†™ä¸šåŠ¡çš„æ—¶å€™ä¼šçªç„¶æ‚Ÿåˆ°ï¼ŒåŸæ¥ react è¿™ä¸ªåœ°æ–¹æ˜¯å¦‚æ­¤å¦‚æ­¤ï¼Œè¿™èˆ¬è¿™èˆ¬ï½æƒ³æ¥è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ¼«é•¿çš„è¿‡ç¨‹ï¼Œæ¬²é€Ÿåˆ™ä¸è¾¾ã€‚åæ­£ä¸å½±å“å¹³æ—¶çš„ä¸šåŠ¡å¼€å‘ï¼Œåè€Œèƒ½æ²‰ä¸‹å¿ƒæ¥ä»”ç»†ç¢ç£¨ã€‚</p><h4 id="æŠ€æœ¯åˆ†äº«"><a href="#æŠ€æœ¯åˆ†äº«" class="headerlink" title="æŠ€æœ¯åˆ†äº«"></a>æŠ€æœ¯åˆ†äº«</h4><p>ä»Šå¹´åœ¨å…¬å¸è¿›è¡Œäº†ä¸¤æ¬¡åˆ†äº«ï¼Œåˆ†åˆ«æ˜¯ å°ç¨‹åºçš„å·¥ç¨‹å®è·µä»¥åŠ React å³å°†å–æ¶ˆçš„ç”Ÿå‘½å‘¨æœŸ è¿™ä¸¤ä¸ªè¯é¢˜ï¼Œæ€»ä½“ä¸Šæ¥è¯´è¾“å‡ºé¢‘ç‡ä¸Šæ˜¯ä¸å¤ªå¤Ÿçš„ã€‚</p><h3 id="ç»å†"><a href="#ç»å†" class="headerlink" title="ç»å†"></a>ç»å†</h3><p>ä»Šå¹´ç»å†äº†ä¸å°‘äº‹æƒ…ã€‚å…ˆæ˜¯ç–¯ç‹‚æ‰©å¼ ï¼Œé¢è¯•äº†ä¸å°‘å‰ç«¯ï¼Œå‘ç°å¾ˆå¤§æ¯”ä¾‹çš„å‰ç«¯éƒ½ä½¿ç”¨çš„ vueï¼Œè€Œ react å®é™…ä¸Šæ˜¯å¾ˆå°‘çš„ã€‚æ¥ç€æ˜¯å¸¦ç€æ–°äººåšäº†ç”µå•†å°ç¨‹åºè¿ç§»ã€‚æ¥ç€åšäº†ä¸€å¹´å¤šçš„é¡¹ç›®åˆç§»äº¤åˆ°åˆ«çš„å›¢é˜Ÿï¼Œå†æ˜¯ç»„ç»‡æ¶æ„è°ƒæ•´ï¼Œç»§è€Œè¢«åˆ†åˆ°äº†æ–°çš„ç»„ã€‚</p><p>åœ¨æ–°çš„ç»„é‡Œï¼Œæ‰¿è’™ leader å…³ç…§ï¼Œè®©æˆ‘ç®¡ç†åå‡ ä¸ªäººçš„å‰ç«¯å›¢é˜Ÿï¼Œä¸èƒœæƒ¶æã€‚ä»é›¶å¯åŠ¨äº†ä¸€ä¸ªåŒ»è¯ç›¸å…³çš„é¡¹ç›®ï¼ŒæœŸé—´ç®¡ç†çš„äº‹é¡¹å¤šä¸”ç¹çï¼Œä¸è¿‡äºä¸ªäººè€Œè¨€ç¡®å®æ˜¯ä¸€ä¸ªä¸å°çš„æˆé•¿ï¼Œå¯ä»¥ç«™åœ¨æ›´é«˜çš„è§’åº¦å»çœ‹é—®é¢˜ã€‚</p><p>å¯æƒœå¥½æ™¯ä¸é•¿ï¼Œæ¥ç€åˆæ˜¯è£å‘˜é£æ³¢ï¼Œè¿™ä¹ˆå‡ å‘¨å› ä¸ºç¦»èŒåŠ å¾®ä¿¡çš„äººæ¯”å»å¹´ä¸€æ•´å¹´éƒ½å¤šã€‚å‡ å®¶æ¬¢å–œå‡ å®¶æ„ï¼Œè€Œå¯¹äºå›¢é˜Ÿè€Œè¨€ï¼Œä¸å°‘æ–°è€åŒå­¦å—åˆ°æ³¢åŠï¼Œæœ‰æœ‹å‹æŒ‡å‡ºæˆ‘åœ¨è¿™ä»¶ä¸Šäº‹æƒ…çš„æŸäº›ç‚¹ä¸Šå¤„ç†çš„è¿‡äºç†æ€§è€Œè¿‘ä¹ä¸è¿‘äººæƒ…ï¼Œå…¶å®è¿™ä¹ŸåŸºäºè¯¸å¤šæ— å¥ˆåŠæˆ‘è¿™äº›å¹´çš„èŒåœºè§‚ä½œå‡ºçš„å†³å®šï¼Œæˆ‘ä¹Ÿåæ€æ˜¯ä¸æ˜¯ç¡®å®åˆäº›å¤„ç†çš„ä¸å¦¥ï¼ˆåšäººæ¯”åšæŠ€æœ¯éš¾ _(:Ğ·ã€âˆ )_ï¼‰å¸Œæœ›èƒ½é€šè¿‡è¿™ä»¶äº‹æœ‰æ‰€æˆé•¿å§ã€‚</p><p>è¿‘æœŸä¸¤ä¸ªè€é¢†å¯¼ä¹Ÿç¦»èŒäº†ï¼Œç•¥å¾®ä¼¤æ„Ÿã€‚è€Œå…¬å¸å†…éƒ¨ä¼¼ä¹å› ä¸ºè¿™æ¬¡è£å‘˜ä¼¼ä¹ä¹Ÿèµ·äº†ä¸€äº›æ³¢æ¾œï¼Œå¸Œæœ›ä¸ç ´ä¸ç«‹ï¼Œ2022 èƒ½æ˜¯ç«‹çš„ä¸€å¹´å§ã€‚</p><p>ä»¥ä¸Šæ˜¯å·¥ä½œä¸Šçš„ï¼Œè€Œç”Ÿæ´»ä¸Šï¼Œå³å°†è¿æ¥æ–°ç”Ÿå‘½ï¼Œç²¾åŠ›ä¹Ÿè¢«åˆ†æ•£äº†äº›è®¸ï¼Œä»¥è‡³äºæœ‰æ—¶å€™æ„Ÿè§‰å¯¹æŠ€æœ¯çš„æ•æ„Ÿåº¦æœ‰æ‰€ä¸‹é™ï¼Œè¿™ä¸ªåº”è¯¥è¦æ³¨æ„ã€‚ä½“é‡æ¯”å»å¹´ä¿æŒçš„å¥½ä¸€ç‚¹ï¼Œæœ‰æ‰€å¢æ¶¨ï¼Œä½†æ˜¯å¥èº«ä¹Ÿå› ä¸ºç§ç§åŸå› ä¸­æ–­æ‰ã€‚</p><p>è·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œå¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢ã€‚å†è¿‡å‡ å¹´å³å°†è€Œç«‹ï¼Œä¸åˆšæ¯•ä¸šçš„æ—¶å€™ç›¸æ¯”ï¼Œå°‘äº†äº›ææ…Œï¼Œä½†ç€çœ¼äºæ›´è¿œçš„è¿œæ–¹ï¼Œè¿·èŒ«å´å¹¶æœªå‡å°‘ã€‚è€Œèƒ½åšçš„æ— éå°±æ˜¯èµ°å¥½è„šä¸‹çš„é“è·¯ï¼Œç„¶åå¶å°”æŠ¬å¤´ï¼Œçœ‹çœ‹æ˜¯å¦ä¾ç„¶åœ¨è¿½é€å¤ªé˜³çš„è·¯ä¸Šã€‚</p><h3 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h3><p>2022 å¹´å¸Œæœ›èƒ½</p><ul><li>å­¦ä¼š rust ï¼Œå¹¶å†™ä¸€äº›å°é¡¹ç›®ç»ƒç»ƒæ‰‹</li><li>ä¿æŒåšå®¢æ›´æ–°çš„ä¹ æƒ¯</li><li>ç»§ç»­å•ƒ React</li><li>æ‰¾æœºä¼šå¯¹å¼€æºåšä¸€ç‚¹è´¡çŒ®</li><li>ä½“é‡ç»§ç»­æ¶¨â€¦</li></ul>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> éšæƒ³ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nextjs åˆä½“éªŒ</title>
      <link href="/2021/08/20/nextjs-%E5%88%9D%E4%BD%93%E9%AA%8C/"/>
      <url>/2021/08/20/nextjs-%E5%88%9D%E4%BD%93%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘æœ‰ä¸ªé¡¹ç›®è½¬åˆ°æˆ‘è¿™é‡Œç»´æŠ¤ï¼Œé¡¹ç›®åŸºäº nextjsï¼Œåˆšå¥½ä¹‹å‰åªæœ‰è€³é—»ï¼Œæœªå°ä½¿ç”¨è¿‡ï¼Œè¿™é‡Œç®€å•è®°å½•ä¸€ä¸‹ã€‚</p><a id="more"></a><p> æ¥æ‰‹è¿‡æ¥çš„æ—¶å€™é¡¹ç›®æ²¡æœ‰æ·»åŠ  eslintï¼ŒæŸ¥çœ‹æ–‡æ¡£åå‘ç°æ·»åŠ  eslint æ¯”è¾ƒç®€å•</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">npm i eslint eslint-config-next -D&#x2F;&#x2F; .eslintrc.json&#123;  &quot;extends&quot;: &quot;next&quot;&#125;</code></pre><p>æœ¬æ¬¡æœ‰ä¸ªè°ƒæ•´éœ€è¦å¼•å…¥ä¸€ä¸ªæ–°çš„ npmï¼Œéº»çƒ¦å°±æ¥äº†ã€‚</p><p>é¦–å…ˆæ˜¯ next.js é»˜è®¤ä¸ç¼–è¯‘ node_modulesï¼Œå…·ä½“æŸ¥çœ‹ <a href="https://github.com/vercel/next.js/issues/706ã€‚è§£å†³åŠæ³•æ˜¯æ·»åŠ ">https://github.com/vercel/next.js/issues/706ã€‚è§£å†³åŠæ³•æ˜¯æ·»åŠ </a> <code>next-transpile-modules</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const withTM &#x3D; require(&#39;next-transpile-modules&#39;)([&#39;package-need-transpile&#39;]);module.exports &#x3D; withTM(&#123;  &#x2F;&#x2F; ...  webpack5: false,&#125;);</code></pre><p>é¡¹ç›®ä¸æ˜¯ webpack5ï¼Œå› æ­¤ç½®ä¸º false</p><p>æ¥ç€ï¼Œnextjs æç¤ºæˆ‘ç¬¬ä¸‰æ–¹åº“å¼•å…¥äº†å…¨å±€ cssã€‚å…·ä½“æŸ¥çœ‹ <a href="https://github.com/fullcalendar/fullcalendar/issues/5393ã€‚è§£å†³åŠæ³•æˆ‘è¿™é‡Œå°±æ¯”è¾ƒç²—æš´äº†ï¼Œfork">https://github.com/fullcalendar/fullcalendar/issues/5393ã€‚è§£å†³åŠæ³•æˆ‘è¿™é‡Œå°±æ¯”è¾ƒç²—æš´äº†ï¼Œfork</a> å‡ºä¸€ä»½ç¬¬ä¸‰æ–¹åº“ï¼Œå°†é‡Œé¢çš„å…¨å±€æ ·å¼æ³¨é‡Šæ‰ã€‚</p><p>æ¥ç€ï¼Œnextjs æç¤ºå…¥é—¨å¿…æç¤ºçš„ window is not definedï¼Œè¿™æ˜¯ç”±äº node ç¯å¢ƒè¿˜ä¸å­˜åœ¨ windowã€‚</p><p>è¿™æ—¶å€™æœ‰å‡ ä¸ªè§£å†³æ–¹æ¡ˆ:</p><ol><li>åœ¨ didMount / useEffect ä¸­ä½¿ç”¨ window</li><li>å¦‚æœæ˜¯å¼•å…¥ç»„ä»¶ï¼Œé‚£ä¹ˆé€šè¿‡ <code>next/dynamic</code> å¼•å…¥, ä¸”è®¾ç½® ssr ä¸º false</li><li>åˆ¤æ–­ typeof window !== â€œundefinedâ€ å†ä½¿ç”¨ window</li></ol><p>æŒ‰ä¸Šè¿°çš„æ–¹æ³•è§£å†³å®Œä¹‹åï¼Œä»£ç è¿è¡Œï¼Œçœ‹ä¼¼æ²¡å•¥é—®é¢˜äº†ã€‚æ‰“åŒ…ï¼Œå¤§åŠŸå‘Šæˆï¼Ÿç­‰ç­‰ï¼Œåˆå‡ºç°äº† window is not definedï¼Œæ‰“åŒ…å¤±è´¥ã€‚å¯æ˜¯æˆ‘åœ¨ dev çš„æ—¶å€™ç¡®å®æ˜¯ç¼–è¯‘æˆåŠŸäº†ä¸”æ²¡æœ‰æŠ¥é”™å•Šã€‚æŸ¥çœ‹æç¤ºå‘ç°åŸæ¥æ˜¯å¼•å…¥çš„åŒ…ä¸­ä½¿ç”¨åˆ°äº† window</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const MyNoSsrCom &#x3D; dynamic(() &#x3D;&gt; import(&#39;.&#x2F;MyCom&#39;), &#123; ssr: false &#125;)&#x2F;&#x2F; MyCom.jsximport &#123; sometool &#125; from &#39;my-package&#39;&#x2F;&#x2F; ...&#x2F;&#x2F; my-package.js&#x2F;&#x2F; ä½¿ç”¨åˆ°äº† windowwindow.xxxx</code></pre><p>è¿™ç§æƒ…å†µè™½ç„¶åœ¨ dev æ˜¯å¯ä»¥çš„ï¼Œç„¶è€Œ build çš„æ—¶å€™å´ä¼šæŠ¥é”™ï¼ŒåŸå› ä¸è¯¦</p><p>æ— å¥ˆï¼Œåªèƒ½åšå¦‚ä¸‹å¤„ç†</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">&#x2F;&#x2F; MyCom.jsxconst &#123;sometool &#125; &#x3D; typeof &#39;window&#39; &#x3D;&#x3D;&#x3D; undefined ? &#123;&#125; : require(&#39;my-package&#39;)&#x2F;&#x2F; ...</code></pre><p>çœ‹ä¼¼æ²¡å•¥é—®é¢˜äº†ï¼Œå†æ¬¡ buildï¼Œä¾ç„¶è¿˜æ˜¯å¤±è´¥äº†ã€‚è¿™æ¬¡æç¤º pages ä¸‹æœ‰æ–‡ä»¶æ²¡æœ‰é»˜è®¤å¯¼å‡º react ç»„ä»¶ï¼Œä»”ç»†ä¸€çœ‹æ­£æ˜¯æˆ‘ fork å‡ºæ¥çš„åŒ…æ–‡ä»¶ã€‚ä¸çŸ¥é“ä¸ºä»€ä¹ˆå°†è¿™ä¸ªæ–‡ä»¶åˆ¤æ–­æˆ react ç»„ä»¶ï¼Œä¼°è®¡æ˜¯å› ä¸ºå…¶ä¸­å­˜åœ¨ Classï¼Ÿåªå¥½æ·»åŠ ä¸€ä¸ªé»˜è®¤å¯¼å‡º</p><p>è‡³æ­¤å¤§åŠŸå‘Šæˆï¼Œä½†æˆ‘å´é™·å…¥æ€€ç–‘ï¼Œè¿™ä¸ªé¡¹ç›®æœ¬èº«å¹¶æ²¡æœ‰å¤ªå¤š seo çš„ç—•è¿¹/éœ€æ±‚ï¼Œä¹Ÿåªæ˜¯ä¸€ä¸ªé¡µé¢ï¼ŒæŒ‰é“ç†æ²¡æœ‰é¦–å±å¹•æ¸²æŸ“ä¹‹ç±»çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆå¼ºè¡Œä¸Šäº†ä¸ª nextjsï¼Œä»£ç ä¸­å¤„å¤„éƒ½è¦  <code>typeof &#39;window&#39; === undefined</code> è¿™çœŸçš„å¥½å—ï¼Ÿ</p><p>ä¹Ÿè®¸æ˜¯è¿˜æ²¡æœ‰æ›´æ·±å…¥å»äº†è§£ nextjsï¼Œæ‰ä¼šæœ‰ä¸Šè¿°è§è§£ã€‚ä½†èµ·ç å¯¹æ™®é€šçš„é¡¹ç›®äºæˆ‘è€Œè¨€å¤§æ¦‚ç‡æ˜¯ä¸ä¼šå†æœ‰ next äº†å§ã€‚ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> react </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°ç¨‹åºè¸©å‘å°è®°ï¼ˆä¸‰ï¼‰</title>
      <link href="/2021/08/13/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%B8%A9%E5%9D%91%E5%B0%8F%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89/"/>
      <url>/2021/08/13/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%B8%A9%E5%9D%91%E5%B0%8F%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>ä¸Šé¢ä¸€ç¯‡ä¸»è¦è®²è¿°äº†ä¸€äº›æŠ€æœ¯ç»†èŠ‚ï¼Œè¿™ä¸€ç¯‡ä¸»è¦æ¥è®²è®²è¸©çš„å‘ä»¥åŠå•çº¯åæ§½</p><a id="more"></a> <h4 id="è¸©è¿‡çš„å‘"><a href="#è¸©è¿‡çš„å‘" class="headerlink" title="è¸©è¿‡çš„å‘"></a>è¸©è¿‡çš„å‘</h4><ol><li><p>ScrollView ä¸­çš„ fixed æ ·å¼æ— æ•ˆ / å‡ºé”™ã€‚è¿™ä¸ªé—®é¢˜æ˜¯åœ¨ä½¿ç”¨å®˜æ–¹çš„æ‹“å±•ç»„ä»¶ mp-sticky æ—¶å‘ç°çš„ã€‚mp-sticky çš„åŸç†æ˜¯åŒ…è£¹ç»„ä»¶æ»šåŠ¨å‡ºè§†å£æ—¶ï¼Œå°†æ ·å¼å˜ä¸º fixed å®ç°çš„ï¼Œä½†å¦‚æœåœ¨ ScrollView ä¸­ä¼šå¤±æ•ˆ / è¡¨ç°å¼‚å¸¸ç­‰ï¼Œå¦‚ <a href="https://developers.weixin.qq.com/community/develop/doc/0004aeafeccb789ac219e474756000">https://developers.weixin.qq.com/community/develop/doc/0004aeafeccb789ac219e474756000</a> </p></li><li><p>fixed å¯èƒ½ä¼šé‡åˆ°å±‚çº§é”™ä¹±</p></li><li><p>wx.getMenuButtonBoundingClientRect() å¶ç°è¿”å›å€¼ä¸º 0 çš„é—®é¢˜ï¼Œä¸€èˆ¬æ˜¯ ios åœ¨é‡æ–°è¿›å…¥å°ç¨‹åºæ—¶ä¼šé‡ç°ï¼Œè§ <a href="https://developers.weixin.qq.com/community/develop/doc/0006a49ba7cf4090feea00db350000?_at=1627380707469">https://developers.weixin.qq.com/community/develop/doc/0006a49ba7cf4090feea00db350000?_at=1627380707469</a> ï¼Œç›®å‰çš„åšæ³•æ˜¯åœ¨ç›‘å¬è·¯ç”± appLaunch çš„æ—¶å€™ï¼Œå¦‚æœè·å–åˆ°çš„å€¼ä¸º 0 åˆ™é‡æ–°è·å–</p></li><li><p>æç¤ºè¿è¡Œç¯å¢ƒåŠ è½½å¤±è´¥ï¼Œè¿™ä¸ªé—®é¢˜å¯èƒ½æ˜¯å¼€äº†ä»£ç†æˆ–è€…å†…å­˜ä¸è¶³å¯¼è‡´çš„</p></li><li><p>ScrollView ç»„ä»¶ä¸­è¦å®šä½åˆ°æŸä¸ªå…ƒç´ æ˜¯é€šè¿‡ scrollIntoView è¿™ä¸ªå±æ€§æ¥å®ç°çš„ï¼Œè¿™é‡Œå°±æœ‰ä¸ªé—®é¢˜ï¼Œä¸æ¸…æ¥šåŸç”Ÿå°ç¨‹åºæ˜¯å¦å­˜åœ¨ï¼Œå³å®šä½è¿‡ä¸€æ¬¡ä¹‹åï¼Œå¦‚æœè¿˜æƒ³å®šä½åˆ°ç›¸åŒçš„å…ƒç´ ï¼Œç”±äº scrollIntoView å±æ€§æ²¡æœ‰å˜åŒ–ï¼Œåˆ™ä¸ä¼šäº§ç”Ÿæ»šåŠ¨ã€‚ã€‚æƒ³åæ§½ä¸€ä¸‹ä¸ºä»€ä¹ˆè¿™ä¸ªä¸è®¾è®¡æˆç±»ä¼¼ pageScrollTo è¿™æ ·çš„ api ï¼Œè€Œæ˜¯ç”¨å±æ€§å½¢å¼</p></li><li><p>å¼€å‘è€…å·¥å…·ä¸çœŸæœºè°ƒè¯•çš„è¯·æ±‚è¶…æ—¶/ æ— ç½‘ç»œæ—¶ çš„errMsgä¸ä¸€è‡´</p></li><li><p>getNetworkType è·å–åˆ°çš„ç½‘ç»œçŠ¶æ€å¯èƒ½ä¼šæœ‰å»¶è¿Ÿ</p></li><li><p>tabbar borderStytle åœ¨ ios 13 ä¸Šæ ¼å¤–ç²—ï¼Œåªèƒ½è‡ªå·±å»å®ç°ä¸€ä¸ª tabbar </p></li><li><p>Taro çš„ PageMeta æ— æ³•ä½¿ç”¨ <a href="https://github.com/NervJS/taro/issues/6092">https://github.com/NervJS/taro/issues/6092</a></p></li><li><p>taro ä¸­ dataset çš„ç›¸å…³è®¨è®º <a href="https://github.com/NervJS/taro/issues/7313">https://github.com/NervJS/taro/issues/7313</a></p></li><li><p>intersectionObserver æ˜¯ä¸€ä¸ªç”¨äºç›‘æ§å…ƒç´ ä¸è§†å£ï¼ˆæˆ–è€…æŒ‡å®šå…ƒç´ ï¼‰ç›¸äº¤æƒ…å†µçš„ä¸€ä¸ª apiï¼Œåœ¨ web ä¸Šæ˜¯éå¸¸å¥½ç”¨çš„ï¼Œç„¶è€Œåˆ°äº†å°ç¨‹åºæœ‰å¦‚ä¸‹é™åˆ¶ï¼Œå¯¼è‡´æˆ‘ä¸€åº¦æƒ³æ”¾å¼ƒè¯¥ api</p><ol><li><p>createIntersectionObserver åˆ›å»ºå‡ºæ¥çš„ observer åªèƒ½ observe ä¸€æ¬¡ï¼Œå³ä½¿ observer disconnect ä¹‹åä¹Ÿæ˜¯å¦‚æ­¤</p></li><li><p>observe ä¸èƒ½ç›‘å¬æ–°å¢çš„å…ƒç´ ï¼ˆæœªæµ‹è¯• web ä¸Šæ˜¯å¦å¦‚æ­¤ï¼‰ï¼Œæ¯”å¦‚æ— é™åŠ è½½çš„åˆ—è¡¨ï¼Œæ–°å¢åŠ è¿›æ¥çš„å…ƒç´ æ˜¯æ— æ³•è¢«ç›‘å¬çš„ï¼Œé™¤éå†æ¬¡ observe ï¼Œç„¶è€Œå°ç¨‹åºä¸å…è®¸åŒä¸€ä¸ª observer é‡å¤ observe</p></li><li><p>observe æ¥æ”¶çš„å‚æ•°æ˜¯é€‰æ‹©å™¨ï¼Œä¾‹å¦‚ â€˜.classnameâ€™ è¿™æ ·çš„ï¼Œè¿™ä¸ªæˆ‘è§‰å¾—æ—¢ç„¶æ˜¯å°ç¨‹åºé‡Œä¸ºä»€ä¹ˆä¸æ”¯æŒ refï¼Ÿ</p></li><li><p>æ³¨æ„ observe  çš„æ—¶æœºï¼Œéœ€è¦åœ¨ç»„ä»¶æŒ‚è½½ä¹‹åï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶é—´åœ¨ Taro å¯¹åº”çš„æ˜¯ useEffect ä¸­çš„ nextTick é‡Œ</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">useEffect(() &#x3D;&gt; &#123;  nextTick(() &#x3D;&gt; &#123;    observer.observe(&#39;.item&#39;, () &#x3D;&gt; &#123;      &#x2F;&#x2F; ...    &#125;)  &#125;)&#125;, []) </code></pre></li><li><p>é€šè¿‡ obsever ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸ªå›è°ƒï¼Œä»£è¡¨ç›¸äº¤çŠ¶æ€å˜åŒ–æ—¶è¦æ‰§è¡Œçš„å›è°ƒï¼Œç„¶è€Œä»è¿™é‡Œè·å–åˆ°çš„ä¿¡æ¯æ¯”è¾ƒå°‘</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">interface ObserveCallbackResult &#123;  &#x2F;** ç›®æ ‡è¾¹ç•Œ *&#x2F;  boundingClientRect: BoundingClientRectResult  &#x2F;** ç›¸äº¤æ¯”ä¾‹ *&#x2F;  intersectionRatio: number  &#x2F;** ç›¸äº¤åŒºåŸŸçš„è¾¹ç•Œ *&#x2F;  intersectionRect: IntersectionRectResult  &#x2F;** å‚ç…§åŒºåŸŸçš„è¾¹ç•Œ *&#x2F;  relativeRect: RelativeRectResult  &#x2F;** ç›¸äº¤æ£€æµ‹æ—¶çš„æ—¶é—´æˆ³ *&#x2F;  time: number&#125;</code></pre><p>é¢å¤–ä¿¡æ¯åªèƒ½å¸¦åœ¨ dataSet ä¸­ï¼Œå¦‚ä¸‹</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">import &#123; document &#125; from &#39;@tarojs&#x2F;runtime&#39;;observer.observe(&#39;.item&#39;,  (res: IntersectionObserver.ObserveCallbackResult &amp; &#123; id: string &#125;) &#x3D;&gt; &#123;      const el &#x3D; document.getElementById(res.id);  console.log(el.dataset)    &#125; &#125;);</code></pre></li></ol><p>æ€»ä¹‹è¿™ä¸ª api åœ¨å°ç¨‹åºä¸Šæˆ‘è§‰å¾—æ²¡æœ‰å¾ˆç¬¦åˆé¢„æœŸã€‚ã€‚</p></li></ol><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>è¿™ä¸ªé¡¹ç›®å†æ—¶ä¸€ä¸ªå¤šæœˆï¼Œå’Œå°ä¼™ä¼´ä»¬å°† rn åº”ç”¨æ¬åˆ°å°ç¨‹åºä¸Šï¼Œä¸­é—´é‡åˆ°ç§ç§é—®é¢˜ã€‚æ•´ä½“å¼€å‘ä¸‹æ¥çš„ä½“éªŒå°±æ˜¯å°ç¨‹åºæœ‰ä¸€äº›æ¯”è¾ƒæ–¹ä¾¿çš„ api åŒæ—¶ä¹Ÿå­˜åœ¨ä¸€äº›å°†åŸå…ˆ web å¥½ç”¨çš„åœ°æ–¹é­”æ”¹è€Œäº§ç”Ÿçš„é—®é¢˜ã€‚</p><p>åç»­è®¡åˆ’æ˜¯å°†å°ç¨‹åºä¸­çš„å…¬ç”¨ç»„ä»¶æŠ½å‡ºæ¥åˆ°å…¬å…±åº“ä¸­ï¼ŒåŒæ—¶æä¾›å°ç¨‹åºè„šæ‰‹æ¶ä»¥ä¾¿åˆ«çš„ä¸šåŠ¡çº¿ä½¿ç”¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å°ç¨‹åº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°ç¨‹åºè¸©å‘å°è®°ï¼ˆäºŒï¼‰</title>
      <link href="/2021/08/13/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%B8%A9%E5%9D%91%E5%B0%8F%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
      <url>/2021/08/13/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%B8%A9%E5%9D%91%E5%B0%8F%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>ä¸Šä¸€ç¯‡ä¸­ä¸»è¦è®²çš„æ˜¯å·¥ç¨‹æ¶æ„æ–¹é¢çš„ï¼Œè¿™ç¯‡ä¸»è¦è®²ä¸€äº›ç»†èŠ‚å®ç°</p><a id="more"></a> <h4 id="ä½¿ç”¨åŸç”Ÿèƒ½åŠ›"><a href="#ä½¿ç”¨åŸç”Ÿèƒ½åŠ›" class="headerlink" title="ä½¿ç”¨åŸç”Ÿèƒ½åŠ›"></a>ä½¿ç”¨åŸç”Ÿèƒ½åŠ›</h4><p>ä½¿ç”¨åŸç”Ÿ apiï¼Œå¦‚ wx.xxxï¼Œtaro å°† wx æš´éœ²çš„ api é›†æˆåˆ° @tarojs/taro ä¸­äº†</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">import Taro from &#39;@tarojs&#x2F;taro&#39;Taro.xxx</code></pre><p>ä½¿ç”¨åŸç”Ÿç»„ä»¶ taro çš„æ–‡æ¡£è®²çš„å°±ç›¸å½“æ¨¡ç³Šã€‚è¿™é‡Œæˆ‘ç»“åˆè‡ªå·±çš„åœºæ™¯ï¼Œä¸€ä¸ªæ˜¯ç”¨åˆ°ç›´æ’­æ’ä»¶, app é…ç½®</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; src&#x2F;app.config.ts&#123;&#x2F;&#x2F; ...plugins: &#123;    &#39;live-player-plugin&#39;: &#123;      version: &#39;1.3.0&#39;,      provider: &#39;wx2b03c6e691cd7370&#39;,    &#125;,  &#125;,&#125;</code></pre><p>å…¶ä¸­ wx2b03c6e691cd7370 æ˜¯å¾®ä¿¡è§„å®šçš„ç›´æ’­æ’ä»¶ï¼Œéœ€è¦å†™æ­»çš„</p><p>ä½¿ç”¨æ—¶ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">&lt;Navigator url&#x3D;&#123;&#96;plugin-private:&#x2F;&#x2F;wx2b03c6e691cd7370&#x2F;pages&#x2F;live-player-plugin&#96;&#125;&gt;  è¿›å…¥ç›´æ’­&lt;&#x2F;Navigator&gt;</code></pre><p>ä½¿ç”¨åŸç”Ÿç»„ä»¶éœ€è¦åœ¨é¡µé¢çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  usingComponents</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#123;&#x2F;&#x2F; ...usingComponents: &#123;    &#39;mp-tabs&#39;:      &#39;..&#x2F;..&#x2F;components&#x2F;@miniprogram-component-plus&#x2F;tabs&#x2F;miniprogram_dist&#39;,    &#39;mp-sticky&#39;:      &#39;..&#x2F;..&#x2F;components&#x2F;@miniprogram-component-plus&#x2F;sticky&#x2F;miniprogram_dist&#39;,  &#125;,&#125;</code></pre><p>çœ‹åˆ°è¿™é‡Œå¼•ç”¨è·¯å¾„æ˜¯ <code>../../components/xxx</code>è¿™ä¸ªè·¯å¾„æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿ</p><p>åŸæ¥ taro ä¸ä¼šå°†æ²¡æœ‰ä½¿ç”¨åˆ°çš„ node_module ä¸‹çš„æ–‡ä»¶æ‹·è´åˆ° distï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å°±è‡ªå·±å»é…ç½®æ‹·è´é¡¹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; config&#x2F;index.js&#123;&#x2F;&#x2F; ...copy: &#123;    patterns: [      &#123;        from: &#39;node_modules&#x2F;@miniprogram-component-plus&#39;,        to: &#39;dist&#x2F;components&#x2F;@miniprogram-component-plus&#39;,      &#125;,    ],  &#125;,&#125;</code></pre><p>è¿™é‡Œæˆ‘ä»¬çº¦å®š dist/components ä¸ºåŸç”Ÿç»„ä»¶æ”¾ç½®çš„ç›®å½•ï¼Œ<code>../../components/xxx</code> å³ç›¸å¯¹è¿™ä¸ªç›®å½•æ¥çš„ã€‚</p><p>ä½¿ç”¨æ—¶</p> <pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">&#x2F;&#x2F; index.tsx&#x2F;&#x2F; ...&lt;mp-sticky&gt;&lt;&#x2F;mp-sticky&gt;&#x2F;&#x2F; global.d.ts&#x2F;&#x2F; å®šä¹‰ä¸€ä¸‹ typeï¼Œå¦‚æœæœ‰ç”¨ typescript çš„è¯declare namespace JSX &#123;  interface IntrinsicElements &#123;    &#39;mp-sticky&#39;: any;  &#125;&#125;</code></pre><h4 id="mini-css-extract-plugin-ç¼–è¯‘è­¦å‘Š"><a href="#mini-css-extract-plugin-ç¼–è¯‘è­¦å‘Š" class="headerlink" title="mini-css-extract-plugin ç¼–è¯‘è­¦å‘Š"></a>mini-css-extract-plugin ç¼–è¯‘è­¦å‘Š</h4><p> mini-css-extract-plugin éœ€è¦æŒ‰å¼•ç”¨é¡ºåºå»ç”Ÿæˆ css æ–‡ä»¶ï¼Œå¦‚æœå¤šä¸ªæ–‡ä»¶å¼•å…¥é¡ºåºä¸ä¸€è‡´å°±ä¼šè­¦å‘Š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">chunk common [mini-css-extract-plugin]Conflicting order between:...</code></pre><p>è¯¦è§ <a href="https://github.com/NervJS/taro/issues/7160">https://github.com/NervJS/taro/issues/7160</a></p><p>è§£å†³æ–¹æ¡ˆï¼šæˆ‘è¿™é‡Œå¼•å…¥é¡ºåºæ²¡æœ‰å¤ªå¤§çš„å½±å“ï¼Œå› æ­¤é€‰æ‹©å¿½ç•¥é¡ºåº</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; config&#x2F;index.js&#123;&#x2F;&#x2F; ...  mini: &#123;    miniCssExtractPluginOption: &#123;      ignoreOrder: true,    &#125;,  &#125;,&#125;</code></pre><h4 id="UUID"><a href="#UUID" class="headerlink" title="UUID"></a>UUID</h4><p>å‰ç«¯ç”Ÿæˆéšæœº idï¼Œé€šå¸¸æ˜¯é€šè¿‡ Math.random å®ç°çš„ï¼Œä¾‹å¦‚ç»„å†…ä¸€ä¸ªå°ä¼™ä¼´çš„å®ç°ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">function uuid(len &#x3D; 8) &#123;let str &#x3D; &#39;&#39;  for(; str.length &lt; len; str +&#x3D; Math.random().toString(36).substr(2)) &#123;&#125;  return str.substr(0, len)&#125;</code></pre><p>ç„¶è€Œä¸Šé¢å®é™…æ˜¯ä¼ªéšæœºï¼Œweb ç«¯å¯ä»¥åˆ©ç”¨ crypto å®ç°ï¼Œç»„å†…å¦ä¸€ä¸ªå°ä¼™ä¼´çš„å®ç°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;** * ç”¨æ¥éšæœºç”Ÿæˆæ–‡ä»¶åçš„å­—ç¬¦ä¸²é›†åˆï¼Œéœ€è¦è¾¾åˆ°256ä½ï¼Œä½†è¶…è¿‡256ä½ä¹‹åä¼šæŠ›å¼ƒ *&#x2F;const randomSeed &#x3D; &#39;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;.repeat(5);&#x2F;** * ä½¿ç”¨æµè§ˆå™¨çš„cryptoæ¨¡å—ï¼Œç®€å•åœ°ç”Ÿæˆéšæœºå­—ç¬¦ä¸² *&#x2F;export const createRandomString &#x3D; (len &#x3D; 16) &#x3D;&gt; &#123;  return Array.from(crypto.getRandomValues(new Uint8Array(len)))    .map((v) &#x3D;&gt; randomSeed[v])    .join(&#39;&#39;);&#125;;</code></pre><p>ç„¶è€Œå°ç¨‹åºè‡ªå·±æä¾›çš„ getRandomValues å¯¹å¾®ä¿¡åŸºç¡€åº“ç‰ˆæœ¬è¦æ±‚è¾ƒé«˜</p> <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const createRandomString &#x3D; async (length &#x3D; 16) &#x3D;&gt; &#123;  const res &#x3D; await wx.getRandomValues(&#123; length &#125;);  return Taro.arrayBufferToBase64(res.randomValues);&#125;;</code></pre><p>å¶ç„¶çœ‹åˆ° taro-ui çš„å®ç°ï¼Œè®°å½•ä¸‹æ¥ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">function uuid(len &#x3D; 8, radix &#x3D; 16): string &#123;  const chars &#x3D; &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz&#39;.split(&#39;&#39;)  const value: string[] &#x3D; []  let i &#x3D; 0  radix &#x3D; radix || chars.length  if (len) &#123;    &#x2F;&#x2F; Compact form    for (i &#x3D; 0; i &lt; len; i++) value[i] &#x3D; chars[0 | (Math.random() * radix)]  &#125; else &#123;    &#x2F;&#x2F; rfc4122, version 4 form    let r    &#x2F;&#x2F; rfc4122 requires these characters    &#x2F;* eslint-disable-next-line *&#x2F;    value[8] &#x3D; value[13] &#x3D; value[18] &#x3D; value[23] &#x3D; &#39;-&#39;    value[14] &#x3D; &#39;4&#39;    &#x2F;&#x2F; Fill in random data.  At i&#x3D;&#x3D;19 set the high bits of clock sequence as    &#x2F;&#x2F; per rfc4122, sec. 4.1.5    for (i &#x3D; 0; i &lt; 36; i++) &#123;      if (!value[i]) &#123;        r &#x3D; 0 | (Math.random() * 16)        value[i] &#x3D; chars[i &#x3D;&#x3D;&#x3D; 19 ? (r &amp; 0x3) | 0x8 : r]      &#125;    &#125;  &#125;  return value.join(&#39;&#39;)&#125;</code></pre><h4 id="åˆ†åŒ…"><a href="#åˆ†åŒ…" class="headerlink" title="åˆ†åŒ…"></a>åˆ†åŒ…</h4><p>åœ¨åŠ å…¥ä¸ƒé±¼æ’ä»¶åï¼Œå°è¯•ä¸Šä¼ ä»£ç æ—¶ï¼Œå°ç¨‹åºæç¤ºä¸»åŒ…ä½“ç§¯è¿‡å¤§ã€‚åˆ†æå‘ç°ï¼Œå°ç¨‹åºå¯¹äºå®˜æ–¹æä¾›çš„æ’ä»¶æˆ–è€…æ‹“å±•ç»„ä»¶ï¼Œå¦‚ ç›´æ’­ / sticky ç­‰ç»„ä»¶æ˜¯ä¸è®¡å…¥ä½“ç§¯çš„ï¼Œè€Œå¯¹äºç¬¬ä¸‰æ–¹çš„æ’ä»¶æ˜¯éœ€è¦è®¡å…¥ä½“ç§¯çš„ã€‚é‚£ä¹ˆæ€ä¹ˆè§£å†³å‘¢ï¼Ÿ</p><p>å·²çŸ¥ä¸ƒé±¼æ’ä»¶çº¦1.3 m, è€Œå¾®ä¿¡å…è®¸ä¸€ä¸ªåŒ…æœ€å¤š 2mï¼Œæ˜¾ç„¶ä¸ƒé±¼çš„ä»£ç ä¸èƒ½å’Œä¸šåŠ¡ä»£ç æ”¾åœ¨åŒä¸€ä¸ªåŒ…é‡Œã€‚è€Œå¾®ä¿¡ä¹Ÿæä¾›äº†åˆ†åŒ…çš„åŠæ³•ã€‚é…ç½®èµ·æ¥å€’æ˜¯ç®€å•ã€‚åœ¨ app.config.json ä¸­å¯ä»¥æ·»åŠ  subpackages å­—æ®µï¼Œå°†éœ€è¦åˆ†åŒ…å‡ºå»çš„é¡µé¢æŒ‰ root åˆ†åˆ«æ‰“åŒ…ã€‚</p><p>ç¬¬äºŒä¸ªé—®é¢˜æ˜¯ï¼Œä¸ƒé±¼åªæ˜¯æä¾›äº†è·³è½¬æ’ä»¶é¡µçš„ url <code>plugin://qiyukefu/chat</code>, å¯æ˜¯è¿™ä¸ª url ç¡®ä¸èƒ½ä½œä¸ºåˆ†åŒ…çš„ pageã€‚å› æ­¤æˆ‘å•ç‹¬åŠ äº†ä¸€ä¸ªé¡µé¢ä½œä¸ºä¸­è½¬åˆ°ä¸ƒé±¼çš„å…¥å£ï¼Œå³è¿›å…¥è¿™ä¸ªä¸­è½¬é¡µé¢åå°±ä¼šæ‰§è¡Œ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">redirectTo(&#123;  url: &#39;plugin:&#x2F;&#x2F;qiyukefu&#x2F;chat&#39;,&#125;);</code></pre><p>ç„¶è€Œï¼Œå°ç¨‹åºè¿™é‡Œè¿˜æœ‰ä¸ªå‘ï¼Œå¦‚æœå½“å‰è¿™ä¸ªæ’ä»¶åŠ è½½é€Ÿåº¦æ¯”è¾ƒæ…¢çš„è¯ï¼Œå°±ä¼šå¯¼è‡´ä¸­è½¬é¡µé¢å…ˆå…³æ‰ï¼Œç„¶åå†è·³è½¬åˆ°ä¸ƒé±¼ï¼Œè¡¨ç°æˆé—ªçƒä¸€ä¸‹ã€‚è¿™é‡Œæ²¡ä»€ä¹ˆå¥½çš„åŠæ³•ï¼Œåœ¨å½“å‰é¡µé¢å»¶æ—¶ 1s åè·³è½¬ã€‚</p><p>åŒæ—¶å¯¹è¿™ä¸ªä¸­è½¬é¡µæ‰€åœ¨åŒ…é€šè¿‡é…ç½® <code>preloadRule</code> åšäº†ä¸€ä¸ªé¢„åŠ è½½ï¼Œä¼˜åŒ–ä½“éªŒã€‚</p><h4 id="è·¯ç”±è®¾è®¡"><a href="#è·¯ç”±è®¾è®¡" class="headerlink" title="è·¯ç”±è®¾è®¡"></a>è·¯ç”±è®¾è®¡</h4><p>å¾®ä¿¡æä¾›äº†è·¯ç”±è·³è½¬çš„ apiï¼Œä¸€å¼€å§‹æ˜¯ç›´æ¥ä½¿ç”¨çš„</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Taro.navigateTo(&#123;url: &#39;xxxx&#39;&#125;)</code></pre><p> ä½†æ˜¯ç›´æ¥ä½¿ç”¨è¿™ä¸ª api å¾ˆå¿«å°±æš´éœ²äº†ä¸€äº›é—®é¢˜</p><ol><li>å‚æ•°éœ€è¦è‡ªè¡Œæ‹¼æ¥ï¼Œå³éœ€è¦æ‹¼æ¥æˆ <code>xxx?x=x</code>  çš„å½¢å¼ï¼Œå†™èµ·æ¥ä¸å¤ªå‹å¥½</li><li>åˆ†åŒ…çš„æ—¶å€™ç”±äºæ–‡ä»¶è·¯å¾„å˜æ›´ï¼Œæ‰€æœ‰æ¶‰åŠåˆ°çš„è·¯ç”±éƒ½è¦æ‰‹åŠ¨æ”¹ï¼Œè¿™é‡Œå¾ˆå®¹æ˜“æ¼æ‰æˆ–è€…å†™é”™</li><li>ä¸å¤Ÿç›´è§‚ï¼Œä¸”æ— æ³•å¤ç”¨</li></ol><p>åŸºäºè¿™äº›é—®é¢˜ï¼Œæˆ‘å¯¹è·¯ç”±è¿›è¡Œäº†ç®€å•çš„å°è£…</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; ç»™å„ä¸ªé¡µé¢æä¾›åˆ«åexport enum RoutesMap &#123;  é¦–é¡µ &#x3D; &#39;&#x2F;pages&#x2F;home&#x2F;index&#39;,  &#x2F;&#x2F; ...&#125;export class Router &#123;  &#x2F;&#x2F; è®°å½•å½“å‰ url  currentUrl;  constructor() &#123;    wx.onAppRoute((res: AppRouteRes) &#x3D;&gt; &#123;      &#x2F;&#x2F; å½“è·¯ç”±å˜åŒ–æ—¶ï¼Œå‘å¸ƒä¸€ä¸ª ON_ROUTE_CHANGE çš„äº‹ä»¶      eventCenter.trigger(ON_ROUTE_CHANGE, &#123;        from: this.currentUrl,        to: this.getUrlFromRouteRes(res),        openType: res.openType,      &#125;);      this.currentUrl &#x3D; this.getUrlFromRouteRes(res);    &#125;);  &#125;  &#x2F;&#x2F; æ ¹æ® wx.onAppRoute çš„è¿”å›å€¼æ‹¼æˆå®Œæ•´ url  getUrlFromRouteRes(res: AppRouteRes) &#123;    return &#39;&#x2F;&#39; + res.path + qs.stringify(res.query || &#123;&#125;);  &#125;  &#x2F;** è·å–å½“å‰æ‰€åœ¨é¡µé¢ *&#x2F;  getCurrentPage() &#123;    const pages &#x3D; Taro.getCurrentPages();    const currentPage &#x3D; pages[pages.length - 1];    return currentPage;  &#125;  &#x2F;**   * å°è£…è·³è½¬ï¼Œæ”¯æŒ NAVIGATE | REDIRECT | SWITCH_TAB   * @example   * &#96;&#96;&#96;tsx   *  router.go(&#123; path: RoutesMap.å•†å“è¯¦æƒ…, data: &#123; id: 1 &#125; &#125;)   * &#96;&#96;&#96;   *&#x2F;  go(&#123; path, openType &#x3D; OpenType.NAVIGATE, data &#x3D; &#123;&#125; &#125;: GoOption) &#123;    const querystring &#x3D; stringify(data);    const url &#x3D; &#96;$&#123;path&#125;$&#123;querystring&#125;&#96;;    switch (openType) &#123;      case OpenType.NAVIGATE:        return navigateTo(&#123;          url,        &#125;);      case OpenType.REDIRECT:        return redirectTo(&#123;          url,        &#125;);      case OpenType.SWITCH_TAB:        return switchTab(&#123;          url,        &#125;);      default:        break;    &#125;  &#125;  &#x2F;**   * ç›‘å¬è·¯ç”±å˜åŒ–   *&#x2F;  onRouteChange(listener: RouteEventListener) &#123;    eventCenter.on(&#39;ON_ROUTE_CHANGE&#39;, listener);    return this;  &#125;  &#x2F;**   * è§£ç»‘è·¯ç”±ç›‘å¬   *&#x2F;  offRouteChange(listener: RouteEventListener) &#123;    eventCenter.off(&#39;ON_ROUTE_CHANGE&#39;, listener);    return this;  &#125;&#125;</code></pre><p>è¿™é‡Œçš„ wx.onAppRoute æ˜¯å¾®ä¿¡å†…éƒ¨ä½¿ç”¨çš„ apiï¼Œæ²¡æœ‰æ–‡æ¡£ï¼Œä¸è¿‡ç¡®å®å¯ä»¥ä½¿ç”¨ã€‚ä¸€å¼€å§‹æˆ‘æ˜¯æƒ³é€šè¿‡æ‰€æœ‰è·³è½¬çš„åœ°æ–¹éƒ½ä½¿ç”¨è‡ªå·±å°è£…çš„ Router æ¥è·³è½¬å®ç°è®°å½•è·¯ç”±ï¼Œä½†æ˜¯è¿™æ ·å…¶å®æœ‰ä¸€ä¸ªæœ€ä¸»è¦çš„é—®é¢˜ï¼šæ— æ³•ç›‘å¬ï¼ˆç‰©ç†ï¼‰è¿”å›ã€‚å› æ­¤ä¸å¾—å·²ä½¿ç”¨è¿™ä¸ª wx.onAppRouteã€‚</p><p>é€šè¿‡ä¸Šè¿°ç®€å•å°è£…ï¼Œå°±å®ç°äº†è·¯ç”±ç›‘å¬ï¼Œé€šè¿‡åˆ«åè·³è½¬ç­‰ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const router &#x3D; new Router()router.go(&#123; path: RoutesMap.å•†å“è¯¦æƒ…, data: &#123; id: 1 &#125; &#125;)router.onRouteChange(() &#x3D;&gt; &#123;   &#x2F;&#x2F;... &#125;)</code></pre><h4 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h4><p>å¾®ä¿¡å°ç¨‹åº sdk æœ€æ–°æœ‰ä¸ªæ›´æ–°æ˜¯æä¾›äº†ä¸€ä¸ªæ–°çš„api  <code>wx.getUserProfile</code> ç”¨äºæ›¿æ¢ <code>wx.getUserInfo</code>ï¼Œå¼€å‘è€…æ¯æ¬¡é€šè¿‡è¯¥æ¥å£è·å–ç”¨æˆ·ä¸ªäººä¿¡æ¯å‡éœ€ç”¨æˆ·ç¡®è®¤ï¼Œè§ <a href="https://developers.weixin.qq.com/community/develop/doc/000cacfa20ce88df04cb468bc52801?highLine=login">https://developers.weixin.qq.com/community/develop/doc/000cacfa20ce88df04cb468bc52801?highLine=login</a></p><p>æœ¬é¡¹ç›®ä¸­æš‚æ—¶åªéœ€è¦è·å–åˆ°ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ï¼Œå› æ­¤éœ€è¦ç”¨åˆ°çš„ api æ˜¯ <code>wx.login</code>ã€‚</p><p>å½“æˆ‘ä»¬è¿›å…¥åˆ°å°ç¨‹åºé¡µé¢çš„æ—¶å€™ï¼Œåˆ†ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯å½“å‰é¡µé¢éœ€è¦ç™»å½•æ€ï¼Œä¸€ç§æ˜¯æ— éœ€ç™»å½•æ€ã€‚è¿›å…¥åˆ°éœ€è¦ç™»å½•æ€çš„é¡µé¢ï¼Œå¦‚æœå½“å‰ storage ä¸­æ²¡æœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œé‚£ä¹ˆå¯ä»¥åˆ¤æ–­ä¸ºæ²¡æœ‰ç™»å½•æ€ï¼Œæ­¤æ—¶å±•ç¤º loading åŒæ—¶è°ƒç”¨ wx.login åï¼Œå°†ä¼šå¾—åˆ°ç”¨æˆ·çš„ union_idï¼Œä½¿ç”¨è¿™ä¸ª union_id å»è·ŸæœåŠ¡ç«¯å…‘æ¢ç”¨æˆ·ä¿¡æ¯å³å¯ã€‚</p><p>é‚£ä¹ˆè¿™é‡Œçš„é€»è¾‘æ˜¯å¦‚ä½•å°è£…çš„å‘¢ï¼Œä»£ç å¦‚ä¸‹</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">&#x2F;** * ç™»å½• hocï¼ŒåŒ…è£¹çš„é¡µé¢æœªç™»å½•æ—¶ä¼šè‡ªè¡Œè¿›è¡Œç™»å½• *&#x2F;export default function NeedLogin(&#123; children &#125;: IProps) &#123;  const [userInfo] &#x3D; useAtom(userInfoAtom);  const childrenVisible &#x3D; !userInfo;  if (childrenVisible) &#123;    &#x2F;&#x2F; å¦‚æœä¸æ˜¯ mock ä¸”æ— ç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œå±•ç¤º loading å¹¶å¼€å§‹ç™»å½•æµç¨‹    return &lt;LoginView &#x2F;&gt;;  &#125;  return children;&#125;&#x2F;** æä¾› hoc * @example * &#96;&#96;&#96;tsx * export default withLogin(Home) * &#96;&#96;&#96;&#96; *&#x2F;export const withLogin &#x3D; (WrappedPage: ComponentType&lt;any&gt;) &#x3D;&gt; () &#x3D;&gt;  (    &lt;NeedLogin&gt;      &lt;WrappedPage &#x2F;&gt;    &lt;&#x2F;NeedLogin&gt;  );</code></pre><p>ä¸ºäº†ä¸å½±å“åˆ°åŸå…ˆé¡µé¢çš„å¸ƒå±€ç»“æ„ï¼Œè¿™é‡Œæä¾›äº†ä¸€ä¸ª <code>withLogin</code> é«˜é˜¶ç»„ä»¶ï¼Œä½¿ç”¨æ—¶ <code>withLogin(Home)</code> å³å¯</p><p>å¯ä»¥çœ‹åˆ°ä¸Šè¿°ä»£ç ä¸­ï¼Œå¦‚é€šè¿‡ userInfoAtom æ¥è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå®é™…ä¸Šè¿™ä¸ª userInfo å°±æ˜¯ä¸€ä¸ªæŒä¹…åŒ–åˆ° storage çš„çŠ¶æ€ã€‚å¦‚æœæ²¡æœ‰è·å–åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå°†ä¼šå±•ç¤º <code>LoginView</code> è¿™ä¸ªç»„ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªç»„ä»¶åšäº†ä»€ä¹ˆå‘¢ï¼Ÿ</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const LoginView &#x3D; () &#x3D;&gt; &#123;  useEffect(() &#x3D;&gt; &#123;    const init &#x3D; async () &#x3D;&gt; &#123;      try &#123;        const currentPage &#x3D; Taro.getCurrentInstance().page;        await login();        Taro.nextTick(() &#x3D;&gt; &#123;          if (currentPage &amp;&amp; currentPage.onShow) &#123;            currentPage.onShow();          &#125;        &#125;);      &#125; catch (error) &#123;        Taro.showToast(&#123;          icon: &#39;none&#39;,          title: error.message || &#39;ç™»å½•å¤±è´¥&#39;,        &#125;);      &#125;    &#125;;    init();  &#125;, []);  return (    &lt;View&gt;      åŠ è½½ä¸­...    &lt;&#x2F;View&gt;  );&#125;;</code></pre><p>å¯ä»¥çœ‹åˆ°å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯åŠ è½½çš„æ—¶å€™æ‰§è¡Œ loginã€‚</p><p>è¿™é‡Œæœ‰ä¸ªæ³¨æ„ç‚¹ï¼Œæˆ‘ä»¬ç›‘å¬è¢«åŒ…è£¹çš„é¡µé¢çš„ onShow äº‹ä»¶ï¼Œä½†æ˜¯ onShow å®é™…ä¸Šæ˜¯é¡µé¢çš„ç”Ÿå‘½å‘¨æœŸï¼Œå³æœªç™»å½•æ—¶ï¼Œè¢«åŒ…è£¹é¡µé¢çš„ç»„ä»¶çš„ onShow ä¸ä¼šåœ¨ç™»å½•å®Œæˆåæ‰§è¡Œã€‚å› æ­¤åšäº†ä¸€ä¸ª hackï¼Œå³ç™»å½•å®Œæˆåè°ƒç”¨å½“å‰é¡µé¢çš„ onShowã€‚</p><p>å›åˆ° login åˆåšäº†ä»€ä¹ˆå‘¢ï¼Ÿè¿™é‡Œå…ˆæŒ‰ä¸‹ä¸è¡¨ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘å‡ ä¸ªé—®é¢˜</p><ol><li>ç”¨æˆ·ç™»å½•æ€å¤±æ•ˆäº†è¯¥æ€ä¹ˆåŠï¼Œä¸Šè¿°ä»£ç å¹¶æ²¡æœ‰æ£€æµ‹ç™»å½•æ€æ˜¯å¦å¤±æ•ˆçš„é€»è¾‘</li><li>è¿›å…¥é¡µé¢æ—¶ç™»å½•æ€æœ‰æ•ˆï¼Œç„¶è€Œè¯·æ±‚æ¥å£æ—¶ç”¨æˆ·ç™»å½•æ€å¤±æ•ˆäº†æ€ä¹ˆå¤„ç†</li></ol><p>å¯¹çš„ï¼Œè§£å†³ä¸Šè¿°ä¸¤ä¸ªé—®é¢˜çš„æ–¹æ³•ï¼Œè¯·æ±‚çš„æ—¶å€™å¦‚æœæœåŠ¡ç«¯è¿”å› 401 ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ‰ä¸¤ç§é€‰æ‹©ï¼š</p><ol><li>åœ¨é¡µé¢ä¸Šç›–ä¸€å±‚æç¤ºå¼‚å¸¸çš„é¡µé¢ï¼Œè®©ç”¨æˆ·ç‚¹å‡»é‡æ–°ç™»å½•</li><li>é™é»˜æ‰§è¡Œ loginï¼Œé‡æ–°è·å–ç”¨æˆ·ä¿¡æ¯å³å¯</li></ol><p>ç¬¬ä¸€ç§æ–¹æ¡ˆçœ‹ä¼¼æŒºå¥½çš„ï¼Œå®é™…ä¸Šå®ç°èµ·æ¥å¹¶ä¸ç®€å•ï¼Œå°†ä¼šæ¶‰åŠåˆ°é¡µé¢å¸ƒå±€ï¼Œæ•°æ®é€šä¿¡ç­‰ç­‰ã€‚é‚£ä¹ˆå¦‚æœé‡‡ç”¨ç¬¬äºŒç§æ–¹æ¡ˆè¦åœ¨æ¥å£ç™»å½•æ€å¤±æ•ˆçš„æ—¶å€™ loginï¼Œéœ€è¦è€ƒè™‘å“ªäº›é—®é¢˜ï¼Ÿ</p><ol><li>å¹¶å‘ï¼š å¦‚æœåŒæ—¶æœ‰ä¸¤ä¸ªæ¥å£è°ƒç”¨ loginï¼Œé‚£ä¼šä¸ä¼šåŒæ—¶å­˜åœ¨ä¸¤ä¸ªè¯·æ±‚ç™»å½•çš„æ¥å£ï¼Œæœ‰æ²¡æœ‰åŠæ³•ä¼˜åŒ–ï¼Ÿ</li><li>é‡è¯•ï¼šç™»å½•æˆåŠŸä¹‹åï¼Œä¹‹å‰çš„å¤±æ•ˆçš„è¯·æ±‚æ˜¯å¦è¿˜éœ€è¦é‡æ–°å‘ä¸€æ¬¡å‘¢ï¼Ÿ</li><li>é‡è¯•æ¬¡æ•°ï¼šå¦‚æœç™»å½•æ¥å£å¼‚å¸¸ï¼Œè¿”å›çš„ç”¨æˆ·ä¿¡æ¯å°±æ˜¯ä¸æ­£ç¡®çš„ï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½å¯¼è‡´ä¸€ç›´é‡è¯•æ­»å¾ªç¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦é™åˆ¶æœ€å¤šå°è¯•ç™»å½•çš„æ¬¡æ•°ã€‚</li></ol><p>å¹¶å‘å°±æ¶‰åŠåˆ° login çš„å®ç°äº†ï¼Œè¿™é‡Œå¾ˆå®¹æ˜“æƒ³åˆ°å°±æ˜¯å•ä¾‹æ¨¡å¼ï¼Œå®é™…ä¸Šåœ¨å‰ç«¯å€ŸåŠ© esm æ˜¯å¾ˆå®¹æ˜“å®ç°ä¸€ä¸ªå•ä¾‹çš„</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">import Taro from &#39;@tarojs&#x2F;taro&#39;;&#x2F;** ä¿æŒä¸€ä¸ª promise é˜²æ­¢å¹¶è¡Œ *&#x2F;let loginPromise;&#x2F;** ç™»å½• *&#x2F;export const login &#x3D; () &#x3D;&gt; &#123;  if (!loginPromise) &#123;    loginPromise &#x3D; new Promise&lt;UserInfo&gt;((resolve, reject) &#x3D;&gt; &#123;      Taro.login(&#123;        async success(res) &#123;          if (res.code) &#123;            try &#123;              &#x2F;&#x2F; è¯·æ±‚æœåŠ¡ç«¯ç”¨æˆ·ä¿¡æ¯              let userRes &#x3D; await getUserLogin(&#123;                code: res.code,              &#125;);              userStore.setState(&#123; userInfo: userRes &#125;);              resolve(userRes);            &#125; catch (error) &#123;              &#x2F;&#x2F; æ¸…é™¤æ‰ storage ä¸­çš„ user ä¿¡æ¯              userStore.setState(&#123; userInfo: undefined &#125;);              reject(error);            &#125;          &#125; else &#123;            reject(&#123; code: -1, message: &#39;ç™»å½•å¤±è´¥&#39; &#125;);          &#125;          loginPromise &#x3D; null;        &#125;,        fail: (res) &#x3D;&gt; &#123;          reject(&#123; code: -1, message: &#39;ç™»å½•å¤±è´¥&#39; &#125;);          loginPromise &#x3D; null;        &#125;,      &#125;);    &#125;);  &#125;  return loginPromise;&#125;;</code></pre><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œå¦‚æœå·²ç»å­˜åœ¨äº† loginPromiseï¼Œå°±ä¸å†åˆ›å»ºæ–°çš„ promise</p><p>ç¬¬äºŒä¸‰ç‚¹åˆ™æ˜¯éœ€è¦å°è£…åœ¨ request é‡Œï¼Œè¿™é‡Œå°±éœ€è¦å¯¹ request è¿›è¡Œä¸€ä¸ªå°æ”¹é€ äº†</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">let retryTimes &#x3D; 0;async function myRequest(config) &#123;  &#x2F;&#x2F; ç™»å½•å¤±æ•ˆä¸€å…±å¯é‡è¯• 3 æ¬¡  let MAX_RETRY_TIMES &#x3D; 3;  try &#123;    const res &#x3D; await request(config);    const &#123; code, data &#125; &#x3D; res.data;    if (res.statusCode &#x3D;&#x3D;&#x3D; 401 &amp;&amp; retryTimes &lt; MAX_RETRY_TIMES) &#123;      &#x2F;&#x2F; é‡è¯•è®¡æ•°å™¨åŠ  1      retryTimes &#x3D; retryTimes + 1;      &#x2F;&#x2F; æ¸…ç©ºç™»å½•      userStore.setState(&#123; userInfo: undefined &#125;);      &#x2F;&#x2F; è¿‡æœŸæˆ–è€…ç™»å½•æ€å¤±æ•ˆ      await login();      &#x2F;&#x2F; é‡æ–°è¯·æ±‚ä¸€æ¬¡      const res2 &#x3D; await youpinRequest&lt;T&gt;(config);      return res2;    &#125;    return data;  &#125; catch (error) &#123;    throw error;  &#125;&#125;</code></pre><p>è¿™é‡Œæ•´ä¸ªåº”ç”¨å­˜åœ¨çš„å‘¨æœŸå…è®¸ç”¨æˆ·é‡è¯• MAX_RETRY_TIMES æ¬¡æ•°</p><h4 id="ä¸€åƒç´ è¾¹æ¡†"><a href="#ä¸€åƒç´ è¾¹æ¡†" class="headerlink" title="ä¸€åƒç´ è¾¹æ¡†"></a>ä¸€åƒç´ è¾¹æ¡†</h4><p>å†™è¿‡ h5 çš„åŒå­¦å¯èƒ½ç»å¸¸é‡åˆ°ä¸€åƒç´ é—®é¢˜ï¼Œå³1px åœ¨ç§»åŠ¨ç«¯å®é™…ä¸Šå¯¹åº”çš„æ˜¯ 1 * pixelRatio çš„ç‰©ç†åƒç´ ï¼Œå¯¼è‡´æ•´ä¸ªè¾¹æ¡†æ˜¾å¾—æ ¼å¤–ç²—ï¼ŒUI åŒå­¦å°±ä¼šè¿‡æ¥æ‰¾ä½ éº»çƒ¦ã€‚è§£å†³æ–¹æ¡ˆä¹Ÿæ˜¯äº”èŠ±å…«é—¨ï¼Œæ¯”è¾ƒé€šç”¨çš„æ–¹æ¡ˆæ˜¯é€šè¿‡ç¼©æ”¾å¸¦è¾¹æ¡†çš„ä¼ªå…ƒç´ æ¥è§£å†³ã€‚</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">.hairline-border &#123;  position: relative;  border: none;  &amp;::after &#123;    content: &#39;&#39;;    position: absolute;    left: 0;    top: 0;    transform-origin: top left;    box-sizing: border-box;    pointer-events: none;    width: 200%;    height: 200%;    transform: scale(0.5);    &#x2F;&#x2F; prettier-ignore    border-width: 1PX;    border-style: solid;    border-color: black;  &#125;&#125;</code></pre><p>ä¹‹ååœ¨éœ€è¦çš„ç»„ä»¶ä¸Šæ·»åŠ è¿™ä¸ª hairline-border æ ·å¼å°±å¯ä»¥äº†ã€‚ç„¶è€Œåœ¨æ¯ä¸ªç»„ä»¶ä¸Šæ·»åŠ æ ·å¼åå®å±æœ‰äº›éº»çƒ¦ï¼Œç‰¹åˆ«æ˜¯ä¸ css module åœ¨ä¸€èµ·ä½¿ç”¨æ—¶</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">&lt;View className&#x3D;&#123;classnames([styles.myStyles, &quot;hairline-border&quot;])&#125; &#x2F;&gt;</code></pre><p>å·®ä¸å¤šæ˜¯ä¸Šè¿°ä»£ç è¿™æ ·çš„ï¼Œå¦‚æœç»„ä»¶æœ‰åœ†è§’åˆ™æ›´ä¸ºéº»çƒ¦ï¼Œéœ€è¦åœ¨ myStyles é‡Œå†™</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">.myStyles &#123;  &amp;::after &#123;    &#x2F;&#x2F; å¦‚æœéœ€è¦çš„åœ†è§’ä¸º 4ï¼Œåˆ™è¦å†™æˆ 4 * 2 &#x3D; 8border-radius: 8px;&#125;&#125;</code></pre><p>è¿˜æ¯”å¦‚æˆ‘å¸Œæœ›ä»…åº•éƒ¨æœ‰ borderï¼Œè¦æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p><p>è¿™é‡Œå¯ä»¥å€ŸåŠ© less æä¾›çš„å‡½æ•°èƒ½åŠ›è¿›è¡Œä¸€ä¸ªç®€å•çš„å°è£…</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">&#x2F;** * 1 åƒç´ è¾¹æ¡† * @example * &#96;&#96;&#96; * @import &#39;@&#x2F;hairline-border.less&#39;; * &#x2F;&#x2F; çº¢è‰²çš„ä¸€åƒç´ è¾¹æ¡† * .hairline-border(red) * &#x2F;&#x2F; åœ†è§’ä¸º 4px çš„ä¸€åƒç´ çº¢è‰²è¾¹æ¡† * .hairline-border(red, 4px) * &#x2F;&#x2F; åœ†è§’ä¸º 4px çš„ä¸€åƒç´ çº¢è‰²é¡¶éƒ¨è¾¹æ¡† * .hairline-border(red, 4px, top) * &#x2F;&#x2F; ä¸å¸¦åœ†è§’çš„ä¸€åƒç´ çº¢è‰²é¡¶éƒ¨è¾¹æ¡† * .hairline-border(red, 0, top) * &#96;&#96;&#96; *&#x2F;.hairline-border(@color) &#123;  position: relative;  border: none;  &amp;::after &#123;    content: &#39;&#39;;    position: absolute;    left: 0;    top: 0;    transform-origin: top left;    box-sizing: border-box;    pointer-events: none;    width: 200%;    height: 200%;    transform: scale(0.5);    &#x2F;&#x2F; prettier-ignore    border-width: 1PX;    border-style: solid;    border-color: @color;  &#125;&#125;.hairline-border(@color, @radius) &#123;  .hairline-border(@color);  &amp;::after &#123;    border-radius: @radius * 2;  &#125;&#125;.hairline-border(@color, @radius, @position) &#123;  .hairline-border(@color, @radius);  &amp;::after &#123;    border-width: 0px;    each(@position, &#123;      &#x2F;&#x2F; prettier-ignore      border-@&#123;value&#125;-width: 1PX;    &#125;);  &#125;&#125;@media only screen and (-webkit-min-device-pixel-ratio: 3) &#123;  .hairline-border(@color) &#123;    position: relative;    border: none;    &amp;::after &#123;      content: &#39;&#39;;      position: absolute;      left: 0;      top: 0;      transform-origin: top left;      box-sizing: border-box;      pointer-events: none;      width: 300%;      height: 300%;      transform: scale(0.33);      &#x2F;&#x2F; prettier-ignore      border-width: 1PX;      border-style: solid;      border-color: @color;    &#125;  &#125;  .hairline-border(@color, @radius) &#123;    .hairline-border(@color);    &amp;::after &#123;      border-radius: @radius * 3;    &#125;  &#125;  .hairline-border(@color, @radius, @position) &#123;    .hairline-border(@color, @radius);    &amp;::after &#123;      border-width: 0px;      each(@position, &#123;      &#x2F;&#x2F; prettier-ignore      border-@&#123;value&#125;-width: 1PX;    &#125;);    &#125;  &#125;&#125;</code></pre><p>é‚£ä¹ˆä½¿ç”¨çš„æ—¶å€™</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">.myStyle &#123;.hairline-border(red, 0, top)&#125;</code></pre><p>æ˜¯ä¸æ˜¯å°±å¾ˆæ–¹ä¾¿äº†</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">&lt;View className&#x3D;&#123;styles.myStyles&#125; &#x2F;&gt;</code></pre><p>æœªå®Œå¾…ç»­</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å°ç¨‹åº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°ç¨‹åºè¸©å‘å°è®°ï¼ˆä¸€ï¼‰</title>
      <link href="/2021/06/15/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%B8%A9%E5%9D%91%E5%B0%8F%E8%AE%B0/"/>
      <url>/2021/06/15/%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%B8%A9%E5%9D%91%E5%B0%8F%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘å…¬å¸å°†æç½®äº†ä¸€å¹´çš„å°† RN åº”ç”¨æ¬åˆ°å°ç¨‹åºçš„è®¡åˆ’æä¸Šè®®ç¨‹ï¼Œç”±æ­¤å¼€å§‹äº†è¿™æ®µæ—¶é—´çš„è¸©å‘ä¹‹æ—…ã€‚è€ƒè™‘åˆ°æŠ€æœ¯æ ˆä¸º reactï¼Œå› æ­¤ä½¿ç”¨ tarojs ä½œä¸ºåŸºç¡€æ¡†æ¶ã€‚</p><a id="more"></a><h4 id="mock"><a href="#mock" class="headerlink" title="mock"></a>mock</h4><p>åœ¨ rn é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ axios å¹¶æ­é… axios-mock-adapter ä½œä¸º mockï¼Œè€Œ tarojs æä¾›äº† mock æ’ä»¶ï¼Œç”±äºä»…åœ¨ dev åœºæ™¯ä¸‹æ‰ä¼šä½¿ç”¨åˆ° mockï¼Œé…ç½®å¦‚ä¸‹:</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; package.json&quot;scripts&quot;: &#123;    &quot;dev:weapp:mock&quot;: &quot;MOCK&#x3D;1 npm run dev:weapp&quot;,  &#125;,</code></pre><p>æ–°å¢ä¸€ä¸ª <code>script</code>, å¹¶ä¸”æ·»åŠ ç¯å¢ƒå˜é‡ <code>MOCK=1</code>ã€‚ç„¶è€Œä»…ä»…æ˜¯è¿™æ ·çš„è¯ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ä¸šåŠ¡ä»£ç ä¸­å»å– <code>process.env.MOCK</code>ï¼Œå–çš„å€¼æ˜¯ <code>undefined</code>ã€‚</p><p>è§£å†³çš„æ–¹æ³•æ˜¯åœ¨ config/dev.js ä¸‹æ³¨å…¥ï¼Œé…ç½®å¦‚ä¸‹:</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#123;  env: &#123;      NODE_ENV: &#39;&quot;development&quot;&#39;,      MOCK: process.env.MOCK,    &#125;,&#125;</code></pre><p>æ­¤æ—¶åœ¨ä¸šåŠ¡ä»£ç ä¸­å»å– <code>process.env.MOCK</code> å¯ä»¥å¾—åˆ° <code>1</code>ã€‚è¿™é‡Œå€¼å¾—æ³¨æ„ï¼ŒæŒ‰é“ç†è¯´åº”è¯¥è·å–åˆ°å­—ç¬¦â€1â€ï¼Œç„¶è€Œå®é™…ä¸Šå´æ˜¯ number ç±»å‹çš„ 1ã€‚</p><p>åœ¨ config/dev.js ä¸‹è¿˜éœ€æ·»åŠ ä¸€ä¸ªmock æ’ä»¶çš„é…ç½®</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#123;  plugins:      process.env.MOCK &#x3D;&#x3D;&#x3D; &#39;1&#39;        ? [            [              &#39;@tarojs&#x2F;plugin-mock&#39;,              &#123;&#125;            ],          ]        : [],&#125;</code></pre><p>è‡³æ­¤ï¼Œå½“æˆ‘ä»¬è¿è¡Œ <code>npm run dev:weapp:mock</code>æ—¶ï¼Œå°†ä¼šå¯åŠ¨ä¸€ä¸ª mock æœåŠ¡å™¨ã€‚</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥å°±éœ€è¦å®šåˆ¶ä¸€ä¸‹æˆ‘ä»¬çš„è¯·æ±‚</p><h4 id="request"><a href="#request" class="headerlink" title="request"></a>request</h4><p>tarojs æä¾›äº† request æ¥å‘é€è¯·æ±‚ï¼Œä½†ä»…ä»…è¿™è¿˜ä¸å¤Ÿç”¨ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬å¸Œæœ›æœ¬åœ°å¼€å‘çš„æ—¶å€™ï¼Œmock æ—¶ä½¿ç”¨çš„æ˜¯ mock æœåŠ¡å™¨çš„æ¥å£ï¼Œémock æ—¶ä½¿ç”¨æµ‹è¯•æœåŠ¡å™¨çš„æ¥å£ï¼Œä¸Šçº¿çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯çº¿ä¸Šçš„æ¥å£ï¼Œå³ä¸€ä¸ªæ ¹æ®ä¸åŒç¯å¢ƒ baseUrl çš„åŠŸèƒ½ã€‚</p><p>åˆ¤æ–­ å¼€å‘/çº¿ä¸Šç¯å¢ƒå¯ä»¥é€šè¿‡ getAccountInfoSync æ¥è·å–ï¼Œåˆ¤æ–­æ˜¯å¦ mock å¯ä»¥é€šè¿‡ process.env.MOCK æ¥è·å–ã€‚</p><p>ç„¶è€Œ request å¹¶ä¸åƒ axios é‚£æ ·å¯ä»¥æ ¹æ®é…ç½®åˆ›å»ºä¸€ä¸ª instance å®ä¾‹ï¼Œå¹¶ä¸”æä¾› baseUrl è¿™æ ·çš„é…ç½®ï¼Œæ‰€å¹¸ request å¯ä»¥è‡ªå®šä¹‰æ‹¦æˆªå™¨ interceptorã€‚</p><p>åˆ©ç”¨è¿™ç‚¹å®ç°ä¸Šè¿°éœ€æ±‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">import &#123; request, addInterceptor, getAccountInfoSync &#125; from &#39;@tarojs&#x2F;taro&#39;;const accountInfo &#x3D; getAccountInfoSync();const interceptor &#x3D; function (chain) &#123;  const requestParams &#x3D; chain.requestParams;  const &#123; url &#125; &#x3D; requestParams;  const host &#x3D;    accountInfo.miniProgram.envVersion &#x3D;&#x3D;&#x3D; &#39;develop&#39;      ? &#x2F;&#x2F; è¿™é‡Œçš„ process.env.MOCK æŒ‰é“ç†åº”è¯¥æ˜¯ stringï¼Œç„¶è€Œå®é™…ä¸Š taro ç»™æ³¨å…¥çš„æ˜¯ numberï¼Œå› æ­¤ä½¿ç”¨ any æš‚æ—¶è·³è¿‡        (process.env.MOCK as any) &#x3D;&#x3D;&#x3D; 1        ? MockServer        : TestServer      : ProServer;  return chain.proceed(&#123; ...requestParams, url: &#96;$&#123;host&#125;$&#123;url&#125;&#96; &#125;);&#125;;addInterceptor(interceptor);</code></pre><p>request è¿”å›çš„ç»“æœ res ä¸­çš„ data å­—æ®µæ˜¯æ¥å£è¿”å›ç»™æˆ‘ä»¬çš„å†…å®¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬è¿˜å¸Œæœ›èƒ½ç›´æ¥è·å–åˆ° res.dataã€‚é€šå¸¸è¿™é‡Œè¿˜æ˜¯ä¼šç”¨ interceptor æ¥åšä¸€å±‚æ‹¦æˆªï¼Œè¿”å› res.data , ä½†æ˜¯è¿™æ ·çš„è¯ï¼Œåœ¨ Typescript ä¸­ä½ ä¼šå‘ç°è¿”å›çš„ç±»å‹ä¸ request çš„è¿”å›ç±»å‹æ˜¯ä¸ä¸€è‡´çš„ã€‚å› æ­¤ä¸ºäº†ä¸å½±å“è¾“å‡ºçš„ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ request åšä¸€å±‚å°è£…</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const myRequest &#x3D; &lt;T &#x3D; any&gt;(config: request.Option) &#x3D;&gt;  request&lt;&#123; code: number; data: T &#125;&gt;(config).then((res) &#x3D;&gt; &#123;    const &#123; code, data &#125; &#x3D; res.data;    return data;  &#125;);export default myRequest;</code></pre><p>åˆ°è¿™ä¸€æ­¥æˆ‘ä»¬çš„è¯·æ±‚å°±å°è£…å¥½äº†ã€‚</p><h4 id="é¡µé¢èƒŒæ™¯è‰²"><a href="#é¡µé¢èƒŒæ™¯è‰²" class="headerlink" title="é¡µé¢èƒŒæ™¯è‰²"></a>é¡µé¢èƒŒæ™¯è‰²</h4><p>å…³äºé¡µé¢èƒŒæ™¯è‰²ï¼Œå°ç¨‹åºæœ‰ä¸ª app.json é…ç½®é¡¹ <code>backgroundColor</code>ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è¿™é‡Œè®¾ç½®çš„è¯ä½ ä¼šå‘ç°åŸºæœ¬æ²¡ç”¨ï¼Œé‚£æ˜¯å› ä¸ºè¿™ä¸ªé…ç½®é¡¹å®é™…ä¸ŠæŒ‡çš„æ˜¯çª—ä½“çš„èƒŒæ™¯è‰²ï¼Œè€Œé <code>page</code> çš„èƒŒæ™¯è‰²ï¼Œå› æ­¤è§£å†³æ–¹æ¡ˆå°±æ˜¯ç›´æ¥åœ¨å…¨å±€æ ·å¼é‡Œç»™ page æ·»åŠ æ ·å¼ã€‚</p><p>è¯´åˆ°è¿™ä¸ª <code>backgroundColor</code>ï¼Œå¦‚æœæˆ‘ä»¬é…ç½®é¡µé¢çš„ <code>enablePullDownRefresh</code> ä¸‹æ‹‰åˆ·æ–°ï¼Œä½ ä¼šå‘ç°ä¸‹æ‹‰åˆ·æ–°ä¼¼ä¹æ²¡æœ‰åŠ¨ç”»ï¼Œè¿™æ˜¯å› ä¸º<code>backgroundColor</code> é»˜è®¤è‰²å€¼æ˜¯ç™½è‰²ï¼Œè€Œè¿™ä¸ªå’ŒåŠ¨ç”»çš„é¢œè‰²æ˜¯ä¸€æ ·çš„ã€‚</p><h4 id="å›¾ç‰‡é™æ€èµ„æº"><a href="#å›¾ç‰‡é™æ€èµ„æº" class="headerlink" title="å›¾ç‰‡é™æ€èµ„æº"></a>å›¾ç‰‡é™æ€èµ„æº</h4><p>å°ç¨‹åºè¦æ±‚æ‰“åŒ…åä½“ç§¯ä¸è¶…è¿‡ 2mï¼Œå› æ­¤å›¾ç‰‡ç­‰é™æ€èµ„æºéœ€è¦ä¸Šä¼ åˆ° cdn ï¼ˆä¸Šä¼ æ–¹æ³•ä¸èµ˜è¿°ï¼Œæ ¹æ®è‡ªå·±çš„ cdn å·¥å…·ç¼–å†™è„šæœ¬ä»£ç å³å¯ï¼‰ã€‚webpack çš„ output æä¾›äº† publicPath å±æ€§æ¥é…ç½®ã€‚</p><p>å› æ­¤ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒé…ç½®å¦‚ä¸‹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; config&#x2F;prod.jsmodule.exports &#x3D; &#123;  env: &#123;    NODE_ENV: &#39;&quot;production&quot;&#39;,  &#125;,  defineConstants: &#123;&#125;,  mini: &#123;    output: &#123;      publicPath: &#39;https:&#x2F;&#x2F;your.cdn.com&#x2F;&#39;,    &#125;,  &#125;&#125;;</code></pre><p>é‚£ä¹ˆç”Ÿäº§ç¯å¢ƒæ‰“åŒ…å°±ä¼šå°†é™æ€èµ„æºå¼•ç”¨åœ°å€å˜æˆè¯¸å¦‚ â€œ<a href="https://your.cdn.com/your.png&quot;">https://your.cdn.com/your.png&quot;</a> çš„å½¢å¼ã€‚</p><p>è¿™æ˜¯åœ¨ js ä»£ç ä¸­ç›´æ¥å¼•ç”¨å›¾ç‰‡çš„å¤„ç†ï¼Œè¿˜æœ‰ä¸€ä¸ªå®¹æ˜“å¿½ç•¥æ‰çš„åœ°æ–¹æ˜¯ css æ–‡ä»¶ä¸­ä¹Ÿä¼šç”¨åˆ° background-imageï¼Œè¿™æ—¶å€™éœ€è¦é…ç½® imageUrlLoaderOption å±æ€§</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; config&#x2F;prod.jsmodule.exports &#x3D; &#123;  env: &#123;    NODE_ENV: &#39;&quot;production&quot;&#39;,  &#125;,  defineConstants: &#123;&#125;,  mini: &#123;    &#x2F;&#x2F; ...    imageUrlLoaderOption: &#123;      limit: 0, &#x2F;&#x2F; å•ä½ä¸º byte å­—èŠ‚      fallback: &#123;        loader: &#39;file-loader&#39;,        options: &#123;          outputPath: &#39;assets&#x2F;images&#39;,          name: &#39;[name].[ext]&#39;,          publicPath: &#39;https:&#x2F;&#x2F;your-cdn&#x2F;assets&#x2F;images&#x2F;&#39;,        &#125;,      &#125;,    &#125;,  &#125;&#125;;</code></pre><p>å¦‚æ­¤è¿™äº› css ä¸­çš„å›¾ç‰‡ä¹Ÿä¼šè½¬æˆ cdn åœ°å€ã€‚</p><p>å‡è®¾æˆ‘ä»¬çš„é™æ€èµ„æºå…¨éƒ¨éƒ½ä½äº src/assets é‡Œï¼Œé€šè¿‡ä¸Šè¿°é…ç½®æˆ‘ä»¬çš„é™æ€èµ„æºè¿˜æ˜¯ä¼šè¢«æ„å»ºåˆ° dist/assets ç›®å½•ä¸‹ã€‚æ­¤æ—¶æœ‰å‡ ä¸ªæ–¹æ¡ˆï¼š</p><ol><li><p>åœ¨æ‰“åŒ…è„šæœ¬é‡Œç›´æ¥åˆ é™¤ <code>rm -rf src/assets</code></p></li><li><p>åœ¨ <code>project.config.json</code> ä¸­é…ç½® <code>packOptions</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#123;&#x2F;&#x2F;...&quot;packOptions&quot;: &#123;    &quot;ignore&quot;: [&#123;      &quot;type&quot;: &quot;folder&quot;,      &quot;value&quot;: &quot;assets&quot;    &#125;]  &#125;&#125;</code></pre><p>æ ¹æ®å°ç¨‹åºçš„æ–‡æ¡£ï¼Œè¿™ä¹ˆé…ç½®å°†ä¼šåœ¨ <strong>æ‰“åŒ…å’Œé¢„è§ˆæ—¶</strong>æ ¹æ®è§„åˆ™å¿½ç•¥ä¸Šä¼ çš„æ–‡ä»¶ã€‚ç„¶è€Œæ ¹æ®å®æµ‹ï¼Œåœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ç¼–è¯‘æ—¶ä¹Ÿä¼šå¯¼è‡´è¯»å–ä¸åˆ°æ–‡ä»¶ï¼Œè¿™é‡Œæ˜¯å®˜æ–¹ç¤¾åŒºçš„å›ç­” <a href="https://developers.weixin.qq.com/community/develop/doc/0002a2a6fe4e38a8c668c95d25b400?highLine=packOptions">https://developers.weixin.qq.com/community/develop/doc/0002a2a6fe4e38a8c668c95d25b400?highLine=packOptions</a></p><blockquote><p>ç›®å‰è¿˜ä¸æ”¯æŒè¿™ç§éœ€æ±‚ï¼Œå¯ä»¥è€ƒè™‘åœ¨ä¸Šä¼ /é¢„è§ˆæ—¶ï¼Œæ‰å¯ç”¨ packOptions å­—æ®µï¼ˆä¾‹å¦‚debugæ—¶æŠŠè¿™ä¸ªå­—æ®µæ”¹æˆ packOptions2ï¼Œä¸Šä¼ æ—¶æ”¹æˆ packOptionsï¼‰</p></blockquote><p>æ€ä¹ˆè¯´å‘¢ï¼Œå°±æŒºæ— è¯­çš„ã€‚ã€‚å› æ­¤è¯¥æ–¹æ¡ˆä¸å¯å–</p></li><li><p>é€šå¸¸æˆ‘ä»¬ä¸ä¼šäººå·¥æ‰“åŒ…ï¼Œå°ç¨‹åºé¡µæä¾›äº† CI æ¥å£æ¥å®ç° CI / CDï¼Œè€Œ CI é‡Œæä¾›äº†é…ç½®æ¥å¿½ç•¥æ–‡ä»¶ã€‚ä¸‹é¢æˆ‘ä¼šåœ¨ CI å‘å¸ƒä¸­è¯¦ç»†è§£é‡Šã€‚</p></li></ol><h4 id="git-flow"><a href="#git-flow" class="headerlink" title="git flow"></a>git flow</h4><p>è¯´ CI ä¹‹å‰ï¼Œå¾—å…ˆè®¾è®¡å¥½ git flowã€‚å°ç¨‹åºä¸ web ä¸åŒä¹‹å¤„åœ¨äºåªèƒ½æœ‰ä¸€ä¸ªä½“éªŒç‰ˆåŠä¸€ä¸ªçº¿ä¸Šç‰ˆï¼Œè€Œ web æˆ‘ä»¬é€šå¸¸æ˜¯å¯ä»¥æœ‰æµ‹è¯•ï¼Œé¢„å‘ï¼Œæ­£å¼ç­‰ç¯å¢ƒã€‚è€Œå½“å‰é¡¹ç›®å®é™…ä¸Šæœ‰æ¶‰åŠç›´æ’­åŠŸèƒ½ï¼Œå…¶ä¸­åå°åˆ›å»ºç›´æ’­é—´æ—¶ï¼ŒæœåŠ¡ç«¯å´æ— æ³•åŒºåˆ†ç¯å¢ƒï¼Œä¸ºæ­¤é¢å¤–ç”³è¯·äº†ä¸€ä¸ªå°ç¨‹åºä½œä¸ºæµ‹è¯•ç¯å¢ƒã€‚ä¸ºäº†æ–¹ä¾¿æè¿°ï¼Œå°†åŸå°ç¨‹åºç§°ä¸º Aï¼Œæµ‹è¯•å°ç¨‹åºç§°ä¸º Bã€‚</p><p>ç›®å‰è®¾è®¡çš„ git flow å¦‚ä¸‹ï¼š</p><ol><li>Release åˆ†æ”¯å¯¹åº”æµ‹è¯•ç¯å¢ƒï¼Œä»£ç å°†ä¼šå‘å¸ƒåˆ° Bï¼Œsimulation åˆ†æ”¯å¯¹åº”é¢„å‘ï¼Œä»£ç å‘å¸ƒåˆ° Aï¼Œmaster åˆ†æ”¯ä»ç„¶ä¸ºçº¿ä¸Šç¨³å®šç‰ˆæœ¬ã€‚</li><li>ä¸Šçº¿æ—¶å°† simulation æå‡ç‰ˆæœ¬å·ååˆå¹¶å› master åˆ†æ”¯ï¼Œæ­¤æ—¶è§¦å‘ CI å‘å¸ƒåˆ° A ä¸Šã€‚</li><li>ç»æµ‹è¯•ï¼ŒåŒæ ·å¼€å‘è€…ä¸Šä¼ åˆ°å°ç¨‹åºä¸Šï¼Œæ˜¯ä¼šç›´æ¥è¦†ç›–æ›´æ–°çš„ï¼Œå°±æ˜¯è¯´å¦‚æœ B ä¸Šé¢å·²ç»æœ‰äº†ä¸€ä¸ªæˆ‘å·²ç»ä¸Šä¼ äº†ä¸€ä¸ªä½“éªŒç‰ˆï¼Œé‚£ä¹ˆå¦‚æœå†æ¬¡ä¸Šä¼ æ›´æ–°çš„ä»£ç ï¼Œå°±ä¼šå°†ä¹‹å‰çš„ä½“éªŒç‰ˆç›´æ¥è¦†ç›–æ‰ã€‚åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œä»£ç ä¸Šåˆ° release æ—¶æ—¶å¯ä»¥ä¸ä¿®æ”¹ç‰ˆæœ¬å·çš„ã€‚å¦‚æ­¤æµ‹è¯•åŒå­¦å°±æ— éœ€æ¯æ¬¡æ‰«ç æ›´æ–°æµ‹è¯•ç¯å¢ƒçš„ç‰ˆæœ¬ã€‚é‚£ä¹ˆä»å‘å¸ƒä»£ç è„šæœ¬å±‚é¢ä¸Šæ¥è¯´å°±æ˜¯ release / simulation åˆ†æ”¯ä¸Šçš„ä»£ç æ„å»ºæ—¶å®Œå…¨å¯ä»¥å°†ç‰ˆæœ¬å·å®šæ­»ï¼Œè€Œä¸ç”¨ä» package.json ä¸­å»è·å–ï¼Œé‚£ä¹ˆéœ€è¦ç»´æŠ¤ç‰ˆæœ¬å·çš„åœ°æ–¹åªæœ‰ master åˆ†æ”¯ã€‚</li><li>master ç‰ˆæœ¬å·ä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿å›æ»š, è¿™é‡Œéœ€è¦å†™å¥½ ChangeLogï¼Œ æ‰“ tagã€‚</li><li>master åˆ†æ”¯è¿˜éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ envVersion æ­¤å‰æˆ‘ä»¬æ ¹æ®è¿™ä¸ªå€¼æ¥åˆ¤æ–­ç¯å¢ƒï¼Œç„¶è€Œå°ç¨‹åºåœ¨å®¡æ ¸æ—¶è¿™ä¸ªå€¼æ˜¯ä¸è§„å¾‹çš„ï¼Œå› æ­¤åœ¨master åˆ†æ”¯æ‰“åŒ…æ—¶éœ€è¦æ³¨æ„è¯·æ±‚çš„ host ä¸èƒ½è¯·æ±‚åˆ°æµ‹è¯•ç¯å¢ƒã€‚</li><li>ç‰ˆæœ¬å·ç®¡ç†ï¼šx.y.z , çƒ­ä¿®å¤åˆ™æå‡ zï¼Œéœ€æ±‚æå‡ yï¼Œbreaking change æå‡ x</li></ol><h4 id="CI-å‘å¸ƒ"><a href="#CI-å‘å¸ƒ" class="headerlink" title="CI å‘å¸ƒ"></a>CI å‘å¸ƒ</h4><p>è¿™é‡Œè®²ä¸€ä¸‹ ci å‘å¸ƒçš„éƒ¨åˆ†</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const ci &#x3D; require(&#39;miniprogram-ci&#39;);&#x2F;&#x2F; ...const project &#x3D; new ci.Project(&#123;  appid: &#39;your_app_id&#39;,  type: &#39;miniProgram&#39;,  projectPath: DIST,  privateKeyPath,  ignores: [&#39;node_modules&#x2F;**&#x2F;*&#39;, &#39;assets&#x2F;**&#x2F;*&#39;],&#125;);await ci.upload(&#123;  project,  version,  desc: &#96;ä¸Šä¼  $&#123;version&#125;&#96;,  setting: &#123;    es6: false,  &#125;,&#125;);</code></pre><p>ä¸»è¦è¿˜æ˜¯åˆ©ç”¨å¾®ä¿¡æä¾›çš„ ci ï¼Œä¸Šé¢çš„ ignore å°±æ˜¯æˆ‘ä»¬å¿½ç•¥é™æ€æ–‡ä»¶ä¸Šä¼ çš„é…ç½®</p><h4 id="é¢„è§ˆ"><a href="#é¢„è§ˆ" class="headerlink" title="é¢„è§ˆ"></a>é¢„è§ˆ</h4><p>å°ç¨‹åºçš„çœŸæœºé¢„è§ˆä¼šå°†ä»£ç æ‰“åŒ…åä¼ è¾“ï¼ŒåŒæ ·è¿™é‡Œé¢„è§ˆä¹Ÿæ˜¯è¦æ±‚ä½“ç§¯ä¸è¶…è¿‡ 2mã€‚</p><p>å¯ä»¥çœ‹å‡ºå°ç¨‹åºçš„é¢„è§ˆæœ¬æ„æ˜¯å°½é‡æ¨¡æ‹Ÿæ‰“åŒ…åçš„ç¯å¢ƒï¼Œé‚£æˆ‘ä»¬å°½é‡ä¸è¦åœ¨ dev æ¨¡å¼ä¸‹é¢„è§ˆï¼Œå› ä¸º dev æ¨¡å¼ä¸‹è¿˜ä¼šæ‰“å‡º source mapï¼Œä¹Ÿæ²¡æœ‰åšå‹ç¼©ï¼Œå¾ˆæœ‰å¯èƒ½å¯¼è‡´ä»£ç åŒ…è¶…è¿‡ 2m æˆ–è€…é¢„è§ˆç»“æœå’Œæœ€ç»ˆæ‰“åŒ…ç»“æœä¸ä¸€è‡´ï¼Œå› æ­¤æˆ‘ä»¬ç”¨</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">taro build --type weapp --watch</code></pre><p>è¿™ä¸ªæ¨¡å¼è¿›è¡Œé¢„è§ˆï¼Œé‚£ä¹ˆé™æ€èµ„æºå‘¢ï¼Ÿé™æ€èµ„æºæ­¤æ—¶è¿˜æ²¡æœ‰ä¸Šä¼ åˆ° cdnï¼Œå› æ­¤æˆ‘çš„æ€è·¯æ˜¯é¢å¤–æ³¨å…¥ <code>PREVIEW=1</code>ï¼Œå³è¡¨ç¤ºå½“å‰æ˜¯é¢„è§ˆæ¨¡å¼</p><p>åŒæ—¶å¯åŠ¨ä¸€ä¸ªæœ¬åœ°æœåŠ¡ï¼Œæˆ‘è¿™é‡Œç®€å•ä½¿ç”¨ koa æ¥æ­å»ºè¿™ä¸ªæœåŠ¡ç”¨äºæä¾›é™æ€èµ„æº</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; server.jsconst Koa &#x3D; require(&#39;koa&#39;);const serve &#x3D; require(&#39;koa-static&#39;);const path &#x3D; require(&#39;path&#39;);const chalk &#x3D; require(&#39;chalk&#39;);const DIST &#x3D; path.resolve(__dirname, &#39;..&#x2F;src&#39;);const server &#x3D; async () &#x3D;&gt; &#123;  const app &#x3D; new Koa();  app.use(serve(DIST));  app.listen(3000);  console.log(chalk.green(&#39;æœ¬åœ°é™æ€èµ„æºæœåŠ¡å¯åŠ¨ï¼Œç«¯å£å·ï¼š3000&#39;));&#125;;try &#123;  server();&#125; catch (error) &#123;  console.log(chalk.red(error));&#125;</code></pre><p> åœ¨è¿™ä¸ªæ¨¡å¼ä¸‹ publicPath ä¸ºæ”¹ä¸ºæœ¬åœ°æœåŠ¡çš„ ipåŠç«¯å£å³å¯ï¼Œè¯¦ç»†é…ç½®ä¸Šé¢å·²ç»è®²è¿‡ç±»ä¼¼çš„ï¼Œè¿™é‡Œå°±ä¸å±•å¼€è¯´äº†ã€‚</p><p>å¯ä»¥çœ‹åˆ°æœåŠ¡å™¨çš„é™æ€èµ„æºç›®å½•æ˜¯ srcï¼Œä¸ºå•¥ä¸æ˜¯ dist å‘¢ï¼Ÿå…¶å® dist ä¹Ÿå¯ä»¥ï¼Œæœ¬åœ°é¢„è§ˆæ—¶ï¼Œé™æ€èµ„æºè¿˜æ˜¯ä¼šè¢«æ„å»ºè¿› dist çš„ã€‚ä½†è¿™æ ·å°ç¨‹åºä½“ç§¯å°±å®¹æ˜“è¶…è¿‡ 2mï¼Œå°±åˆå›åˆ°äº†ä¸Šé¢çš„æåˆ°è¿‡çš„é—®é¢˜ã€‚æ­¤æ—¶å·²ç»æ²¡äº† ci çš„å¸®åŠ©ï¼Œå› è€Œæˆ‘è¿™é‡Œçš„åªèƒ½å»åˆ é™¤ dist/assets ï¼Œé‚£ä¹ˆå°±åªèƒ½ä» src å»æä¾›äº†ã€‚å°ç¨‹åºå®é™…ä¸Šæä¾›äº†å‡ ä¸ª hookï¼Œåˆ†åˆ«æ˜¯ç¼–è¯‘å‰ï¼Œé¢„è§ˆå‰ï¼Œä¸Šä¼ å‰</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; project.config.json&#123;&#x2F;&#x2F; ...&quot;scripts&quot;: &#123;    &quot;beforeCompile&quot;: &quot;&quot;,    &quot;beforePreview&quot;: &quot;rm -rf dist&#x2F;assets&quot;,    &quot;beforeUpload&quot;: &quot;&quot;  &#125;,&#125;</code></pre><p>ä¸€å¼€å§‹ï¼Œæˆ‘æ˜¯åœ¨é¢„è§ˆå‰å°† dist/assets åˆ æ‰ï¼Œåæ¥å‘ç°è¿™ä¹ˆåšæœ‰å‡ ä¸ªé—®é¢˜ï¼š</p><ol><li>éœ€è¦å¼€å¯å¾®ä¿¡å¼€å‘è€…å·¥å…·çš„è‡ªå®šä¹‰å¤„ç†å‘½ä»¤</li><li>ç”¨ windows çš„åŒå­¦ä¸æ”¯æŒ rm</li></ol><p>åé¢å‘ç° Taro æä¾›äº† pluginï¼Œæš´éœ²äº†æ„å»ºæ—¶çš„ä¸€äº›é’©å­ï¼Œå¦‚ <code>onBuildFinish</code>ï¼Œé€šè¿‡è‡ªå®šä¹‰æ’ä»¶ï¼Œåœ¨æ„å»ºç»“æŸååˆ é™¤ assets å³å¯ï¼Œè¿™é‡Œç”¨äº† <code>fs-extra</code> æä¾›çš„ <code>removeSync</code> æ¥åˆ é™¤ï¼Œå…·ä½“å®ç°æŒºç®€å•çš„ï¼Œè¿™é‡Œä¸èµ˜è¿°ã€‚</p><h4 id="çŠ¶æ€ç®¡ç†"><a href="#çŠ¶æ€ç®¡ç†" class="headerlink" title="çŠ¶æ€ç®¡ç†"></a>çŠ¶æ€ç®¡ç†</h4><p>ç»™åé¢å†…å®¹åšé“ºå«ï¼Œè¿™é‡Œæå‰è®²ä¸€ä¸‹å½“å‰é¡¹ç›®çš„çŠ¶æ€ç®¡ç†ä»¥åŠé€‰å‹çš„ç†ç”±ï¼Œä»¥ä¾›å‚è€ƒã€‚</p><p>ç›®å‰ react æ¯”è¾ƒä¸»æµçš„ä¸€äº›çŠ¶æ€ç®¡ç†æœ‰ï¼šçº¯ Reduxï¼ŒåŸºäº Redux çš„è¯¸å¦‚ saga / dvaï¼Œæˆ–è€…æ˜¯åŸºäºè§‚å¯Ÿè€…çš„ mobxï¼Œ æœ‰åŸºäº hooks ç®€å•å°è£…çš„ unstateï¼ŒåŒæ—¶å®˜æ–¹ä¹Ÿåœ¨åšä¸€ä¸ª recoilï¼Œä¹Ÿæœ‰ä¸€äº›åé—¨æ–¹æ¡ˆå¦‚ rxjs å¯ä»¥è¯´æ˜¯äº”èŠ±å…«é—¨äº†ã€‚è¿™ä¸ªæˆ‘å€’æ˜¯æ¯”è¾ƒæ¬£èµ vue çš„ç®€å•ç²—æš´ï¼ˆåˆ«æ•´è¿™äº›å¹ºè›¾å­ï¼Œå°±ç”¨ vuexï¼‰</p><h5 id="redux"><a href="#redux" class="headerlink" title="redux"></a>redux</h5><p>redux ä¹‹æµçš„æ¨¡æ¿è™½ç„¶æ˜¯ä¸ºäº†æ›´å¥½çº¦æŸå¼€å‘è€…ï¼Œä½†æ˜¯å†™èµ·æ¥å®å±ç¹çï¼Œå› æ­¤æš‚ä¸è€ƒè™‘ã€‚</p><h5 id="mobx"><a href="#mobx" class="headerlink" title="mobx"></a>mobx</h5><p>mobx ä¹‹å‰æœ‰åšè¿‡ä¸€äº›å°è¯•ï¼Œmobx ç»™æˆ‘çš„æ„Ÿè§‰å°±å¾ˆåƒ vuexã€‚ react åœ¨æ¨ fpï¼Œè€Œ mobx æ›´æ¥è¿‘ oopã€‚</p><p>ä¸»è¦çš„é—®é¢˜åœ¨äºå’Œ react ä¸€ç›´æ¨å´‡çš„ immutable æ€è·¯æ˜¯å®Œå…¨ä¸åŒçš„ï¼Œmobx æ›´æ¨èçš„æ˜¯ mutableï¼Œåœ¨ä¸€äº›æ—¶å€™ immutable çš„å†™æ³•åè€Œä¼šä½¿æ•°æ®å¤±å»å“åº”æ€§ã€‚</p><p>mobx ä½¿ç”¨ Class å®šä¹‰ storeï¼Œé‚£ä¹ˆå°±éœ€è¦æ³¨æ„ this æŒ‡å‘ç­‰é—®é¢˜ï¼ˆä¾‹å¦‚ action ä¸­çš„ this æŒ‡å‘ï¼Œéœ€è¦ç”¨ action.bound ç­‰ api æ¥ hackï¼‰</p><p>æ›´ä¸ç”¨è¯´è¿˜æœ‰ä¸€äº›å¸¸è§é™·é˜±ï¼Œå¦‚ <a href="https://cn.mobx.js.org/best/react.html#%E5%B8%B8%E8%A7%81%E9%99%B7%E9%98%B1-consolelog">https://cn.mobx.js.org/best/react.html#%E5%B8%B8%E8%A7%81%E9%99%B7%E9%98%B1-consolelog</a> </p><p>å½“ç„¶æˆ‘å¹¶ä¸æ˜¯è¯´ oop ä¸å¦‚ fpï¼Œåªæ˜¯ç§ç§ç‰¹æ€§è®©æˆ‘åœ¨ react ä¸­ä½¿ç”¨ mobx çš„æ—¶å€™æ„Ÿè§‰è‡ªå·±ç›¸å½“ç²¾åˆ†ï¼Œä»¥è‡³äºä¸èƒ½ç¡®å®šè¿è¡Œçš„ç»“æœæ˜¯ä¸æ˜¯çœŸçš„ä¼šå¦‚è‡ªå·±é¢„æœŸã€‚</p><h5 id="hooks-ç±»å‹çš„çŠ¶æ€ç®¡ç†"><a href="#hooks-ç±»å‹çš„çŠ¶æ€ç®¡ç†" class="headerlink" title="hooks ç±»å‹çš„çŠ¶æ€ç®¡ç†"></a>hooks ç±»å‹çš„çŠ¶æ€ç®¡ç†</h5><p>è¿™ç§æ–¹æ¡ˆä¸€èˆ¬æ˜¯å€ŸåŠ© useContext æ¥å®ç°çš„ï¼Œè¿™ç§æ–¹æ¡ˆæˆ‘å¹¶æ²¡æœ‰ä½¿ç”¨è¿‡ï¼Œä¸è¿‡å¾ˆå®¹æ˜“æƒ³åˆ°çš„å°±æ˜¯æ€§èƒ½é—®é¢˜ï¼Œå…³äºæ€§èƒ½é—®é¢˜å¯ä»¥å‚è€ƒ <a href="https://github.com/ascoders/weekly/blob/v2/146.%E7%B2%BE%E8%AF%BB%E3%80%8AReact%20Hooks%20%E6%95%B0%E6%8D%AE%E6%B5%81%E3%80%8B.md">https://github.com/ascoders/weekly/blob/v2/146.%E7%B2%BE%E8%AF%BB%E3%80%8AReact%20Hooks%20%E6%95%B0%E6%8D%AE%E6%B5%81%E3%80%8B.md</a> </p><p>å¦‚æœåªæ˜¯åšç®€å•çš„çŠ¶æ€ç®¡ç†åº”è¯¥æ˜¯ä¸ªè½»é‡çš„æ–¹æ¡ˆï¼Œä½†æ˜¯ç›®å‰çš„é¡¹ç›®è€Œè¨€æ˜¯ä¸å¤ªåˆé€‚çš„ã€‚</p><h5 id="recoil"><a href="#recoil" class="headerlink" title="recoil"></a>recoil</h5><p>è¿™ä¸ªæ˜¯å®˜æ–¹åœ¨åšçš„ä¸€ä¸ªçŠ¶æ€ç®¡ç†ï¼Œä½“éªŒçš„è¿‡ç¨‹æ˜¯ï¼Œä½¿ç”¨èµ·æ¥ç›¸å½“æ–¹ä¾¿ï¼Œæ¯ä¸ªçŠ¶æ€ç›¸å½“äºä¸€ä¸ªåŸå­ï¼Œåœ¨éœ€è¦ä½¿ç”¨çš„æ—¶å€™å°±</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const textState &#x3D; atom(&#123;  key: &#39;textState&#39;, &#x2F;&#x2F; unique ID (with respect to other atoms&#x2F;selectors)  default: &#39;&#39;, &#x2F;&#x2F; default value (aka initial value)&#125;);function TextInput() &#123;  const [text, setText] &#x3D; useRecoilState(textState);  const onChange &#x3D; (event) &#x3D;&gt; &#123;    setText(event.target.value);  &#125;;  return (    &lt;div&gt;      &lt;input type&#x3D;&quot;text&quot; value&#x3D;&#123;text&#125; onChange&#x3D;&#123;onChange&#125; &#x2F;&gt;      &lt;br &#x2F;&gt;      Echo: &#123;text&#125;    &lt;&#x2F;div&gt;  );&#125;</code></pre><p>å’Œ useState å‡ ä¹ä¸€æ ·ï¼ŒåŒæ—¶è¿˜æä¾›äº†<code>selector</code> ç”¨äºç¼“å­˜æé«˜æ€§èƒ½ï¼Œäºæ­¤åŒæ—¶è¿˜æ”¯æŒ <code>React.Suspense</code> ç­‰</p><p>å®é™…ä¸Šæˆ‘æŒºå€¾å‘ä¸è¿™ä¸ªæ–¹æ¡ˆçš„ï¼Œä½†æ˜¯è¿™ä¸ªåº“è¿˜å¤„äºå®éªŒé˜¶æ®µï¼Œå¹¶ä¸æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚</p><p>å½“ç„¶ä¸Šè¿°ç§ç§ä»…ä»…æ˜¯æˆ‘ä¸ªäººçš„ä¸€ä¸ªç®€å•å®ç”¨ä½“éªŒï¼Œæ¯ä¸ªäººä¹ æƒ¯çš„ç¼–ç¨‹æ€è·¯ä¸å¤ªä¸€æ ·ï¼Œä»…ä¾›å‚è€ƒã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬æœ€ç»ˆä½¿ç”¨çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆæ˜¯ jotai + zustandã€‚è¿™ä¸¤ä¸ªå¯èƒ½å¯¹å¤§å®¶æ¯”è¾ƒé™Œç”Ÿã€‚jotai çš„ api ä¸ recoil æå…¶ç›¸ä¼¼ï¼Œæ¯ä¸ªçŠ¶æ€éƒ½æ˜¯ä¸€ä¸ª atom</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import &#123; atom &#125; from &#39;jotai&#39;const countAtom &#x3D; atom(0)import &#123; useAtom &#125; from &#39;jotai&#39;function Counter() &#123;  const [count, setCount] &#x3D; useAtom(countAtom)  return (    &lt;h1&gt;      &#123;count&#125;      &lt;button onClick&#x3D;&#123;() &#x3D;&gt; setCount(c &#x3D;&gt; c + 1)&#125;&gt;one up&lt;&#x2F;button&gt;)&#125;</code></pre><p>ç›¸æ¯”äº recoilï¼Œå®˜æ–¹æå‡ºè¿™ä¹ˆäº›ä¼˜ç‚¹ï¼š</p><ol><li>æ ¸å¿ƒ api æ›´å°‘</li><li>æ¨¡ç‰ˆä»£ç æ›´å°‘ï¼ˆä¸éœ€è¦æä¾› keyï¼‰</li><li>ä»£ç ä½“ç§¯æ›´å°</li><li>å¯ä»¥å¾ˆæ–¹ä¾¿æ¥å…¥å…¶ä»–ç¬¬ä¸‰æ–¹åº“æ‹“å±•èƒ½åŠ›ï¼Œå¦‚ zustand ç­‰</li><li>å†…ç½®æŒä¹…åŒ–æ–¹æ¡ˆ</li><li>æ–‡æ¡£æ›´å‹å¥½</li></ol><p>è§ <a href="https://github.com/pmndrs/jotai/issues/420">https://github.com/pmndrs/jotai/issues/420</a></p><p>å…³äºç¬¬ 4 ç‚¹ï¼Œå°ç¨‹åºä¸­åŠ å…¥äº† zustand è¿™ä¸ªåº“ï¼Œä¸»è¦æ˜¯å› ä¸º jotai è·å–æˆ–è€…ä¿®æ”¹ atom æ˜¯é€šè¿‡ hooksï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬éœ€è¦åœ¨éç»„ä»¶çš„ä»£ç é‡Œå–å€¼/ä¿®æ”¹å€¼å°±éœ€è¦å€ŸåŠ© zustandã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">import &#123; useAtom &#125; from &#39;jotai&#39;import &#123; atomWithStore &#125; from &#39;jotai&#x2F;zustand&#39;import create from &#39;zustand&#x2F;vanilla&#39;const store &#x3D; create(() &#x3D;&gt; (&#123; count: 0 &#125;))const stateAtom &#x3D; atomWithStore(store)store.getState() &#x2F;&#x2F; &#123; count: 0 &#125;</code></pre><p>Zustand è¿˜æä¾›äº† subscribe ç­‰éå¸¸å®ç”¨çš„ apiã€‚</p><p>å…³äºç¬¬ 6 ç‚¹ï¼Œåœ¨å°ç¨‹åºä¸­ï¼Œå¦‚æœæƒ³æŠŠçŠ¶æ€åŒæ­¥åˆ° storageï¼Œæˆ‘æ˜¯å€ŸåŠ©äº† zustand</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">import &#123; persist, StateStorage &#125; from &#39;zustand&#x2F;middleware&#39;;const storage: StateStorage &#x3D; &#123;  getItem: (name: string) &#x3D;&gt; Taro.getStorageSync(name),  setItem: (name: string, value: string) &#x3D;&gt; Taro.setStorageSync(name, value),&#125;;export const myStore &#x3D; create&lt;MyStore&gt;(  persist(    (set, get) &#x3D;&gt; (&#123;      data: [],    &#125;),    &#123;      name: &#39;myStore&#39;,      getStorage: () &#x3D;&gt; storage,    &#125;,  ),);  export const myStoreAtom &#x3D; atomWithStore&lt;MyStore&gt;(myStore);</code></pre><p>è€Œå®é™…ä¸Š atom æœ¬èº«ä¹Ÿæ˜¯æ”¯æŒæŒä¹…åŒ–çš„ <a href="https://docs.pmnd.rs/jotai/guides/persistence">https://docs.pmnd.rs/jotai/guides/persistence</a> è¿™é‡Œå°±ä¸å±•å¼€äº†</p><p>æœªå®Œå¾…ç»­</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å°ç¨‹åº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äº webpack çš„ tree shaking</title>
      <link href="/2021/05/27/%E5%85%B3%E4%BA%8E-webpack-%E7%9A%84-tree-shaking/"/>
      <url>/2021/05/27/%E5%85%B3%E4%BA%8E-webpack-%E7%9A%84-tree-shaking/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘é‡æ–°ç¿»çœ‹äº†ä¸‹ ant design çš„æ–‡æ¡£ï¼Œå‘ç°è¿™æ ·ä¸€æ®µè¯</p><blockquote><p><code>antd</code> é»˜è®¤æ”¯æŒåŸºäº ES modules çš„ tree shakingï¼Œå¯¹äº js éƒ¨åˆ†ï¼Œç›´æ¥å¼•å…¥ <code>import &#123; Button &#125; from &#39;antd&#39;</code> å°±ä¼šæœ‰æŒ‰éœ€åŠ è½½çš„æ•ˆæœã€‚</p></blockquote><p>è€Œä¹‹å‰çš„ç‰ˆæœ¬è¦åšåˆ°æŒ‰éœ€åŠ è½½æ˜¯é€šè¿‡ <a href="https://github.com/ant-design/babel-plugin-import">babel-plugin-import</a> ï¼Œé€šè¿‡ä¿®æ”¹å¼•ç”¨è·¯å¾„æ¥å®ç°çš„ã€‚</p><p>è™½ç„¶ä¹ŸçŸ¥é“ tree shakingï¼Œä½†æ²¡æœ‰æ·±å…¥å»äº†è§£å…·ä½“çš„é…ç½®ã€‚ä»¥ä¸‹ç®€å•è®°å½•ä¸€ä¸‹æ¢ç´¢çš„è¿‡ç¨‹ï¼Œwebpack ç‰ˆæœ¬ä¸º 5.37.1ã€‚</p><a id="more"></a><p>tree shaking ç®€å•æ¥è¯´å°±æ˜¯å¯ä»¥å°†ä»£ç ä¸­æ²¡æœ‰ä½¿ç”¨åˆ°çš„ä»£ç ç§»é™¤ï¼Œä»¥å‡å°‘åŒ…çš„ä½“ç§¯ã€‚</p><p>æ ¹æ® <a href="https://webpack.js.org/guides/tree-shaking/#conclusion">webpack æ–‡æ¡£</a>å¯çŸ¥ï¼Œå½±å“ webpack tree shaking æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li>ä½¿ç”¨ esm è¯­æ³•ï¼ˆimportï¼Œexportï¼‰</li><li>æœªå°†ä»£ç ç¼–è¯‘æˆ CommonJSï¼Œå¸¸è§çš„å¦‚ @babel/preset-env è¿™ä¸ªé¢„è®¾å°±ä¼šå°†ä»£ç ç¼–è¯‘æˆ CommonJS</li><li>package.json æ·»åŠ  sideEffects å­—æ®µ</li><li>mode å¿…é¡»æ˜¯ production</li></ol><p>æ–‡æ¡£é‡Œçš„è¯´æ˜æœ‰ç‚¹ç»•ï¼Œå› æ­¤æˆ‘ç®€å•å†™äº†å‡ ä¸ª case æµ‹è¯•å®é™…æ•ˆæœå¦‚ä½•</p><h4 id="1-ç¬¦åˆæ‰€æœ‰æ¡ä»¶çš„æƒ…å†µ"><a href="#1-ç¬¦åˆæ‰€æœ‰æ¡ä»¶çš„æƒ…å†µ" class="headerlink" title="1. ç¬¦åˆæ‰€æœ‰æ¡ä»¶çš„æƒ…å†µ"></a>1. ç¬¦åˆæ‰€æœ‰æ¡ä»¶çš„æƒ…å†µ</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; a.jsexport const a1 &#x3D; &#39;a1&#39;export const a2 &#x3D; &#39;a2&#39;&#x2F;&#x2F; index.jsimport &#123; a1, a2 &#125; from &#39;.&#x2F;a&#39;console.log(a1)&#x2F;&#x2F; webpack.config.jsmode: &#39;production&#39;&#x2F;&#x2F; package.json&quot;sideEffects&quot;: false&#x2F;&#x2F; è¾“å‡º(()&#x3D;&gt;&#123;&quot;use strict&quot;;console.log(&quot;a1&quot;)&#125;)();</code></pre><p>å¯ä»¥çœ‹åˆ°è™½ç„¶ a.js æ–‡ä»¶ä¸­åŒ…å«äº† a2ï¼Œä½†æ˜¯å®é™…æ‰“åŒ…å´å¹¶æœªå°†å…¶æ‰“åŒ…è¿›å»</p><h4 id="2-é-production-æ¨¡å¼"><a href="#2-é-production-æ¨¡å¼" class="headerlink" title="2. é production æ¨¡å¼"></a>2. é production æ¨¡å¼</h4><p>å°†ä¸Šè¿° mode æ”¹æˆ development</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; è¾“å‡º...&#x2F;***&#x2F; &quot;.&#x2F;src&#x2F;a.js&quot;:&#x2F;*!******************!*\  !*** .&#x2F;src&#x2F;a.js ***!  \******************&#x2F;&#x2F;***&#x2F; ((__unused_webpack_module, __webpack_exports__, __webpack_require__) &#x3D;&gt; &#123;eval(&quot;__webpack_require__.r(__webpack_exports__);\n&#x2F;* harmony export *&#x2F; __webpack_require__.d(__webpack_exports__, &#123;\n&#x2F;* harmony export *&#x2F;   \&quot;a1\&quot;: () &#x3D;&gt; (&#x2F;* binding *&#x2F; a1),\n&#x2F;* harmony export *&#x2F;   \&quot;a2\&quot;: () &#x3D;&gt; (&#x2F;* binding *&#x2F; a2)\n&#x2F;* harmony export *&#x2F; &#125;);\nconst a1 &#x3D; &#39;a1&#39;\nconst a2 &#x3D; &#39;a2&#39;\n\n&#x2F;&#x2F;# sourceURL&#x3D;webpack:&#x2F;&#x2F;test-webpack&#x2F;.&#x2F;src&#x2F;a.js?&quot;);&#x2F;***&#x2F; &#125;),...</code></pre><p>å¯ä»¥çœ‹åˆ°è¿™æ¬¡å°† a2 æ‰“åŒ…è¿›æ¥äº†ï¼Œå³ development æ¨¡å¼ä¸‹æ˜¯ä¸ä¼šè¿›è¡Œ tree shaking çš„</p><p>è€Œå¦‚æœï¼Œæˆ‘ä»¬å¼€å¯äº†<code>optimization.usedExports</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; webpack.config.jsoptimization: &#123;  usedExports: true,&#125;,</code></pre><p>å¯ä»¥çœ‹åˆ°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;***&#x2F; &#39;.&#x2F;src&#x2F;a.js&#39;:      &#x2F;*!******************!*\  !*** .&#x2F;src&#x2F;a.js ***!  \******************&#x2F;      &#x2F;***&#x2F; (        __unused_webpack_module,        __webpack_exports__,        __webpack_require__      ) &#x3D;&gt; &#123;        eval(          &#39;&#x2F;* harmony export *&#x2F; __webpack_require__.d(__webpack_exports__, &#123;\n&#x2F;* harmony export *&#x2F;   &quot;a1&quot;: () &#x3D;&gt; (&#x2F;* binding *&#x2F; a1)\n&#x2F;* harmony export *&#x2F; &#125;);\n&#x2F;* unused harmony export a2 *&#x2F;\nconst a1 &#x3D; &quot;a1&quot;\n\nconst a2 &#x3D; \&#39;a2\&#39;\n\n\n\n&#x2F;&#x2F;# sourceURL&#x3D;webpack:&#x2F;&#x2F;test-webpack&#x2F;.&#x2F;src&#x2F;a.js?&#39;        )        &#x2F;***&#x2F;      &#125;,</code></pre><p>è¿™é‡Œçœ‹åˆ° <code>unused harmony export a2</code> å³ webpack æ ‡è¯† a2 æ²¡æœ‰è¢«å®é™…ä½¿ç”¨åˆ°ã€‚</p><p>è¿™é‡Œ optimization.usedExports åœ¨ webpack æ–‡æ¡£é‡Œæåˆ°ï¼Œå¯ä»¥ç”¨äºåˆ«çš„å‹ç¼©å·¥å…·å‹ç¼©æ—¶ç§»é™¤æ‰ã€‚</p><p>æ ¹æ®æ–‡æ¡£è¯´æ˜ï¼Œé…ç½®äº†<code>concatenateModules</code> ä¸ <code>TerserPlugin</code> ï¼Œä½†æ˜¯æ²¡èƒ½å°† a2 tree shaking æ‰</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; webpack.config.js&#123;  ...  mode: &#39;development&#39;,  optimization: &#123;    usedExports: true,    minimize: true,    minimizer: [new TerserPlugin(&#123;&#125;)],    concatenateModules: true,  &#125;&#125;&#x2F;&#x2F;è¾“å‡º;(() &#x3D;&gt; &#123;  &#39;use strict&#39;  var __webpack_modules__ &#x3D; &#123;      &#39;.&#x2F;src&#x2F;index.js&#39;: () &#x3D;&gt; &#123;        eval(          &#39;\n;&#x2F;&#x2F; CONCATENATED MODULE: .&#x2F;src&#x2F;a.js\nconst a1 &#x3D; &quot;a1&quot;\n\nconst a2 &#x3D; \&#39;a2\&#39;\n\n\n;&#x2F;&#x2F; CONCATENATED MODULE: .&#x2F;src&#x2F;index.js\n\n\nconsole.log(a1)\n\n\n&#x2F;&#x2F;# sourceURL&#x3D;webpack:&#x2F;&#x2F;test-webpack&#x2F;.&#x2F;src&#x2F;index.js_+_1_modules?&#39;        )      &#125;,    &#125;,    __webpack_exports__ &#x3D; &#123;&#125;  __webpack_modules__[&#39;.&#x2F;src&#x2F;index.js&#39;]()&#125;)()</code></pre><p>æ³¨æ„åˆ°ä¸Šè¿°ä»£ç æ˜¯ eval åŒ…è£¹çš„ï¼Œåº”è¯¥ç”±äº development æ¨¡å¼ä¸‹ source map é»˜è®¤ä¸º eval å¯¼è‡´çš„ï¼Œé‚£ä¹ˆæˆ‘è¿™é‡Œå°† source map å…³æ‰</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; webpack.config.js&#123;&#x2F;&#x2F; ...mode: &#39;development&#39;,  devtool: false,  optimization: &#123;    usedExports: true,    minimize: true,    minimizer: [new TerserPlugin(&#123;&#125;)],    concatenateModules: true,  &#125;,&#125;&#x2F;&#x2F; è¾“å‡º(()&#x3D;&gt;&#123;&quot;use strict&quot;;console.log(&quot;a1&quot;)&#125;)();</code></pre><p>åŒæ ·ï¼Œå°† mode æ”¹æˆ â€˜noneâ€™ ä¹‹åä¹Ÿæ˜¯èƒ½æ­£ç¡® tree shaking çš„</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; webpack.config.js&#123;  ...  mode: &#39;none&#39;,  optimization: &#123;    usedExports: true,    minimize: true,    minimizer: [new TerserPlugin(&#123;&#125;)],    concatenateModules: true,    providedExports: true,  &#125;,&#125;&#x2F;&#x2F; è¾“å‡º(()&#x3D;&gt;&#123;&quot;use strict&quot;;console.log(&quot;a1&quot;)&#125;)();</code></pre><p>å¦‚æœå°†ç›¸å…³é…ç½®ç§»é™¤æ‰ï¼Œé‚£å³ä½¿æ˜¯åœ¨ none æ¨¡å¼ä¸‹ä¹Ÿæ˜¯ä¸èƒ½æ­£å¸¸ tree shaking çš„</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; webpack.config.js&#123;...mode: &#39;none&#39;,  optimization: &#123;    usedExports: true,    &#x2F;&#x2F; minimize: true,    &#x2F;&#x2F; minimizer: [new TerserPlugin(&#123;&#125;)],    &#x2F;&#x2F; concatenateModules: true,    &#x2F;&#x2F; providedExports: true,  &#125;,&#125;  &#x2F;&#x2F; è¾“å‡º&#x2F;***&#x2F; ((__unused_webpack_module, __webpack_exports__, __webpack_require__) &#x3D;&gt; &#123;&#x2F;* harmony export *&#x2F; __webpack_require__.d(__webpack_exports__, &#123;&#x2F;* harmony export *&#x2F;   &quot;a1&quot;: () &#x3D;&gt; (&#x2F;* binding *&#x2F; a1)&#x2F;* harmony export *&#x2F; &#125;);&#x2F;* unused harmony export a2 *&#x2F;const a1 &#x3D; &quot;a1&quot;const a2 &#x3D; &#39;a2&#39;&#x2F;***&#x2F; &#125;)</code></pre><p>å¯è§é…ç½®å¥½äº† usedExports ä¸ TerserPlugin ä»¥åŠ concatenateModules ç­‰ç›¸å…³é…ç½®ï¼Œå³ä½¿åœ¨åˆ«çš„ mode ä¸‹ä¹Ÿæ˜¯èƒ½å°†æ— ç”¨çš„ä»£ç  tree shaking æ‰çš„ï¼Œè€Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ–‡æ¡£é‡Œæåˆ°éœ€è¦åœ¨ production æ¨¡å¼ä¸‹æ‰èƒ½ tree shaking çš„åŸå› äº†</p><h4 id="3-æ”¹æˆ-commonjs"><a href="#3-æ”¹æˆ-commonjs" class="headerlink" title="3. æ”¹æˆ commonjs"></a>3. æ”¹æˆ commonjs</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; index.jsconst &#123; a1 &#125; &#x3D; require(&#39;.&#x2F;a&#39;)console.log(a1)&#x2F;&#x2F; è¾“å‡ºï¼ˆæ ¼å¼åŒ–åï¼‰...var e &#x3D; &#123;      85: (e, o, r) &#x3D;&gt; &#123;        &#39;use strict&#39;        r.r(o), r.d(o, &#123; a1: () &#x3D;&gt; t, a2: () &#x3D;&gt; n &#125;)        const t &#x3D; &#39;a1&#39;,          n &#x3D; &#39;a2&#39;      &#125;,    &#125;...</code></pre><p>å¯ä»¥çœ‹åˆ° a2  è¿˜æ˜¯è¢«æ‰“åŒ…è¿›æ¥äº†ï¼Œå› æ­¤ commonjs æ˜¯ä¸æ”¯æŒ tree shaking çš„ã€‚å¥‡æ€ªçš„æ˜¯åœ¨ <a href="https://webpack.docschina.org/blog/2020-10-10-webpack-5-release/#commonjs-tree-shaking">https://webpack.docschina.org/blog/2020-10-10-webpack-5-release/#commonjs-tree-shaking</a> é‡Œæåˆ° webpack5 æ˜¯æ”¯æŒå¯¹éƒ¨åˆ† commonjs å¯¼å‡ºåš tree shaking çš„ï¼Œä½†æ˜¯æˆ‘å®éªŒçš„ç»“æœå´æ˜¯æ²¡æœ‰æ•ˆæœï¼Œä¸çŸ¥é“æ˜¯å¦å“ªé‡Œæœ‰å‡ºå…¥</p><h4 id="4-sideEffects"><a href="#4-sideEffects" class="headerlink" title="4. sideEffects"></a>4. sideEffects</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; package.json ç§»é™¤æ‰ sideEffects&#x2F;&#x2F; &quot;sideEffects&quot;: false&#x2F;&#x2F; è¾“å‡º(()&#x3D;&gt;&#123;&quot;use strict&quot;;console.log(&quot;a1&quot;)&#125;)();</code></pre><p>çœ‹èµ·æ¥å³ä½¿æœªé…ç½® sideEffects èƒ½ tree shaking</p><p>å¯¹æ­¤æˆ‘äº§ç”Ÿäº†ä¸€ä¸ªç–‘æƒ‘ï¼Œé‚£ä¹ˆ sideEffects çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆæ–‡æ¡£é‡Œåˆè¯´ sideEffects æ˜¯å¿…é¡»è¦é…ç½®çš„ï¼Ÿæ¯”å¦‚ ant design ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆé…ç½® <a href="https://github.com/ant-design/ant-design/blob/master/package.json#L38">sideEffects</a> å‘¢ï¼Ÿ</p><p>å› æ­¤æˆ‘åˆåšäº†ä»¥ä¸‹å‡ ä¸ªå®éªŒ</p><ol><li><p>IIFE</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; a.jsexport const a1 &#x3D; &#39;a1&#39;export const a2 &#x3D; &#39;a2&#39;export const a3 &#x3D; (function () &#123;  console.log(&#39;a3&#39;)  return &#39;a3&#39;&#125;)()&#x2F;&#x2F; index.jsimport &#123; a1, a2 &#125; from &#39;.&#x2F;a&#39;console.log(a1)&#x2F;&#x2F; è¾“å‡º(()&#x3D;&gt;&#123;&quot;use strict&quot;;console.log(&quot;a3&quot;),console.log(&quot;a1&quot;)&#125;)();</code></pre><p>æ— è®º package.json ä¸­ sideEffects æ˜¯å¦é…ç½®ï¼Œå³ä½¿æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨åˆ° a3ï¼Œ IIFE ä¸­çš„ä»£ç ä¼šè¢«æ‰“åŒ…è¿›å»æ‰§è¡Œ,ä½†æ˜¯ a3 æ˜¯ä¸ä¼šè¢«æ‰“åŒ…è¿›å»çš„ã€‚</p></li><li><p>æ ·å¼æ–‡ä»¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; webpack.config.jsmodule: &#123;  rules: [    &#123;      test: &#x2F;\.css$&#x2F;i,      use: [&#39;style-loader&#39;, &#39;css-loader&#39;],    &#125;,  ],&#125;,  &#x2F;&#x2F; style.cssbody &#123;  background-color: red;&#125;  &#x2F;&#x2F; index.jsimport &#39;.&#x2F;style.css&#39;</code></pre><p>è¿™é‡Œå°±æœ‰å·®åˆ«äº†ï¼Œå¦‚æœæˆ‘ä»¬æ­¤æ—¶é…ç½® <code>sideEffects: false</code> é‚£ä¹ˆè¾“å‡ºå°†ä¼šæ˜¯ç©ºç™½å†…å®¹ï¼Œå¦‚æœå°† <code>sideEffects: false</code> åˆ æ‰ï¼Œåˆ™è¾“å‡º</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">...o.push([e.id, &#39;body &#123;\n  background-color: red;\n&#125;\n&#39;, &#39;&#39;])...</code></pre><p>ä¹Ÿå°±æ˜¯è¯´å¼•å…¥æ ·å¼æ–‡ä»¶ä¼šè¢«è®¤ä¸ºä¸€ç§å‰¯ä½œç”¨ï¼Œå¦‚æœ sideEffectsï¼šfalseï¼Œåˆ™è®¤ä¸ºæˆ‘ä»¬çš„ä»£ç ä¸­æ²¡æœ‰åŒ…å«å‰¯ä½œç”¨çš„æ¨¡å—ï¼Œå¯ä»¥æ”¾å¿ƒå°†æ ·å¼æ–‡ä»¶ç§»é™¤ã€‚å¦‚æœæˆ‘ä»¬é…ç½® <code>sideEffectsï¼š[&quot;src/style.css&quot;]</code>,å³é…ç½® style.css ä¸ºæœ‰å‰¯ä½œç”¨çš„æ¨¡å—ï¼Œé‚£ä¹ˆæ­¤æ—¶ä¹Ÿæ˜¯ä¼šå°† style.css æ‰“åŒ…è¿›å»çš„</p></li><li><p>polyfill</p><p>å¦‚æœåœ¨ä»£ç ä¸­ä¿®æ”¹äº†å…¨å±€å˜é‡ï¼Œæˆ–åŸå‹ä¼šå‘ç”Ÿä»€ä¹ˆ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; b.jswindow.b1 &#x3D; &#39;b1&#39;Array.prototype.test &#x3D; function () &#123;  console.log(&#39;test&#39;)&#125;&#x2F;&#x2F; index.jsimport &#39;.&#x2F;b&#39;&#x2F;&#x2F; package.json&#x2F;&#x2F; sideEffects: false&#x2F;&#x2F; è¾“å‡º...;(window.b1 &#x3D; &#39;b1&#39;),  (Array.prototype.test &#x3D; function () &#123;  console.log(&#39;test&#39;)&#125;)...</code></pre><p>ä¸æ ·å¼çš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œå³å¦‚æœé…ç½®äº† sideEffect: falseï¼Œåˆ™è®¤ä¸ºæ‰€æœ‰æ–‡ä»¶æ¨¡å—éƒ½æ˜¯æ²¡æœ‰å‰¯ä½œç”¨çš„ï¼Œå°±ä¸ä¼šå°† b.js ä¸­çš„å†…å®¹æ‰“åŒ…</p></li><li><p>ä½œä¸º npm åŒ…</p><p>ä¸Šé¢çš„å®éªŒéƒ½æ˜¯å¼•ç”¨æœ¬åœ°æ–‡ä»¶ï¼Œé‚£ webpack æ˜¯å¦‚ä½•å¯¹ä¾èµ–è¿›è¡Œ tree shaking çš„å‘¢ï¼Ÿè¿™é‡Œæˆ‘æ–°å¼€ä¸€ä¸ªé¡¹ç›® test-npmï¼Œå¹¶ä¸”å°†å½“å‰é¡¹ç›® link è¿‡å»</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; npm-test src&#x2F;index.jsexport &#123; a3 &#125; from &#39;.&#x2F;a&#39;export const a1 &#x3D; &#39;a1&#39;export const a2 &#x3D; &#39;a2&#39;&#x2F;&#x2F; npm-test src&#x2F;index.jsexport const a3 &#x3D; &quot;a3&quot;window.a4 &#x3D; &quot;a4&quot;&#x2F;&#x2F; npm-test package.json&quot;module&quot;: &quot;src&#x2F;index.js&quot;,</code></pre><p>åœ¨ test-npm ä¸­ï¼ŒæŒ‡å®š esm å…¥å£æ–‡ä»¶ä¸º src/index.jsï¼Œåœ¨è¿™é‡Œé‡æ–°çš„å¯¼å‡º a.js ä¸­çš„ a3ï¼Œç„¶è€Œ a.js ä¸­å­˜åœ¨ä¸€ä¸ªå‰¯ä½œç”¨ <code>window.a4 = &quot;a4&quot;</code>ã€‚</p><p>é¢˜å¤–è¯ï¼šè¿™é‡Œé€šè¿‡ module å­—æ®µåˆ¶å®š esm å…¥å£ï¼Œå®é™…ä¸Š module å¹¶ä¸æ˜¯ package.json çš„æ ‡å‡†å­—æ®µï¼Œè€Œæ˜¯æ‰“åŒ…å·¥å…·çº¦å®šçš„å­—æ®µï¼Œpackage.json ä¸­æ ‡å‡†çš„å…¥å£å®é™…ä¸Šæ˜¯ mainã€‚å¦‚æœæˆ‘ä»¬çš„åº“éœ€è¦åŒæ—¶æ”¯æŒ esm ä¸ commonjsï¼Œå¯ä»¥å‚è€ƒ antdï¼Œæ„å»ºå‡º lib/ å’Œ es/ ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œå¹¶é…ç½®<code>package.json</code>çš„<code>main</code>ã€<code>module</code>å­—æ®µã€‚</p><p>å½“æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ä½¿ç”¨æ—¶ï¼Œæ— è®ºæ˜¯å¦ç”¨åˆ° a3ï¼Œéƒ½ä¼šå°† a4 è¿™ä¸ªå‰¯ä½œç”¨å¼•è¿›æ¥</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">   &#x2F;&#x2F; index.js   import &#123; a1 &#125; from &#39;test-npm&#39;   console.log(a1)      &#x2F;&#x2F; è¾“å‡º(()&#x3D;&gt;&#123;&quot;use strict&quot;;window.a4&#x3D;&quot;a4&quot;,console.log(&quot;a1&quot;)&#125;)();</code></pre><p>è€Œå½“åœ¨ test-npm ä¸­æˆ‘ä»¬é…ç½®äº† <code>sideEffects: false</code> ä¹‹åï¼Œåªæœ‰ä½¿ç”¨åˆ° a3 æ‰ä¼šå°† a4 è¿™ä¸ªå‰¯ä½œç”¨å¼•è¿›æ¥ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">   &#x2F;&#x2F; index.js   import &#123; a1 &#125; from &#39;test-npm&#39;   console.log(a1)      &#x2F;&#x2F; è¾“å‡º(()&#x3D;&gt;&#123;&quot;use strict&quot;;console.log(&quot;a1&quot;)&#125;)();</code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">   &#x2F;&#x2F; index.js   import &#123; a1, a3 &#125; from &#39;test-npm&#39;   console.log(a1, a3)      &#x2F;&#x2F; è¾“å‡º(()&#x3D;&gt;&#123;&quot;use strict&quot;;window.a4&#x3D;&quot;a4&quot;,console.log(&quot;a1&quot;,&quot;a3&quot;)&#125;)();</code></pre><p>å®é™…ä¸Šæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ <code>/*#__PURE__*/</code> è¿™ä¸ªæ³¨é‡Šæ¥è¡¨ç¤ºè¯­å¥æ˜¯æ— å‰¯ä½œç”¨çš„ã€‚å¦‚æœä½ æœ‰å»æ³¨æ„åˆ° babel å¦‚ä½•ç¼–è¯‘ jsxï¼Œä½ å°±ä¼šå¯¹è¿™ä¸ªæ³¨é‡Šæ¯”è¾ƒç†Ÿæ‚‰</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; react let div &#x3D; &lt;div className&#x3D;&quot;header&quot;&gt;hello&lt;&#x2F;div&gt;;&#x2F;&#x2F; babel ç¼–è¯‘ålet div &#x3D; &#x2F;*#__PURE__*&#x2F;React.createElement(&quot;div&quot;, &#123;  className: &quot;header&quot;&#125;, &quot;hello&quot;);</code></pre><p>è¿™é‡Œå°±ä¸å±•å¼€æ¢è®¨</p></li></ol><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>ä¸Šé¢çš„ç”¨ä¾‹å¹¶æ²¡æœ‰åšåˆ°å®Œå…¨çš„æ§åˆ¶å˜é‡ï¼Œä»…ä¾›å‚è€ƒã€‚ç„¶åè¿™é‡Œæˆ‘ç»“åˆè‡ªå·±çš„ç†è§£æ¥è¯•å›¾è¯´æ˜ webpack ä¸­ tree shaking ï¼š</p><p>webpack æœ‰ä¸¤ä¸ªæ–¹å¼åš tree shakingï¼Œä¸€æ–¹é¢æ˜¯é€šè¿‡ optimization.usedExports æ ‡è®°æœªä½¿ç”¨çš„å¯¼å‡ºï¼Œç„¶åé€šè¿‡å‹ç¼©å·¥å…·æ¥ç§»é™¤ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼åšä¸åˆ°ç§»é™¤åŒ…å«å‰¯ä½œç”¨çš„ä»£ç ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦ç§»é™¤å¯èƒ½åŒ…å«å‰¯ä½œç”¨çš„ä»£ç ï¼Œå°±éœ€è¦ç”¨åˆ°ç¬¬äºŒä¸ªæ–¹å¼ï¼šé…ç½® sideEffects å‘ŠçŸ¥ webpack å½“å‰é¡¹ç›®ä¸­å“ªäº›æ–‡ä»¶å¯èƒ½åŒ…å«å‰¯ä½œç”¨æˆ–è€…å½“å‰é¡¹ç›®å®Œå…¨æ²¡æœ‰å‰¯ä½œç”¨ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å·¥ç¨‹åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°å½•ä¿å­˜ç½‘é¡µçš„è„šæœ¬ä¼˜åŒ–è¿‡ç¨‹</title>
      <link href="/2021/05/21/%E8%AE%B0%E5%BD%95%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5%E7%9A%84%E8%84%9A%E6%9C%AC%E4%BC%98%E5%8C%96%E8%BF%87%E7%A8%8B/"/>
      <url>/2021/05/21/%E8%AE%B0%E5%BD%95%E4%BF%9D%E5%AD%98%E7%BD%91%E9%A1%B5%E7%9A%84%E8%84%9A%E6%9C%AC%E4%BC%98%E5%8C%96%E8%BF%87%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>è¿‘æœŸä¸ºäº†çœ‹æ–‡ç« å¼€äº†ç½‘ç«™ä¼šå‘˜ï¼Œæƒ³æŠŠå†…å®¹ä¿å­˜åˆ°æœ¬åœ°ï¼Œä»¥ä¾¿åç»­å›é¡¾ï¼Œä¸ºæ­¤å†™äº†ä¸ªè„šæœ¬ï¼Œè®°å½•ä¸€ä¸‹æ€è€ƒçš„è¿‡ç¨‹</p><a id="more"></a><h3 id="æ–¹æ¡ˆä¸€"><a href="#æ–¹æ¡ˆä¸€" class="headerlink" title="æ–¹æ¡ˆä¸€"></a>æ–¹æ¡ˆä¸€</h3><p>é•¿æˆªå›¾ï¼Œç„¶è€Œä¸€æ–¹é¢ï¼Œé•¿æˆªå›¾æ•ˆæœä¸å¤ªå¥½ï¼Œä¿å­˜ä¸‹æ¥æ˜¯å›¾ç‰‡ï¼Œæ–‡å­—ä¹Ÿä¸èƒ½é€‰ä¸­ï¼Œè€Œä¸”æ“ä½œä¹Ÿéº»çƒ¦ã€‚</p><h3 id="æ–¹æ¡ˆäºŒ"><a href="#æ–¹æ¡ˆäºŒ" class="headerlink" title="æ–¹æ¡ˆäºŒ"></a>æ–¹æ¡ˆäºŒ</h3><p>chrome dev tool æä¾›äº† capture snapshot çš„åŠŸèƒ½ï¼Œå¯ä»¥å…¨å±é•¿æˆªå›¾ï¼Œæˆ–è€…æ˜¯å¯¹èŠ‚ç‚¹è¿›è¡Œæˆªå›¾ã€‚åŠŸèƒ½è™½å¥½ï¼Œä½†ä¾ç„¶å­˜åœ¨æ‰‹åŠ¨çš„éº»çƒ¦ï¼Œå¹¶ä¸”å­˜ä¸‹æ¥è¿˜æ˜¯å›¾ç‰‡</p><h3 id="æ–¹æ¡ˆä¸‰"><a href="#æ–¹æ¡ˆä¸‰" class="headerlink" title="æ–¹æ¡ˆä¸‰"></a>æ–¹æ¡ˆä¸‰</h3><p>ä½¿ç”¨ html2pdfï¼Œå°†ç½‘é¡µå­˜æˆ pdfã€‚<a href="https://github.com/eKoopmans/html2pdf.js">html2pdf</a> å®é™…ä¸Šä¾èµ–äº† <a href="https://github.com/niklasvh/html2canvas">html2canvas</a> ä¸ <a href="https://github.com/MrRio/jsPDF">jsPDF</a></p><p>å­˜åœ¨å‡ ä¸ªé—®é¢˜ï¼š</p><ol><li>åŸç½‘é¡µåšäº†ç‰¹æ®Šå¤„ç†ï¼Œå¯¼è‡´ç»˜åˆ¶ canvas æ—¶ä¸èƒ½æ­£ç¡®è¿˜åŸå±•ç¤ºæ ·å¼</li><li>ä¿å­˜æˆ pdf æ—¶ page-breaks é…ç½®æ— æ•ˆï¼Œå¯¼è‡´æ–‡æœ¬ä»ä¸­é—´è¢«æ–­å¼€</li><li>pdf å®é™…ä¸Šä¹Ÿæ˜¯æ’å…¥ cavansï¼Œæ‰€ä»¥å®é™…ä½“éªŒå’Œå›¾ç‰‡å·®ä¸å¤š</li><li>æ–‡ç« ä¸­çš„å›¾ç‰‡ç»˜åˆ¶åˆ° canvas æ—¶ï¼Œä¼šè·¨åŸŸå¯¼è‡´æ— æ³•ç»˜åˆ¶ï¼Œéœ€è¦å°† img æ ‡ç­¾é‡Œçš„ src è½¬æˆ object url æˆ–è€… base64</li></ol><p>ä»£ç å¦‚ä¸‹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">var imgs &#x3D; document.querySelectorAll(&#39;img&#39;)for (let i &#x3D; 0; i &lt; imgs.length; i++) &#123;  var img &#x3D; imgs[i]  await fetch(new Request(img.src))    .then((response) &#x3D;&gt; response.blob())    .then(function (myBlob) &#123;      var objectURL &#x3D; URL.createObjectURL(myBlob)      &#x2F;&#x2F; å°† img è½¬ä¸º objectURL, é˜²æ­¢è·¨åŸŸ      img.src &#x3D; objectURL    &#125;)&#125;function addScript(url) &#123;  var script &#x3D; document.createElement(&#39;script&#39;)  script.type &#x3D; &#39;application&#x2F;javascript&#39;  script.src &#x3D; url  document.head.appendChild(script)&#125;addScript(  &#39;https:&#x2F;&#x2F;raw.githack.com&#x2F;eKoopmans&#x2F;html2pdf&#x2F;master&#x2F;dist&#x2F;html2pdf.bundle.js&#39;)var pdfTitle &#x3D; document.querySelector(&#39;.title&#39;).innerTexthtml2pdf()  .set(&#123;    filename: &#96;$&#123;pdfTitle&#125;.pdf&#96;,  &#125;)  .from(document.body)  .save()</code></pre><h3 id="æ–¹æ¡ˆå››"><a href="#æ–¹æ¡ˆå››" class="headerlink" title="æ–¹æ¡ˆå››"></a>æ–¹æ¡ˆå››</h3><p>åˆ©ç”¨æ— å¤´æµè§ˆå™¨ä¾‹å¦‚ <a href="https://pptr.dev/">puppeteer</a> ï¼ˆä»¥ä¸‹ç®€ç§° pptrï¼‰æ¥ç”Ÿæˆ pdfã€‚è¿™ä¸ªæ–¹æ¡ˆå¯ä»¥å®Œç¾é¿å¼€æ–¹æ¡ˆä¸‰çš„é—®é¢˜ï¼Œç”Ÿæˆçš„ pdf è´¨é‡ä¹Ÿæ˜¯æœ€å¥½çš„ã€‚ä½†æ˜¯éœ€è¦è§£å†³ä¸€ä¸ªé—®é¢˜ï¼šç™»å½•é—®é¢˜ã€‚ç†æƒ³çš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨ pptr ï¼Œå¯åŠ¨æ—¶å³å¯å®ç°ç™»å½•ï¼Œè·³è½¬åˆ°å¯¹åº”çš„æ–‡ç« ï¼Œä¿å­˜æˆ pdfã€‚é‰´äºå®ç°è„šæœ¬ç™»å½•çš„æˆæœ¬è¾ƒå¤§ï¼Œå°†éœ€æ±‚æ‹†åˆ†ï¼Œå³ç™»å½•æ˜¯åœ¨ chrome é‡Œæ‰‹åŠ¨å®Œæˆçš„ï¼Œä¹‹åå°†æ•´ä¸ª html ä¿å­˜ä¸ºæœ¬åœ° htmlï¼Œpptr è¯»å–æœ¬åœ° html å¹¶è½¬æˆ pdf å³å¯ã€‚</p><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>æ€è·¯</p><ol><li>ç½‘ç«™æœ‰æ¯”è¾ƒå¤šå½±å“é˜…è¯»çš„å…ƒç´ ï¼Œå¦‚ç›®å½•ï¼Œç”¨æˆ·ä¿¡æ¯ç­‰ï¼Œéœ€è¦å°†è¿™äº›å…ƒç´ ç§»é™¤ï¼Œä»…ä¿ç•™å†…å®¹å’Œæ ·å¼ã€‚</li><li>åå°èµ·ä¸€ä¸ª nodejs æ­å»ºçš„æœ¬åœ°æœåŠ¡ï¼Œå½“å¤„ç†å®Œç½‘é¡µåï¼Œå°†æ•´ä¸ª html å†…å®¹ä¼ è¾“ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å†™å…¥ä¸€ä¸ªæœ¬åœ°ç›®å½•ï¼ˆè¿™é‡Œæˆ‘ç”¨ distï¼‰ä¿å­˜èµ·æ¥</li><li>å°†æ‰€æœ‰éœ€è¦ä¿å­˜çš„æ–‡ç« éƒ½å­˜åˆ°æœ¬åœ°åï¼Œè¿è¡Œç”Ÿæˆ pdf è„šæœ¬ï¼Œè¿™ä¸ªè„šæœ¬è¯»å– dist ç›®å½•æ‰€æœ‰æ–‡ä»¶ï¼Œå¯åŠ¨ pptrï¼Œä¾æ¬¡å°†å†…å®¹ä½œä¸ºç½‘é¡µæ‰“å¼€ï¼Œä¿å­˜æˆ pdf</li></ol><p>ä¸Šè¿°å°±æ˜¯ç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„åšæ³•</p><p>æœ¬åœ°æœåŠ¡ server ä»£ç </p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const Koa &#x3D; require(&#39;koa&#39;)const cors &#x3D; require(&#39;@koa&#x2F;cors&#39;)const bodyParser &#x3D; require(&#39;koa-bodyparser&#39;)const fs &#x3D; require(&#39;fs-extra&#39;)const path &#x3D; require(&#39;path&#39;)const app &#x3D; new Koa()&#x2F;&#x2F; å…è®¸è·¨åŸŸapp.use(  cors(&#123;    allowHeaders: &#39;*&#39;,  &#125;))app.use(bodyParser())app.use(async (ctx) &#x3D;&gt; &#123;  &#x2F;&#x2F; æ¥æ”¶ &#123; html, title &#125; å‚æ•°  const &#123; title, html &#125; &#x3D; ctx.request.body  const dir &#x3D; path.join(__dirname, &#39;..&#x2F;dist&#x2F;&#39;)  try &#123;    await fs.ensureDir(dir)    &#x2F;&#x2F; æ³¨æ„ title å¦‚æœå¸¦æœ‰ &#x2F; ä¼šå¯¼è‡´åˆ›å»ºæ–‡ä»¶å¤±è´¥ï¼Œå°† &#x2F; æ›¿æ¢æˆ |    &#x2F;&#x2F; å°† title ä½œä¸ºæ–‡ä»¶å    await fs.writeFile(path.join(dir, &#96;$&#123;title.replace(&#39;&#x2F;&#39;, &#39;ï½œ&#39;)&#125;.html&#96;), html)    ctx.body &#x3D; &#123; code: 200 &#125;  &#125; catch (error) &#123;    console.log(error)  &#125;&#125;)&#x2F;&#x2F; æœåŠ¡ç«¯å£ 3000app.listen(3000)</code></pre><p>ç½‘é¡µç™»å½•åï¼Œåœ¨æµè§ˆå™¨æ§åˆ¶å°è¾“å…¥å¦‚ä¸‹ web,js ä»£ç </p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; ä¸»è¦å†…å®¹éƒ¨åˆ†var mainEle &#x3D; document.querySelector(&#39;.main&#39;)&#x2F;&#x2F; æ–‡ç« æ ‡é¢˜var title &#x3D; document.querySelector(&#39;.title&#39;).innerTextdocument  .querySelectorAll(&#39;script&#39;)  .forEach((s) &#x3D;&gt; s.remove())var body &#x3D; document.querySelector(&#39;body&#39;)&#x2F;&#x2F; ç§»é™¤å…¶ä»–å†…å®¹ï¼Œä»…ä¿ç•™ä¸»è¦å†…å®¹body.innerHTML &#x3D; &#39;&#39;body.appendChild(mainEle)&#x2F;&#x2F; é€šè¿‡ fetch å°† html åŠ title ä¼ ç»™æœåŠ¡ç«¯await fetch(&#39;http:&#x2F;&#x2F;localhost:3000&#x2F;&#39;, &#123;  method: &#39;POST&#39;,  headers: &#123;    &#39;Content-Type&#39;: &#39;application&#x2F;json&#39;,  &#125;,  body: JSON.stringify(&#123;    title,    html: document.documentElement.outerHTML,  &#125;),&#125;)</code></pre><p>pptr è„šæœ¬ä»£ç å¦‚ä¸‹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const puppeteer &#x3D; require(&#39;puppeteer&#39;)const path &#x3D; require(&#39;path&#39;)const fs &#x3D; require(&#39;fs-extra&#39;);(async () &#x3D;&gt; &#123;  const dist &#x3D; path.resolve(__dirname, &#39;..&#x2F;dist&#39;)  const htmls &#x3D; await fs.readdir(dist)  &#x2F;&#x2F; å¯åŠ¨æ— å¤´æµè§ˆå™¨  const browser &#x3D; await puppeteer.launch()  &#x2F;&#x2F; æ‰“å¼€æ–°é¡µé¢  const page &#x3D; await browser.newPage()  for (let i &#x3D; 0; i &lt; htmls.length; i++) &#123;    &#x2F;&#x2F; ä¾æ¬¡è¯»å– html æ–‡ä»¶    const html &#x3D; htmls[i]    var contentHtml &#x3D; await fs.readFile(path.join(dist, html), &#39;utf8&#39;)    &#x2F;&#x2F; ç”±äºé¡µé¢ä¼šæœ‰å›¾ç‰‡ï¼Œ&#123; &#39;waitUntil&#39;: &#39;networkidle0&#39; &#125; å³ç­‰å¾…ç½‘ç»œè¯·æ±‚å®Œæˆå    await page.setContent(contentHtml, &#123; &#39;waitUntil&#39;: &#39;networkidle0&#39; &#125;)    &#x2F;&#x2F; ç”Ÿæˆ pdf æ–‡ä»¶ï¼Œæ³¨æ„è¿™ä¸ª api éœ€è¦åœ¨ headless æ¨¡å¼ä¸‹æ‰èƒ½è°ƒç”¨    await page.pdf(&#123; path: path.join(dist, html.replace(&#39;.html&#39;, &#39;.pdf&#39;)) &#125;)  &#125; &#x2F;&#x2F; å…³æ‰æµè§ˆå™¨  await browser.close()&#125;)()</code></pre><h3 id="ä¼˜åŒ–1"><a href="#ä¼˜åŒ–1" class="headerlink" title="ä¼˜åŒ–1"></a>ä¼˜åŒ–1</h3><p>ç”±äº web,js ä¸­çš„ä»£ç ä¼šä¿®æ”¹ç½‘é¡µï¼Œæ‰€ä»¥æ¯æ¬¡ä¿å­˜å®Œæˆä¹‹åï¼Œéœ€è¦åˆ·æ–°é¡µé¢ï¼Œç‚¹å‡»ä¸‹ä¸€é¡µã€‚è¿™éœ€è¦é¡µé¢é‡æ–°åŠ è½½è„šæœ¬ï¼Œæ ·å¼æ–‡ä»¶ç­‰ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–¹æ³•ä¸å»ä¿®æ”¹åŸç½‘é¡µï¼Œæ‰€å¹¸ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨ cloneNode æ¥å¤åˆ¶æ•´ä¸ªç½‘é¡µçš„ dom ç»“æ„ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨ä¿®æ”¹åŸæ¥çš„ dom äº†ã€‚</p><p>web-v2.js ä»£ç å¦‚ä¸‹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">var doc &#x3D; document.documentElement.cloneNode(true)&#x2F;&#x2F; ...</code></pre><p>è¿™é‡Œå°† document æ·±æ‹·è´ï¼Œä¹‹åæ‰€æœ‰çš„æ“ä½œéƒ½åŸºäºè¿™ä¸ªæ·±æ‹·è´ï¼Œå°±ä¸ä¼šå½±å“åˆ°åŸé¡µé¢</p><h3 id="ä¼˜åŒ–2"><a href="#ä¼˜åŒ–2" class="headerlink" title="ä¼˜åŒ–2"></a>ä¼˜åŒ–2</h3><p>ä¸Šè¿°è¿˜æœ‰ä¸ªé—®é¢˜å°±æ˜¯éœ€è¦æ‰‹åŠ¨ç‚¹ä¸‹ä¸€é¡µï¼Œç„¶åç­‰å¾…é¡µé¢åŠ è½½å®Œæˆåï¼Œé‡æ–°æ‰§è¡Œ web-v2.js ã€‚è¿™é‡Œä¹Ÿå¯ä»¥å®Œå…¨ä½¿ç”¨è„šæœ¬æ¥å®ç°</p><p>Web-v3.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">async function fetchWeb() &#123;  &#x2F;&#x2F; æ·±æ‹·è´  var doc &#x3D; document.documentElement.cloneNode(true)  var body &#x3D; doc.querySelector(&#39;body&#39;)  var mainEle &#x3D; body.querySelector(&#39;.main&#39;)  &#x2F;&#x2F; ç§»é™¤æ¢è¡Œç¬¦å·ç­‰ç‰¹æ®Šå­—ç¬¦  var title &#x3D; body.querySelector(&#39;.title&#39;).innerText.replace(&#x2F;\s&#x2F;g, &#39;&#39;)  doc.querySelectorAll(&#39;script&#39;).forEach((s) &#x3D;&gt; s.remove())  body.innerHTML &#x3D; &#39;&#39;  body.appendChild(mainEle)  await fetch(&#39;http:&#x2F;&#x2F;localhost:3000&#x2F;&#39;, &#123;    method: &#39;POST&#39;,    headers: &#123;      &#39;Content-Type&#39;: &#39;application&#x2F;json&#39;,    &#125;,    body: JSON.stringify(&#123;      title,      html: doc.outerHTML,    &#125;),  &#125;)&#125;&#x2F;&#x2F; å»¶æ—¶å‡½æ•°async function sleep(time) &#123;  return new Promise((resolve) &#x3D;&gt; &#123;    setTimeout(() &#x3D;&gt; &#123;      resolve()    &#125;, time)  &#125;)&#125;&#x2F;&#x2F; è·³è½¬ä¸‹ä¸€é¡µfunction next() &#123;  const btn &#x3D; document.querySelector(&#39;.next&#39;)  btn.click()&#125;&#x2F;&#x2F; total ä¸ºéœ€è¦ä¿å­˜çš„é¡µæ•°async function fetchAll(total) &#123;  for (let i &#x3D; 0; i &lt; total; i++) &#123;    console.log(&#39;å¼€å§‹&#39;)    await fetchWeb()    &#x2F;&#x2F; ç­‰å¾… 1 s    await sleep(1000)    &#x2F;&#x2F; ç‚¹å‡»ä¸‹ä¸€é¡µ    next()    &#x2F;&#x2F; ç­‰å¾… 3s é¡µé¢åŸºæœ¬éƒ½åŠ è½½å¥½äº†ï¼Œè¿™é‡Œå…¶å®å¯ä»¥åšçš„æ›´å‡†ç¡®ç‚¹ï¼Œæ¯”å¦‚æ ¹æ®æŸä¸ªå…ƒç´ åŠ è½½å¥½åå¼€å§‹ fetchWeb    await sleep(3000)  &#125;&#125;</code></pre><p>è‡³æ­¤ï¼Œåªéœ€è¦åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸Šè¾“å…¥ web-v3 è„šæœ¬ä¸€æ¬¡ï¼Œç„¶åè¿è¡Œ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; total ä¸ºéœ€è¦ä¿å­˜çš„é¡µé¢æ•°é‡å³å¯fetchAll(total)</code></pre>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> çˆ¬è™« </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RN ç‰ˆæœ¬å‡çº§æŒ‡åŒ—</title>
      <link href="/2021/05/17/RN-%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%E6%8C%87%E5%8C%97/"/>
      <url>/2021/05/17/RN-%E7%89%88%E6%9C%AC%E5%8D%87%E7%BA%A7%E6%8C%87%E5%8C%97/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘å®¢æˆ·ç«¯æ‰“ç®—å°† react-native ç‰ˆæœ¬å‡çº§åˆ° 0.64.1ï¼Œæ­¤å‰æ˜¯ 0.59 ç‰ˆæœ¬ã€‚ä¸­é—´è¸©äº†ä¸å°‘å‘ï¼Œè®°å½•ä¸€ä¸‹å‡çº§è¿‡ç¨‹ã€‚</p><a id="more"></a><ol><li><p>å‡çº§ä¸€ä¸‹ react-native å’Œ reactï¼Œç”±äºé¡¹ç›®ä½¿ç”¨äº† Typescriptï¼Œå› æ­¤è¿˜è¦å‡çº§ä¸€ä¸‹å¯¹åº”çš„ types åº“</p><pre class="line-numbers language-none"><code class="language-none">npm i react-native@0.64.1 react@17.0.1 @types&#x2F;react  @types&#x2F;react-native</code></pre></li><li><p>è¿è¡ŒåæŠ¥é”™: Module xxxx is not a registered callable module.</p><p>æ ¹æ® <a href="https://github.com/react-native-community/upgrade-support/issues/47">https://github.com/react-native-community/upgrade-support/issues/47</a> è¿™ä¸ª issue æåˆ°çš„éœ€è¦é…ç½® metro ä¸­çš„ resolver æ¥è·³è¿‡å¯¹ node_modules ä¸­çš„ react-native çš„ç¼–è¯‘ã€‚è¿™è®©æˆ‘æƒ³åˆ°æœ‰å¯èƒ½æ˜¯ç”±äºæˆ‘ä»¬ç”¨åˆ°ä¸€ä¸ªç§æœ‰åŒ…ï¼ˆä»¥ä¸‹ç®€ç§° A å§ï¼‰ã€‚A è¿™ä¸ªåŒ…é‡Œæœ‰ react-native çš„ä¾èµ–ï¼Œå¹¶ä¸”å£°æ˜åˆ°äº† dependencies é‡Œäº†ã€‚å› æ­¤ä¼šå­˜åœ¨ä¸¤ä¸ªç‰ˆæœ¬çš„ react-nativeã€‚</p><p>è€ƒè™‘åˆ°è¿™ç‚¹ï¼Œæˆ‘å¯¹ A ä¸­çš„ react-native ä¹Ÿè¿›è¡Œäº†å‡çº§ã€‚å‘ç°å³ä½¿æ˜¯ç›¸åŒç‰ˆæœ¬ï¼Œä¾ç„¶ä¼šå‡ºç°æŠ¥é”™ã€‚å› æ­¤æ‰“ç®—å…ˆæŒ‰ issue æåˆ°çš„æ¥è¿›è¡Œé…ç½®ã€‚</p><p>issue ä¸­æåˆ°çš„ resolver é…ç½®å¦‚ä¸‹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const blacklist &#x3D; require(&#39;metro-config&#x2F;src&#x2F;defaults&#x2F;blacklist&#39;);module.exports &#x3D; &#123;  transformer: &#123;    getTransformOptions: async () &#x3D;&gt; (&#123;      transform: &#123;        experimentalImportSupport: false,        inlineRequires: false,      &#125;,    &#125;),  &#125;,  resolver: &#123;    blacklistRE: blacklist([      &#x2F;node_modules\&#x2F;.*\&#x2F;node_modules\&#x2F;react-native\&#x2F;.*&#x2F;,    ])  &#125;,&#125;;</code></pre><p>åœ¨ 0.64.1 é‡Œå¹¶æœªæ‰¾åˆ° blacklistï¼Œæˆ‘è¿™é‡Œé…ç½® resolver ä¸º</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const exclusionList &#x3D; require(&#39;metro-config&#x2F;src&#x2F;defaults&#x2F;exclusionList&#39;);module.exports &#x3D; &#123;  transformer: &#123;    getTransformOptions: async () &#x3D;&gt; (&#123;      transform: &#123;        experimentalImportSupport: false,        inlineRequires: false,      &#125;,    &#125;),  &#125;,  resolver: &#123;    blockList: exclusionList([      &#x2F;node_modules\&#x2F;.*\&#x2F;node_modules\&#x2F;react-native\&#x2F;.*&#x2F;,    ]),  &#125;,&#125;;</code></pre><p>è¿™æ—¶å€™å¯ä»¥æˆåŠŸè¿è¡Œã€‚</p><p>æ›´å¥½çš„åŠæ³•æ˜¯ï¼Œæˆ‘ä»¬ä¸åœ¨ A ä¸­å°† react-native è®¾ç½®ä¸º dependencyï¼Œè€Œä»…éœ€è¦æœ€å¤–å±‚ä¸€ä¸ª react-native å³å¯ã€‚æˆ‘ä»¬è¦åšåˆ°è¿™ç‚¹ï¼Œå¯ä»¥å°†  react-native ä» dependencies ä¸­ç§»é™¤ï¼Œæ”¹ä¸º peerDependenciesã€‚åŒæ—¶ä¸ºäº†æ–¹ä¾¿å¼€å‘ï¼Œæˆ‘ä»¬è¿˜åº”è¯¥å°†å…¶å£°æ˜åˆ°  devDependencies ä¸­ã€‚å¦‚æœåšäº†è¿™äº›ï¼Œå…¶å®ä¸Šè¿° metro çš„é…ç½®å°±æ— éœ€ä¿®æ”¹äº†ã€‚</p></li><li><p>è¿è¡Œåæç¤º hook ä¸èƒ½åœ¨å‡½æ•°å¼ç»„ä»¶ä»¥å¤–ä½¿ç”¨ã€‚æˆ‘è·Ÿç€æŸ¥çœ‹äº†æŠ¥é”™çš„ç»„ä»¶ï¼Œè¯¥ç»„ä»¶ç”± A æä¾›ï¼Œå¥‡æ€ªçš„æ˜¯è¯¥ç»„ä»¶ç¡®å®æ˜¯å‡½æ•°å¼ç»„ä»¶ï¼Œæ ¹æ®æç¤ºï¼Œæ€€ç–‘å¯èƒ½æ˜¯å†…å¤–ä¸¤ä¸ªç‰ˆæœ¬çš„ react å¯¼è‡´çš„ï¼Œå› æ­¤ç±»ä¼¼æ­¥éª¤ä¸€æ‰€ç¤ºï¼Œå°† react ä¾èµ–ç§»å‡ºå³å¯</p></li><li><p>åŠ è½½é¡µé¢æ—¶ï¼Œæç¤ºæœ‰æ¨¡å—è·¯å¾„å¼•ç”¨é”™è¯¯ã€‚æˆ‘ä»¬é¡¹ç›®ä¸­ babel é…ç½®äº†è‡ªå®šä¹‰çš„ presetï¼ˆä»¥ä¸‹ç®€ç§° Bï¼‰ã€‚B ä¸­ä½¿ç”¨ babel-plugin-transform-imports æ¥æŒ‰éœ€åŠ è½½ react-native å¯¼å‡ºçš„æ¨¡å—ã€‚è€Œç”±äº react-native å¯¼å‡ºçš„æ¨¡å—è·¯å¾„å˜æ›´ï¼Œå¯¼è‡´æŠ¥é”™ã€‚æˆ‘ä¸€å¼€å§‹åœ¨æƒ³ metro æ˜¯å¦ä¼šæä¾›ç±»ä¼¼ tree-shaking çš„å¤„ç†ï¼Œæœç´¢åå‘ç° metro å¹¶ä¸æ”¯æŒï¼Œè§ <a href="https://github.com/facebook/metro/issues/227">https://github.com/facebook/metro/issues/227</a> ã€‚éš¾é“åªèƒ½ä¸€ä¸ªä¸ªä¿®æ”¹è·¯å¾„äº†ä¹ˆï¼Ÿ</p><p>å¹¸è¿çš„æ˜¯ï¼Œæœ‰è¿™ä¹ˆä¸ª pr <a href="https://github.com/facebook/metro/pull/362">https://github.com/facebook/metro/pull/362</a> ï¼Œé€šè¿‡ @babel/plugin-transform-modules-commonjs å°† esm ä¸“ç¨‹ commonjs å¹¶ä¸”å®ç°æ‡’åŠ è½½ï¼Œå¹¶ä¸”è¿˜æ˜¯é»˜è®¤ä¸ºæ‡’åŠ è½½ï¼Œè¿™ä¸å°±æ˜¯æˆ‘éœ€è¦çš„ä¹ˆï¼Ÿå› æ­¤ç®€å•å¤„ç†å°† babel-plugin-transform-imports ä¸­å…³äº react-native çš„éƒ¨åˆ†å…¨éƒ¨åˆ é™¤å³å¯</p></li><li><p>è¿è¡Œæç¤ºï¼šA åŒ…ä¸­çš„ TextPropTypes ç­‰æ–‡ä»¶æ‰¾ä¸åˆ°ã€‚çœ‹åˆ°æ–‡æ¡£è¯´åˆ°ï¼š</p><blockquote><p><strong>Remove PropTypes</strong>: Weâ€™re removing <code>propTypes</code> from core components in order to reduce the app size impact of React Native core and to favor static type systems which check at compile time instead of runtime</p></blockquote><p>emmï¼Œä¸ºäº†å‡å°‘åº”ç”¨ä½“ç§¯å·²ç»å°† PropTypes ç§»é™¤äº†ï¼Œå¹¶ä¸”å€¾å‘äºä½¿ç”¨é™æ€ç±»å‹ç³»ç»Ÿã€‚é‚£å°±æ²¡ä»€ä¹ˆå¥½è¯´äº†ï¼Œåªèƒ½å°† PropTypes ç›¸å…³çš„ç§»é™¤ï¼Œåç»­å†æ…¢æ…¢æ·»åŠ ç±»å‹å£°æ˜æ–‡ä»¶ã€‚</p></li><li><p>æç¤ºï¼š Warning: ReactClass: Youâ€™re attempting to include a mixin that is either null or not an object.</p><p>A åŒ…ä¸­æœ‰éƒ¨åˆ†æ—§çš„ç»„ä»¶ä¸­ç”¨åˆ° mixinï¼Œreact å·²ç»ä¸æ¨èä½¿ç”¨ mixin å•¦ï¼Œå¹¶ä¸”çœ‹åˆ° mixin çš„æ˜¯ NativeMethodsï¼Œç›®å‰æ²¡æœ‰åœºæ™¯ä¼šä½¿ç”¨åˆ°ï¼Œå…ˆç®€å•ç§»é™¤æ‰ mixinï¼Œåç»­è€ƒè™‘é‡æ„ã€‚</p></li><li><p>æŠ¥é”™ï¼šVirtualizedLists should never be nested inside plain ScrollViews with the same orientation - use another VirtualizedList-backed container instead. æ–°ç‰ˆæœ¬ rn çš„ ScrollView ä¸èƒ½åµŒå¥—åŒæ–¹å‘çš„ VirtualizedListã€‚</p><p>æœ€ç®€å•çš„å¤„ç†æ–¹å¼æ˜¯å°† ScrollView æ”¹ä¸º FlatListï¼Œå°†åŸå…ˆ ScrollView ä¸­çš„ children æ”¹ä¸º FlatList çš„ ListHeaderComponent, åŒæ—¶æ³¨æ„ ScrollView ä¸ FlatList å¯èƒ½æœ‰äº› api ä¸å¤ªä¸€æ ·ï¼Œéœ€è¦è‡ªè¡Œè°ƒæ•´ä¸€ä¸‹ã€‚</p></li><li><p>æç¤ºï¼šCalling <code>getNode()</code> on the ref of an Animated component is no longer necessaryã€‚Animated ç»„ä»¶ä¸éœ€è¦é€šè¿‡ getNode æ¥è·å–èŠ‚ç‚¹äº†ï¼Œç›´æ¥ç”¨ ref å³å¯</p></li><li><p>æç¤ºï¼šAnimated.event now requires a second argument for optionsã€‚å³æ­¤å‰æœ‰é»˜è®¤å€¼çš„ useNativeDriverï¼Œç°åœ¨éœ€è¦æ‰‹åŠ¨ç»™å€¼äº†ã€‚</p></li><li><p>æŠ¥é”™ï¼šInvariant Violation: ViewPagerAndroid has been removed from React Native. It can now be installed and imported from â€˜@react-native-community/viewpagerâ€™ instead of â€˜react-nativeâ€™.  å¦‚æœæœ‰ä½¿ç”¨åˆ°æˆ–è€…æ˜¯ç¬¬ä¸‰æ–¹åº“æœ‰ä½¿ç”¨åˆ° ViewPagerAndroid çš„ï¼Œå¦‚ react-native-scrollable-tab-viewï¼Œè®°å¾—å‡çº§ä¸€ä¸‹ï¼Œä½¿ç”¨ @react-native-community/viewpagerã€‚</p></li></ol><p>ä»¥ä¸Šä¸ºå‡çº§ RN åˆ° 0.64.1 è¸©è¿‡çš„å‘ï¼Œä»…ä¾›å‚è€ƒã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ReactNative </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ©ç”¨ IntersectionObserver åšæ›å…‰åŸ‹ç‚¹</title>
      <link href="/2021/04/15/%E5%88%A9%E7%94%A8-IntersectionObserver-%E5%81%9A%E6%9B%9D%E5%85%89%E5%9F%8B%E7%82%B9/"/>
      <url>/2021/04/15/%E5%88%A9%E7%94%A8-IntersectionObserver-%E5%81%9A%E6%9B%9D%E5%85%89%E5%9F%8B%E7%82%B9/</url>
      
        <content type="html"><![CDATA[<p>å‰äº›å¤©æ¥äº†ä¸ªç´§æ€¥çš„ç®€å•éœ€æ±‚ï¼Œæœ‰å¤šç®€å•å‘¢ï¼Œå°±æ˜¯ä¸€å¼ èƒŒæ™¯å›¾ï¼Œç„¶åä¸Šé¢åŠ ä¸Šä¸€ä¸ªæ‚¬æµ®çš„æŒ‰é’®ã€‚æœç„¶ç®€å•ï¼ä¸è¿‡æŒ‰æƒ¯ä¾‹ï¼Œä¸å¯èƒ½è¿™ä¹ˆç®€å•ã€‚æœç„¶ç¬¬äºŒå¤©å°±è¯´è¯´åŠ äº†ä¸ªéœ€æ±‚ï¼Œéœ€è¦åœ¨è¿™ä¸ªèƒŒæ™¯å›¾åº•éƒ¨ç»§ç»­å¢åŠ ä¸¤è¡Œï¼Œæ¯è¡Œä¸‰ä¸ªå•†å“ï¼Œéœ€è¦ç»Ÿè®¡ç‚¹å‡»å’Œæ›å…‰äº‹ä»¶ã€‚ä¸ŠæŠ¥ç‚¹å‡»äº‹ä»¶å€’æ˜¯ç®€å•ï¼Œæ›å…‰åˆ™ç›¸å¯¹éº»çƒ¦ç‚¹ã€‚</p><a id="more"></a><p>æ­£å¦‚ mdn ä¸Šæ‰€è¯´çš„</p><blockquote><p>è¿‡å»ï¼Œç›¸äº¤æ£€æµ‹é€šå¸¸è¦ç”¨åˆ°äº‹ä»¶ç›‘å¬ï¼Œå¹¶ä¸”éœ€è¦é¢‘ç¹è°ƒç”¨<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getBoundingClientRect"><code>Element.getBoundingClientRect()</code></a> æ–¹æ³•ä»¥è·å–ç›¸å…³å…ƒç´ çš„è¾¹ç•Œä¿¡æ¯ã€‚äº‹ä»¶ç›‘å¬å’Œè°ƒç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getBoundingClientRect"><code>Element.getBoundingClientRect()</code></a> éƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šè¿è¡Œï¼Œå› æ­¤é¢‘ç¹è§¦å‘ã€è°ƒç”¨å¯èƒ½ä¼šé€ æˆæ€§èƒ½é—®é¢˜ã€‚è¿™ç§æ£€æµ‹æ–¹æ³•æå…¶æ€ªå¼‚ä¸”ä¸ä¼˜é›…ã€‚</p></blockquote><p>å› æ­¤å¦‚ä»Šçš„æµè§ˆå™¨æä¾›äº† IntersectionObserver  è¿™ä¸ª api ï¼Œæ¯å½“è¢«ç›‘è§†çš„å…ƒç´ è¿›å…¥æˆ–è€…é€€å‡ºå¦å¤–ä¸€ä¸ªå…ƒç´ æ—¶(æˆ–è€… <a href="https://developer.mozilla.org/en-US/docs/Glossary/Viewport">viewport</a> )ï¼Œæˆ–è€…ä¸¤ä¸ªå…ƒç´ çš„ç›¸äº¤éƒ¨åˆ†å¤§å°å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¯¥å›è°ƒæ–¹æ³•ä¼šè¢«è§¦å‘æ‰§è¡Œã€‚</p><h3 id="å…¼å®¹æ€§"><a href="#å…¼å®¹æ€§" class="headerlink" title="å…¼å®¹æ€§"></a>å…¼å®¹æ€§</h3><p>åœ¨äº†è§£å¦‚ä½•ä½¿ç”¨ä¹‹å‰ï¼Œä½œä¸ºå¼€å‘è€…æˆ‘ä»¬å¾€å¾€æ¯”è¾ƒå…³å¿ƒçš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šè¿™ä¸ª API çš„å…¼å®¹æ€§å¦‚ä½•ï¼Ÿ</p><p>åœ¨ <a href="https://caniuse.com/?search=IntersectionObserver%20%20">can i use</a> ä¸Šçœ‹åˆ°å¤§éƒ¨åˆ†çš„æµè§ˆå™¨æ˜¯æ”¯æŒçš„</p><p><img src="https://i.loli.net/2021/04/15/SJXa9fkoCY1q3AE.png" alt="image.png"></p><p>é‚£æœ‰äººå°±é—®äº†ï¼Œå¦‚æœè€æ¿å°±æ˜¯è¦å…¼å®¹ IE å‘¢ ğŸ˜‚ </p><p>å¹¸å¥½ IntersectionObserver  æä¾›äº† <a href="https://github.com/w3c/IntersectionObserver/tree/main/polyfill">polyfill</a> ï¼Œæˆ‘ä»¬åªéœ€è¦æŒ‰ç…§æ–‡æ¡£å¼•å…¥<code>polyfill</code> å°±å¥½äº†ã€‚ç®€å•ç„äº†ä¸€ä¸‹ polyfill æºç åº”è¯¥å°±æ˜¯å›é€€åˆ° getBoundingClientRect æ–¹æ¡ˆã€‚</p><h3 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h3><p>åŸå…ˆçš„ä»£ç æ˜¯åŸç”Ÿ js å†™çš„ï¼Œåæ¥ï¼ˆæƒ¯ä¾‹ï¼‰åˆåŠ äº†ä¸€äº› AB å®éªŒç­‰éœ€æ±‚ï¼Œç´¢æ€§æ”¹æˆ vue å†™åè€Œæ›´å¿«äº†ï¼Œé¡µé¢ç»“æ„å¤§è‡´å¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre class="line-numbers language-html" data-language="html"><code class="language-html">&lt;template&gt;  &lt;div&gt;    &lt;img class&#x3D;&quot;bg-img&quot; :src&#x3D;&quot;bg-img&quot; &#x2F;&gt;    &lt;img      v-for&#x3D;&quot;product in productList&quot;      :key&#x3D;&quot;product.id&quot;      :src&#x3D;&quot;product.src&quot;      class&#x3D;&quot;product-img&quot;    &#x2F;&gt;  &lt;&#x2F;div&gt;&lt;&#x2F;template&gt;</code></pre><p>ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª observer</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">&#x2F;&#x2F; å£°æ˜å½“è§‚å¯Ÿåˆ°å…ƒç´ è¿›å‡ºè§†å£æ—¶è§¦å‘çš„å›è°ƒå‡½æ•°const callback &#x3D; (changes) &#x3D;&gt; &#123;  changes.forEach(function(change) &#123;    &#x2F;&#x2F; el å³ä¸ºæˆ‘ä»¬è§‚å¯Ÿçš„å…ƒç´     const el &#x3D; change.target;      &#x2F;&#x2F; ä¸ŠæŠ¥æ›å…‰    console.log(&quot;exposure&quot;, change);      &#x2F;&#x2F; å–æ¶ˆè§‚å¯Ÿ    observer.unobserve(el);  &#125;);&#125;&#x2F;&#x2F; IntersectionObserver å¯ä»¥æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•° opt å¯ä»¥å®šä¹‰å®¹å™¨ï¼ˆé»˜è®¤ä¸ºè§†å£ï¼‰ç­‰é…ç½®,è¿™é‡Œä¸å±•å¼€è®²ï¼Œè¯¦ç»†å¯çœ‹ mdn æ–‡æ¡£const observer &#x3D; new IntersectionObserver(callbackï¼Œopt || &#123;&#125;);</code></pre><p>ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡µé¢åˆå§‹åŒ–çš„æ—¶å€™è§‚å¯Ÿã€‚</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">mounted() &#123;[...document.querySelectorAll(&quot;.product-img&quot;)].forEach(item &#x3D;&gt; &#123;    observer.observe(item);  &#125;);&#125;</code></pre><p>å¤§åŠŸå‘Šæˆï¼Ÿno.</p><h3 id="è¸©è¿‡çš„å‘"><a href="#è¸©è¿‡çš„å‘" class="headerlink" title="è¸©è¿‡çš„å‘"></a>è¸©è¿‡çš„å‘</h3><p>å®é™…ä¸Šå¦‚æœè¿™ä¹ˆå†™çš„è¯ä¼šæœ‰å‡ ä¸ªé—®é¢˜ã€‚</p><ol><li><p>é¦–å…ˆå°±æ˜¯æˆ‘ä»¬ä¸€æ‰“å¼€é¡µé¢ï¼Œå°±ä¼šå‘ç°è§¦å‘æ‰€æœ‰çš„äº†ä¸ŠæŠ¥æ›å…‰äº‹ä»¶ã€‚è¿™ä¸ªé—®é¢˜å°±å‡ºåœ¨å½“æˆ‘ä»¬ observe çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡å›è°ƒï¼Œå³ä½¿å…ƒç´ å¹¶æ²¡æœ‰è¿›å‡ºè§†å£ã€‚é‚£ä¹ˆæˆ‘ä»¬è¦åšçš„å°±æ˜¯åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨è§†å£ä¸­å³å¯ï¼Œè°ƒæ•´ callback</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">&#x2F;&#x2F; å£°æ˜å½“è§‚å¯Ÿåˆ°å…ƒç´ è¿›å‡ºè§†å£æ—¶è§¦å‘çš„å›è°ƒå‡½æ•°const callback &#x3D; (changes) &#x3D;&gt; &#123;  changes.forEach(function(change) &#123;    &#x2F;&#x2F; el å³ä¸ºæˆ‘ä»¬è§‚å¯Ÿçš„å…ƒç´     const el &#x3D; change.target;    if (change.intersectionRatio &gt; 0) &#123;    &#x2F;&#x2F; ä¸ŠæŠ¥æ›å…‰    console.log(&quot;exposure&quot;, change);    &#x2F;&#x2F; å–æ¶ˆè§‚å¯Ÿ    observer.unobserve(el);    &#125;  &#125;);&#125;&#x2F;&#x2F; IntersectionObserver å¯ä»¥æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•° opt å¯ä»¥å®šä¹‰å®¹å™¨ï¼ˆé»˜è®¤ä¸ºè§†å£ï¼‰ç­‰é…ç½®,è¿™é‡Œä¸å±•å¼€è®²ï¼Œè¯¦ç»†å¯çœ‹ mdn æ–‡æ¡£const observer &#x3D; new IntersectionObserver(callbackï¼Œopt || &#123;&#125;);</code></pre><p>é€šè¿‡ change.intersectionRatio å¯ä»¥çŸ¥é“å…ƒç´ åœ¨è§†å£ä¸­äº¤å‰çš„æ¯”ä¾‹æ˜¯å¤šå°‘ï¼Œå¦‚æœå¤§äº 0 åˆ™è¯æ˜å…ƒç´ æ˜¯åœ¨è§†å£ä¸­ï¼Œæ­¤æ—¶æ‰éœ€è¦æ›å…‰ã€‚</p></li><li><p>ç»è¿‡ä¸Šè¿°çš„ä¿®æ”¹ï¼Œæˆ‘ä»¬æ‰“å¼€é¡µé¢å†çœ‹ï¼Œemmmâ€¦ è¿˜æ˜¯ä¸€å¼€å§‹å°±æŠŠæ‰€æœ‰çš„å…ƒç´ æ›å…‰éƒ½ä¸ŠæŠ¥äº†å•Šã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ›å…‰æ—¶ change çš„ä¸€äº›å±æ€§</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">&#123;  &#x2F;&#x2F; ...å…¶ä»–ä¸€äº›å±æ€§  &#x2F;&#x2F; äº¤å‰æ¯”ä¾‹  intersectionRatio: 1  &#x2F;&#x2F; ç›®æ ‡å…ƒç´ çš„å±æ€§  boundingClientRect: &#123;    bottom: 0    height: 0    left: 0    right: 375    top: 0    width: 375    x: 0    y: 0  &#125;&#125;</code></pre><p>å¯ä»¥çœ‹åˆ° intersectionRatio = 1 å³è¯´æ˜å…ƒç´ ç¡®ç¡®å®å®åœ¨è§†å£ä¸­äº†ï¼Œè€Œ boundingClientRect ä¸­çš„ height è¡¨ç¤ºå½“æ—¶å…ƒç´ çš„é«˜åº¦è¿˜æ˜¯ 0ï¼Œå†ä¸€çœ‹ y ä¹Ÿæ˜¯ 0ã€‚ç¬é—´æƒ³åˆ°ï¼šmounted çš„æ—¶å€™ï¼Œå›¾ç‰‡éƒ½è¿˜æ²¡åŠ è½½å¥½ï¼Œé‚£ä¹ˆæ­¤æ—¶é¡µé¢è¿˜æ²¡æœ‰æ’‘å¼€ï¼Œè‡ªç„¶æ‰€æœ‰çš„äº§å“å¡ç‰‡éƒ½æ˜¯åœ¨è§†å£ä¸­ï¼ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ observe çš„æ—¶æœºä¸æ­£ç¡®ã€‚é‚£ä¹ˆæ­£ç¡®çš„æ—¶æœºåº”è¯¥æ˜¯åœ¨é¡µé¢ onload ä¹‹åï¼Œè€Œéåœ¨ç»„ä»¶çš„ mounted äº‹ä»¶ä¸­ã€‚</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">mounted() &#123;window.addEventListener(&#39;load&#39;, function() &#123;    [...document.querySelectorAll(&quot;.product-img&quot;)].forEach(item &#x3D;&gt; &#123;    observer.observe(item);  &#125;);  &#125;)&#125;</code></pre><p>è‡³æ­¤å°±å¯ä»¥æ­£å¸¸ä¸ŠæŠ¥æ›å…‰ã€‚</p><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><p>æ€»ç»“ï¼ŒIntersectionObserver æœ‰å¦‚ä¸‹å‡ ä¸ªä¼˜ç‚¹ï¼š</p><ol><li>æä¾›çš„ Api å‹å¥½ï¼Œä½¿ç”¨èµ·æ¥ç®€å•</li><li>å…¼å®¹æ€§ä¸é”™ï¼Œå¹¶ä¸”æä¾›äº† polyfill</li><li>æ€§èƒ½æ–¹é¢æµè§ˆå™¨åšäº†ç›¸å…³ä¼˜åŒ–</li><li>é€‚ç”¨æ€§å¹¿æ³›ï¼Œåº”ç”¨åœºæ™¯åˆ™åŒ…æ‹¬ä¸Šè¿°çš„æ›å…‰åŸ‹ç‚¹ï¼Œå›¾ç‰‡æ‡’åŠ è½½ï¼Œæ— é™æ»šåŠ¨ç­‰ç­‰</li></ol></li></ol>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>inversify åˆä½“éªŒ</title>
      <link href="/2021/04/01/inversify-%E5%88%9D%E4%BD%93%E9%AA%8C/"/>
      <url>/2021/04/01/inversify-%E5%88%9D%E4%BD%93%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>è°ˆè°ˆ styled-components</title>
      <link href="/2021/03/30/%E8%B0%88%E8%B0%88%20styled-components/"/>
      <url>/2021/03/30/%E8%B0%88%E8%B0%88%20styled-components/</url>
      
        <content type="html"><![CDATA[<p>æ—©åœ¨åˆšå¼€å§‹æ¥è§¦ React çš„æ—¶å€™å°±æœ‰å¬é—»è¿‡ <code>css in js</code> çš„ç†å¿µï¼Œä¸­é—´ä¹Ÿç®€å•ä½¿ç”¨è¿‡ <code>styled-components</code>ï¼Œä½†ç”¨åˆ°æœ€åæ€»å› ä¸ºå„ç§åŸå› æ”¾å¼ƒã€‚è¿™æ¬¡åˆšå¥½å¿ƒè¡€æ¥æ½®åˆæƒ³é‡æ–°è¯•è¯•ï¼ŒåŒæ—¶è®°å½•ä¸€ä¸‹ä»ä¸ªäººè§’åº¦æ¥çœ‹ <code>styled-components</code> çš„ä¼˜ç¼ºç‚¹ï¼Œä»¥ä¾¿å°†æ¥é€‰å‹æ—¶ä½œä¸ºå‚è€ƒä¹‹ç”¨ã€‚</p><a id="more"></a><p>åŸºäº create-react-app æ­å»ºçš„ TypeScript é¡¹ç›®ï¼Œè‡³äºå¦‚ä½•åŠ å…¥ styled-componentsï¼Œè¿™é‡Œä¸èµ˜è¿°ï¼ŒæŒ‰ç…§æ–‡æ¡£å¾ˆç®€å•å°±å¯ä»¥å®Œæˆäº†ã€‚ä»¥ä¸‹ç®€ç§°ä¸º <code>sc</code>ã€‚</p><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>ç®€å•ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹:</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import styled from &#39;styled-components&#39;const Title &#x3D; styled.h1&#96;  font-size: 1.5em;&#96;;render(  &lt;Title&gt;    Hello World!  &lt;&#x2F;Title&gt;);</code></pre><p>æœ€ç»ˆç¼–è¯‘å‡ºæ¥çš„æ˜¯ä¸€ä¸ªç‹¬ç‰¹çš„ hash å€¼çš„æ ·å¼åï¼Œè¿™å¯ä»¥é¿å…æˆ‘ä»¬æ ·å¼åç§°è¢«è¦†ç›–ï¼Œè€Œåœ¨æ­¤ä¹‹å‰æˆ‘ä»¬å¾€å¾€éœ€è¦é…ç½® css modulesï¼Œ å¦‚æœæ˜¯ create react app åˆ›å»ºçš„é¡¹ç›®ï¼Œå¾€å¾€ä¼šç”¨ .module.css æ¥è¡¨ç¤º css æ¨¡å—ã€‚è€Œ sc åˆ™è‡ªå¸¦äº†è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘è§‰å¾—è¿™æ˜¯ä»–çš„ç¬¬ä¸€ä¸ªä¼˜ç‚¹ã€‚</p><p>styled-components å¯ä»¥ä¼  propsã€‚</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import styled from &#39;styled-components&#39;const Title &#x3D; styled.h1&lt;&#123;isRed: boolean&#125;&gt;&#96;  font-size: 1.5em;color: $&#123;props &#x3D;&gt; props.isRed ? &#39;red&#39; : &#39;black&#39;&#125;&#96;;const isRed &#x3D; ...render(  &lt;Title isRed&#x3D;&#123;isRed&#125;&gt;    Hello World!  &lt;&#x2F;Title&gt;);</code></pre><p>è€Œåœ¨ä½¿ç”¨ styled-components ä¹‹å‰ï¼Œæˆ‘ä»¬è¦åšåˆ°è¿™ä¸ªæ•ˆæœå¾€å¾€æ˜¯åœ¨ style é‡Œå¤„ç†ï¼Œæˆ–è€…æ˜¯é€šè¿‡æ ·å¼åæ¥æ§åˆ¶</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">&#x2F;&#x2F; åœ¨ style é‡Œå¤„ç†ï¼Œä¸æ–¹ä¾¿å¤ç”¨render(  &lt;h1 style&#x3D;&#123;&#123; color: isRed ? &#39;red&#39; : &#39;black&#39; &#125;&#125;&gt;    Hello World!  &lt;&#x2F;h1&gt;);&#x2F;&#x2F; é€šè¿‡æ ·å¼åæ§åˆ¶è¾ƒä¸ºç¹ç.red &#123; color: &#39;red&#39; &#125;.black &#123; color: &#39;black&#39; &#125;render(  &lt;h1 className&#x3D;&#123;isRed ? &#39;red&#39; : &#39;black&#39;&#125;&gt;    Hello World!  &lt;&#x2F;h1&gt;);</code></pre><p>è¿™æ˜¯ styled-components çš„ç¬¬äºŒä¸ªä¼˜ç‚¹ã€‚</p><p>æœ‰ä¸ªåœºæ™¯æ¯”è¾ƒç»å¸¸å‡ºç°åœ¨ç»´æŠ¤æ—§ä»£ç çš„æ—¶å€™ï¼Œå¾€å¾€æœ‰çš„ç»„ä»¶ä¸éœ€è¦äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•ç§»é™¤æ‰ï¼Œä½†æ˜¯è¿™ä¸ªç»„ä»¶æ‰€ä½¿ç”¨çš„æ ·å¼åå´ä¸æ•¢è½»æ˜“åˆ æ‰ï¼Œå› ä¸ºé¬¼çŸ¥é“è¿™ä¸ªæ ·å¼æ˜¯ä¸æ˜¯åˆ«çš„åœ°æ–¹ç”¨åˆ°äº†ã€‚è€Œè¿™ä¸ªåˆ™æ˜¯ sc ä¸­æ ·å¼ç»„ä»¶åˆ™ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥è¿™æ˜¯ç¬¬ä¸‰ä¸ªä¼˜ç‚¹ï¼šä¾¿äºç»´æŠ¤ã€‚</p><p>ä»¥ä¸Šæ˜¯æˆ‘è§‰å¾—æ„ŸçŸ¥æ¯”è¾ƒå¼ºçƒˆçš„ä¼˜ç‚¹ï¼Œå½“ç„¶è¿˜æœ‰ä¸€äº›åˆ«çš„ä¼˜ç‚¹è¿™é‡Œå°±ä¸è¯´äº†ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹æ–‡æ¡£ã€‚</p><p>è¯´å®Œäº†ä¼˜ç‚¹ï¼Œè¯´è¯´å¼€å‘æ—¶é‡åˆ°çš„ç¼ºç‚¹å§</p><p>ç¬¬ä¸€ä¸ªå°±æ˜¯ç”±äº sc å®é™…ä¸Šå°±æ˜¯ç»„ä»¶ï¼Œè€Œè¿™ä¸ªå¾€å¾€ä¼šè®©æˆ‘åˆ†ä¸æ¸…å“ªäº›æ˜¯æ ·å¼ç»„ä»¶ï¼Œå“ªäº›æ˜¯ React ç»„ä»¶ï¼Œå°±æ˜¯æ˜¾å¾—ä¸å¤Ÿç›´è§‚ã€‚</p><p>ç¬¬äºŒä¸ªæ˜¯æœ‰ä¸€äº›ç»„ä»¶ï¼Œå®é™…ä¸Šåªæ˜¯ä¸€è¡Œæ ·å¼å°±è§£å†³äº†ï¼Œé‚£ä¹ˆæ¯æ¬¡éƒ½éœ€è¦é‡æ–°å†™ä¸€ä¸ª sc ç»„ä»¶ï¼Œåè€Œæ˜¾å¾—ç¹çã€‚å®˜æ–¹æ˜¯æ¨èå¯ä»¥ä½¿ç”¨ <code>css prop</code>  æ¥è§£å†³</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import &#123; css &#125; from &#39;styled-components&#x2F;macro&#39;render(  &lt;h1 css&#x3D;&#123;css&#96;font-size: 1.5em;&#96;&#125;&gt;    Hello World!  &lt;&#x2F;h1&gt;);</code></pre><p>è¿™ä¸ªåŠŸèƒ½éœ€è¦æœ‰babel-plugin-styled-components æˆ–è€… babel-plugin-macro çš„æ”¯æŒï¼Œcreate react app é»˜è®¤æ”¯æŒäº†,è¯¦æƒ…çœ‹<a href="https://styled-components.com/docs/api#css-prop">æ–‡æ¡£</a>ã€‚</p><p>å¦‚æœæ˜¯ Typescriptï¼Œç”±äºåŸå…ˆçš„ç»„ä»¶ä¸Šå¹¶æ²¡æœ‰ css è¿™ä¸ªå±æ€§ï¼Œåˆ™éœ€è¦é¢å¤–åœ¨å…¨å±€å¼•å…¥</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import &#123;&#125; from &#39;styled-components&#x2F;cssprop&#39;</code></pre><p>æ–‡æ¡£ä¸­æåˆ° <code>css prop</code> å®é™…ä¸Šä¹Ÿæ˜¯å°†ç»„ä»¶è½¬ä¸ºæ ·å¼ç»„ä»¶ï¼Œè€Œå¦‚æœæ˜¯åœ¨ typescript ä¸­éœ€è¦ä¼ é€’è‡ªå®šä¹‰ propï¼Œæˆ‘ä¸çŸ¥é“è¯¥å¦‚ä½•å®šä¹‰ç±»å‹?</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import &#123; css &#125; from &#39;styled-components&#x2F;macro&#39;const Title &#x3D; css&#96;font-size: 1.5em;color: &#123;props &#x3D;&gt; props.color&#125;&#96;render(  &#x2F;&#x2F; æ­¤æ—¶å°†æç¤º color ç±»å‹é”™è¯¯äº‘äº‘ã€‚ã€‚  &lt;h1 css&#x3D;&#123;Title&#125; color&#x3D;&quot;red&quot;&gt;    Hello World!  &lt;&#x2F;h1&gt;);</code></pre><p>ç¬¬ä¸‰ä¸ªæ˜¯æ ·å¼å¤ç”¨ï¼Œå³å¦‚æœæˆ‘æœ‰ç›¸åŒçš„æ ·å¼æƒ³è¦ç”¨åœ¨ä¸åŒçš„ç»„ä»¶ä¸Šï¼Œsc ä¹Ÿæ˜¯æ¨èä½¿ç”¨ <code>css props</code>ï¼Œè€Œ css props çš„ä½“éªŒæ˜¯åœ¨æ˜¯ä¸æ•¢è¯´å¾ˆå¥½ã€‚</p><p>å°±æˆ‘ä¸ªäººè€Œè¨€ç›®å‰ä¸»è¦æ˜¯è¿™ä¸‰ç‚¹ç”¨ç€ä¸çˆ½ã€‚</p><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>é‚£ä¹ˆ <code>sc</code> ä¸ºä»€ä¹ˆå¯ä»¥é€šè¿‡ <code>styled</code>æ¥ç»™ç»„ä»¶æ·»åŠ æ ·å¼çš„å‘¢ï¼Ÿ</p><p>es6 æä¾›äº† `` ä½œä¸ºæ¨¡æ¿å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬é€šå¸¸çš„ç”¨æ³•</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const name &#x3D; &#96;$&#123;firstName&#125;$&#123;secondName&#125;&#96;</code></pre><p>è€Œå¦‚æœ ``æ˜¯è·Ÿéšåœ¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œåˆ™è¯¥å‡½æ•°å°†è¢«è°ƒç”¨æ¥å¤„ç†è¿™ä¸ªæ¨¡æ¿å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªç§°ä¸ºæ ‡ç­¾æ¨¡æ¿</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console.log&#96;hi&#96;&#x2F;&#x2F; ç­‰åŒäºconsole.log(&#39;hi&#39;)</code></pre><p>å…³äºè¿™éƒ¨åˆ†å¯ä»¥æŸ¥é˜… <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#tagged_templates">MDN ç›¸å…³æ–‡æ¡£</a></p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">styled.div&#96;color: red&#96;&#x2F;&#x2F; ç­‰åŒäºstyled.div([&#39;\n  color: red;\n&#39;])</code></pre><p>åœ¨ç¼–è¯‘åçš„ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ä¸€æ®µå¦‚ä¸‹ä»£ç ï¼Œä¸éš¾çŒœæµ‹å‡º <code>Object(i.a)</code> å°±æ˜¯ <code>styled.div</code></p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">var n &#x3D; Object(i.a)([&#39;\n  color: red;\n&#39;])</code></pre><p><code>styled.div</code>ç­‰åŒäº <code>styled(&#39;div&#39;)</code>ï¼Œå› è€Œ <code>styled</code> å¯ä»¥çœ‹ä½œä¸€ä¸ªé«˜é˜¶ç»„ä»¶</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const StyledComponent &#x3D; styled(Component)(styles)</code></pre><h4 id="åç»­"><a href="#åç»­" class="headerlink" title="åç»­"></a>åç»­</h4><p>ä¸ºäº†è§£å†³ä¸€ä¸¤è¡Œä»£ç ä¹Ÿè¦ç”¨ <code>css prop</code> çš„æƒ…å†µï¼Œæˆ‘å¼•å…¥äº† <code>tailwindcss</code>ï¼Œè¿™ä¸ª css æ¡†æ¶ä¸­çš„åŸå­æ€§ç±»åç†å¿µéå¸¸å¥‘åˆæˆ‘çš„é—®é¢˜ã€‚æˆ‘è§‰å¾—è¿™ä¸¤ä¸ªæ¡†æ¶æ­é…å†™èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒé¡ºç•…çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åœ¨ react ä¸­ä½¿ç”¨ rxjs</title>
      <link href="/2021/03/24/%E5%9C%A8-react-%E4%B8%AD%E4%BD%BF%E7%94%A8-rxjs/"/>
      <url>/2021/03/24/%E5%9C%A8-react-%E4%B8%AD%E4%BD%BF%E7%94%A8-rxjs/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘å‡ºäºå­¦ä¹ ç›®çš„åœ¨ä¸´æ‘¹ä¸€ä¸ªåœ¨çº¿ ppt çš„å¼€æºé¡¹ç›®ã€‚åŸé¡¹ç›®ä½¿ç”¨çš„æ˜¯ vue3ï¼Œæˆ‘åˆ™æ‰“ç®—ç”¨ react æ¥å®ç°ï¼ŒåŒæ—¶ç©ä¸€äº›æš‚æ—¶ä¸ä¼šåœ¨å·¥ä½œä¸­ä½¿ç”¨åˆ°çš„æŠ€æœ¯ï¼Œæ¯”å¦‚ rxjsã€‚æœ¬æ–‡ç”¨äºè®°å½•åœ¨ react ä¸­åŠ å…¥ rxjs çš„è¿‡ç¨‹ï¼Œæœ¬äººä¹Ÿæ˜¯åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œå› æ­¤ä»¥ä¸‹ä»…ä¸ºä¸ªäººç†è§£ï¼Œå¹¶ä¸ä»£è¡¨æœ€ä½³å®è·µã€‚</p><a id="more"></a><h4 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h4><p>æ¯æ¬¡ç‚¹å‡»â€æ·»åŠ å¹»ç¯ç‰‡â€æŒ‰é’®ï¼Œåˆ›å»ºä¸€å¼ å¹»ç¯ç‰‡ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªå†å²å¿«ç…§ï¼Œåˆ›å»ºå†å²å¿«ç…§æ˜¯ä¸€ä¸ª debounce åçš„æ–¹æ³•ã€‚å³å¦‚æœå¿«é€Ÿç‚¹å‡»å¤šæ¬¡â€æ·»åŠ å¹»ç¯ç‰‡â€ï¼Œ ä¹Ÿä»…åˆ›å»ºä¸€ä¸ªå†å²å¿«ç…§ã€‚</p><h4 id="React-é€šå¸¸å†™æ³•"><a href="#React-é€šå¸¸å†™æ³•" class="headerlink" title="React é€šå¸¸å†™æ³•"></a>React é€šå¸¸å†™æ³•</h4><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import React from &#39;react&#39;import debounce from &#39;lodash&#x2F;debounce&#39;const CreateSlideButton &#x3D; () &#x3D;&gt; &#123;  const createSnapshot &#x3D; debounce(() &#x3D;&gt; &#123;    console.log(&#39;create snapshot&#39;)  &#125;, 300)  const createSlide &#x3D; () &#x3D;&gt; &#123;    console.log(&#39;create slide&#39;)  &#125;  const handleClick &#x3D; () &#x3D;&gt; &#123;    createSlide()    createSnapshot()  &#125;  return (    &lt;div onClick&#x3D;&#123;handleClick&#125;&gt;åˆ›å»ºå¹»ç¯ç‰‡&lt;&#x2F;div&gt;  )&#125;export default CreateSlideButton</code></pre><h4 id="æ”¹æˆ-rxjs-å®ç°"><a href="#æ”¹æˆ-rxjs-å®ç°" class="headerlink" title="æ”¹æˆ rxjs å®ç°"></a>æ”¹æˆ rxjs å®ç°</h4><p>åœ¨ rxjs é‡Œï¼Œæ•°æ® / äº‹ä»¶ æ˜¯ä¸€ä¸ªæµçš„æ¦‚å¿µã€‚æ¯”å¦‚æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®ï¼Œæ¯ç‚¹å‡»ä¸€æ¬¡ï¼Œé‚£ä¹ˆè¿™ä¸ªäº‹ä»¶æµå°±å¤šäº†ä¸€ä¸ªç‚¹å‡»äº‹ä»¶ã€‚</p><p>æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯åœ¨ç»„ä»¶åˆ›å»ºè¿™ä¹ˆä¸ªäº‹ä»¶æµå¹¶ä¸”è®¢é˜…ï¼Œæ¯å½“äº‹ä»¶æµæœ‰æ–°çš„äº‹ä»¶ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œæˆ‘ä»¬çš„å›è°ƒå‡½æ•°ï¼Œå½“ç„¶åˆ«å¿˜äº†åœ¨ç»„ä»¶å¸è½½çš„æ—¶å€™ï¼Œéœ€è¦å–æ¶ˆè®¢é˜…ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šä»¥ <code>$</code> ç»“å°¾æ¥è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæµï¼Œè®¢é˜…è¿™ä¸ªæµå®é™…ä¸Šå°±æ˜¯æ‰§è¡Œæµçš„ subscribe æ–¹æ³•ï¼Œsubscribe æ¥æ”¶çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯å½“äº‹ä»¶æµæœ‰æ–°äº‹ä»¶æ—¶æ‰§è¡Œçš„å›è°ƒã€‚è€Œå¸è½½åˆ™æ˜¯æŒ‡æµçš„ unsubscribe æ–¹æ³•ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•åˆ›å»ºä¸€ä¸ªæµå‘¢ï¼Ÿrxjs æä¾›äº†å¾ˆå¤šæ“ä½œç¬¦ï¼Œé€šå¸¸æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>fromEvent</code>åˆ›å»ºä¸€ä¸ªäº‹ä»¶æµ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">import &#123; fromEvent &#125; from &#39;rxjs&#39;;const clickEvt$ &#x3D; fromEvent(document, &#39;click&#39;);</code></pre><p>ä½†æ˜¯ react æœ‰è‡ªå·±çš„åˆæˆäº‹ä»¶æœºåˆ¶ï¼Œæ˜¾ç„¶ä¸Šé¢çš„å†™æ³•ä¸å¤ªåˆé€‚ã€‚æˆ‘ä»¬éœ€è¦è‡ªå·±æ¥åˆ›å»ºä¸€ä¸ªæµï¼Œè¿™ä¸ªæµå¯ä»¥æ¥æ”¶ react äº‹ä»¶ï¼ŒåŒæ—¶è¿™ä¸ªæµå¯ä»¥è¢«è®¢é˜…ã€‚æˆ‘ä»¬ç§°è¿™æ ·çš„æµä¸º Subjectã€‚é‚£ä¹ˆç°åœ¨åˆ›å»ºä¸€ä¸ªæµå¯ä»¥è¿™ä¹ˆå†™</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import React, &#123; useEffect &#125; from &quot;react&quot;;import &#123; Subject &#125; from &quot;rxjs&quot;;const CreateSlideButton &#x3D; () &#x3D;&gt; &#123;  const clickEvt$ &#x3D; new Subject();  const handleClick &#x3D; () &#x3D;&gt; &#123;    clickEvt$.next();  &#125;;  return &lt;div onClick&#x3D;&#123;handleClick&#125;&gt;åˆ›å»ºå¹»ç¯ç‰‡&lt;&#x2F;div&gt;;&#125;;export default CreateSlideButton;</code></pre><p>ä¸Šè¿°ä»£ç é€šè¿‡ <code>const clickEvt$ = new Subject();</code> åˆ›å»ºäº†ä¸€ä¸ªç‚¹å‡»äº‹ä»¶æµï¼Œå¹¶ä¸”åœ¨æ¯æ¬¡ <code>onClick</code> çš„æ—¶å€™ï¼Œ<code>clickEvt$.next();</code>ç»™äº‹ä»¶æµæ¨é€ä¸€ä¸ªäº‹ä»¶ã€‚</p><p>ä½†æ˜¯è¿™ä¸ªå†™æ³•æ˜æ˜¾æœ‰ä¸ªé—®é¢˜ï¼Œæ¯æ¬¡ç»„ä»¶æ›´æ–°çš„æ—¶å€™éƒ½å°†åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>clickEvt$</code>ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨<code>useMemo</code>åŒ…èµ·æ¥</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import React, &#123; useMemo &#125; from &quot;react&quot;;import &#123; Subject &#125; from &quot;rxjs&quot;;const CreateSlideButton &#x3D; () &#x3D;&gt; &#123;  const clickEvt$ &#x3D; useMemo(() &#x3D;&gt; new Subject(), []);  const handleClick &#x3D; () &#x3D;&gt; &#123;    clickEvt$.next();  &#125;;  return &lt;div onClick&#x3D;&#123;handleClick&#125;&gt;åˆ›å»ºå¹»ç¯ç‰‡&lt;&#x2F;div&gt;;&#125;;export default CreateSlideButton;</code></pre><p>æ¥ç€æˆ‘ä»¬éœ€è¦åœ¨ç»„ä»¶åˆå§‹åŒ–æ—¶è®¢é˜…è¿™ä¸ªäº‹ä»¶æµï¼Œå¹¶ä¸”åœ¨ç»„ä»¶å¸è½½æ—¶å–æ¶ˆè®¢é˜…è¿™ä¸ªäº‹ä»¶æµã€‚</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import React, &#123; useEffect, useMemo &#125; from &quot;react&quot;;import &#123; Subject &#125; from &quot;rxjs&quot;;const CreateSlideButton &#x3D; () &#x3D;&gt; &#123;  const clickEvt$ &#x3D; useMemo(() &#x3D;&gt; new Subject(), []);  useEffect(() &#x3D;&gt; &#123;    clickEvt$.subscribe(() &#x3D;&gt; &#123;      console.log(&quot;click&quot;);    &#125;);    return () &#x3D;&gt; clickEvt$.unsubscribe();  &#125;, [clickEvt$]);  const handleClick &#x3D; () &#x3D;&gt; &#123;    clickEvt$.next();  &#125;;  return &lt;div onClick&#x3D;&#123;handleClick&#125;&gt;åˆ›å»ºå¹»ç¯ç‰‡&lt;&#x2F;div&gt;;&#125;;export default CreateSlideButton;</code></pre><p>è‡³æ­¤æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®åï¼Œå°†æ‰“å° â€œclickâ€ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•å®ç°åˆ›å»º å¹»ç¯ç‰‡å’Œå†å²å¿«ç…§è‡ªç„¶å°±ä¸è¨€è€Œå–»äº†</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import React, &#123; useEffect, useMemo &#125; from &quot;react&quot;;import &#123; Subject &#125; from &quot;rxjs&quot;;import debounce from &quot;lodash&#x2F;debounce&quot;;const CreateSlideButton &#x3D; () &#x3D;&gt; &#123;  &#x2F;&#x2F; åˆ›å»ºç‚¹å‡»äº‹ä»¶æµ  const clickEvt$ &#x3D; useMemo(() &#x3D;&gt; new Subject(), []);  const [createSnapshot, createSlide] &#x3D; useMemo(    () &#x3D;&gt; [      debounce(() &#x3D;&gt; &#123;        console.log(&quot;create snapshot&quot;);      &#125;, 300),      () &#x3D;&gt; &#123;        console.log(&quot;create slide&quot;);      &#125;    ],    []  );  useEffect(() &#x3D;&gt; &#123;    &#x2F;&#x2F; è®¢é˜…    clickEvt$.subscribe(() &#x3D;&gt; &#123;      createSlide();      createSnapshot();    &#125;);    &#x2F;&#x2F; å–æ¶ˆè®¢é˜…    return () &#x3D;&gt; clickEvt$.unsubscribe();  &#125;, [clickEvt$, createSnapshot, createSlide]);  const handleClick &#x3D; () &#x3D;&gt; &#123;    &#x2F;&#x2F; æ¨é€ç‚¹å‡»äº‹ä»¶    clickEvt$.next();  &#125;;  return &lt;div onClick&#x3D;&#123;handleClick&#125;&gt;åˆ›å»ºå¹»ç¯ç‰‡&lt;&#x2F;div&gt;;&#125;;export default CreateSlideButton;</code></pre><p>è¿˜æœ‰å¯ä»¥æ”¹é€ çš„åœ°æ–¹ä¹ˆï¼Ÿ</p><p>æ—¢ç„¶æˆ‘ä»¬æ¥å—äº† frp çš„ç¼–ç¨‹æ€æƒ³ï¼Œæ˜¯å¦å¯ä»¥è¿™ä¹ˆæ€è€ƒï¼Œæˆ‘ä»¬æ¯æ¬¡ç‚¹å‡»ï¼Œå°±äº§ç”Ÿäº†ç‚¹å‡»äº‹ä»¶æµï¼Œè€Œç‚¹å‡»äº‹ä»¶çš„å›è°ƒä¸­ï¼Œæˆ‘ä»¬åˆæ´¾å‘äº†åˆ›å»ºå†å²å¿«ç…§è¿™ä¸ªäº‹ä»¶ï¼Ÿé‚£ä¹ˆåˆ›å»ºå†å²å¿«ç…§è¿™ä¸ªäº‹ä»¶åº”è¯¥ä¹Ÿæœ‰è‡ªå·±çš„æµï¼</p><p>ä»è¿™ä¸ªè§’åº¦æˆ‘ä»¬ç”¨åŒæ ·çš„æ–¹æ³•æ”¹é€ ä¸€ä¸‹ä»£ç </p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import React, &#123; useEffect, useMemo &#125; from &quot;react&quot;;import &#123; Subject &#125; from &quot;rxjs&quot;;import debounce from &quot;lodash&#x2F;debounce&quot;;const CreateSlideButton &#x3D; () &#x3D;&gt; &#123;  const clickEvt$ &#x3D; useMemo(() &#x3D;&gt; new Subject(), []);  &#x2F;&#x2F; åˆå§‹åŒ– åˆ›å»ºå¿«ç…§äº‹ä»¶æµ  const createSnapshotEvt$ &#x3D; useMemo(() &#x3D;&gt; new Subject(), []);  const [createSnapshot, createSlide] &#x3D; useMemo(    () &#x3D;&gt; [      debounce(() &#x3D;&gt; &#123;        console.log(&quot;create snapshot&quot;);      &#125;, 300),      () &#x3D;&gt; &#123;        console.log(&quot;create slide&quot;);      &#125;    ],    []  );  useEffect(() &#x3D;&gt; &#123;    createSnapshotEvt$.subscribe(() &#x3D;&gt; &#123;      createSnapshot();    &#125;);    return () &#x3D;&gt; createSnapshotEvt$.unsubcribe()  &#125;, [createSnapshotEvt$, createSnapshot]);  useEffect(() &#x3D;&gt; &#123;    clickEvt$.subscribe(() &#x3D;&gt; &#123;      createSlide();      &#x2F;&#x2F; æ¨é€åˆ›å»ºå¿«ç…§äº‹ä»¶      createSnapshotEvt$.next();    &#125;);    return () &#x3D;&gt; clickEvt$.unsubscribe();  &#125;, [clickEvt$, createSnapshotEvt$, createSlide]);  const handleClick &#x3D; () &#x3D;&gt; &#123;    clickEvt$.next();  &#125;;  return &lt;div onClick&#x3D;&#123;handleClick&#125;&gt;åˆ›å»ºå¹»ç¯ç‰‡&lt;&#x2F;div&gt;;&#125;;export default CreateSlideButton;</code></pre><p>å®é™…ä¸Š createSlide ä¹Ÿå¯ä»¥å•ç‹¬åˆ›å»ºäº‹ä»¶æµï¼Œè¿™é‡Œä¸èµ˜è¿°ã€‚é‚£ä¹ˆä¸Šé¢å†™æ³•æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ</p><p>å¥½å¤„å°±æ˜¯ rxjs æä¾›äº†å¤§é‡çš„æ“ä½œç¬¦ï¼Œå…¶ä¸­å°±åŒ…æ‹¬äº† <code>debounceTime</code>ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import React, &#123; useEffect, useMemo &#125; from &quot;react&quot;;import &#123; Subject &#125; from &quot;rxjs&quot;;import &#123; debounceTime &#125; from &quot;rxjs&#x2F;operators&quot;;const CreateSlideButton &#x3D; () &#x3D;&gt; &#123;  const clickEvt$ &#x3D; useMemo(() &#x3D;&gt; new Subject(), []);  const createSnapshotEvt$ &#x3D; useMemo(() &#x3D;&gt; new Subject(), []);  const [createSnapshot, createSlide] &#x3D; useMemo(    () &#x3D;&gt; [      () &#x3D;&gt; &#123;        console.log(&quot;create snapshot&quot;);      &#125;,      () &#x3D;&gt; &#123;        console.log(&quot;create slide&quot;);      &#125;    ],    []  );  useEffect(() &#x3D;&gt; &#123;    &#x2F;&#x2F; é€šè¿‡ .pipe å¯¹äº‹ä»¶æµè¿›è¡Œ debounce æ“ä½œ    createSnapshotEvt$.pipe(debounceTime(300)).subscribe(() &#x3D;&gt; &#123;      createSnapshot();    &#125;);    return () &#x3D;&gt; createSnapshotEvt$.unsubcribe();  &#125;, [createSnapshotEvt$, createSnapshot]);  useEffect(() &#x3D;&gt; &#123;    clickEvt$.subscribe(() &#x3D;&gt; &#123;      createSlide();      createSnapshotEvt$.next();    &#125;);    return () &#x3D;&gt; clickEvt$.unsubscribe();  &#125;, [clickEvt$, createSnapshotEvt$, createSlide]);  const handleClick &#x3D; () &#x3D;&gt; &#123;    clickEvt$.next();  &#125;;  return &lt;div onClick&#x3D;&#123;handleClick&#125;&gt;åˆ›å»ºå¹»ç¯ç‰‡&lt;&#x2F;div&gt;;&#125;;export default CreateSlideButton;</code></pre><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¸å†éœ€è¦ lodash çš„ debounce å¯¹ createSnapshot è¿›è¡Œæ“ä½œï¼Œè€Œæ˜¯å¯¹äº‹ä»¶æµè¿›è¡Œ debounce æ“ä½œã€‚</p><h4 id="è¸©è¿‡çš„å‘"><a href="#è¸©è¿‡çš„å‘" class="headerlink" title="è¸©è¿‡çš„å‘"></a>è¸©è¿‡çš„å‘</h4><p>ä¸Šé¢ä¸¾å‡ºçš„ä¾‹å­é‡Œ <code>observable</code> çš„ <code>observer</code> å¾ˆç®€å•ï¼Œå°±ç›´æ¥ console.log å°±å®Œäº‹å„¿äº†ã€‚ç„¶è€Œåœ¨å®é™…çš„å¼€å‘åœºæ™¯ä¸­ï¼Œç¡®å¹¶éå¦‚æ­¤ç®€å•ã€‚ä¸Šé¢çš„ä»£ç å¤ªé•¿äº†ï¼Œå› æ­¤é‡æ–°ä¸¾ä¸€ä¸ªä¾‹å­</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import React, &#123; useEffect, useState &#125; from &#39;react&#39;import &#123; of &#125; from &#39;rxjs&#39;export default function App() &#123;  const [count, setCount] &#x3D; useState(0)  const sum &#x3D; (val) &#x3D;&gt; setCount(count + val)  useEffect(() &#x3D;&gt; &#123;    const subscription &#x3D; of(1, 2, 3).subscribe(sum)    return () &#x3D;&gt; subscription.unsubscribe()  &#125;, [])  return &lt;div&gt;&#123;count&#125;&lt;&#x2F;div&gt;&#125;</code></pre><p>ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œæˆ‘çš„æœ¬æ„æ˜¯å¸Œæœ›è®¢é˜…ä¸€ä¸ª <code>of</code>  æµï¼Œå¹¶ä¸”å°†äº§å‡ºçš„å€¼ç›¸åŠ åå±•ç¤ºå‡ºæ¥ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘é¢„æœŸæ˜¯èƒ½æ‰“å°å‡º <code>0 + 1 + 2 + 3 = 6</code>ã€‚ä½†ä¸€æ—¦å¦‚æœæŒ‰ä¸Šé¢çš„å†™æ³•ï¼Œè¾“å‡ºå°†ä¼šæ˜¯ <code>3</code>ã€‚å¦‚æœæœ‰å¼€å¯ <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks#installation"><code>eslint-plugin-react-hooks</code></a>ï¼Œeslint ä¼šæç¤º <code>React Hook useEffect has a missing dependency: &#39;sum&#39;. Either include it or remove the dependency array</code>ã€‚å®é™…ä¸Šå°±æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰æ­£ç¡®å»é…ç½® <code>useEffect</code> çš„ä¾èµ–ï¼Œå¯¼è‡´ <code>sum</code> ä¸­è·å–åˆ°çš„ <code>count</code> ä¸€ç›´æ˜¯ 0ï¼Œå› æ­¤æœ€ç»ˆè¾“å‡ºä¸º 3ã€‚é‚£æˆ‘ä»¬ç¨åŠ æ”¹è¿›</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import React, &#123; useEffect, useState, useCallback &#125; from &#39;react&#39;import &#123; of &#125; from &#39;rxjs&#39;export default function App() &#123;  const [count, setCount] &#x3D; useState(0)  const sum &#x3D; useCallback((val) &#x3D;&gt; setCount(count + val), [count])  useEffect(() &#x3D;&gt; &#123;    const subscription &#x3D; of(1, 2, 3).subscribe(sum)    return () &#x3D;&gt; subscription.unsubscribe()  &#125;, [sum])  return &lt;div&gt;&#123;count&#125;&lt;&#x2F;div&gt;&#125;</code></pre><p>è¿™æ¬¡æˆ‘ä»¬ç»™ useEffect æ·»åŠ äº† <code>sum</code> ä½œä¸ºä¾èµ–ï¼Œå¹¶ä¸”ç»™ <code>sum</code> åŒ…è£¹äº† <code>useCallback</code>ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæ‰“å¼€é¡µé¢å‘ç°ï¼Œé¡µé¢ä¸Šçš„æ•°å­—ä¸æ–­å¢åŠ ã€‚åŸå› æ˜¯æˆ‘ä»¬æ¯æ¬¡ <code>setCount</code> ä¹‹åï¼Œ<code>count</code> æ›´æ–°å¯¼è‡´ <code>sum</code> æ›´æ–°ï¼ŒåŒæ—¶ä¹Ÿå¯¼è‡´ä¸æ–­æ‰§è¡Œ <code>useEffect</code> ä¸­çš„æ–¹æ³•ï¼Œå³ä¸æ–­çš„ <code>subscribe</code>  ä¸ <code>unsubscribe</code>ã€‚</p><p>react ä¸º setState æä¾›äº†ä¸€ç§å‡½æ•°å›è°ƒçš„æ–¹å¼ï¼Œå³å¯ä»¥é€šè¿‡ <code>setCount(count =&gt; count + val)</code>è¿™æ ·çš„å½¢å¼æ¥è·å–æ—§å€¼ï¼Œé‚£ä¹ˆä»£ç å¯ä»¥æ”¹æˆ</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import React, &#123; useEffect, useState, useCallback &#125; from &#39;react&#39;import &#123; of &#125; from &#39;rxjs&#39;export default function App() &#123;  const [count, setCount] &#x3D; useState(0)const sum &#x3D; useCallback((val) &#x3D;&gt; setCount((count) &#x3D;&gt; count + val), [])  useEffect(() &#x3D;&gt; &#123;    const subscription &#x3D; of(1, 2, 3).subscribe(sum)    return () &#x3D;&gt; subscription.unsubscribe()  &#125;, [sum])  return &lt;div&gt;&#123;count&#125;&lt;&#x2F;div&gt;&#125;</code></pre><p>è¿™ä¸€æ¬¡é¡µé¢æ˜¾ç¤ºäº†é¢„æœŸçš„ <code>6</code>ã€‚</p><p>ç»è¿‡ä¸Šé¢çš„æ”¹å†™ï¼Œæˆ‘ä»¬è·å–åˆ°äº†é¢„æœŸçš„ç»“æœï¼Œä¹‹åæˆ‘ä¸€åº¦è€ƒè™‘æ˜¯å¦èƒ½é€šè¿‡å°† sum ä¿å­˜åˆ° ref ä¸­ï¼Œä»è€Œå°† sum ä» ä¾èµ–é¡¹ä¸­ç§»é™¤å‘¢ï¼Ÿ</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import React, &#123; useEffect, useState, useCallback, useRef &#125; from &#39;react&#39;import &#123; of &#125; from &#39;rxjs&#39;export default function App() &#123;  const [count, setCount] &#x3D; useState(0)  const sum &#x3D; useCallback((val) &#x3D;&gt; setCount((count) &#x3D;&gt; count + val), [])  const latestSum &#x3D; useRef(sum)  useEffect(() &#x3D;&gt; &#123;    latestSum.current &#x3D; sum  &#125;)  useEffect(() &#x3D;&gt; &#123;    const subscription &#x3D; of(1, 2, 3).subscribe(latestSum.current)    return () &#x3D;&gt; subscription.unsubscribe()  &#125;, [])  return &lt;div&gt;&#123;count&#125;&lt;&#x2F;div&gt;&#125;</code></pre><p>å¾ˆé—æ†¾ï¼Œä¸Šé¢çš„å†™æ³•æ˜¯èƒ½è¾“å‡ºé¢„æœŸç»“æœï¼Œç„¶è€Œå®é™…ä¸Šè¿™ä¹ˆå†™å´å¹¶éæ­£ç¡®ã€‚å› ä¸ºä¸Šè¿°çš„ä¾‹å­åªæ˜¯æ°å¥½ sum ä¸ä¼šå˜æ›´ï¼Œä»è€Œåªéœ€è¦ subscribe ä¸€æ¬¡ã€‚å‡è®¾ sum ä¼šå˜æ›´ï¼Œé‚£ä¹ˆ subscribe è®¢é˜…çš„å°†ä¸€ç›´æ˜¯åˆå§‹åŒ–æ—¶çš„ sumï¼Œè€Œéæœ€æ–°çš„ sumã€‚å°†ä¸Šè¿°ä»£ç æ”¹æˆ</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import React, &#123; useEffect, useState, useCallback, useRef &#125; from &#39;react&#39;import &#123; of &#125; from &#39;rxjs&#39;export default function App() &#123;  const [count, setCount] &#x3D; useState(0)  const sum &#x3D; useCallback((val) &#x3D;&gt; setCount(count + val), [count])  const latestSum &#x3D; useRef(sum)  useEffect(() &#x3D;&gt; &#123;    latestSum.current &#x3D; sum  &#125;)  useEffect(() &#x3D;&gt; &#123;    const subscription &#x3D; of(1, 2, 3).subscribe(latestSum.current)    return () &#x3D;&gt; subscription.unsubscribe()  &#125;, [])  return &lt;div&gt;&#123;count&#125;&lt;&#x2F;div&gt;&#125;</code></pre><p>é¡µé¢å°†ä¼šè¾“å‡º 3ï¼Œå³ latestSum.current ä¸­çš„ count ä¸€ç›´æ˜¯ 0ã€‚</p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>å¯ä»¥çœ‹åˆ°å¯¹äºåŸä»£ç è€Œè¨€ï¼Œrxjs çš„å®ç°åè€Œå¤šäº†å¾ˆå¤šä»£ç ï¼Œä¸è¿‡ä¸Šé¢çš„ä¾‹å­åªæ˜¯ç»™åˆ°ä¸€ä¸ªå¯å‘ä¸å…¥é—¨çš„ä½œç”¨ï¼Œè®©æˆ‘ä»¬ä»å‡½æ•°å“åº”å¼ç¼–ç¨‹çš„è§’åº¦å»æ€è€ƒå¦‚ä½•ç»„ç»‡ä»£ç ï¼Œè€Œå¾€å¾€åœ¨æ›´å¤æ‚çš„åœºæ™¯æ‰èƒ½çœŸæ­£å±•ç¤º rxjs çš„å¨åŠ›ï¼Œæ˜¯å¦è¦ä½¿ç”¨ rxjs éœ€è¦æ ¹æ®å…·ä½“çš„åœºæ™¯æ¥è€ƒé‡ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TypeScript ä¸­çš„ unknown ç±»å‹</title>
      <link href="/2021/03/20/TypeScript-%E4%B8%AD%E7%9A%84-unknown-%E7%B1%BB%E5%9E%8B/"/>
      <url>/2021/03/20/TypeScript-%E4%B8%AD%E7%9A%84-unknown-%E7%B1%BB%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<p>æ—©åœ¨ TypeScript 3.0 ä¸­å°±æ–°å¢åŠ äº†ä¸€ç§ unkown ç±»å‹ <a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-0.html#new-unknown-top-type">New <code>unknown</code> top type</a>ï¼Œç„¶è€Œç›®å‰ä¸­æ–‡æ–‡æ¡£ä¼¼ä¹è¿˜æ²¡æœ‰ç›¸å…³çš„è¯´æ˜ï¼Œè€Œ<a href="https://www.typescriptlang.org/docs/handbook/2/functions.html#unknown">è‹±æ–‡æ–‡æ¡£</a>ä¸­ä¹Ÿä»…æœ‰ç®€çŸ­çš„ä¸€ç‚¹è¯´æ˜ã€‚é‚£ä¹ˆ unknown çš„åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆéœ€è¦æ–°å¢è¿™ä¸ªç±»å‹å‘¢ï¼Ÿä»¥ä¸‹ä¸ºç»“åˆå®˜æ–¹ wikiï¼Œå°±æ¯”è¾ƒå¸¸è§çš„åº”ç”¨åœºæ™¯åšçš„ä¸ªäººç¬”è®°æ€»ç»“ã€‚</p><a id="more"></a><p>å¦‚æœå°†ç±»å‹çœ‹ä½œä¸€ä¸ªé›†åˆçš„è¯ï¼Œé‚£ä¹ˆé¡¶éƒ¨ç±»å‹åˆ™åŒ…å«äº†æ‰€æœ‰å…¶ä»–ç±»å‹ï¼Œè€Œåº•éƒ¨ç±»å‹åˆ™ä¸åŒ…å«å…¶ä»–æ‰€æœ‰ç±»å‹ã€‚åœ¨ typescript ä¸­ï¼Œåº•éƒ¨ç±»å‹åˆ™æ˜¯ neverã€‚è€Œ unknown  ç±»å‹ä¸ any éå¸¸ç›¸ä¼¼ï¼Œéƒ½æ˜¯é¡¶éƒ¨ç±»å‹ã€‚</p><p>æˆ‘ä»¬çŸ¥é“å¦‚æœä½¿ç”¨äº† anyï¼Œé‚£å°±å‡ ä¹æ„å‘³ç€æ”¾å¼ƒäº†ç±»å‹ä¿æŠ¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ any åšä»»ä½•äº‹æƒ…ï¼Œè€Œ unknown å´æ°æ°ç›¸åï¼Œæˆ‘ä»¬å‡ ä¹æ— æ³•åˆ©ç”¨ unknown æ¥åšä»»ä½•äº‹æƒ…ã€‚</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">function f1(a: any) &#123;  a.b(); &#x2F;&#x2F; OK&#125;function f2(a: unknown) &#123;  a.b();  &#x2F;&#x2F; error: Object is of type &#39;unknown&#39;.&#125;</code></pre><p>è¦ä½¿ç”¨ unknown å‰é¡»é€šè¿‡ç±»å‹æ–­è¨€ç­‰æ–¹å¼ç¡®å®šç±»å‹ï¼Œå› æ­¤åœ¨é¢å¯¹æœªçŸ¥ç±»å‹æ—¶ï¼Œä½¿ç”¨ unknown æ¯” any æ›´åŠ å®‰å…¨ã€‚</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">declare interface A &#123;  b: Function;&#125;declare function isA(x: unknown): x is A;function func(x: unknown) &#123;  &#x2F;&#x2F; ç±»å‹æ–­è¨€  (x as number).toFixed(2);    &#x2F;&#x2F; ç›¸ç­‰  if(x &#x3D;&#x3D;&#x3D; 123) &#123;    x; &#x2F;&#x2F; 123  &#125;    &#x2F;&#x2F; ç±»å‹é˜²æŠ¤  if (typeof x &#x3D;&#x3D;&#x3D; &#39;string&#39; || typeof x &#x3D;&#x3D;&#x3D; &#39;number&#39;) &#123;    x; &#x2F;&#x2F; string | number  &#125;  if (x instanceof Error) &#123;    x; &#x2F;&#x2F; Error  &#125;    &#x2F;&#x2F; æ–­è¨€å‡½æ•°  if (isA(x)) &#123;    x.b();  &#125;&#125;</code></pre><p>é‚£ä¹ˆ unknown ä¸ any å…·ä½“è¿˜æœ‰å“ªäº›åŒºåˆ«å‘¢ï¼Ÿ</p><ol><li><p>ä½œä¸ºé¡¶éƒ¨ç±»å‹ï¼Œåˆ™æ„å‘³ç€æ‰€æœ‰çš„ç±»å‹éƒ½å¯ä»¥èµ‹å€¼ç»™ unknownï¼Œç„¶è€Œ unknown åªèƒ½èµ‹å€¼ç»™ any æˆ–è€… unknownã€‚</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">&#x2F;&#x2F; Anything is assignable to unknownfunction f21&lt;T&gt;(pAny: any, pNever: never, pT: T) &#123;  let x: unknown;  x &#x3D; 123;  x &#x3D; &quot;hello&quot;;  x &#x3D; [1, 2, 3];  x &#x3D; new Error();  x &#x3D; x;  x &#x3D; pAny;  x &#x3D; pNever;  x &#x3D; pT;&#125;&#x2F;&#x2F; unknown assignable only to itself and anyfunction f22(x: unknown) &#123;  let v1: any &#x3D; x;  let v2: unknown &#x3D; x;  let v3: object &#x3D; x; &#x2F;&#x2F; Error  let v4: string &#x3D; x; &#x2F;&#x2F; Error  let v5: string[] &#x3D; x; &#x2F;&#x2F; Error  let v6: &#123;&#125; &#x3D; x; &#x2F;&#x2F; Error  let v7: &#123;&#125; | null | undefined &#x3D; x; &#x2F;&#x2F; Error&#125;</code></pre></li><li><p>åœ¨è”åˆç±»å‹ä¸­ï¼Œany äº¤å‰(&amp;)æˆ–è€…è”åˆ(|)ä»»ä½•ç±»å‹, é™¤äº† never å¤–éƒ½ä¸º anyï¼Œè€Œ unknown äº¤å‰(&amp;)ä»»ä½•ç±»å‹éƒ½ä¸ºå…¶æ‰€äº¤å‰ç±»å‹ï¼Œè”åˆ(|)ä»»ä½•ç±»å‹(é™¤äº† any å¤–)éƒ½ä¸º unknown</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">type T00 &#x3D; unknown &amp; null; &#x2F;&#x2F; nulltype T03 &#x3D; unknown &amp; string; &#x2F;&#x2F; stringtype T06 &#x3D; unknown &amp; any; &#x2F;&#x2F; anytype T00 &#x3D; any &amp; null; &#x2F;&#x2F; anytype T02 &#x3D; any &amp; null &amp; undefined; &#x2F;&#x2F; null &amp; undefined (which becomes never)type T03 &#x3D; any &amp; string; &#x2F;&#x2F; any</code></pre><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">type T10 &#x3D; unknown | null; &#x2F;&#x2F; unknowntype T13 &#x3D; unknown | string; &#x2F;&#x2F; unknowntype T16 &#x3D; unknown | any; &#x2F;&#x2F; anytype T10 &#x3D; any | null; &#x2F;&#x2F; anytype T12 &#x3D; any | null | undefined; &#x2F;&#x2F; anytype T13 &#x3D; any | string; &#x2F;&#x2F; any</code></pre></li><li><p>åœ¨ä¹‹å‰æ³›å‹ç±»å‹é»˜è®¤ä¸º <code>&#123;&#125;</code>, ç°åœ¨åˆ™é»˜è®¤ä¸º unknownã€‚</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">function foo&lt;T&gt;(x: T): [T, string] &#123;    return [x, x.toString()]    &#x2F;&#x2F;           ~~~~~~~~ TypeScript 3.5 ä¹‹åå°†ä¼šæŠ¥é”™ï¼šerror! Property &#39;toString&#39; does not exist on type &#39;T&#39;.&#125;</code></pre><p>å¦‚æœè¦ä¸æŠ¥é”™ï¼Œå¯ä»¥è¿™ä¹ˆå†™</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">function foo&lt;T extends &#123;&#125;&gt;(x: T): [T, string] &#123;    return [x, x.toString()]&#125;</code></pre></li><li><p>function å¦‚æœè¿”å›çš„æ˜¯ unknown ï¼Œåˆ™å¯ä»¥æ²¡æœ‰è¿”å›è¯­å¥</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">function f27(): unknown &#123;&#125;</code></pre></li></ol><p>ç®€å•æ¥è¯´ï¼Œunknown ä¸»è¦çš„åœºæ™¯å°±æ˜¯ï¼Œå½“æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨è¿™ä¸ªå€¼å‰ï¼Œéœ€è¦å…ˆåˆ¤æ–­ç±»å‹ä»¥ç¡®ä¿ç±»å‹å®‰å…¨ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨ä½¿ç”¨ any å‰ï¼Œå¯ä»¥å…ˆè¯•è¯• unknownã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript-OOP.md</title>
      <link href="/2021/02/19/JavaScript-OOP/"/>
      <url>/2021/02/19/JavaScript-OOP/</url>
      
        <content type="html"><![CDATA[<p>åœ¨å¹³æ—¶çš„ CodeReview ä¸­è¦å¦‚ä½•å»åˆ†è¾¨ä»£ç çš„å¥½åå‘¢ï¼Ÿæœ€è¿‘çœ‹åˆ° <a href="https://github.com/ryanmcdermott/clean-code-javascript">https://github.com/ryanmcdermott/clean-code-javascript</a> è¿™ä¸ªä»“åº“çš„æ€»ç»“ï¼Œæ„Ÿè§‰è›®æœ‰å‚è€ƒä»·å€¼çš„ã€‚ç‰¹åˆ«æ˜¯å…³äºç±»è¿™ä¸€ç« ï¼Œæ¶‰åŠå¾ˆå¤šè®¾è®¡æ¨¡å¼çš„æ€æƒ³ã€‚åˆšå¥½ç›¸å…³çš„ä¸­æ–‡ä»“åº“ä¼¼ä¹ç¼ºå¤±äº†ç±»è¿™ç« èŠ‚çš„ç¿»è¯‘ï¼Œä»¥ä¸‹ä¸ºç±»ä»¥åŠ SOLID è¿™ä¸ªç« èŠ‚çš„ç¿»è¯‘å¹¶æ·»åŠ ä¸ªäººç†è§£ã€‚</p><a id="more"></a><h2 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h2><h3 id="æœ€å¥½ä½¿ç”¨-ES2015-ES6-classes-è€Œé-ES5-çš„å‡½æ•°"><a href="#æœ€å¥½ä½¿ç”¨-ES2015-ES6-classes-è€Œé-ES5-çš„å‡½æ•°" class="headerlink" title="æœ€å¥½ä½¿ç”¨  ES2015/ES6 classes è€Œé ES5 çš„å‡½æ•°"></a>æœ€å¥½ä½¿ç”¨  ES2015/ES6 classes è€Œé ES5 çš„å‡½æ•°</h3><p>ä¼ ç»Ÿçš„ ES5 ç±»çš„ç»§æ‰¿ï¼Œæ„é€ ï¼Œä»¥åŠå†…éƒ¨æ–¹æ³•å¯è¯»æ€§éå¸¸å·®ï¼Œåœ¨éœ€è¦ç»§æ‰¿ï¼ˆå½“ç„¶ä½ ä¹Ÿå¯ä»¥æ— éœ€ç»§æ‰¿ï¼‰çš„åœºæ™¯ä¸‹ï¼Œæ¨èä½¿ç”¨  ES2015/ES6 classesã€‚å¦‚æœä½ éœ€è¦ä¸€ä¸ªå¤§å‹ä¸”æåº¦å¤æ‚çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ function æ›¿ä»£ classã€‚</p><p><strong>Bad</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const Animal &#x3D; function(age) &#123;  if (!(this instanceof Animal)) &#123;    throw new Error(&quot;Instantiate Animal with &#96;new&#96;&quot;);  &#125;  this.age &#x3D; age;&#125;;Animal.prototype.move &#x3D; function move() &#123;&#125;;const Mammal &#x3D; function(age, furColor) &#123;  if (!(this instanceof Mammal)) &#123;    throw new Error(&quot;Instantiate Mammal with &#96;new&#96;&quot;);  &#125;&#x2F;&#x2F; è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–å½“å‰å­ç±»çš„ this çš„ age å±æ€§  Animal.call(this, age);  &#x2F;&#x2F; åˆå§‹åŒ–å­ç±»çš„ this çš„ furColor å±æ€§  this.furColor &#x3D; furColor;&#125;;&#x2F;&#x2F; å°†å­ç±»çš„ prototype ä¿®æ”¹ä¸ºçˆ¶ç±»çš„ prototypeMammal.prototype &#x3D; Object.create(Animal.prototype);&#x2F;&#x2F; ä¿®æ”¹å­ç±»çš„ prototype.constructor çš„æŒ‡å‘Mammal.prototype.constructor &#x3D; Mammal;&#x2F;&#x2F; ç»™å­ç±»çš„ prototype æ·»åŠ é¢å¤–çš„å‡½æ•°Mammal.prototype.liveBirth &#x3D; function liveBirth() &#123;&#125;;const Human &#x3D; function(age, furColor, languageSpoken) &#123;  if (!(this instanceof Human)) &#123;    throw new Error(&quot;Instantiate Human with &#96;new&#96;&quot;);  &#125;  Mammal.call(this, age, furColor);  this.languageSpoken &#x3D; languageSpoken;&#125;;Human.prototype &#x3D; Object.create(Mammal.prototype);Human.prototype.constructor &#x3D; Human;Human.prototype.speak &#x3D; function speak() &#123;&#125;;</code></pre><p>ä¸Šè¿°çš„ç»§æ‰¿å®é™…ä¸Šå°±æ˜¯æœ€å¸¸è§çš„ç»„åˆå¯„ç”Ÿå¼ç»§æ‰¿ï¼š</p><ol><li>åœ¨å­ç±»ä¸­è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ç”¨äºç»§æ‰¿å±æ€§</li><li>è®¾ç½®å­ç±»è‡ªå·±çš„å±æ€§</li><li>å°†å­ç±»çš„ prototype ä¿®æ”¹ä¸ºçˆ¶ç±»çš„ prototype ç”¨äºç»§æ‰¿çˆ¶ç±»çš„æ–¹æ³•</li><li>ä¿®æ”¹ å­ç±»çš„ prototype.constructor çš„æŒ‡å‘ä¸ºå­ç±»</li><li>æ·»åŠ å­ç±»è‡ªå·±çš„æ–¹æ³• </li></ol><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªè¿‡ç¨‹æä¸ºç¹çã€‚</p><p><strong>Good</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class Animal &#123;  constructor(age) &#123;    this.age &#x3D; age;  &#125;  move() &#123;    &#x2F;* ... *&#x2F;  &#125;&#125;class Mammal extends Animal &#123;  constructor(age, furColor) &#123;    &#x2F;&#x2F; æ‰§è¡Œçˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œç»§æ‰¿çˆ¶ç±»å±æ€§å€¼ä»¥åŠæ–¹æ³•    super(age);    this.furColor &#x3D; furColor;  &#125;  liveBirth() &#123;    &#x2F;* ... *&#x2F;  &#125;&#125;class Human extends Mammal &#123;  constructor(age, furColor, languageSpoken) &#123;    super(age, furColor);    this.languageSpoken &#x3D; languageSpoken;  &#125;  speak() &#123;    &#x2F;* ... *&#x2F;  &#125;&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨ class åˆ™ç®€å•çš„å¤šï¼Œåªéœ€è¦ extends å…³é”®å­—ï¼Œå¹¶ä¸”åœ¨å­ç±»ä¸­çš„ constructor çš„ super æ¥å®ç°ç»§æ‰¿ã€‚</p><p>è¿™é‡Œæœ‰ä¸ªæ³¨æ„ç‚¹æ˜¯ï¼šå­ç±»å¦‚æœå†™äº† constructorï¼Œ è€Œä¸å†™ super æˆ–æ˜¯åœ¨è°ƒç”¨ this åå†è°ƒç”¨ superï¼Œåˆ™ä¼šæŠ¥é”™ï¼Œè¿™æ˜¯å› ä¸º constructor ä¸å†™åˆ™é»˜è®¤ä¸ºçˆ¶ç±»çš„ constructorï¼Œå¦‚æœå†™äº† constructorï¼Œä½†æ˜¯æ²¡æœ‰è°ƒç”¨ superï¼Œåˆ™æ— æ³•ç”Ÿæˆ thisï¼Œè¿™ç‚¹ä¸ ES5 ä¹Ÿæ˜¯æœ‰åŒºåˆ«çš„ã€‚å³ ES5 å­ç±»ç»§æ‰¿å‰å°±æœ‰ this äº†ï¼Œè€Œ ES6 çš„ class å­ç±»åˆ™æ˜¯ super ä¹‹åæ‰æœ‰çš„ thisã€‚</p><h3 id="é“¾å¼è°ƒç”¨"><a href="#é“¾å¼è°ƒç”¨" class="headerlink" title="é“¾å¼è°ƒç”¨"></a>é“¾å¼è°ƒç”¨</h3><p>è¿™ç§æ¨¡å¼åœ¨ JavaScript ä¸­éå¸¸æœ‰ç”¨ï¼Œåœ¨è¯¸å¦‚ JQuery, Lodash ä¹‹ç±»çš„ä»“åº“ä¸­ï¼Œéå¸¸å¸¸è§ã€‚è¿™ç§æ¨¡å¼å¯ä»¥è®©ä½ çš„ä»£ç çœ‹èµ·æ¥ç®€æ´æ˜äº†ã€‚åŸºäºä¸Šè¿°åŸå› ï¼Œæˆ‘å¯ä»¥ç›´è¨€ï¼Œä½¿ç”¨é“¾å¼è°ƒç”¨ç„¶åçœ‹çœ‹ä½ çš„ä»£ç å°†æ˜¯å¦‚æ­¤ä¼˜é›…ã€‚åœ¨æ–¹æ³•ä¸­ï¼Œè¿”å› thisï¼Œå°±å¯ä»¥å®ç°ã€‚</p><p><strong>Bad</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class Car &#123;  constructor(make, model, color) &#123;    this.make &#x3D; make;    this.model &#x3D; model;    this.color &#x3D; color;  &#125;  setMake(make) &#123;    this.make &#x3D; make;  &#125;  setModel(model) &#123;    this.model &#x3D; model;  &#125;  setColor(color) &#123;    this.color &#x3D; color;  &#125;  save() &#123;    console.log(this.make, this.model, this.color);  &#125;&#125;const car &#x3D; new Car(&quot;Ford&quot;, &quot;F-150&quot;, &quot;red&quot;);car.setColor(&quot;pink&quot;);car.save();</code></pre><p><strong>Good</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class Car &#123;  constructor(make, model, color) &#123;    this.make &#x3D; make;    this.model &#x3D; model;    this.color &#x3D; color;  &#125;  setMake(make) &#123;    this.make &#x3D; make;    &#x2F;&#x2F; NOTE: è¿”å› this    return this;  &#125;  setModel(model) &#123;    this.model &#x3D; model;    &#x2F;&#x2F; NOTE: è¿”å› this    return this;  &#125;  setColor(color) &#123;    this.color &#x3D; color;     &#x2F;&#x2F; NOTE: è¿”å› this    return this;  &#125;  save() &#123;    console.log(this.make, this.model, this.color);     &#x2F;&#x2F; NOTE: è¿”å› this    return this;  &#125;&#125;const car &#x3D; new Car(&quot;Ford&quot;, &quot;F-150&quot;, &quot;red&quot;).setColor(&quot;pink&quot;).save();</code></pre><h3 id="ç»„åˆä¼˜äºç»§æ‰¿"><a href="#ç»„åˆä¼˜äºç»§æ‰¿" class="headerlink" title="ç»„åˆä¼˜äºç»§æ‰¿"></a>ç»„åˆä¼˜äºç»§æ‰¿</h3><p>æ®åœ¨å››äººå¸®çš„è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»¬åº”è¯¥å°½å¯èƒ½ä½¿ç”¨ç»„åˆè€Œéç»§æ‰¿ã€‚æœ‰å¾ˆå¤šç†ç”±ä½¿ç”¨ç»§æ‰¿ï¼ŒåŒæ—¶ä¹Ÿæœ‰å¾ˆå¤šç†ç”±ä½¿ç”¨ç»„åˆã€‚è¿™é‡Œæœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœç›´è§‰å‘Šè¯‰ä½ è¦ä½¿ç”¨ç»§æ‰¿ï¼Œé‚£ä¹ˆå¯ä»¥è¯•è¯•çœ‹ä½¿ç”¨ç»„åˆæ˜¯å¦èƒ½æ›´å¥½åœ°è§£å†³é—®é¢˜ï¼Ÿ</p><p>é‚£ä½ å¯èƒ½ä¼šæƒ³ï¼Œä»€ä¹ˆæ—¶å€™ç”¨ç»§æ‰¿ä¼šæ¯”è¾ƒå¥½ï¼Ÿè¿™éœ€è¦è§†æƒ…å†µè€Œå®šï¼Œä½†ä¸‹é¢ç½—åˆ—äº†ä¸€äº›ç»§æ‰¿ä¼˜äºç»„åˆçš„åœºæ™¯ï¼š</p><ol><li>ä½ çš„ç»§æ‰¿ä»£è¡¨ â€œis-aâ€ è€Œé â€œhas-aâ€ï¼ˆäºº æ˜¯ä¸€ç§ åŠ¨ç‰© vs ç”¨æˆ· æœ‰ ç”¨æˆ·è¯¦æƒ…ï¼‰</li><li>ä½ éœ€è¦é‡ç”¨åŸºç±»çš„ä»£ç ï¼ˆäººå¯ä»¥åƒæ‰€æœ‰åŠ¨ç‰©ä¸€æ ·ç§»åŠ¨ï¼‰</li><li>ä½ å¸Œæœ›ä¿®æ”¹åŸºç±»çš„ä»£ç ä»¥å…¨å±€å˜æ›´æ‰€æœ‰å­ç±»çš„è¡Œä¸ºï¼ˆæ‰€æœ‰åŠ¨ç‰©ç§»åŠ¨æ—¶éƒ½éœ€è¦æ¶ˆè€—çƒ­é‡ï¼‰</li></ol><p><strong>Bad</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class Employee &#123;  constructor(name, email) &#123;    this.name &#x3D; name;    this.email &#x3D; email;  &#125;  &#x2F;&#x2F; ...&#125;&#x2F;&#x2F; åä¾‹ï¼šå› ä¸ºå‘˜å·¥ æœ‰ ç¨æ”¶ï¼Œè€Œä¸æ˜¯è¯´ ç¨æ”¶æ˜¯ä¸€ç§ å‘˜å·¥class EmployeeTaxData extends Employee &#123;  constructor(ssn, salary) &#123;    super();    this.ssn &#x3D; ssn;    this.salary &#x3D; salary;  &#125;  &#x2F;&#x2F; ...&#125;</code></pre><p><strong>Good</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class EmployeeTaxData &#123;  constructor(ssn, salary) &#123;    this.ssn &#x3D; ssn;    this.salary &#x3D; salary;  &#125;  &#x2F;&#x2F; ...&#125;class Employee &#123;  constructor(name, email) &#123;    this.name &#x3D; name;    this.email &#x3D; email;  &#125;  setTaxData(ssn, salary) &#123;    this.taxData &#x3D; new EmployeeTaxData(ssn, salary);  &#125;  &#x2F;&#x2F; ...&#125;</code></pre><p>å®é™…ä¸Š React çš„è®¾è®¡å“²å­¦ä¹Ÿæ˜¯æå€¡ç»„åˆä¼˜äºç»§æ‰¿,è¯¦æƒ…å¯ä»¥å‚è€ƒ <a href="https://reactjs.org/docs/composition-vs-inheritance.html#gatsby-focus-wrapper">Composition vs Inheritance</a></p><h2 id="SOLID"><a href="#SOLID" class="headerlink" title="SOLID"></a>SOLID</h2><p>SOLID æ˜¯è®¾è®¡æ¨¡å¼éœ€è¦éµå¾ªçš„å‡ ä¸ªåŸåˆ™ç®€ç§°ï¼š</p><ol><li>å•ä¸€èŒè´£ï¼ˆSingle Responsibility Principle, SRPï¼‰</li><li>å¼€é—­åŸåˆ™ï¼ˆOpen/Closed Principle, OCPï¼‰</li><li>é‡Œæ°æ›¿æ¢ï¼ˆLiskov Substitution Principleï¼ŒLSPï¼‰</li><li>æ¥å£éš”ç¦»ï¼ˆInterface Segregation Principleï¼ŒISPï¼‰</li><li>ä¾èµ–å€’ç½®ï¼ˆDependency Inversion Principleï¼ŒDIPï¼‰</li></ol><p>###å•ä¸€èŒè´£</p><p>å¦‚ä»£ç æ•´æ´ä¹‹é“æ‰€è¯´ï¼Œä¿®æ”¹ä¸€ä¸ªç±»çš„ç†ç”±ä¸åº”è¯¥è¶…è¿‡ä¸€ä¸ª ã€‚å¦‚åŒä¸€ä¸ªèˆªç­åªèƒ½å¸¦ä¸€ä¸ªè¡Œæç®±ï¼Œå› æ­¤æˆ‘ä»¬å°†æ‰€æœ‰è¡Œæéƒ½å¡å…¥è¿™ä¸ªç®±å­ï¼Œæˆ‘ä»¬æ€»æ˜¯å€¾å‘äºåœ¨ä¸€ä¸ªç±»é‡Œå®ç°è®¸å¤šåŠŸèƒ½ã€‚ç„¶è€Œè¿™ä¹ˆåšçš„é—®é¢˜åœ¨äºä½ çš„ç±»æ— æ³•åšåˆ°æ¦‚å¿µä¸Šçš„å†…èšï¼Œå¹¶ä¸”ç»å¸¸ä¸å¾—ä¸è¿›è¡Œä¿®æ”¹ã€‚æœ€å°åŒ–ä¸€ä¸ªç±»çš„ä¿®æ”¹æ¬¡æ•°æ˜¯éå¸¸é‡è¦çš„ï¼Œè¿™æ˜¯å› ä¸ºå¦‚æœä¸€ä¸ªç±»å……æ–¥è¿‡å¤šçš„åŠŸèƒ½ï¼Œå½“æˆ‘ä»¬å¯¹å…¶ä¸­ä¸€éƒ¨åˆ†ä¿®æ”¹æ—¶ï¼Œæ— æ³•é¢„æµ‹åˆ°è¿™ä¸ªä¿®æ”¹ä¼šå¯¹ä¾èµ–è¿™ä¸ªç±»çš„å…¶ä»–æ¨¡å—å¸¦æ¥ä»€ä¹ˆå½±å“ã€‚</p><p><strong>Bad</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class UserSettings &#123;  constructor(user) &#123;    this.user &#x3D; user;  &#125;  changeSettings(settings) &#123;    if (this.verifyCredentials()) &#123;      &#x2F;&#x2F; ...    &#125;  &#125;  verifyCredentials() &#123;    &#x2F;&#x2F; ...  &#125;&#125;</code></pre><p>UserSettings ç±»è´Ÿè´£ä¿®æ”¹è®¾ç½®ï¼ŒåŒæ—¶è¿˜è´Ÿè´£äº†é‰´æƒï¼Œè€Œé‰´æƒåº”è¯¥è¦ä» UserSettings åˆ†ç¦»å‡ºæ¥ã€‚</p><p><strong>Good</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class UserAuth &#123;  constructor(user) &#123;    this.user &#x3D; user;  &#125;  verifyCredentials() &#123;    &#x2F;&#x2F; ...  &#125;&#125;class UserSettings &#123;  constructor(user) &#123;    this.user &#x3D; user;    this.auth &#x3D; new UserAuth(user);  &#125;  changeSettings(settings) &#123;    if (this.auth.verifyCredentials()) &#123;      &#x2F;&#x2F; ...    &#125;  &#125;&#125;</code></pre><h3 id="å¼€é—­åŸåˆ™"><a href="#å¼€é—­åŸåˆ™" class="headerlink" title="å¼€é—­åŸåˆ™"></a>å¼€é—­åŸåˆ™</h3><p>â€œä»£ç å®ä½“ï¼ˆç±»ï¼Œæ¨¡å—ï¼Œæ–¹æ³•ç­‰ï¼‰åº”è¯¥å¯¹æ‹“å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹é—­åˆâ€ã€‚</p><p>ç®€å•æ¥è¯´å°±æ˜¯ï¼šä»¥å¢ä»£æ”¹ã€‚</p><p><strong>Bad</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class AjaxAdapter extends Adapter &#123;  constructor() &#123;    super();    this.name &#x3D; &quot;ajaxAdapter&quot;;  &#125;&#125;class NodeAdapter extends Adapter &#123;  constructor() &#123;    super();    this.name &#x3D; &quot;nodeAdapter&quot;;  &#125;&#125;class HttpRequester &#123;  constructor(adapter) &#123;    this.adapter &#x3D; adapter;  &#125;  fetch(url) &#123;    if (this.adapter.name &#x3D;&#x3D;&#x3D; &quot;ajaxAdapter&quot;) &#123;      return makeAjaxCall(url).then(response &#x3D;&gt; &#123;        &#x2F;&#x2F; transform response and return      &#125;);    &#125; else if (this.adapter.name &#x3D;&#x3D;&#x3D; &quot;nodeAdapter&quot;) &#123;      return makeHttpCall(url).then(response &#x3D;&gt; &#123;        &#x2F;&#x2F; transform response and return      &#125;);    &#125;  &#125;&#125;function makeAjaxCall(url) &#123;  &#x2F;&#x2F; request and return promise&#125;function makeHttpCall(url) &#123;  &#x2F;&#x2F; request and return promise&#125;</code></pre><p>å‡è®¾å°†æ¥æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ª customAdapter, é‚£ä¹ˆæˆ‘ä»¬éœ€è¦ï¼š</p><ol><li>æ·»åŠ ä¸€ä¸ª CustomAdapter ç±»</li><li>åœ¨ HttpRequester ä¸­æ·»åŠ ä¸€ä¸ª makCustomCall æ–¹æ³•</li><li>ä¿®æ”¹ fetch æ–¹æ³•ï¼Œåˆ¤æ–­ adpater.name</li></ol><p>ä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬åªä¸è¿‡æ˜¯æƒ³æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„è¯·æ±‚æ–¹æ³•ï¼Œå´è¦å¯¹ HttpRequester è¿›è¡Œä¿®æ”¹ã€‚å®é™…ä¸Š HttpRequester åº”è¯¥ä¸å…³å¿ƒå…·ä½“ request è¿‡ç¨‹ã€‚ä¿®æ”¹å¦‚ä¸‹ï¼š</p><p><strong>Good</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class AjaxAdapter extends Adapter &#123;  constructor() &#123;    super();    this.name &#x3D; &quot;ajaxAdapter&quot;;  &#125;  request(url) &#123;    &#x2F;&#x2F; request and return promise  &#125;&#125;class NodeAdapter extends Adapter &#123;  constructor() &#123;    super();    this.name &#x3D; &quot;nodeAdapter&quot;;  &#125;  request(url) &#123;    &#x2F;&#x2F; request and return promise  &#125;&#125;class HttpRequester &#123;  constructor(adapter) &#123;    this.adapter &#x3D; adapter;  &#125;  fetch(url) &#123;    return this.adapter.request(url).then(response &#x3D;&gt; &#123;      &#x2F;&#x2F; transform response and return    &#125;);  &#125;&#125;</code></pre><p>ç»è¿‡è¿™æ ·è°ƒæ•´ï¼Œä¸ç®¡æ‹“å±•å¤šå°‘ä¸ªæ–° Adapter éƒ½ä¸éœ€è¦å¯¹ HttpRequester è¿›è¡Œä¿®æ”¹ã€‚</p><h3 id="é‡Œæ°æ›¿æ¢"><a href="#é‡Œæ°æ›¿æ¢" class="headerlink" title="é‡Œæ°æ›¿æ¢"></a>é‡Œæ°æ›¿æ¢</h3><p>â€œå­ç±»å¯¹è±¡åº”è¯¥å¯ä»¥ç›´æ¥æ›¿æ¢å…¶è¶…ç±»å¯¹è±¡è¢«ä½¿ç”¨â€</p><p>å¯¹äºè¿™ä¸ªåŸåˆ™æœ‰ä¸€ä¸ªæ¯”è¾ƒå¥½çš„è§£é‡Šæ˜¯ï¼šå¦‚æœä½ æœ‰ä¸€ä¸ªçˆ¶ç±»å’Œä¸€ä¸ªå­ç±»ï¼Œé‚£ä¹ˆç”¨å­ç±»ä»»æ„æ›¿æ¢æ‰çˆ¶ç±»è€Œä¸ä¼šå‡ºé”™ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç»å…¸çš„ä¾‹å­ï¼Œæ•°å­¦ä¸Šæ¥è¯´ï¼Œæ­£æ–¹å½¢æ˜¯ä¸€ç§é•¿æ–¹å½¢ï¼Œä½†æ˜¯å¦‚æœä½ çœŸçš„ä½¿ç”¨ â€œis-aâ€ æ¥æ„é€ çš„è¯ï¼Œå¾ˆå¿«ä½ å°±ä¼šå‘ç°é—®é¢˜æ‰€åœ¨ã€‚</p><p><strong>Bad</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class Rectangle &#123;  constructor() &#123;    this.width &#x3D; 0;    this.height &#x3D; 0;  &#125;  setColor(color) &#123;    &#x2F;&#x2F; ...  &#125;  render(area) &#123;    &#x2F;&#x2F; ...  &#125;  setWidth(width) &#123;    this.width &#x3D; width;  &#125;  setHeight(height) &#123;    this.height &#x3D; height;  &#125;  getArea() &#123;    return this.width * this.height;  &#125;&#125;class Square extends Rectangle &#123;  setWidth(width) &#123;    this.width &#x3D; width;    this.height &#x3D; width;  &#125;  setHeight(height) &#123;    this.width &#x3D; height;    this.height &#x3D; height;  &#125;&#125;function renderLargeRectangles(rectangles) &#123;  rectangles.forEach(rectangle &#x3D;&gt; &#123;    rectangle.setWidth(4);    rectangle.setHeight(5);    &#x2F;&#x2F; è¿™é‡Œï¼Œå¦‚æœæˆ‘ä»¬ä¼ å…¥çš„æ˜¯ä¸€ä¸ª squareï¼Œé‚£ä¹ˆè®¡ç®—ç»“æœå°†ä¼šæ˜¯ 25ï¼Œä¸é¢„æœŸçš„ 20 ä¸ç¬¦    const area &#x3D; rectangle.getArea();    rectangle.render(area);  &#125;);&#125;const rectangles &#x3D; [new Rectangle(), new Rectangle(), new Square()];renderLargeRectangles(rectangles);</code></pre><p>å¯ä»¥çœ‹åˆ°åœ¨è®¾ç½®å®½é«˜ä»¥åŠé¢ç§¯æ—¶ï¼Œå®é™…ä¸Šæ­£æ–¹å½¢ä¸é•¿æ–¹å½¢çš„è¡Œä¸ºæ—¶ä¸ä¸€è‡´çš„ï¼Œé‚£ä¹ˆè¿™é‡Œ æ­£æ–¹å½¢ä¸åº”è¯¥ä» é•¿æ–¹å½¢ç»§æ‰¿ã€‚æˆ‘ä»¬å¯ä»¥æŠ½è±¡å‡ºä¸€ä¸ªæ›´é«˜çš„å±‚çº§ Shapeï¼Œé•¿æ–¹å½¢ä¸æ­£æ–¹å½¢ç›¸åŒçš„æ–¹æ³•å¯ä»¥æ”¾åœ¨ Shape åŸºç±»ä¸­ï¼Œè€Œä¸åŒç‚¹åˆ™å„è‡ªå®ç°ã€‚</p><p><strong>Good</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class Shape &#123;  setColor(color) &#123;    &#x2F;&#x2F; ...  &#125;  render(area) &#123;    &#x2F;&#x2F; ...  &#125;&#125;class Rectangle extends Shape &#123;  constructor(width, height) &#123;    super();    this.width &#x3D; width;    this.height &#x3D; height;  &#125;  getArea() &#123;    return this.width * this.height;  &#125;&#125;class Square extends Shape &#123;  constructor(length) &#123;    super();    this.length &#x3D; length;  &#125;  getArea() &#123;    return this.length * this.length;  &#125;&#125;function renderLargeShapes(shapes) &#123;  shapes.forEach(shape &#x3D;&gt; &#123;    const area &#x3D; shape.getArea();    shape.render(area);  &#125;);&#125;const shapes &#x3D; [new Rectangle(4, 5), new Rectangle(4, 5), new Square(5)];renderLargeShapes(shapes);</code></pre><h3 id="æ¥å£éš”ç¦»"><a href="#æ¥å£éš”ç¦»" class="headerlink" title="æ¥å£éš”ç¦»"></a>æ¥å£éš”ç¦»</h3><p>JavaScript æ²¡æœ‰æ¥å£è¿™ä¸ªæ¦‚å¿µï¼Œå› æ­¤è¿™ä¸€æ¡ä¸åƒå…¶ä»–è¯­è¨€ä¸€æ ·ä¼šè¢«ä¸¥æ ¼æ‰§è¡Œï¼ˆä¸è¿‡ TypeScript å¯ä»¥å‚è€ƒä¸€ä¸‹ï¼‰ã€‚ä½†å³ä¾¿å¦‚æ­¤ï¼Œå³ä½¿æ˜¯ JavaScript è¿™æ ·ç¼ºå°‘ç±»å‹ç³»ç»Ÿçš„è¯­è¨€ä¸­ï¼Œè¿™æ¡åŸåˆ™ä¹Ÿæ˜¯æä¸ºé‡è¦çš„ã€‚</p><p>æ¥å£éš”ç¦»æŒ‡çš„æ˜¯ï¼šå®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£ï¼Œä¸€ä¸ªç±»å¯¹å¦ä¸€ä¸ªç±»çš„ä¾èµ–åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Šã€‚</p><p>ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ä¾‹å­æ˜¯ï¼šä¸€ä¸ªåŒ…å«å¾ˆå¤šè®¾ç½®é¡¹çš„ classã€‚å®¢æˆ·ç«¯æ— éœ€è®¾ç½®å¤§é‡çš„å¯é€‰é¡¹ï¼Œå› ä¸ºå¤§éƒ¨åˆ†æƒ…å†µæ˜¯æ— éœ€è®¾ç½®æ‰€æœ‰çš„é€‰é¡¹ï¼Œå°†è¿™äº›é€‰é¡¹è®¾ä¸ºå¯é€‰å°±å¯ä»¥é¿å… â€œèƒ–æ¥å£â€ã€‚</p><p><strong>Bad</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class DOMTraverser &#123;  constructor(settings) &#123;    this.settings &#x3D; settings;    this.setup();  &#125;  setup() &#123;    this.rootNode &#x3D; this.settings.rootNode;    this.settings.animationModule.setup();  &#125;  traverse() &#123;    &#x2F;&#x2F; ...  &#125;&#125;const $ &#x3D; new DOMTraverser(&#123;  rootNode: document.getElementsByTagName(&quot;body&quot;),  animationModule() &#123;&#125; &#x2F;&#x2F; å¤šæ•°æ—¶å€™æˆ‘ä»¬å¹¶ä¸éœ€è¦ animationModule  &#x2F;&#x2F; ...&#125;);</code></pre><p><strong>Good</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class DOMTraverser &#123;  constructor(settings) &#123;    this.settings &#x3D; settings;    this.options &#x3D; settings.options;    this.setup();  &#125;  setup() &#123;    this.rootNode &#x3D; this.settings.rootNode;    this.setupOptions();  &#125;  setupOptions() &#123;    if (this.options.animationModule) &#123;      &#x2F;&#x2F; ...    &#125;  &#125;  traverse() &#123;    &#x2F;&#x2F; ...  &#125;&#125;const $ &#x3D; new DOMTraverser(&#123;  rootNode: document.getElementsByTagName(&quot;body&quot;),  options: &#123;    animationModule() &#123;&#125;  &#125;&#125;);</code></pre><h3 id="ä¾èµ–å€’ç½®"><a href="#ä¾èµ–å€’ç½®" class="headerlink" title="ä¾èµ–å€’ç½®"></a>ä¾èµ–å€’ç½®</h3><p>è¿™ä¸ªåŸåˆ™æœ‰ä¸¤ä¸ªæ ¸å¿ƒç‚¹ï¼š</p><ol><li>é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—çš„å®ç°ï¼Œä»–ä»¬éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡æ¥å£ã€‚</li><li>æŠ½è±¡æ¥å£ä¸åº”è¯¥ä¾èµ–å…·ä½“å®ç°ï¼Œå…·ä½“å®ç°åº”è¯¥ä¾èµ–æŠ½è±¡æ¥å£ã€‚</li></ol><p>ç®€å•æ¥è¯´å³é«˜å±‚æ¨¡å—è´Ÿè´£å®šä¹‰æ¥å£ï¼Œè€Œä½å±‚æ¨¡å—è´Ÿè´£å®ç°æ¥å£ã€‚</p><p>ä¾èµ–å€’ç½®ç»å¸¸ä¼šä¸æ§åˆ¶åè½¬ï¼ˆIoCï¼‰è”ç³»åœ¨ä¸€èµ·ï¼ŒIoC æ˜¯å®ç° DIP çš„ä¸€ç§æ–¹å¼ï¼Œè€Œè¦å®ç° IoC ä¸€ç§å¸¸è§çš„æ–¹æ³•æ˜¯  Dependency Injection (DIï¼Œä¾èµ–æ³¨å…¥) ã€‚</p><p>è¿™ä¸¤è€…å®é™…ä¸Šä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼ŒDIP æŒ‡çš„æ˜¯é«˜å±‚æ¨¡å—ä¸åº”è¯¥çŸ¥é“ä½å±‚æ¨¡å—çš„å…·ä½“å®ç°ã€‚è€Œä¾èµ–æ³¨å…¥åˆ™æ˜¯å°†ä½å±‚æ¨¡å—çš„å®ç°æä¾›ç»™é«˜å±‚æ¨¡å—çš„å…·ä½“æ–¹æ³•ã€‚</p><p>è¿™ç§åšæ³•æœ€å¤§çš„å¥½å¤„æ˜¯å¯ä»¥å‡å°‘æ¨¡å—ä¹‹é—´çš„è€¦åˆåº¦ã€‚</p><p>å¦‚åˆšåˆšè¯´çš„ï¼ŒJavaScript æ²¡æœ‰æ¥å£çš„æ¦‚å¿µï¼Œå› æ­¤æŠ½è±¡æ¥å£çš„ä¾èµ–æ˜¯éšå¼çš„ï¼Œå³å¯¹è±¡å‘å¤–éƒ¨æš´éœ²çš„æ–¹æ³•å’Œå±æ€§ã€‚ä¸‹é¢ä¾‹å­ä¸­å°† InventoryTracker  è§†ä¸ºé«˜å±‚æ¨¡å—ï¼ŒInventoryRequester  ä¸ºä½å±‚æ¨¡å—ï¼Œæ¥å£æŒ‡çš„æ˜¯ InventoryTracker æ¨¡å—ä¾èµ–åˆ° InventoryRequester æ¨¡å—æš´éœ²çš„ requestItemï¼Œå³éšå¼è¦æ±‚æ‰€æœ‰çš„ InventoryRequester éƒ½åº”è¯¥æœ‰ requestItem æ–¹æ³•ã€‚é‚£ä¹ˆå…·ä½“å®ç°å…¶å®å°±æ˜¯è¯´ä¸åº”è¯¥åœ¨ InventoryTracker  å»å®ä¾‹åŒ–ä¸€ä¸ª InventoryRequesterï¼Œè€Œåº”è¯¥é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥è¿›æ¥ã€‚</p><p><strong>Bad</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class InventoryRequester &#123;  constructor() &#123;    this.REQ_METHODS &#x3D; [&quot;HTTP&quot;];  &#125;  requestItem(item) &#123;    &#x2F;&#x2F; ...  &#125;&#125;class InventoryTracker &#123;  constructor(items) &#123;    this.items &#x3D; items;   &#x2F;&#x2F; è¿™é‡Œæˆ‘ä»¬ä¸åº”è¯¥å»å®ä¾‹åŒ–ä¸€ä¸ªå…·ä½“çš„ Requesterï¼Œæˆ‘ä»¬åº”è¯¥åªä½¿ç”¨ Requester å®ä¾‹çš„ requestItem    this.requester &#x3D; new InventoryRequester();  &#125;  requestItems() &#123;    this.items.forEach(item &#x3D;&gt; &#123;      this.requester.requestItem(item);    &#125;);  &#125;&#125;const inventoryTracker &#x3D; new InventoryTracker([&quot;apples&quot;, &quot;bananas&quot;]);inventoryTracker.requestItems();</code></pre><p><strong>Good</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class InventoryTracker &#123;  constructor(items, requester) &#123;    this.items &#x3D; items;    this.requester &#x3D; requester;  &#125;  requestItems() &#123;    this.items.forEach(item &#x3D;&gt; &#123;      this.requester.requestItem(item);    &#125;);  &#125;&#125;class InventoryRequesterV1 &#123;  constructor() &#123;    this.REQ_METHODS &#x3D; [&quot;HTTP&quot;];  &#125;  requestItem(item) &#123;    &#x2F;&#x2F; ...  &#125;&#125;class InventoryRequesterV2 &#123;  constructor() &#123;    this.REQ_METHODS &#x3D; [&quot;WS&quot;];  &#125;  requestItem(item) &#123;    &#x2F;&#x2F; ...  &#125;&#125;&#x2F;&#x2F; è¿™é‡Œæˆ‘ä»¬åœ¨å¤–éƒ¨å®ä¾‹åŒ– InventoryRequester å¹¶ä¸”æ³¨å…¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç®€å•å°±å°† InventoryRequesterV1 æ›¿æ¢ InventoryRequesterV2const inventoryTracker &#x3D; new InventoryTracker(  [&quot;apples&quot;, &quot;bananas&quot;],  new InventoryRequesterV2());inventoryTracker.requestItems();</code></pre>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ReactNative æ–‡å­—æŠ˜å </title>
      <link href="/2021/01/22/ReactNative-%E6%96%87%E5%AD%97%E6%8A%98%E5%8F%A0/"/>
      <url>/2021/01/22/ReactNative-%E6%96%87%E5%AD%97%E6%8A%98%E5%8F%A0/</url>
      
        <content type="html"><![CDATA[<p> h5 çš„å•è¡Œ/å¤šè¡Œæ–‡å­—æº¢å‡ºæˆªæ–­å®ç°å¦‚ä¸‹</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">&#x2F;&#x2F; å•è¡Œdiv &#123;  white-space: nowrap;  overflow: hidden;  text-overflow: ellipsis;&#125;&#x2F;&#x2F; å¤šè¡Œdiv &#123;  display: -webkit-box;  overflow: hidden;  -webkit-line-clamp: 2;  -webkit-box-orient: vertical;  text-overflow: ellipsis;&#125;</code></pre><p>åœ¨ h5 ä¸­ï¼Œå¤šè¡Œæ–‡å­—æˆªæ–­çš„å…¼å®¹æ€§å¹¶ä¸å¥½ï¼Œè€Œåœ¨ RN ä¸­ï¼Œå®ç°æ–‡å­—æˆªæ–­åˆ™ç®€å•çš„å¤šï¼Œåªéœ€è¦ç»™ Text ç»„ä»¶æ·»åŠ  <code>numberOfLines</code> å±æ€§å³å¯ã€‚</p><p>ä½†æ˜¯é€šå¸¸æˆ‘ä»¬è¿˜ä¼šé‡åˆ°å¦‚ä¸‹éœ€æ±‚ï¼š</p><p>æ–‡å­—åœ¨ä¸è¶…å‡º N è¡Œæ—¶ï¼Œå…¨éƒ¨å±•ç¤ºï¼Œè¶…å‡º N è¡Œæ—¶æˆªæ–­ï¼Œå¹¶æ˜¾ç¤º é˜…è¯»æ›´å¤š æŒ‰é’®ï¼Œç”¨äºç‚¹å‡»å±•å¼€ï¼Œå±•å¼€å é˜…è¯»æ›´å¤š æŒ‰é’®æ˜¾ç¤ºä¸º æ”¶èµ·ï¼Œç‚¹å‡»åæŠ˜å æ–‡å­—ã€‚</p><a id="more"></a><p>å¦‚æœæˆ‘ä»¬èƒ½å¾—çŸ¥æ–‡å­—åˆå§‹æ—¶æ˜¯å¦å¤„äºæŠ˜å çŠ¶æ€ï¼Œé‚£ä¹ˆå°±å¾ˆå¥½åŠäº†ï¼Œé€šè¿‡ä¿®æ”¹ <code>numberOfLines</code>  çš„å€¼ 0 / Nï¼Œæ¥å˜æ›´ å±•å¼€ä¸æŠ˜å  çŠ¶æ€ã€‚</p><p>ä½†æ˜¯å¾ˆå¯æƒœï¼ŒRN å¹¶æ²¡æœ‰æä¾› api æ¥å‘ŠçŸ¥æ–‡å­—æ˜¯å¦å¤„äºæŠ˜å çŠ¶æ€ï¼Œå› æ­¤åªèƒ½å¦å¯»ä»–æ³•ã€‚</p><h5 id="å°è¯•ä¸€"><a href="#å°è¯•ä¸€" class="headerlink" title="å°è¯•ä¸€"></a>å°è¯•ä¸€</h5><p>å‚è€ƒ github ä¸Šçš„ <a href="https://github.com/facebook/react-native/issues/2496">issue</a> å¯ä»¥çœ‹åˆ°è¿™ä¸ªé—®é¢˜ç”±æ¥å·²ä¹…ï¼Œæœ‰ä¸ªè§£æ³•æ˜¯åœ¨ onLayout æ—¶è·å– Text çš„é«˜åº¦, å¯¹æ¯”ç†è®ºæŠ˜å å€¼( N * lineHeight)ï¼Œå¦‚æœæ¯”ç†è®ºæŠ˜å å€¼å¤§ï¼Œåˆ™è¯´æ˜æ–‡å­—å¤„äºæŠ˜å çŠ¶æ€ã€‚</p><p>ä¸Šé¢è¿™ä¸ªæ–¹æ¡ˆæˆ‘å°è¯•äº†ä¸‹ï¼Œåœ¨ ios ä¸Šè¡¨ç°è‰¯å¥½ï¼Œä½†æ˜¯åœ¨ å®‰å“ æœºå™¨ä¸Šï¼ŒonLayout æ—¶è·å–åˆ°çš„ Text é«˜åº¦å´æ˜¯æŠ˜å åçš„é«˜åº¦ï¼Œè¿™æ„å‘³ç€ä¸Šè¿°æ–¹æ³•å°†å¤±æ•ˆã€‚</p><h5 id="å°è¯•äºŒ"><a href="#å°è¯•äºŒ" class="headerlink" title="å°è¯•äºŒ"></a>å°è¯•äºŒ</h5><p>æ¥ç€æˆ‘åˆæ³¨æ„åˆ°ä¸€ä¸ª api <code>onTextLayout</code>ã€‚<code>onTextLayout</code> åœ¨ Text layout çš„æ—¶å€™ä¼šè¢«è°ƒç”¨ï¼Œå¯ä»¥è·å–åˆ° linesï¼Œè¿™æ˜¯ä¸ªå¯¹è±¡æ•°ç»„ï¼ŒåŒ…å«äº†æ¯è¡Œæ–‡å­—çš„å®½é«˜ç­‰ä¿¡æ¯ã€‚æˆ‘æ‰“ç®—å°è¯•ä¸€ä¸‹è¿™ä¸ª api å…·ä½“çš„è¡¨ç°å¦‚ä½•ã€‚å¥‡æ€ªçš„æ˜¯<code>onTextLayout</code> è™½ç„¶å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯ TS çš„ç”³æ˜æ–‡ä»¶ä¸­ Text ç»„ä»¶å´æ²¡æœ‰è¿™ä¸ªå±æ€§ã€‚å†åˆ™åœ¨å®‰å“æœºä¸Š <code>onTextLayout</code>  è¿”å›çš„ lines ä¸ºæœªæŠ˜å æ—¶çš„è¡Œæ•°ï¼Œè€Œåœ¨ ios ä¸Šåˆ™ä¸ºæŠ˜å åçš„è¡Œæ•°ï¼ˆæœ€åä¸€è¡Œå°†åŒ…æ‹¬æŠ˜å åæœªèƒ½æ”¾ä¸‹çš„æ–‡å­—ï¼‰ã€‚çœ‹æ¥ä»…é€šè¿‡ <code>onTextLayout</code>  ä¹Ÿæ˜¯æ— æ³•åˆ¤æ–­åˆ°æ˜¯å¦æ–‡å­—å¤„äºæŠ˜å çŠ¶æ€ã€‚</p><h5 id="å°è¯•ä¸‰"><a href="#å°è¯•ä¸‰" class="headerlink" title="å°è¯•ä¸‰"></a>å°è¯•ä¸‰</h5><p>ä¸è¿‡ä¸Šè¿°çš„å°è¯•å¯å‘äº†æˆ‘ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥å¾—çŸ¥æ–‡å­—åœ¨å…¨éƒ¨å±•å¼€æ—¶çš„è¡Œæ•°ï¼Œå¦‚æœè¶…è¿‡ N ï¼Œåˆ™å°† <code>numberOfLines</code>  è®¾ç½®ä¸º Nï¼Œå¦åˆ™ä¸º 0ï¼Œæ­¤æ—¶çš„åˆå§‹åŒ–çŠ¶æ€å¿…å®šæ˜¯æŠ˜å çš„ã€‚é‚£ä¹ˆé—®é¢˜æ˜¯å¦‚ä½•å¾—çŸ¥æ–‡å­—åœ¨å…¨éƒ¨å±•å¼€æ—¶çš„è¡Œæ•°ï¼Ÿå¦‚æœå°†æ–‡å­— <code>numberOfLines</code>  åˆå§‹å€¼è®¾ç½®ä¸º 0ï¼Œè¡¨ç°å°†ä¼šæ˜¯ä¸€å¼€å§‹å…¨éƒ¨å±•å¼€ï¼Œä¹‹åå†æ”¶èµ·ï¼Œæ˜¾ç„¶ä¸ç¬¦åˆéœ€æ±‚ã€‚é‚£ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ªä¸ä¼šè¢«çœ‹åˆ°çš„åœ°æ–¹æš—æˆ³æˆ³åœ°æ¸²æŸ“ <code>numberOfLines</code>  ä¸º 0 çš„ Textã€‚è¿™é‡Œæˆ‘æ˜¯æ„å»ºäº†ä¸€ä¸ª height ä¸º 0 çš„ ScrollViewï¼Œåœ¨è¿™ä¸ª ScrollView ä¸­æ¸²æŸ“ <code>numberOfLines</code>  ä¸º 0 çš„ Textï¼Œå¹¶ä¸”é€šè¿‡è¯¥ Text çš„ onTextLayout å¯ä»¥è·å–åˆ°æ–‡å­—çš„è¡Œæ•°ï¼Œå¹¶ä¸”ä¸ N è¿›è¡Œå¯¹æ¯”ï¼Œå°±å¯ä»¥çŸ¥é“æ–‡å­—æ˜¯å¦å¯æŠ˜å ã€‚</p><p>æœ€ç»ˆä»£ç å®ç°å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">&#x2F;* è¯¥ç»„ä»¶çš„ä¸»è¦ç”¨é€”æ˜¯æµ‹é‡å…·æœ‰ numberOfLines å±æ€§çš„ Text æ˜¯å¦ä¼šè¢«è£å‰ªï¼Œä»¥ç”¨äºè‡ªå®šä¹‰å±•å¼€æ›´å¤šæŒ‰é’® åŸç†æ˜¯åœ¨ä¸€ä¸ªé«˜åº¦ä¸º 0 çš„ ScrollView ä¸­è¿›è¡Œæ¸²æŸ“ï¼Œè·å–åˆ°æ¸²æŸ“åçš„è¡Œæ•°*&#x2F;import React, &#123; Children, isValidElement, cloneElement &#125; from &#39;react&#39;;import &#123; View, ViewStyle, ScrollView &#125; from &#39;react-native&#39;;interface IProps &#123;&#x2F;&#x2F; æœ€å¤šè¡Œæ•°ï¼Œè¶…å‡ºæŠ˜å   limitLineNumber: number;  children: React.ReactElement;  onReady: (truncated: boolean) &#x3D;&gt; void;  style: ViewStyle;&#125;const ReadMore &#x3D; (&#123; children, limitLineNumber, onReady, style &#125;: IProps) &#x3D;&gt; &#123;  &#x2F;* å¤åˆ¶å‡ºä¸€ä¸ªä¸å¸¦æœ‰ numberOfLines çš„ children *&#x2F;  const childrenTemp &#x3D; Children.map(children, (child) &#x3D;&gt; &#123;    if (isValidElement(child)) &#123;      return cloneElement(child as React.ReactElement&lt;any&gt;, &#123;        numberOfLines: 0,        onTextLayout: (e: any) &#x3D;&gt; &#123;          &#x2F;&#x2F; onTextLayoutäº‹ä»¶ï¼šios ä¸ å®‰å“ åœ¨æ–‡å­—æŠ˜å æƒ…å†µæ—¶ä¼šç•¥å¾®ä¸åŒï¼Œä½“ç°åœ¨ lines å±æ€§ä¸Š          &#x2F;&#x2F; ios æ˜¯è¿”å›æŠ˜å åçš„ï¼Œè€Œå®‰å“åˆ™è¿”å›çš„æ˜¯æŠ˜å ä¹‹å‰çš„          &#x2F;&#x2F; onTextLayout åœ¨ 0.59 çš„æ–‡æ¡£ä¸Šå¹¶æœªä½“ç°ï¼Œä¸” ts ç±»å‹ä¹Ÿæ²¡æœ‰ï¼Œä½†å®é™…ä¸Šæ˜¯å¯ä»¥ä½¿ç”¨çš„          onReady(e.nativeEvent.lines?.length &gt; limitLineNumber);        &#125;,      &#125;);    &#125;    return child;  &#125;);  return (    &lt;View style&#x3D;&#123;style&#125;&gt;      &lt;ScrollView style&#x3D;&#123;&#123; height: 0 &#125;&#125;&gt;&#123;childrenTemp&#125;&lt;&#x2F;ScrollView&gt;      &#123;children&#125;    &lt;&#x2F;View&gt;  );&#125;;export default ReadMore;</code></pre><p>ä½¿ç”¨æ—¶:</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const Demo &#x3D; () &#x3D;&gt; &#123;  const onReadMoreReady &#x3D; (truncated: boolean) &#x3D;&gt; &#123;      &#x2F;&#x2F; æ ¹æ®æ˜¯å¦å¯æŠ˜å ï¼Œåˆ¤æ–­å±•ç¤ºæŒ‰é’®çš„æ–‡å­—ç­‰çŠ¶æ€  &#125;;    return &lt;ReadMore onReady&#x3D;&#123;onReadMoreReady&#125; limitLineNumber&#x3D;&#123;2&#125; &gt;    &lt;Text&gt;      any content you need...    &lt;&#x2F;Text&gt;  &lt;&#x2F;ReadMore&gt;&#125;</code></pre><p>âš ï¸ ä»¥ä¸Šå…¨éƒ¨åŸºäº RN 0.59 ç‰ˆæœ¬</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ReactNative </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°å½•ä¸€æ¬¡è¸©å‘ï¼šwebpä¸ios</title>
      <link href="/2020/12/31/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E8%B8%A9%E5%9D%91%EF%BC%9Awebp%E4%B8%8Eios/"/>
      <url>/2020/12/31/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E8%B8%A9%E5%9D%91%EF%BC%9Awebp%E4%B8%8Eios/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘æœ‰åŒäº‹é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œæœ‰ä¸ªé¡µé¢çš„å›¾ç‰‡ï¼ˆ<a href="http://www.xxx.jpgï¼‰åœ¨å®‰å“å’Œ">www.xxx.jpgï¼‰åœ¨å®‰å“å’Œ</a> pc éƒ½èƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œä½†æ˜¯ç”¨ ios å°±å±•ç¤ºä¸äº†ã€‚é€šå¸¸å‡ºç°åœ¨è¿™ç§æƒ…å†µæ˜¯å› ä¸º WKWebview ä¸æ”¯æŒ webp çš„å›¾ç‰‡å¯¼è‡´çš„ã€‚é€šè¿‡ <a href="https://caniuse.com/?search=webpï¼Œå¯ä»¥çœ‹åˆ°">https://caniuse.com/?search=webpï¼Œå¯ä»¥çœ‹åˆ°</a> safari åœ¨ 14.0 ä¹‹åæ‰æ”¯æŒ webpã€‚</p><a id="more"></a><p>è™½ç„¶è¿™ä¸ªåœºæ™¯é‡Œçš„å›¾ç‰‡åç¼€åæ˜¯ jpgï¼Œä½†æ–‡ä»¶çš„åç¼€åå¹¶ä¸èƒ½å‡†ç¡®åæ˜ æ–‡ä»¶çš„å®é™…æ ¼å¼ã€‚å› æ­¤åœ¨ pc ç«¯æ‰“å¼€é“¾æ¥åï¼ŒæŸ¥çœ‹ <code>Content-Type</code> çœ‹åˆ°å±æ€§ä¸º <code>image/webp</code>, å› æ­¤å¯ä»¥ç¡®å®šè¿™ä¸ªå›¾ç‰‡æ–‡ä»¶å®é™…ä¸Šæ˜¯ webpã€‚</p><p>è¿™ä¸ªå›¾ç‰‡æ˜¯åœ¨åå°ç³»ç»Ÿä¸Šä¼ çš„ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½æ˜¯æ“ä½œäººå‘˜ä»ç½‘ç»œä¸‹è½½äº†ä¸€å¼  webp çš„å›¾ç‰‡ï¼Œä¹‹åä¿®æ”¹åç¼€åå¹¶ä¸Šä¼ ã€‚</p><p>ä¸Šä¼ ç»„ä»¶æ˜¯é€šè¿‡ antdesign æä¾›çš„<code>Upload</code>ï¼ˆè¯¥ç»„ä»¶æœ¬è´¨ä¸Šä¹Ÿæ˜¯å°è£…äº† input ç»„ä»¶ï¼‰ã€‚ åœ¨ <code>beforeUpload</code> å¯ä»¥è·å–åˆ°ä¸Šä¼ çš„ fileï¼Œ ä¸Šä¼ å‰é€šè¿‡ <code>file.type</code> æ ¡éªŒè¿‡æ–‡ä»¶çš„ MIME type å¿…é¡»æ˜¯ <code>image/jpeg</code>ã€‚</p><p>å¥‡æ€ªçš„è¿™é‡Œ webp æ–‡ä»¶ï¼Œå¦‚æœåç¼€åæ”¹æˆ jpg, åˆ™ file.type æ˜¾ç¤ºçš„æ˜¯ <code>image/jpeg</code> è€Œé <code>image/webp</code>, å³ file.type è·å–åˆ°ç±»å‹ä¼šæ”¶åˆ°åç¼€åçš„å½±å“ï¼Œå¹¶ä¸æ˜¯å‡†ç¡®çš„æ–‡ä»¶ç±»å‹ã€‚</p><p>æ ¹æ® MDN çš„æè¿°</p><blockquote><p> Based on the current implementation, browsers wonâ€™t actually read the bytestream of a file to determine its media type. It is assumed based on the file extension; a PNG image file renamed to .txt would give â€œ<em>text/plain</em>â€œ and not â€œ<em>image/png</em>â€œ. Moreover, <code>file.type</code> is generally reliable only for common file types like images, HTML documents, audio and video. Uncommon file extensions would return an empty string. Client configuration (for instance, the Windows Registry) may result in unexpected values even for common types. <strong>Developers are advised not to rely on this property as a sole validation scheme.</strong></p></blockquote><p>ç¡®å®æµè§ˆå™¨ä¼šä¾æ®åç¼€åæ¥åˆ¤æ–­ File.type è€ŒéçœŸæ­£å»è¯»å–æ–‡ä»¶æµå†…å®¹ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•åˆ¤æ–­æ–‡ä»¶çš„ç±»å‹æ˜¯å¦ä¸ºæˆ‘ä»¬éœ€è¦çš„ç±»å‹å‘¢ï¼Ÿæœ‰åŒäº‹ç»™äº†æ®µä»£ç :</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">var reader &#x3D; new FileReader();reader.onload &#x3D; function() &#123;  const isJPG &#x3D; z &#x3D;&gt; [255,216,255].every((v, k) &#x3D;&gt; z.charCodeAt(k)&#x3D;&#x3D;&#x3D;v);  const isWEBP &#x3D; z &#x3D;&gt; [87,69,66,80].every((v, k) &#x3D;&gt; z.charCodeAt(k+8)&#x3D;&#x3D;&#x3D;v);  const isPNG &#x3D; z &#x3D;&gt; [137,80,78,71,13,10,26,10].every((v, k) &#x3D;&gt; z.charCodeAt(k) &#x3D;&#x3D;&#x3D; v);  const isGIF &#x3D; z &#x3D;&gt; [71,73,70].every((v, k) &#x3D;&gt; z.charCodeAt(k) &#x3D;&#x3D;&#x3D; v);  var res &#x3D; reader.result;  console.log(isJPG(res));  console.log(isWEBP(res));  console.log(isPNG(res));  console.log(isGIF(res));&#125;;reader.readAsBinaryString($0.files[0]);</code></pre>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»™ RN æ·»åŠ  mobx</title>
      <link href="/2020/12/14/%E7%BB%99-RN-%E6%B7%BB%E5%8A%A0-mobx/"/>
      <url>/2020/12/14/%E7%BB%99-RN-%E6%B7%BB%E5%8A%A0-mobx/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>é¡¹ç›®ç»„ä¸­ RN ä¹‹å‰ä½¿ç”¨çš„çŠ¶æ€ç®¡ç†æ˜¯å°ä¼™ä¼´è‡ªè¡Œå°è£… reduxï¼Œ redux-saga çš„ä¸€ä¸ªç»„ä»¶åº“ï¼Œç„¶è€Œç”±äºæ–‡æ¡£ä¸å…¨ï¼Œä½¿ç”¨èµ·æ¥ä¸æ–¹ä¾¿ç­‰åŸå› ï¼Œç»è¿‡è®¨è®ºï¼Œå†³å®šæ›¿æ¢æˆ mobxã€‚ä¸»è¦å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š <a href="https://mobx.js.org/react-integration.html#react-integrationã€‚æœ¬æ–‡è®°å½•æˆ‘å°†">https://mobx.js.org/react-integration.html#react-integrationã€‚æœ¬æ–‡è®°å½•æˆ‘å°†</a> mobx åŠ å…¥ RN çš„è¿‡ç¨‹ä»¥åŠä½¿ç”¨ mobx çš„ä¸€äº›æ³¨æ„äº‹é¡¹ï¼ˆå®é™…ä¸Šä¸æ™®é€šçš„ React é¡¹ç›®å·®ä¸å¤šï¼‰</p><a id="more"></a><h4 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h4><ol><li><p>åœ¨ src ç›®å½•ä¸‹æ–°å¢ä¸€ä¸ª stores æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾ mobx ç›¸å…³çš„ä»£ç </p></li><li><p>ç¼–å†™ observable stateï¼Œè¿™é‡Œæˆ‘å†™äº†ä¸€ä¸ª Counter.ts å¹¶ä¸”æ–°å»º stores.ts ç®¡ç†æ‰€æœ‰çš„çŠ¶æ€ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">&#x2F;&#x2F; Counter.tsimport &#123; makeAutoObservable &#125; from &#39;mobx&#39;;class Counter &#123;  count &#x3D; 0;  constructor() &#123;    makeAutoObservable(this);  &#125;  &#x2F;&#x2F; æ³¨æ„è¦ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œå¦åˆ™éœ€è¦ç”¨ action.bound æ¥ç»‘å®š thisï¼Œå¦åˆ™æŒ‡å‘ React ç»„ä»¶  increase &#x3D; () &#x3D;&gt; &#123;    this.count +&#x3D; 1;  &#125;;  decrease &#x3D; () &#x3D;&gt; &#123;    this.count -&#x3D; 1;  &#125;;&#125;export default Counter;&#x2F;&#x2F; stores.tsimport Counter from &#39;.&#x2F;Counter&#39;;export default &#123;  counter: new Counter(),&#125;;</code></pre></li><li><p>æ ¹æ® mobx æ–‡æ¡£ï¼Œç»„ä»¶è¦ä½¿ç”¨å¤–éƒ¨çŠ¶æ€æœ‰ä¸‰ç§å†™æ³•ï¼š</p><ol><li>é€šè¿‡ props å°† çŠ¶æ€ä¼ é€’åˆ°ç»„ä»¶</li><li>ç›´æ¥é€šè¿‡ import è¿›æ¥</li><li>é€šè¿‡ React context å¼•å…¥åˆ°ç»„ä»¶</li></ol><p>ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œè€ƒè™‘ 2ï¼Œ3 ä¸­å†™æ³•ï¼Œæ–‡æ¡£ä¸­æ¨èä½¿ç”¨ contextï¼Œé‚£ä¹ˆå°±è¿™é‡Œå°è¯•ä½¿ç”¨ contextã€‚</p></li><li><p>ç¼–å†™ withStores.ts å‡½æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œä¸»è¦çš„ä½œç”¨æ˜¯ç»™æ ¹å…ƒç´ ç”¨ Provider åŒ…è£¹èµ·æ¥ï¼Œå¹¶ä¸”æ ¹å…ƒç´ é€šå¸¸ä¹Ÿæ˜¯éœ€è¦ observe çš„ï¼Œå› æ­¤è¿™é‡Œä¹Ÿé¡ºä¾¿å°†å…¶è½¬æˆå¯è§‚æµ‹çš„ç»„ä»¶ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">&#x2F;&#x2F; withStores.tsimport React, &#123; createContext &#125; from &#39;react&#39;;import &#123; observer &#125; from &#39;mobx-react-lite&#39;;import stores from &#39;.&#x2F;stores&#39;;&#x2F;&#x2F; åˆå§‹åŒ– Contextexport const StoresContext &#x3D; createContext&lt;typeof stores&gt;(stores);const withStores &#x3D; &lt;P extends object&gt;(  WrappedComponent: React.FunctionComponent&lt;P&gt;,) &#x3D;&gt; (props: P) &#x3D;&gt; &#123;  &#x2F;&#x2F; è½¬æˆå¯è§‚æµ‹çš„ç»„ä»¶  const ObserverWrappedComponent &#x3D; observer(WrappedComponent);  return (    &lt;StoresContext.Provider value&#x3D;&#123;stores&#125;&gt;      &lt;ObserverWrappedComponent &#123;...props&#125; &#x2F;&gt;    &lt;&#x2F;StoresContext.Provider&gt;  );&#125;;export default withStores;</code></pre></li><li><p>æ¥ä¸‹æ¥çš„ä½¿ç”¨å°±ç®€å•äº†ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import React, &#123; useEffect, useContext &#125; from &#39;react&#39;;import &#123; TouchableOpacity, View, Text &#125; from &#39;react-native&#39;;import &#123; withStores, StoresContext &#125; from &#39;@&#x2F;stores&#39;;import Child from &#39;.&#x2F;Child&#39;;const MobxDemo &#x3D; () &#x3D;&gt; &#123;  const &#123; counter &#125; &#x3D; useContext(StoresContext);  return (    &lt;View&gt;      &lt;Text&gt;count: &#123;counter.count&#125;&lt;&#x2F;Text&gt;      &lt;TouchableOpacity onPress&#x3D;&#123;counter.increase&#125;&gt;        &lt;Text&gt;increase: +&lt;&#x2F;Text&gt;      &lt;&#x2F;TouchableOpacity&gt;      &lt;TouchableOpacity onPress&#x3D;&#123;counter.decrease&#125;&gt;        &lt;Text&gt;decrease: -&lt;&#x2F;Text&gt;      &lt;&#x2F;TouchableOpacity&gt;      &lt;Child &#x2F;&gt;    &lt;&#x2F;View&gt;  );&#125;;export default withStores(MobxDemo);&#x2F;&#x2F; Child.tsximport React, &#123; useContext &#125; from &#39;react&#39;;import &#123; observer &#125; from &#39;mobx-react-lite&#39;;import &#123; Text &#125; from &#39;react-native&#39;;import &#123; StoresContext &#125; from &#39;@&#x2F;stores&#39;;export const Child &#x3D; () &#x3D;&gt; &#123;  const &#123; counter &#125; &#x3D; useContext(StoresContext);  return &lt;Text&gt;child: &#123;counter.count&#125;&lt;&#x2F;Text&gt;;&#125;;export default observer(Child);</code></pre></li></ol>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>svg ä¸å­—ä½“</title>
      <link href="/2020/12/10/svg-%E4%B8%8E%E5%AD%97%E4%BD%93/"/>
      <url>/2020/12/10/svg-%E4%B8%8E%E5%AD%97%E4%BD%93/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>ç»§ä¸Šä¸€ç¯‡ ã€Šsvg å›¾ç‰‡çš„ä¸Šä¼ ä¸ä¸‹è½½ã€‹åï¼Œäº§å“è¦æ±‚ä¸‹è½½çš„ svg éœ€è¦ä½¿ç”¨ â€œOCR-B 10 BTâ€ è¿™ä¸ªå­—ä½“ã€‚ä¸‹é¢è®°å½•ä¸‹é‡åˆ°çš„å‘ã€‚</p><a id="more"></a><h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><p><code>jsbarcode</code> è¿™ä¸ªåº“æä¾›äº†ä¸€ä¸ª <code>font</code> é…ç½®é¡¹ã€‚ä¾‹å¦‚è¿™é‡Œé…ç½® </p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">JsBarcode(svg, barcode, &#123;  font: &#39;Arial&#39;&#125;);</code></pre><p>è¿™ä¸ªé…ç½®çš„ä½œç”¨æ˜¯åœ¨ svg çš„ text èŠ‚ç‚¹çš„ style å±æ€§ä¸Šæ·»åŠ <code>font:Arial</code></p><p>é‚£ä¹ˆé—®é¢˜å¦‚æœæ˜¯ OCR-B 10 BTï¼Œæˆ‘ä»¬ç›´æ¥é…ç½®æˆ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">JsBarcode(svg, barcode, &#123;  font: &#39;OCR-B 10 BT&#39;&#125;);</code></pre><p>é‚£ä¹ˆç»“æœä¼šå˜æˆ:</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&lt;text style&#x3D;&quot;font: OCR-B 10 BT&quot;&gt;xxx&lt;&#x2F;text&gt;</code></pre><p>è¿™å°†ä¼šå¯¼è‡´æ— æ³•è¯†åˆ«å‡º font çš„å±æ€§ï¼Œè€Œ jsbarcode å¹¶æ²¡æœ‰å•ç‹¬æä¾› font-family é…ç½®ã€‚æ­£ç¡®çš„å†™æ³•å¯ä»¥å¦‚ä¸‹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">JsBarcode(svg, barcode, &#123;  font: &#96;&quot;OCR-B 10 BT&quot;&#96;&#125;);</code></pre><p>åˆ°äº†è¿™ä¸€æ­¥å¹¶æ²¡æœ‰å®Œå…¨è§£å†³é—®é¢˜ï¼Œå¯¹äºç³»ç»Ÿæœ‰å®‰è£…è¿‡ OCR-B 10 BT å­—ä½“çš„ç”¨æˆ·æ˜¯å¯ä»¥æ­£å¸¸å±•ç¤ºä¸‹è½½çš„ svgï¼Œç„¶è€Œå¯¹äºæ²¡æœ‰å®‰è£…è¿‡è¿™ä¸ªå­—ä½“çš„åˆ™ä¼šå±•ç¤ºé»˜è®¤å­—ä½“ã€‚è¿™é‡Œåˆ†æˆä¸¤ç§åœºæ™¯ï¼š1. åœ¨æˆ‘ä»¬çš„ç½‘ç«™ä¸Šå±•ç¤º 2. ä¸‹è½½åçš„ svg å±•ç¤º</p><p>å¯¹äºç¬¬ä¸€ä¸ªåœºæ™¯ï¼Œåœ¨ web é€šè¿‡ font-face å¼•å…¥å­—ä½“æ–‡ä»¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">@font-face &#123;    font-family: &#39;OCR-B 10 BT&#39;;    src: url(&#39;fonts&#x2F;webfont.eot&#39;);    src:url(&#39;fonts&#x2F;webfont.woff&#39;) format(&#39;woff&#39;),       url(&#39;fonts&#x2F;webfont.woff2&#39;) format(&#39;woff2&#39;),        url(&#39;fonts&#x2F;webfont.ttf&#39;) format(&#39;truetype&#39;);    font-weight: normal;    font-style: normal;&#125;</code></pre><p>ç„¶è€Œåœ¨ç¬¬äºŒä¸ªåœºæ™¯åˆ™éœ€è¦å°†å­—ä½“æ–‡ä»¶æ”¾åˆ° svg é‡Œé¢ï¼Œæ³¨æ„è¿™ä¸ªä¼šå¯¼è‡´ svg ä½“ç§¯å¢å¤§ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨ svg ä¸­å®šä¹‰ styleï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const defs &#x3D; document.createElementNS(&#39;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&#39;, &#39;defs&#39;);const style &#x3D; document.createElementNS(&#39;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&#39;, &#39;style&#39;);style.type &#x3D; &#39;text&#x2F;css&#39;;&#x2F;&#x2F; myFontStyle æ˜¯æˆ‘ä»¬å®šä¹‰çš„æ ·å¼ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€æ®µå®šä¹‰ font-face çš„å­—ç¬¦ä¸²style.innerHTML &#x3D; myFontStyle;defs.appendChild(style);svgElement.appendChild(defs);</code></pre><p>å¯ä»¥é€šè¿‡ <a href="https://www.fontsquirrel.com/tools/webfont-generator">https://www.fontsquirrel.com/tools/webfont-generator</a> è¿™é‡Œé€‰æ‹© EXPERT æ¨¡å¼ï¼Œåœ¨ css çš„å‹¾é€‰æ é€‰ä¸­ Base64 ç¼–ç ï¼Œç”Ÿæˆçš„ zip åŒ…ä¸­çš„ css æ–‡ä»¶å†…å®¹å°±åŒ…å«æˆ‘ä»¬ç¼–ç æˆ base64 åçš„æ ·å¼ã€‚å°† myFontStyle æ›¿æ¢æˆ æ–‡ä»¶å†…å®¹å³å¯ã€‚</p><p>è‡³æ­¤ç»™ svg å®šä¹‰å­—ä½“çš„éœ€æ±‚å°±ç®—æ˜¯å®Œæˆäº†ï¼Œä¸è¿‡çœŸçš„ä¸æ¨èå°†å­—ä½“å¡è¿› svg ä¸­ï¼Œå¦åˆ™æ–‡ä»¶ä½“ç§¯å°†ä¼šé£™å‡ â˜ ï¸</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å›é¡¾é¡¹ç›®ä¸­å®è·µçš„ graphql</title>
      <link href="/2020/11/16/%E5%9B%9E%E9%A1%BE%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%AE%9E%E8%B7%B5%E7%9A%84-graphql/"/>
      <url>/2020/11/16/%E5%9B%9E%E9%A1%BE%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%AE%9E%E8%B7%B5%E7%9A%84-graphql/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>æ—©äº›æ—¶å€™åœ¨å…¬å¸å†…éƒ¨çš„åšè¿‡ä¸€ä¸ªå†…éƒ¨é¡¹ç›® <code>api-docs</code>ï¼Œè¯¥é¡¹ç›®æ˜¯æä¾›ä¸€ä¸ª Api ç®¡ç†æ–‡æ¡£å¹³å°ï¼Œç±»ä¼¼äº YApi ã€‚é¡¹ç›®æ˜¯åŠè·¯æ¥è¿‡æ¥çš„ï¼Œå‰ç«¯ä½¿ç”¨ <code>vue</code>ï¼ŒæœåŠ¡ç«¯ä½¿ç”¨ <code>eggjs</code> æä¾›ç¬¦åˆ restful è§„èŒƒçš„æ¥å£ï¼Œæ•°æ®åº“åˆ™é€‰æ‹©çš„æ˜¯ <code>mongodb</code>ã€‚</p><p>åœ¨ä¸æ–­çš„è¿­ä»£ä¸­ï¼Œé‡åˆ°ä»¥ä¸‹ä¸€äº›é—®é¢˜</p><ol><li>é¦–é¡µå’Œæµ‹è¯•æ¨¡å—éƒ½å±•ç¤ºäº† api åˆ—è¡¨ï¼Œä½†æ˜¯é¦–é¡µä¸æµ‹è¯•æ¨¡å—æ‰€å±•ç¤ºçš„å­—æ®µå­˜åœ¨ä¸€äº›å¼‚åŒç‚¹ï¼ŒåŸºäºæ­¤ï¼Œæœ‰ä¸¤ç§åšæ³•ï¼š<ol><li>æä¾›ä¸¤ä¸ªä¸åŒçš„æ¥å£</li><li>æä¾›åŒä¸€ä¸ªæ¥å£ï¼Œæ ¹æ®è¯·æ±‚å‚æ•°åˆ¤æ–­éœ€è¦ä¸‹å‘çš„å­—æ®µ</li></ol></li><li>éœ€è¦å¯¹å¤–å¼€æ”¾æŸ¥è¯¢æ¥å£ï¼Œä¸åŒéƒ¨é—¨éœ€æ±‚çš„å­—æ®µä¿¡æ¯ä¸åŒ</li><li>ç”±äºæ˜¯å†…éƒ¨ä½¿ç”¨ï¼Œæ¥å£ ( éœ€æ±‚ ) æ”¹åŠ¨æ¯”è¾ƒé¢‘ç¹ï¼Œä»…ä»…æ˜¯ä¿®æ”¹å‰ç«¯å±•ç¤ºçš„æ•°æ®å´éœ€è¦é¢‘ç¹ä¿®æ”¹æœåŠ¡ç«¯æ¥å£ï¼Œå½“ç„¶å¯ä»¥å°†é¡µé¢éœ€è¦çš„å­—æ®µå…¨éƒ¨ä¸‹å‘ï¼Œä¸è¿‡è¿™ä¹ˆåšæœ‰ç‚¹æµªè´¹å¸¦å®½ã€‚</li></ol><p>å› æ­¤æˆ‘å¼•å…¥äº† <code>graphql</code> æ¥è§£å†³ä¸Šè¿°çš„é—®é¢˜ã€‚åŸºæœ¬æƒ³æ³•æ˜¯å‰ç«¯è‡ªè¡Œæ„å»ºéœ€è¦çš„å­—æ®µï¼ŒæœåŠ¡ç«¯æ— éœ€å˜æ›´ã€‚</p><p>æœ¬æ–‡å°è¯•å»è¿˜åŸå¼•å…¥çš„è¿‡ç¨‹æ˜¯é˜²æ­¢é—å¿˜( å®é™…ä¸Šæ—¶é—´éš”å¾—æ¯”è¾ƒä¹…äº†ï¼Œä¸€äº›ç»†èŠ‚ç¡®å®å·²ç»æ¨¡ç³Šäº† )ã€‚ç”±äºå½“æ—¶ä¹Ÿæ˜¯æ‘¸çŸ³å¤´è¿‡æ²³ï¼Œå¯èƒ½ä¼šæœ‰ä¸€äº›ä¸æ˜¯æœ€ä½³å®è·µçš„åœ°æ–¹ï¼Œè¿˜æœ›æŒ‡æ•™ã€‚</p><a id="more"></a><p>æ–‡ä¸­æ¶‰åŠåˆ°çš„åº“ç‰ˆæœ¬ï¼š</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; æœåŠ¡ç«¯dataloader: 1.4.0egg: 2.0.0egg-graphql: 2.3.0graphql-type-json: 0.2.1&#x2F;&#x2F; å‰ç«¯graphqlï¼š14.5.8apollo-boostï¼š0.1.23</code></pre><h4 id="å‰ç«¯å¤„ç†"><a href="#å‰ç«¯å¤„ç†" class="headerlink" title="å‰ç«¯å¤„ç†"></a>å‰ç«¯å¤„ç†</h4><p>å‰ç«¯æˆ‘æ˜¯ä½¿ç”¨äº† apollo æ¥å‘é€è¯·æ±‚çš„ï¼Œå¼•å…¥ apollo</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">import Vue from &quot;vue&quot;;import VueApollo from &quot;vue-apollo&quot;;import ApolloClient from &quot;apollo-boost&quot;;import API from &quot;@&#x2F;config&#x2F;api&quot;;const apolloClient &#x3D; new ApolloClient(&#123;  uri: &#39;&#x2F;graphql&#39;&#125;);const apolloProvider &#x3D; new VueApollo(&#123;  defaultClient: apolloClient&#125;);Vue.use(VueApollo);export default apolloProvider;</code></pre><p>æ„é€ ä¸€ä¸ªæŸ¥è¯¢ api åˆ—è¡¨çš„è¯­å¥</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">import gql from &quot;graphql-tag&quot;;const apiListQuery &#x3D; gql&#96;    query($pageInfo: PageInfo)&#123;      apis(pageInfo: $pageInfo)&#123;        nodes&#123;          _id          name        &#125;        total      &#125;    &#125;  &#96;</code></pre><p>è¿˜å¯ä»¥é€šè¿‡å¼€å‘è€…å·¥å…· graphiql å¿«é€Ÿæ„é€ æ­£ç¡®çš„æŸ¥è¯¢è¯­å¥ï¼Œè¿™ä¸ªåé¢ä¼šç»“åˆ eggjs ä»‹ç»ã€‚</p><p>å‘é€è¯·æ±‚</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">function getList &#x3D; async () &#x3D;&gt; &#123;  const pageInfo &#x3D; &#123;    pageSize: 20,    currentPage: 1&#125;;  await apolloProvider.defaultClient.query(&#123;    query: apiListQuery,    variables: &#123;      pageInfo    &#125;  &#125;);&#125;</code></pre><p>æˆ–è€…ç®€å•é€šè¿‡ axios å‘é€</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">axios(&#123;  url: &#39;http:&#x2F;&#x2F;xxxxx&#x2F;graphql&#39;,  method: &#39;POST&#39;,  data: &#123;    query: &#96;            query ($filter: Api_Filter, $pageInfo: PageInfo) &#123;              apis(filter: $filter, pageInfo: $pageInfo) &#123;                  nodes &#123;                      _id                      name                  &#125;                  total              &#125;          &#125;&#96;,    variables: &#123;      pageInfo: &#123;        pageSize: 20,        currentPage: 1,      &#125;    &#125;,  &#125;,&#125;);</code></pre><h4 id="æœåŠ¡ç«¯å¤„ç†"><a href="#æœåŠ¡ç«¯å¤„ç†" class="headerlink" title="æœåŠ¡ç«¯å¤„ç†"></a>æœåŠ¡ç«¯å¤„ç†</h4><p>ä»…æ”¹é€ æ—§æ¥å£ä¸­æœ‰ä¸Šè¿°éœ€æ±‚çš„ get è¯·æ±‚ï¼Œå¯¹äºå…¶ä»–æ²¡æœ‰å¿…è¦å…¨éƒ¨è½¬ä¸º graphql çš„æ¥å£ä¸åšå˜æ›´ã€‚</p><p>egg å¯¹ graphql åšäº†ä¸€å®šçš„æ”¯æŒ: <a href="https://github.com/eggjs/egg-graphqlï¼Œå…¶ä¸­çš„é…ç½®å¯ä»¥å‚è€ƒæ–‡æ¡£ã€‚">https://github.com/eggjs/egg-graphqlï¼Œå…¶ä¸­çš„é…ç½®å¯ä»¥å‚è€ƒæ–‡æ¡£ã€‚</a></p><pre class="line-numbers language-js" data-language="js"><code class="language-js">&#x2F;&#x2F; congfig.jsgraphql: &#123;  router: &#39;&#x2F;graphql&#39;,  &#x2F;&#x2F; æ˜¯å¦åŠ è½½åˆ° app ä¸Šï¼Œé»˜è®¤å¼€å¯  app: true,  &#x2F;&#x2F; æ˜¯å¦åŠ è½½åˆ° agent ä¸Šï¼Œé»˜è®¤å…³é—­  agent: false,  &#x2F;&#x2F; æ˜¯å¦åŠ è½½å¼€å‘è€…å·¥å…· graphiql, é»˜è®¤å¼€å¯ã€‚è·¯ç”±åŒ router å­—æ®µã€‚ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€è¯¥å¯è§ã€‚  graphiql: true&#125;&#x2F;&#x2F; pluginexports.graphql &#x3D; &#123;  enable: true,  package: &#39;egg-graphql&#39;&#125;</code></pre><p>ç›®å½•ç»“æ„ï¼š</p><pre class="line-numbers language-none"><code class="language-none">.â”œâ”€â”€ appâ”‚   â”œâ”€â”€ graphqlâ”‚   â”‚   â”œâ”€â”€ projectâ”‚   â”‚   â”‚   â””â”€â”€ schema.graphqlâ”‚   â”‚   â”œâ”€â”€ api  &#x2F;&#x2F; api æ¨¡å‹â”‚   â”‚   â”‚   â”œâ”€â”€ connector.js  â”‚   â”‚   â”‚   â”œâ”€â”€ resolver.jsâ”‚   â”‚   â”‚   â””â”€â”€ schema.graphqlâ”‚   â”œâ”€â”€ modelâ”‚   â”‚   â””â”€â”€ api.jsâ”‚   â”œâ”€â”€ publicâ”‚   â””â”€â”€ router.js</code></pre><p>åœ¨ app ä¸‹æ–°å¢ä¸€ä¸ª graphql æ–‡ä»¶å¤¹ã€‚</p><p>ä¸‹é¢å†æ–°å»ºä¸€ä¸ª api æ–‡ä»¶å¤¹ï¼Œæ ¹æ® GraphQL çš„è§„èŒƒï¼Œå°† GraphQL ç›¸å…³é€»è¾‘åˆ†æˆ Schema, Resolvers, Models, å’Œ Connectorsã€‚</p><p> schema.graphql ä¸­æè¿°æ•°æ®æ¨¡å‹ï¼Œæœ‰ç‚¹åƒ typescript ä¸­çš„ interfaceã€‚</p><p>graphql çš„æ•°æ®æ¨¡å‹å…¥å£åœ¨ project/schema.graphql</p><pre class="line-numbers language-none"><code class="language-none">type Apis &#123;  nodes: [Api],  total: Int&#125;type Query &#123;  apis(filter: Api_Filter, pageInfo: PageInfo): Apis&#125;</code></pre><p>api / schema.graphql çš„å†…å®¹å¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">type Api_Options &#123;&#x2F;&#x2F; ã€‚ã€‚ã€‚&#125;type Api &#123;  _id: String  name: String  options: Api_Options&#125;</code></pre><p>å£°æ˜çš„ type å¯ä»¥è¢«åˆ«çš„ type å¼•ç”¨ã€‚</p><p>resolver æ˜¯å¯¹æ¥åˆ°ç”¨æˆ·æŸ¥è¯¢</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">module.exports &#x3D; &#123;  Query: &#123;    apis (root, params, ctx) &#123;      return ctx.connector.api.find(params)    &#125;,  &#125;,&#125;</code></pre><p>ä¸Šé¢æˆ‘ä»¬çœ‹åˆ° ctx æœ‰ä¸ª connector å±æ€§ï¼Œå®é™…ä¸Šå¯¹åº”çš„å°±æ˜¯æˆ‘ä»¬çš„ connector æ–‡ä»¶ï¼Œconnector ä¸»è¦è´Ÿè´£å–æ•°é€»è¾‘ï¼Œç±»ä¼¼äº controller çš„èŒèƒ½ã€‚</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">class ApiConnector &#123;  constructor (ctx) &#123;    this.ctx &#x3D; ctx  &#125;  async find (params) &#123;    &#x2F;&#x2F; è·å–åˆ°å‚æ•°    const &#123; pageInfo &#125; &#x3D; params    const &#123; currentPage, pageSize &#125; &#x3D; pageInfo    const apis &#x3D; await this.ctx.model.Api.find()      .sort(&#123;        createTime: -1      &#125;)      .skip((Number(currentPage) - 1) * Number(pageSize))      .limit(Number(pageSize))      .exec()    const total &#x3D; await this.ctx.model.Api.find()      .count()      .exec()    return &#123;      nodes: apis,      total    &#125;  &#125;&#125;module.exports &#x3D; ApiConnector</code></pre><p>è‡³æ­¤å®Œæˆäº†ä¸€ä¸ªç®€å•çš„å‘ graphql è¯·æ±‚ï¼Œåˆ°æœåŠ¡ç«¯å¤„ç†çš„å¹¶è¿”å›çš„è¿‡ç¨‹ã€‚</p><h4 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h4><p>DataLoaderï¼šgraphql æ”¯æŒåµŒå¥—æŸ¥è¯¢ï¼Œæœ‰æ—¶å€™ä¼šå‡ºç°ä¸¥é‡çš„N+1æŸ¥è¯¢æ€§èƒ½é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œfacebook æå‡º dataloader è¿™ä¸ªæ–¹æ¡ˆã€‚</p><ol><li>å…·ä½“å¯ä»¥çœ‹ <a href="https://zhuanlan.zhihu.com/p/30604868">https://zhuanlan.zhihu.com/p/30604868</a> çš„è¯´æ˜ã€‚</li><li>dataloader è¦æ±‚è¿”å›çš„ç»“æœå’Œä¼ å…¥çš„ key ä¸€è‡´ï¼Œè€Œ mongo find ä¸ $in æ˜¯ä¸ä¿è¯é¡ºåºçš„ï¼Œè¯·æ³¨æ„è¦è½¬æˆæ­£ç¡®çš„é¡ºåºã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GraphQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VSCode merge-diffs æ’ä»¶å¼€å‘</title>
      <link href="/2020/10/30/%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/"/>
      <url>/2020/10/30/%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>å½“å‰çš„é¡¹ç›®ç”±äºä¸æ˜¯ä¸¥æ ¼æŒ‰ç…§æ•æ·å¼€å‘è¿›è¡Œçš„ï¼Œç»å¸¸æœ‰åŠŸèƒ½åˆ†æ”¯éœ€è¦åˆ†åˆ«ä¸Šåˆ° æµ‹è¯•ï¼Œé¢„å‘ä»¥åŠå¼€å‘ç¯å¢ƒã€‚è¿™ä¸ªå°±å¯¼è‡´äº†åŠŸèƒ½åˆ†æ”¯æ¯”è¾ƒå¤šï¼Œä¸”å¼€å‘è¦åœ¨ä¸´ä¸Šçº¿å‰æ•´ç†éœ€ä¸Šçº¿çš„åˆ†æ”¯ï¼Œåœ¨ä¸Šåˆ°æ­£å¼ç¯å¢ƒä¹‹å‰éœ€è¦åˆå¹¶åˆ°ä¸€ä¸ªä¸´æ—¶åˆ†æ”¯ï¼Œä¹‹åå†ç»Ÿä¸€ä¸Šåˆ° master åˆ†æ”¯ã€‚å› æ­¤ç»å¸¸ä¼šé—æ¼æ‰ä¸€äº›åˆ†æ”¯ã€‚ç”¨ git log å¯ä»¥å¯¹æ¯”å‡ºä¸¤ä¸ªåˆ†æ”¯åˆå¹¶åˆ†æ”¯çš„åŒºåˆ«ï¼Œä»è€ŒçŸ¥é“æœ‰å“ªäº›åˆ†æ”¯åˆå¹¶åˆ°æµ‹è¯•åˆ†æ”¯ï¼Œä½†æ˜¯å¹¶æ²¡åˆå¹¶åˆ° masterã€‚ é‚£ä¹ˆè¿™äº›åˆ†æ”¯å°±æœ‰å¯èƒ½æ˜¯éœ€è¦ä¸Šçº¿åˆ° master çš„ã€‚æˆ‘ä¸ªäººæ¯”è¾ƒä¹ æƒ¯ä½¿ç”¨å‘½ä»¤è¡Œ + vscode æ¥ä½¿ç”¨ gitï¼Œä½†æ˜¯å‘½ä»¤è¡Œä¸å¤ªç›´è§‚ï¼Œä¸”äº¤äº’æ¯”è¾ƒéº»çƒ¦ï¼Œå› æ­¤æ‰“ç®—å†™ä¸ª VSCode æ’ä»¶ã€‚</p><a id="more"></a><p>å…³äºä¸ªäººé¡¹ç›®ï¼ˆæ’é™¤å•çº¯ä¸ºäº†æŠ˜è…¾æŠ€æœ¯çš„ç›®çš„ï¼‰æˆ‘æœ‰ä¸€ä¸ªç»éªŒæ˜¯è¿½æ±‚çš„ä¸åº”è¯¥æ˜¯æŠ€æœ¯æ–¹æ¡ˆå®Œç¾ï¼Œè€Œæ˜¯èƒ½å°½å¿«ä½œå‡ºéœ€è¦çš„åŠŸèƒ½ï¼ˆå¦åˆ™æå¯èƒ½ä¸­é€”æ”¾å¼ƒï¼‰ï¼Œä¹‹åå†ä¸æ–­è¿­ä»£ç›´è‡³è‡ªå·±æ»¡æ„ï¼Œå› æ­¤è¿™ä¸ªè¿‡ç¨‹ä¸­å¯èƒ½ä¼šæœ‰ä¸€äº›ä¸å¤Ÿåå…¨åç¾çš„åœ°æ–¹ï¼Œè¿˜æœ›è§è°…ã€‚</p><p>ä»£ç åœ°å€ï¼š<a href="https://github.com/KNighD/merge-diffs">https://github.com/KNighD/merge-diffs</a></p><h4 id="æŠ€æœ¯æ ˆ"><a href="#æŠ€æœ¯æ ˆ" class="headerlink" title="æŠ€æœ¯æ ˆ"></a>æŠ€æœ¯æ ˆ</h4><p>è¿™é‡Œæˆ‘é€‰æ‹©ä½¿ç”¨ Typescript æ¥å®ç°æ’ä»¶ï¼Œè¦è¯´åŸå› ï¼Œä¸»è¦æ˜¯å¯ä»¥æç¤ºå‚æ•°ç±»å‹å§ï¼Œæ¯•ç«Ÿä¸å¤ªç†Ÿæ‚‰æ–‡æ¡£ã€‚</p><p>ç”±äºå­˜åœ¨è¾“å…¥æ—¶é—´ä¹‹ç±»çš„äº¤äº’ï¼Œå› æ­¤è¿˜æ˜¯éœ€è¦ä½¿ç”¨åˆ° webview çš„ï¼Œhtml éƒ¨åˆ†è€ƒè™‘ä½¿ç”¨ vue3 æ¥å®ç°ï¼ˆè™½ç„¶react å†™èµ·æ¥æ›´ç†Ÿæ‚‰ï¼Œä½†æ˜¯æƒ³æŠ˜è…¾ä¸€ä¸‹ï¼‰</p><p>æ€»ä½“çš„æƒ³æ³•æ˜¯åœ¨é¡µé¢è¾“å…¥æŸ¥è¯¢æ¡ä»¶ï¼Œç„¶ååœ¨ä¸ node ç«¯è¿›è¡Œé€šä¿¡ï¼Œæ‰§è¡Œå‘½ä»¤æŸ¥è¯¢å‡ºç»“æœå¤„ç†å®Œæˆåå›ä¼ ç»™é¡µé¢å¹¶åšå±•ç¤ºã€‚ç•Œé¢ UI çš„è¯å°±å‚è€ƒ Git Historyã€‚</p><h4 id="åˆå§‹åŒ–é¡¹ç›®"><a href="#åˆå§‹åŒ–é¡¹ç›®" class="headerlink" title="åˆå§‹åŒ–é¡¹ç›®"></a>åˆå§‹åŒ–é¡¹ç›®</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&#x2F;&#x2F; å®‰è£…è„šæ‰‹æ¶npm install -g yo generator-code&#x2F;&#x2F; ç”Ÿæˆæ¨¡æ¿ä»£ç yo code</code></pre><p>é¢˜å¤–è¯ï¼šgithub ä¸Šçš„ä¸»åˆ†æ”¯å·²ç»æ”¹å« main äº†ã€‚ã€‚</p><h4 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h4><p>åˆå§‹ä»£ç æ¨¡æ¿å…¥å£æ˜¯ <code>src/extension.ts</code>ï¼ŒåŠŸèƒ½å°±æ˜¯åœ¨å‘½ä»¤é¢æ¿è¾“å…¥ <code>Hello World</code>ï¼Œå°†ä¼šå¼¹å‡ºä¸€å¥æç¤ºã€‚</p><p>ç”¨ vscode æ‰“å¼€ç”Ÿæˆçš„é¡¹ç›®ï¼ŒæŒ‰ F5 å°†ä¼šå¼¹å‡ºä¸€ä¸ªæ–°çª—å£ï¼Œåœ¨æ–°çª—å£çš„å‘½ä»¤é¢æ¿è¾“å…¥ <code>Hello World</code>ï¼Œå¦‚æœå¼¹å‡ºä¸€å¥æç¤ºï¼Œå°±è¡¨æ˜é¡¹ç›®åˆå§‹åŒ–æˆåŠŸäº†ã€‚</p><h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; package.json&#123;  &quot;activationEvents&quot;: [  &#x2F;&#x2F; å½“å‘½ä»¤è¿è¡Œæ—¶å¯åŠ¨      &quot;onCommand:merge-logs.showMergeLogs&quot;    ],    &quot;contributes&quot;: &#123;      &quot;commands&quot;: [      &#x2F;&#x2F; å®šä¹‰å‘½ä»¤        &#123;          &quot;command&quot;: &quot;merge-logs.showMergeLogs&quot;,          &#x2F;&#x2F; å‘½ä»¤é¢æ¿ä¸Šå±•ç¤ºçš„          &quot;title&quot;: &quot;MergeLogs: show&quot;        &#125;      ]    &#125;&#125;</code></pre><h4 id="æ‰“å¼€ä¸€ä¸ª-webview"><a href="#æ‰“å¼€ä¸€ä¸ª-webview" class="headerlink" title="æ‰“å¼€ä¸€ä¸ª webview"></a>æ‰“å¼€ä¸€ä¸ª webview</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">let show &#x3D; vscode.commands.registerCommand(&#39;merge-logs.showMergeLogs&#39;, () &#x3D;&gt; &#123;    const panel &#x3D; vscode.window.createWebviewPanel(      &#39;testWebview&#39;,      &#x2F;&#x2F; title      &#39;MergeLogs&#39;,      &#x2F;&#x2F; æ˜¾ç¤ºåœ¨ç¼–è¾‘å™¨çš„å“ªä¸ªéƒ¨ä½      vscode.ViewColumn.One,      &#123;        &#x2F;&#x2F; å¯ç”¨JSï¼Œé»˜è®¤ç¦ç”¨        enableScripts: true,        &#x2F;&#x2F; webviewè¢«éšè—æ—¶ä¿æŒçŠ¶æ€ï¼Œé¿å…è¢«é‡ç½®        retainContextWhenHidden: true,      &#125;    )    panel.webview.html &#x3D; &#96;&lt;html&gt;&lt;body&gt;test merge logs&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;&#96;  &#125;)  context.subscriptions.push(show)</code></pre><p>WebView åŠ è½½çš„èµ„æºè·¯å¾„å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•è·å–</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">const getRelativeResource &#x3D; (webview: Webview, relativePath: string) &#x3D;&gt; &#123;  return webview.asWebviewUri(Uri.file(path.join(context.extensionPath, relativePath)));&#125;;panel.webview.html &#x3D; &#96;&lt;html&gt;&lt;head&gt;&lt;script src&#x3D;&#39;$&#123;getRelativeResource(panel.webview, &#39;.&#x2F;test.js&#39;)&#125;&#39;&gt;&lt;&#x2F;script&gt;&lt;&#x2F;head&gt;&lt;body&gt;test merge logs&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;&#96;;&#125;);</code></pre><p>è°ƒè¯•çš„æ—¶å€™éœ€è¦åœ¨å¼€å‘çª—å£æ‰“å¼€å‘½ä»¤é¢æ¿ï¼Œè¾“å…¥ <code>Open Webview Developer Tools</code> </p><h4 id="å¼€å‘-web-é¡µé¢"><a href="#å¼€å‘-web-é¡µé¢" class="headerlink" title="å¼€å‘ web é¡µé¢"></a>å¼€å‘ web é¡µé¢</h4><p>æˆ‘å°† web é¡µé¢æ”¾åœ¨ /client ç›®å½•ä¸‹</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">npm init vite-app client cd clientnpm i</code></pre><p>é¡¹ç›®æ˜¯åŸºäº Typescript çš„ï¼Œè€Œ client æ˜¯ vueï¼Œæ­¤æ—¶æ ¹ç›®å½•çš„ eslint ä¼šæŠ¥é”™ï¼Œæˆ‘ä»¬å…ˆå°† client ç›®å½•ä¸‹çš„æ–‡ä»¶å¿½ç•¥æ‰,å°†æ¥åœ¨ client ä¸­å•ç‹¬æ·»åŠ  eslintã€‚</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; .eslint.json&quot;ignorePatterns&quot;: [&quot;&#x2F;client&quot;]</code></pre><p>é¡¹ç›®æ‰“åŒ…åèµ„æºæ–‡ä»¶ä¼šå¸¦ä¸Š hash å€¼ï¼ŒæŒ‰ç…§ webpack çš„ç»éªŒï¼Œåº”è¯¥å¯ä»¥é‡‡å–ä¸¤ç§å¤„ç†æ–¹å¼ï¼š</p><ol><li>ä¿®æ”¹æ‰“åŒ…é…ç½®å°† public path æ›¿æ¢æˆ getRelativeResource åè·å–åˆ°çš„åœ°å€, åŠ¨æ€è¯»å–æ‰“åŒ…åçš„ html</li><li>webview å†™æ­» html æ¨¡æ¿ï¼Œä¿®æ”¹æ‰“åŒ…é…ç½®ï¼Œè®©æ‰“åŒ…åçš„èµ„æºä¸å¸¦ hash,è§ <a href="https://github.com/vitejs/vite/issues/378">https://github.com/vitejs/vite/issues/378</a></li></ol><p>è¿™é‡Œé‡‡ç”¨ç¬¬äºŒç§æ–¹æ¡ˆï¼Œåœ¨ client ä¸‹æ·»åŠ  <code>vite.config.js</code> </p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; vite.config.jsexport default &#123;  rollupOutputOptions: &#123;    entryFileNames: &#96;[name].js&#96;,    chunkFileNames: &#96;[name].js&#96;,    assetFileNames: &#96;[name].[ext]&#96;,  &#125;,&#125;</code></pre><p>ğŸ¤”ä¸è¿‡è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè°ƒè¯•èµ·æ¥éå¸¸éº»çƒ¦ï¼Œæ¯æ¬¡ä¿®æ”¹å®Œéƒ½éœ€è¦ build ä¸€ä¸‹</p><h4 id="å®ç°ç®€å•é€šä¿¡"><a href="#å®ç°ç®€å•é€šä¿¡" class="headerlink" title="å®ç°ç®€å•é€šä¿¡"></a>å®ç°ç®€å•é€šä¿¡</h4><p>åœ¨é¡µé¢ä¸Šæ·»åŠ ä¸€ä¸ªç®€å•çš„æŒ‰é’®ï¼Œç‚¹å‡»è¿™ä¸ªæŒ‰é’®åï¼Œå°†ä¼šå‘ä¸€ä¸ª getLogs çš„å‘½ä»¤ç»™æ’ä»¶ç«¯ï¼Œæ’ä»¶ç«¯æ¥æ”¶ä¹‹åï¼Œæ‰§è¡Œ <code>git log</code>,å¹¶è¿”å›ç»“æœã€‚</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&#x2F;&#x2F; App.vue&lt;template&gt;  &lt;button @click&#x3D;&quot;sendMessage&quot;&gt;sendMessage&lt;&#x2F;button&gt;&lt;&#x2F;template&gt;&lt;script&gt;export default &#123;  data() &#123;    return &#123;      vscode: null,    &#125;  &#125;,  mounted() &#123;    &#x2F;&#x2F; åˆå§‹åŒ– vscode å¯¹è±¡    this.vscode &#x3D; acquireVsCodeApi()    &#x2F;&#x2F; ç›‘å¬æ¥è‡ª vscode æ’ä»¶çš„ä¿¡æ¯    window.addEventListener(&#39;message&#39;, (event) &#x3D;&gt; &#123;      const message &#x3D; event.data      console.log(message)    &#125;)  &#125;,  methods: &#123;    sendMessage() &#123;      &#x2F;&#x2F; å‘é€æ¶ˆæ¯ç»™æ’ä»¶      this.vscode.postMessage(&#39;getLogs&#39;)    &#125;,  &#125;,&#125;&lt;&#x2F;script&gt;</code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; æ’ä»¶ç«¯æ¥æ”¶åˆ°æ¶ˆæ¯panel.webview.onDidReceiveMessage(  async (message) &#x3D;&gt; &#123;    if (message &#x3D;&#x3D;&#x3D; &#39;getLogs&#39;) &#123;      try &#123;        const logs &#x3D; await getLogs();        panel.webview.postMessage(logs);      &#125; catch (error) &#123;        panel.webview.postMessage(error);      &#125;    &#125;  &#125;,  undefined,  context.subscriptions);&#125;</code></pre><p>ä½¿ç”¨ <code>child_process</code> å¹¶æ‰§è¡Œ node å‘½ä»¤ï¼Œå¹¶å°è£…æˆ Promiseï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const getLogs &#x3D; () &#x3D;&gt; &#123;  return new Promise((resolve, reject) &#x3D;&gt; &#123;    cp.exec(      &#96;git log&#96;,      (err: Error, stdout: string, stderr: string) &#x3D;&gt; &#123;        if (stderr || err) &#123;          return reject(stderr || err);        &#125;        return resolve(stdout);      &#125;    );  &#125;);&#125;;</code></pre><p>âš ï¸ ç”±äº exec ä¼šè¡ç”Ÿå­ shellï¼Œå› æ­¤åœ¨æ¯æ¬¡æ‰§è¡Œ shell å‘½ä»¤æ—¶è¦ç¡®è®¤å½“å‰çš„è·¯å¾„æ˜¯å¦æ­£ç¡®ã€‚</p><p>è‡³æ­¤ä¸€ä¸ªå¤§ä½“çš„æ¡†æ¶å°±å®Œæˆäº†ã€‚</p><p>åç»­çš„å¼€å‘ä¸»è¦æ˜¯ç”¨ <code>git branch --merged</code> æŸ¥è¯¢åˆ†æ”¯åˆå¹¶æƒ…å†µï¼Œç„¶ååˆ†åˆ«å¯¹æ¯”ä¸¤ä¸ªåˆ†æ”¯çš„åˆå¹¶åˆ†æ”¯çš„å¼‚åŒï¼Œå¹¶å±•ç¤ºåˆ°é¡µé¢ä¸Šï¼Œè¿™é‡Œä¸è¿›è¡Œèµ˜è¿°ã€‚</p><h4 id="æ·»åŠ -UI-ç»„ä»¶åº“"><a href="#æ·»åŠ -UI-ç»„ä»¶åº“" class="headerlink" title="æ·»åŠ  UI ç»„ä»¶åº“"></a>æ·»åŠ  UI ç»„ä»¶åº“</h4><p>ç»„ä»¶åº“è¿™é‡Œçœ‹åˆ° ant-desin-vue æ”¯æŒ vue3 äº†ï¼Œæ‰“ç®—è¯•è¯•ã€‚ç‰ˆæœ¬éœ€è¦ 2.0.0-beta.5 åŠä»¥ä¸Šã€‚</p><p>æŒ‰éœ€å¼•å…¥ï¼ŒåŸå…ˆæ˜¯æ˜¯ç”¨ babel-plugin-import æ¥å¤„ç†çš„ï¼Œä¸è¿‡è¿˜æ²¡ç ”ç©¶å¦‚ä½•åœ¨ vite ä¸­æ·»åŠ ï¼Œå°±æ‰“ç®—ä½¿ç”¨ <code>import Button from &#39;ant-design-vue/lib/button&#39;;</code> è¿™æ ·çš„å†™æ³•ï¼Œç„¶è€Œè¿è¡Œçš„æ—¶å€™ï¼Œvite ä¼šæç¤º:</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[vite] Avoid deep import &quot;ant-design-vue&#x2F;lib&#x2F;button&quot; (imported by &#x2F;src&#x2F;main.js)because &quot;ant-design-vue&quot; has been pre-optimized by vite into a single file.Prefer importing directly from the module entry:import &#123; ... &#125; from &quot;ant-design-vue&quot; If the dependency requires deep import to function properly, add the deep path to optimizeDeps.include in vite.config.js.</code></pre><p>æ„æ€æ˜¯ vite å·²ç»åšäº†æŒ‰éœ€å¼•å…¥çš„ä¼˜åŒ–äº†ï¼Œé‚£ä¹ˆåº”è¯¥ç›´æ¥å¯¼å…¥å°±å¥½äº†ã€‚</p><h4 id="vue3-çš„-eslint-é…ç½®"><a href="#vue3-çš„-eslint-é…ç½®" class="headerlink" title="vue3 çš„ eslint é…ç½®"></a>vue3 çš„ eslint é…ç½®</h4><p>å¡«ä¹‹å‰çš„å‘ï¼Œé¡ºä¾¿è¡¥ä¸Š prettier é…ç½®ï¼Œæœ€ç»ˆæ ¹ç›®å½•çš„ eslint é…ç½®å¦‚ä¸‹</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">&#123;  &quot;root&quot;: true,  &quot;parser&quot;: &quot;vue-eslint-parser&quot;,  &quot;parserOptions&quot;: &#123;    &quot;parser&quot;: &quot;@typescript-eslint&#x2F;parser&quot;,    &quot;ecmaVersion&quot;: 6,    &quot;sourceType&quot;: &quot;module&quot;  &#125;,  &quot;extends&quot;: [&quot;plugin:vue&#x2F;vue3-recommended&quot;],  &quot;plugins&quot;: [&quot;@typescript-eslint&quot;, &quot;prettier&quot;],  &quot;rules&quot;: &#123;    &quot;@typescript-eslint&#x2F;naming-convention&quot;: &quot;warn&quot;,    &quot;curly&quot;: &quot;warn&quot;,    &quot;eqeqeq&quot;: &quot;warn&quot;,    &quot;no-throw-literal&quot;: &quot;warn&quot;,    &quot;semi&quot;: &quot;off&quot;,    &quot;vue&#x2F;singleline-html-element-content-newline&quot;: &quot;off&quot;  &#125;&#125;</code></pre><h4 id="vite-åˆ«å"><a href="#vite-åˆ«å" class="headerlink" title="vite åˆ«å"></a>vite åˆ«å</h4><p>ç›®å‰ä¼¼ä¹æ²¡æœ‰æ”¯æŒå¤šç›®å½• vue é¡¹ç›®çš„ vscode æ’ä»¶ï¼Œè§ <a href="https://github.com/vuejs/vetur/issues/424ã€‚æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯">https://github.com/vuejs/vetur/issues/424ã€‚æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯</a> veturï¼Œä¸ºäº†é¿å…æŠ¥é”™ï¼Œåœ¨ vite ä¸­é…ç½® aliasã€‚ï¼ˆåæ§½ä¸€ä¸‹ï¼šæ€»è§‰å¾— vscode / ts å¯¹ react çš„æ”¯æŒè¿˜æ˜¯æ¯” vue è¦å¥½ä¸Šä¸å°‘çš„ï¼‰</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">alias: &#123;  &#x2F;&#x2F; import useInit from &#39;&#x2F;@&#x2F;composables&#x2F;useInit&#39;  &#39;&#x2F;@&#x2F;&#39;: path.resolve(__dirname, &#39;.&#x2F;src&#x2F;&#39;),&#125;</code></pre><h4 id="å‘å¸ƒ"><a href="#å‘å¸ƒ" class="headerlink" title="å‘å¸ƒ"></a>å‘å¸ƒ</h4><p>ç”±äºè¾“å‡ºå®‰è£…åŒ…æ—¶æ— éœ€ç”¨åˆ° client çš„æºç ï¼Œå› æ­¤å¯ä»¥åœ¨ .vscodeignore ä¸­åŠ å…¥ clientï¼ŒåŒæ—¶ä¿®æ”¹ vite çš„è¾“å‡ºç›®å½•ï¼Œä»¥åŠæ’ä»¶ä¸­å¼•ç”¨ client èµ„æºçš„ç›®å½•ã€‚</p><p>å¦‚æœæ­¤å‰æ²¡æœ‰å‘å¸ƒè¿‡ï¼Œå¯ä»¥å‚è€ƒ <a href="https://code.visualstudio.com/api/working-with-extensions/publishing-extension#publishing-extensionsã€‚">https://code.visualstudio.com/api/working-with-extensions/publishing-extension#publishing-extensionsã€‚</a></p><p>éœ€è¦åœ¨ package.json ä¸­æ·»åŠ  <code>publisher name</code> å’Œ <code>repository</code>ï¼Œè¿è¡Œ <code>vsce package</code> å¯ä»¥æ‰“å‡ºä¸€ä¸ª .vsix çš„æ‹“å±•åŒ…ç”¨äºå®‰è£…ã€‚</p><p>å¦‚æœæ­¤å‰æœ‰å‘å¸ƒè¿‡æ’ä»¶ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½ä¸ªäººè®¿é—®ä»¤ç‰Œå·²ç»å¤±æ•ˆäº†ï¼Œéœ€è¦åˆ° <a href="https://aka.ms/SignupAzureDevOps">https://aka.ms/SignupAzureDevOps</a> ä¸Šé‡æ–°åˆ›å»ºæ–°çš„ä¸ªäººè®¿é—®ä»¤ç‰Œã€‚</p><p>åˆ›å»ºä¸ªäººè®¿é—®ä»¤ç‰Œè¦æ³¨æ„<code>Organization</code>è¦é€‰æ‹©<code>all accessible organizations</code>ï¼Œ<code>Scopes</code>è¦é€‰æ‹©<code>Full access</code>ï¼Œå¦åˆ™å‘å¸ƒä¼šå¤±è´¥ã€‚</p><p>ä¹‹åæ·»åŠ ä¸€ä¸‹ icon ï¼Œå†è¡¥å…¨ä¸€ä¸‹ README å°±å¯ä»¥å‘å¸ƒäº†</p><pre class="line-numbers language-none"><code class="language-none">vsce publish</code></pre><h4 id="æ„Ÿæƒ³"><a href="#æ„Ÿæƒ³" class="headerlink" title="æ„Ÿæƒ³"></a>æ„Ÿæƒ³</h4><p>ä»¥ä¸‹ä¸ºä¸ªäººè§‚ç‚¹ï¼šæ€»ä½“ä¸Šæ„Ÿè§‰ Vue3 çš„ç»„åˆå¼ api å’Œ react çš„ hooks æƒ³åšçš„éƒ½æ˜¯åŒä¸€ä»¶äº‹ï¼šå°†åŸå…ˆè·Ÿç”Ÿå‘½å‘¨æœŸç»‘å®šåœ¨ä¸€èµ·çš„é€»è¾‘æŠ½ç¦»å‡ºæ¥ï¼Œä½¿å¾—ä»£ç çš„å…³æ³¨ç‚¹æ›´ä¸ºæ¸…æ™°ï¼ŒåŒæ—¶ä¹Ÿæ›´æ˜“äºå¤ç”¨ï¼Œä½œä¸º hoc / mixins çš„ä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆã€‚</p><p>ä¸åŒç‚¹æ˜¯ react æ˜¯è¶Šæ¥è¶Šåå‘å‡½æ•°å¼ï¼Œæ¯”å¦‚ useEffect å®Œå…¨è„±ç¦»äº†ç”Ÿå‘½å‘¨æœŸçš„æ¦‚å¿µï¼Œå£°æ˜å¼ç¼–ç¨‹ã€‚è€Œ vue ä¾ç„¶æ˜¯å‘½ä»¤å¼ï¼Œæä¾›äº†onMounted ä¹‹ç±»çš„ apiã€‚</p><p>è‡³äº vite è¿˜æ²¡ä»”ç»†å»ç ”ç©¶ï¼Œä¸è¿‡é…ç½®ç¡®å®æ˜¯å°‘äº†å¾ˆå¤šï¼Œæ›´å®¹æ˜“ä¸Šæ‰‹çš„æ ·å­ï¼Œä¼¼ä¹æ˜¯åŸºäº rollup ï¼Ÿè¿˜æœ‰å¾…è¸©å‘ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> VSCodeæ’ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RNç€‘å¸ƒæµ</title>
      <link href="/2020/10/20/RN%E7%80%91%E5%B8%83%E6%B5%81/"/>
      <url>/2020/10/20/RN%E7%80%91%E5%B8%83%E6%B5%81/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>ç”µå•†ä»¥åŠå›¾ç‰‡ç½‘ç«™ç»å¸¸å¯ä»¥çœ‹åˆ°ç€‘å¸ƒæµçš„åˆ—è¡¨ï¼Œå³å¤šåˆ—ç­‰å®½çš„åˆ—è¡¨ï¼Œä½†æ˜¯æ¯ä¸€åˆ—ä¸­çš„å…ƒç´ é«˜åº¦ä¸ä¸€å®šä¸€è‡´ã€‚è¿™åœ¨ web æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„è®¾è®¡ä¸”æœ‰å¾ˆå¤šç»„ä»¶å¯ä¾›ä½¿ç”¨ï¼Œè€Œåœ¨ ReactNative ä¸­ï¼Œå°‘æœ‰æˆç†Ÿçš„ç€‘å¸ƒæµç»„ä»¶ï¼Œå¤§å¤šæ•°ç»„ä»¶è¦ä¹ˆæ˜¯å¤šå¹´å‰ç»´æŠ¤çš„ï¼Œè¦ä¹ˆ star æ•°è¾ƒå°‘ï¼Œæˆ–è€…å¹²è„†æœ‰ä¸€äº›ä¸ç»´æŠ¤äº†ï¼Œæ€»ä¹‹å°±æ˜¯ç”¨ç€ä¸æ”¾å¿ƒã€‚å› æ­¤åœ¨äº§å“åŒå­¦çš„è¦æ±‚ä¸‹ï¼Œå®ç°äº†ä¸€ä¸ª RN ç€‘å¸ƒæµç»„ä»¶ã€‚è¿™é‡Œåªè®°å½•æ€è·¯ï¼Œå…·ä½“ä»£ç åé¢æ·»åŠ äº†è¾ƒå¤šä¸šåŠ¡ç›¸å…³çš„ï¼Œå°±ä¸è´´äº†ã€‚</p><a id="more"></a><h4 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h4><ol><li><p>æ”¯æŒä¸Šæ‹‰åŠ è½½ï¼Œä¸‹æ‹‰åˆ·æ–°</p></li><li><p>æ”¯æŒå¤šåˆ—å¯å®šåˆ¶</p></li><li><p>æ€§èƒ½å°½é‡å¥½</p></li><li><p>è‡ªå®šä¹‰å…ƒç´ </p></li></ol><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><ol><li><p>æ•´ä¸ªç€‘å¸ƒæµé€šè¿‡ FlatList æ¥å®ç°ï¼Œé€šè¿‡è®¾ç½® columnsNum ä¸ renderItemï¼Œå°†æ¯ä¸€åˆ—åˆåˆ†åˆ«æ¸²æŸ“æˆä¸€ä¸ª FlatListã€‚å†…å±‚å¹¶åˆ—çš„ FlatList å°†ä¼šæ’‘å¼€ä¸”ä¸ä¼šäº§ç”Ÿå¤šä½™çš„æ»šåŠ¨æ¡ï¼Œæ»šåŠ¨æ—¶æ˜¯å¤–å±‚çš„ FlatListã€‚</p></li><li><p>æ¥æ”¶ data æ—¶ï¼Œåˆ¤æ–­æ¯ä¸€é¡¹åº”è¯¥å±äºå“ªä¸€åˆ—ï¼Œ å¦‚æœé¡¹çš„é«˜åº¦ä¸èƒ½æå‰è·å¾—ï¼Œé‚£ä¹ˆè¦åœ¨é¡¹çš„ onLayout æ—¶è·å–é«˜åº¦ï¼Œä¹‹ååˆ¤æ–­ä¸‹ä¸€é¡¹å±äºå“ªä¸€åˆ—</p></li><li><p>ä¸‹æ‹‰é‡‡ç”¨ RN æä¾›çš„ RefreshControl å°±å¯ä»¥å®Œæˆï¼Œè€Œä¸Šæ‹‰çš„äº‹ä»¶ï¼Œå•åˆ—è¡¨å¯ä»¥é€šè¿‡ onReachEnd è§¦å‘ï¼Œè€Œå¯¹äºæˆ‘ä»¬è¿™ç§å®ç°æ–¹å¼åˆ™åªèƒ½é€šè¿‡ onScroll è‡ªè¡Œåˆ¤æ–­æ˜¯å¦åˆ°è¾¾åº•éƒ¨</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; ç”±äº onEndReached åœ¨æ¸²æŸ“ data é¡¹æ—¶ä¼šå¤šæ¬¡è§¦å‘ï¼Œä¸” props åŠ state æœªå˜åŒ–æ—¶ä¸ä¼šè§¦å‘ï¼Œå› æ­¤è‡ªè¡Œå®ç°const handleScroll &#x3D; (event: NativeSyntheticEvent&lt;NativeScrollEvent&gt;) &#x3D;&gt; &#123;  const &#123;    nativeEvent: &#123;      contentOffset: &#123; y: scrollTop &#125;,      contentSize: &#123; height: scrollHeight &#125;,      layoutMeasurement: &#123; height &#125;,    &#125;,  &#125; &#x3D; event;  if (scrollHeight - height - scrollTop &lt;&#x3D; onEndReachedThreshold) &#123;    if (onEndReached) &#123;      onEndReached(event);    &#125;  &#125;  if (props.onScroll) &#123;    props.onScroll(event);  &#125;&#125;;</code></pre></li></ol><p>è¿™æ ·ä¸€ä¸ªç®€å•çš„ ç€‘å¸ƒæµå°±å®Œæˆäº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ReactNative </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>react-native é€šè®¯å½•å­—æ¯åˆ—è¡¨</title>
      <link href="/2020/09/22/react-native-%E9%80%9A%E8%AE%AF%E5%BD%95%E5%AD%97%E6%AF%8D%E5%88%97%E8%A1%A8/"/>
      <url>/2020/09/22/react-native-%E9%80%9A%E8%AE%AF%E5%BD%95%E5%AD%97%E6%AF%8D%E5%88%97%E8%A1%A8/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>éœ€æ±‚ï¼šå®ç°ä¸€ä¸ªé€‰æ‹©å¿«é€’çš„é¡µé¢ï¼Œæ“ä½œç±»ä¼¼äºé€šè®¯å½•ï¼Œè®¾è®¡å›¾å¦‚ä¸‹</p><img src="https://i.loli.net/2020/10/20/OwH5A3bRgSuiBKt.png" alt="image.png" style="zoom: 50%"><p>ä¸ŠåŠéƒ¨åˆ†çš„æœç´¢äº¤äº’åŠå®ç°è¿™é‡Œå°±ä¸èµ˜è¿°ï¼Œé‡ç‚¹æ¢è®¨å­—æ¯åˆ—è¡¨çš„å®ç°ã€‚</p><a id="more"></a><p>éœ€è¦å®ç°çš„ç‚¹ï¼š</p><ol><li>ä¸»åˆ—è¡¨åˆ†ç»„ï¼Œå¤´éƒ¨ä¸å¸é¡¶</li><li>å­—æ¯åˆ—è¡¨å¯ä»¥æ»‘åŠ¨æˆ–ç‚¹å‡»ï¼Œå˜æ›´å½“å‰é€‰ä¸­çš„å­—æ¯ï¼Œä¸”ä¸»åˆ—è¡¨è·Ÿéšæ»‘åŠ¨å®šä½</li><li>ä¸»åˆ—è¡¨æ»šåŠ¨æ—¶ï¼Œå­—æ¯åˆ—è¡¨å½“å‰é€‰ä¸­çš„å­—æ¯å¯¹åº”å˜åŒ–</li></ol><p>æœç´¢äº†ç›®å‰å·²æœ‰çš„å¼€æºç»„ä»¶ï¼Œè¦ä¹ˆæœ€åä¸€æ¬¡æ›´æ–°çš„æ—¶é—´ä¹Ÿæ¯”è¾ƒä¹…è¿œï¼Œè¦ä¹ˆä¸é€‚ç”¨äºæˆ‘ä»¬çš„åœºæ™¯ï¼Œè¦ä¹ˆ star æ•°é‡ä¸å¤š ğŸ˜‚ã€‚å› æ­¤æ‰“ç®—é‡æ–°é€ ä¸ªè½®å­ï¼Œå³ä½¿å°†æ¥æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä¹Ÿèƒ½è‡ªè¡Œç»´æŠ¤ã€‚</p><h4 id="AlphabetList"><a href="#AlphabetList" class="headerlink" title="AlphabetList"></a>AlphabetList</h4><p>å°†æˆ‘ä»¬çš„ç»„ä»¶å‘½åä¸º AlphabetListï¼Œå®ƒå°†æ¥æ”¶ä¸€ä¸ª dataSource ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">&lt;AlphabetList dataSource&#x3D;&#123;dataSource&#125; &#x2F;&gt;</code></pre><p>dataSource çš„ç»“æ„å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">interface IListItem &#123;  name: string;  value: string | number;&#125;interface ISectionItem &#123;sectionKey: string;data: &#123;name: string;value: string&#125;[]&#125;interface DataSource: SectionItem[]</code></pre><p>ä¾‹å¦‚ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">[  &#123;    sectionKey: &#39;å¸¸&#39;,    data: [      &#123;        name: &#39;é¡ºä¸°ç‰©æµ&#39;,        value: &#39;1&#39;,      &#125;,      &#123;        name: &#39;äº¬ä¸œå¿«é€’&#39;,        value: &#39;2&#39;,      &#125;,    ],  &#125;,  &#123;    sectionKey: &#39;A&#39;,    data: [      &#123;        name: &#39;å®‰èƒ½ç‰©æµ&#39;,        value: &#39;3&#39;,      &#125;,      &#123;        name: &#39;æ¾³å¤§åˆ©äºšé‚®æ”¿&#39;,        value: &#39;4&#39;,      &#125;,    ],  &#125;]</code></pre><p>AlphabetList çš„ç»“æ„å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">&lt;View&gt;  &#123;&#x2F;* ä¸»åˆ—è¡¨ *&#x2F;&#125;  &lt;MainList &#x2F;&gt;  &#123;&#x2F;* å³ä¾§å­—æ¯åˆ—è¡¨ *&#x2F;&#125;  &lt;SideBar &#x2F;&gt;&lt;&#x2F;View&gt;</code></pre><h4 id="MainList"><a href="#MainList" class="headerlink" title="MainList"></a>MainList</h4><p>ä¸»åˆ—è¡¨åˆ†ç»„ Mainï¼Œé‚£ä¹ˆä½¿ç”¨ SectionList æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ç”¨ FlatList æ¥å®ç°ï¼‰</p><p>å½“æ»šåŠ¨ MainList æ—¶ï¼Œé€šè¿‡ <code>onListViewableItemsChanged</code> çš„å›è°ƒå¯ä»¥å¾—åˆ°å½“å‰çª—å£å¯è§†çš„åˆ†ç»„ï¼Œä»è€Œæ”¹å˜å½“å‰é€‰ä¸­çš„å­—æ¯</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const MainList &#x3D; (&#123;    dataSource,    onMainListViewableItemsChanged,  &#125;) &#x3D;&gt; &#123;  return (    &lt;SectionList      renderItem&#x3D;&#123;(&#123; item &#125;) &#x3D;&gt; (&lt;ListItem item&#x3D;&#123;item&#125; &#x2F;&gt;)&#125;      renderSectionHeader&#x3D;&#123;(&#123; section &#125;) &#x3D;&gt; &lt;SectionHeader section&#x3D;&#123;section&#125; &#x2F;&gt;&#125;      keyExtractor&#x3D;&#123;(item) &#x3D;&gt; &#96;$&#123;item.value&#125;&#96;&#125;      sections&#x3D;&#123;dataSource&#125;      stickySectionHeadersEnabled&#x3D;&#123;false&#125;      onViewableItemsChanged&#x3D;&#123;onMainListViewableItemsChanged&#125;    &#x2F;&gt;  );&#125;;export default MainList;</code></pre><p>åœ¨ AlphabetList ä¸­ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const AlphabetList &#x3D; (&#123; dataSource &#125;: IProps) &#x3D;&gt; &#123;  &#x2F;&#x2F; å³ä¾§å­—æ¯è¡¨åˆ—è¡¨  const letterlist &#x3D; dataSource.map((item) &#x3D;&gt; &#123;    return item.sectionKey;  &#125;);  const [currentSectionKey, setCurrentSectionKey] &#x3D; useState(letterlist);  const onMainListViewableItemsChanged &#x3D; (info: &#123;    viewableItems: ViewToken[];  &#125;) &#x3D;&gt; &#123;    &#x2F;&#x2F; å°†é€‰ä¸­çš„å­—æ¯è®¾ç½®ä¸ºå½“å‰ç¬¬ä¸€ä¸ªå¯è§ section çš„ sectionKey    setCurrentSectionKey(info.viewableItems[0].section.sectionKey);  &#125;;  return (    &lt;View style&#x3D;&#123;styles.container&#125;&gt;      &#123;&#x2F;* ä¸»åˆ—è¡¨ start *&#x2F;&#125;      &lt;MainList        dataSource&#x3D;&#123;dataSource&#125;        onMainListTouchStart&#x3D;&#123;() &#x3D;&gt; setCurrentResponder(&#39;mainList&#39;)&#125;        onMainListViewableItemsChanged&#x3D;&#123;onMainListViewableItemsChanged&#125;      &#x2F;&gt;      &#123;&#x2F;* ä¸»åˆ—è¡¨ end *&#x2F;&#125;      &#123;&#x2F;* å³ä¾§å­—æ¯åˆ—è¡¨ start *&#x2F;&#125;      &lt;SideBar &#x2F;&gt;      &#123;&#x2F;* å³ä¾§å­—æ¯åˆ—è¡¨ end *&#x2F;&#125;    &lt;&#x2F;View&gt;  );&#125;;export default AlphabetList;</code></pre><h4 id="SideBar"><a href="#SideBar" class="headerlink" title="SideBar"></a>SideBar</h4><p>ä¾§è¾¹æ çš„å®ç°æ¯”èµ·æ¥åˆ™è¦å¤æ‚ä¸€äº›ï¼Œè¿™é‡Œä½¿ç”¨ä¸€ä¸ªç»å¯¹å®šä½çš„ FlatListï¼Œå®é™…ä¸Šç®€å•ä½¿ç”¨ View å»å®ç°ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const SideBar &#x3D; (&#123;  letterlist,  &#x2F;&#x2F; å›è°ƒ  handleSideBarItemRespond,  currentSectionKey&#125;: IProps) &#x3D;&gt; &#123;  return (    &lt;FlatList      style&#x3D;&#123;styles.wrap&#125;      scrollEnabled&#x3D;&#123;false&#125;      data&#x3D;&#123;letterlist&#125;      renderItem&#x3D;&#123;(&#123; item, index &#125;) &#x3D;&gt; (        &lt;Item          item&#x3D;&#123;item&#125;          handleSideBarItemRespond&#x3D;&#123;handleSideBarItemRespond&#125;          letterlist&#x3D;&#123;letterlist&#125;        &#x2F;&gt;      )&#125;      keyExtractor&#x3D;&#123;item &#x3D;&gt; item&#125;    &#x2F;&gt;  );&#125;;</code></pre><p>ä¸€å¼€å§‹æˆ‘çš„æƒ³æ³•æ˜¯é€šè¿‡ç›‘å¬ Item çš„ onPress | onPressIn ï¼Œä»ä¸€é¡¹æ»‘åŠ¨åˆ°å¦ä¸€é¡¹çš„æ—¶å€™ï¼Œä¾æ¬¡è§¦å‘äº‹ä»¶ï¼Œå®éªŒåå‘ç°ï¼Œåœ¨é‡Šæ”¾æ‰‹åŠ¿ä¹‹å‰ï¼Œä»…ä¼šæœ‰ä¸€ä¸ªå“åº”çš„å…ƒç´ ã€‚</p><p>è¿™é‡Œå°±å¾—æä¸€ä¸‹ RN çš„æ‰‹åŠ¿ç³»ç»Ÿäº†ã€‚</p><h5 id="Responder"><a href="#Responder" class="headerlink" title="Responder"></a>Responder</h5><p>åœ¨ React Native ä¸­ï¼Œå“åº”æ‰‹åŠ¿çš„åŸºæœ¬å•ä½æ˜¯<code>responder</code>ï¼Œå¹¶ä¸”ä»…æœ‰ä¸€ä¸ª <code>responder</code> æ‹¥æœ‰æ§åˆ¶æƒã€‚åœ¨ View ä¸Šæœ‰è¿™äº›å±æ€§ï¼š</p><ol><li>onStartShouldSetResponderï¼šç‚¹å‡»æ—¶æ˜¯å¦å˜æˆä¸€ä¸ª responder</li><li>onMoveShouldSetResponderï¼šæ»‘åŠ¨æ—¶æ˜¯å¦å˜æˆä¸€ä¸ª responder</li><li>onResponderGrantï¼š ç‚¹å‡»æ—¶çš„å›è°ƒ</li><li>onResponderMoveï¼šç§»åŠ¨æ—¶çš„å›è°ƒ</li><li>onResponderTerminationRequestï¼šå½“åˆ«çš„å…ƒç´ å¸Œæœ›æˆä¸º responder æ—¶ï¼Œæ˜¯å¦è¦é‡Šæ”¾å½“å‰çš„ responderï¼Ÿ</li><li>onResponderReleaseï¼šå½“ reponder é‡Šæ”¾æ—¶çš„å›è°ƒ</li><li>ç­‰ç­‰</li></ol><p>é€šè¿‡ä¸Šè¿°è¿™äº› API æˆ‘ä»¬å°±èƒ½å¾ˆå®¹æ˜“çš„å®ç°ä¸€äº›æ‰‹åŠ¿ã€‚åˆæ¬¡ä¹‹å¤–ï¼ŒRN è¿˜æä¾›äº†æ›´é«˜çº§çš„æŠ½è±¡ PanResponderï¼Œå®ƒå¯ä»¥ç»™æˆ‘ä»¬æä¾›æ›´å¤šæ‰‹åŠ¿ä¿¡æ¯ï¼Œè¿™é‡Œä¸å±•å¼€è§£é‡Šã€‚</p><p>ä¸è¿‡å½“æˆ‘å°è¯•åœ¨æ¯ä¸ª Item ä¸Šè®¾ç½®æ‰‹åŠ¿å“åº”ï¼Œå¹¶ä¸”è®¾ç½®  onResponderTerminationRequest ä¸º <code>() =&gt; true</code>ï¼Œæ‰‹åŠ¿ä¾ç„¶æ²¡æœ‰åœ¨åˆ‡æ¢ Item æ—¶é‡Šæ”¾åŸ responderã€‚</p><p>å› æ­¤åªèƒ½é€šè¿‡è®¡ç®—é«˜åº¦æ¥è·å–æ»‘åŠ¨æ—¶å½“å‰çš„å­—æ¯</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; evt.nativeEvent.pageY: è§¦æ‘¸äº‹ä»¶çš„ pageY&#x2F;&#x2F; sideBarTop: SideBar çš„ pageY&#x2F;&#x2F; letterHeightï¼šæ¯ä¸ªå­—æ¯çš„é«˜åº¦const index &#x3D; Math.floor((evt.nativeEvent.pageY - sideBarTop) &#x2F; letterHeight);</code></pre><p>è¦è·å–å…ƒç´ è·ç¦»å±å¹•çš„é«˜åº¦ï¼Œå¯ä»¥åœ¨ onLayout çš„æ—¶å€™ï¼Œè°ƒç”¨ measure æ¥è·å–ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const SideBar &#x3D; (&#123;  letterlist,  handleSideBarItemRespond,  currentSectionKey,  letterHeight,&#125;: IProps) &#x3D;&gt; &#123;  const [sideBarTop, setSideBarTop] &#x3D; useState(0);  const sideBarRef &#x3D; useRef&lt;View&gt;(null);  const measure &#x3D; () &#x3D;&gt; &#123;    if (sideBarRef.current) &#123;      sideBarRef.current.measure((x, y, width, height, pageX, pageY) &#x3D;&gt; &#123;        setSideBarTop(pageY);      &#125;);    &#125;  &#125;;  return (    &lt;View onLayout&#x3D;&#123;measure&#125; ref&#x3D;&#123;sideBarRef&#125;&gt;      &lt;FlatList&lt;string&gt;        &#x2F;&#x2F; ...      &#x2F;&gt;    &lt;&#x2F;View&gt;  );&#125;;</code></pre><p>ç„¶åå°±æ˜¯ Item çš„å®ç°ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const Item &#x3D; (&#123;  item,  handleSideBarItemRespond,  isCurrentSectionKey,  letterlist,  letterHeight,  sideBarTop,&#125;: &#123;  item: string;  isFirst: boolean;  handleSideBarItemRespond: (item: string) &#x3D;&gt; void;  letterlist: string[];  letterHeight: number;  sideBarTop?: number;&#125;) &#x3D;&gt; &#123;  const panResponder &#x3D; PanResponder.create(&#123;    onStartShouldSetPanResponderCapture: () &#x3D;&gt; true,    onStartShouldSetPanResponder: () &#x3D;&gt; true,    &#x2F;&#x2F; å°è¯•é€šè¿‡ onResponderTerminationRequest æ¥ç»ˆæ­¢æ‰‹åŠ¿ï¼Œå‘ç°ä¸ç”Ÿæ•ˆï¼Œåªèƒ½é€šè¿‡è®¡ç®—åç§»é‡æ¥è·å–å½“å‰é€‰ä¸­    onPanResponderTerminationRequest: () &#x3D;&gt; true,    onPanResponderGrant: () &#x3D;&gt; &#123;      handleSideBarItemRespond(item);    &#125;,    onPanResponderMove: (evt, gs) &#x3D;&gt; &#123;      if (!sideBarTop) &#123;        return;      &#125;      const index &#x3D; Math.floor(        (evt.nativeEvent.pageY - sideBarTop) &#x2F; letterHeight,      );      if (index &gt;&#x3D; 0 &amp;&amp; index &lt; letterlist.length) &#123;        &#x2F;&#x2F; è§¦å‘ä¾§è¾¹å­—æ¯é€‰ä¸­çš„å›è°ƒ        handleSideBarItemRespond(letterlist[index]);      &#125;    &#125;,  &#125;);  return (    &lt;View &#123;...panResponder.panHandlers&#125;&gt;      &lt;Text&gt;        &#123;item&#125;      &lt;&#x2F;Text&gt;    &lt;&#x2F;View&gt;  );&#125;;</code></pre><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œä¾§è¾¹æ çš„é€»è¾‘å·²ç»å®Œæˆã€‚ç°åœ¨å¤„ç†ä¾§è¾¹æ äº‹ä»¶çš„å›è°ƒé€»è¾‘, ä¸»è¦é€šè¿‡ scrollToLocation æ¥å®ç°åˆ—è¡¨æ»šåŠ¨åˆ°å¯¹åº”çš„ä½ç½®</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const AlphabetList &#x3D; (&#123; dataSource, companyList, onCompanySelect &#125;: IProps) &#x3D;&gt; &#123;  &#x2F;&#x2F; ...  const mainListRef &#x3D; useRef&lt;SectionList&lt;IListItem&gt;&gt;(null);  const handleSideBarItemRespond &#x3D; (item: string) &#x3D;&gt; &#123;    if (!mainListRef.current) &#123;      return;    &#125;  &#x2F;&#x2F; è®°å½•å½“å‰é€‰ä¸­çš„å­—æ¯    setCurrentSectionKey(item);    mainListRef.current.scrollToLocation(&#123;      sectionIndex: dataSource.findIndex((data) &#x3D;&gt; data.sectionKey &#x3D;&#x3D;&#x3D; item),      itemIndex: 0,      animated: false,    &#125;);  &#125;;  return (    &lt;View style&#x3D;&#123;styles.container&#125;&gt;      &#123;&#x2F;* ä¸»åˆ—è¡¨ start *&#x2F;&#125;      &lt;MainList        &#x2F;&#x2F; ...        ref&#x3D;&#123;mainListRef&#125;      &#x2F;&gt;      &#x2F;&#x2F; ...    &lt;&#x2F;View&gt;  );&#125;;</code></pre><p>è¿™é‡Œéœ€è¦é€šè¿‡ React.forwardRef è·å–åˆ° MainList çš„ ref</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const MainList: React.ForwardRefRenderFunction&lt;  SectionList&lt;IListItem&gt;,  IProps&gt; &#x3D; (  &#123;    dataSource,    &#x2F;&#x2F; ...  &#125;,  ref,) &#x3D;&gt; &#123; &#x2F;&#x2F; ...  return (    &lt;SectionList      &#x2F;&#x2F; ...      ref&#x3D;&#123;ref&#125;    &#x2F;&gt;  );&#125;;export default React.forwardRef(MainList)</code></pre><p>åˆ°è¿™ä¸€æ­¥ï¼Œå·²ç»åŸºæœ¬å®Œæˆäº†ä¸€ä¸ªé€šè®¯å½•å­—æ¯åˆ—è¡¨ã€‚</p><h4 id="å…¶ä»–ç»†èŠ‚"><a href="#å…¶ä»–ç»†èŠ‚" class="headerlink" title="å…¶ä»–ç»†èŠ‚"></a>å…¶ä»–ç»†èŠ‚</h4><p>åœ¨å®Œæˆä¸Šè¿°åŠŸèƒ½åï¼Œç”±äºç‚¹å‡»ä¾§è¾¹æ ä¼šæ»šåŠ¨ä¸»åˆ—è¡¨ï¼Œæ­¤æ—¶ä¹Ÿä¼šè§¦å‘ MainList çš„ onViewableItemsChangedï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªæ ‡è¯†æ¥åŒºåˆ†æ˜¯ä»€ä¹ˆåŠ¨ä½œè§¦å‘çš„ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const AlphabetList &#x3D; (&#123; dataSource, companyList, onCompanySelect &#125;: IProps) &#x3D;&gt; &#123;  &#x2F;&#x2F; æ ‡è¯†ä½ï¼šç”¨äºåŒºåˆ†å½“å‰çš„æ“ä½œæ˜¯ç”±ä»€ä¹ˆè§¦å‘çš„  const [currentResponder, setCurrentResponder] &#x3D; useState(&#39;&#39;);  const mainListRef &#x3D; useRef&lt;SectionList&lt;IListItem&gt;&gt;(null);  &#x2F;&#x2F; å³ä¾§å­—æ¯è¡¨åˆ—è¡¨  const letterlist &#x3D; dataSource.map((item) &#x3D;&gt; &#123;    return item.sectionKey;  &#125;);  const [currentSectionKey, setCurrentSectionKey] &#x3D; useState(letterlist[0]);  const handleSideBarItemRespond &#x3D; (item: string) &#x3D;&gt; &#123;    if (!mainListRef.current) &#123;      return;    &#125;    setCurrentResponder(&#39;sideBar&#39;);  &#x2F;&#x2F; ...  &#125;;  const onMainListViewableItemsChanged &#x3D; (info: &#123;    viewableItems: ViewToken[];  &#125;) &#x3D;&gt; &#123;    if (      &#x2F;&#x2F; ä¾§è¾¹æ è§¦å‘çš„æ»šåŠ¨åˆ™ä¸è§¦å‘      currentResponder &#x3D;&#x3D;&#x3D; &#39;sideBar&#39; ||      !info.viewableItems[0].section.sectionKey    ) &#123;      return;    &#125;    setCurrentSectionKey(info.viewableItems[0].section.sectionKey);  &#125;;  return (    &lt;View style&#x3D;&#123;styles.container&#125;&gt;      &#123;&#x2F;* ä¸»åˆ—è¡¨ start *&#x2F;&#125;      &lt;MainList       &#x2F;&#x2F; ...        onMainListTouchStart&#x3D;&#123;() &#x3D;&gt; setCurrentResponder(&#39;mainList&#39;)&#125;        &#x2F;&#x2F; ...      &#x2F;&gt;      &#123;&#x2F;* ä¸»åˆ—è¡¨ end *&#x2F;&#125;      &#x2F;&#x2F; ...    &lt;&#x2F;View&gt;  );&#125;;</code></pre><h4 id="è¸©å‘"><a href="#è¸©å‘" class="headerlink" title="è¸©å‘"></a>è¸©å‘</h4><p>åŠŸèƒ½æ˜¯åŸºæœ¬ä¸Šå®Œæˆäº†ï¼Œç„¶è€Œç”±äºè¿™é‡Œçš„æ•°æ®é‡æ¯”è¾ƒå¤šï¼Œå¤§æ¦‚æœ‰ 600 æ¡æ•°æ®ï¼Œä¸”ç”±äº SectionList ä¹Ÿæ˜¯åŸºäº VirtualListï¼Œå› æ­¤å¯¼è‡´äº†ä»¥ä¸‹é•¿åˆ—è¡¨å›ºæœ‰çš„å‡ ä¸ªé—®é¢˜ï¼š</p><ol><li>å¿«é€Ÿæ»šåŠ¨ MainListï¼Œå½“ SectionList æ¥ä¸åŠæ¸²æŸ“æ—¶ï¼Œä¼šå¯¼è‡´å±å¹•ç©ºç™½</li><li>å½“ä½¿ç”¨ scrollToLocation æ—¶ï¼Œå¦‚æœå®šä½åˆ°æ¥ä¸åŠæ¸²æŸ“çš„åŒºåŸŸï¼Œå°†ä¼šæŠ¥é”™ï¼Œæç¤ºéœ€è¦è®¾ç½® getItemLayout å±æ€§ï¼Œè¿™ä¸ªå±æ€§æ˜¯ç”¨äºè®¡ç®—ä¸»åˆ—è¡¨æ¯ä¸€é¡¹é«˜åº¦ä»¥åŠåç§»é‡çš„</li></ol><p>åœ¨å°è¯•äº†ä¸€äº›ä¼˜åŒ–çš„æ‰‹æ®µåï¼Œå¦‚ React.memo, initialNumToRenderï¼ŒgetItemLayout ç­‰å±æ€§ä¾ç„¶æ— æ³•æœ‰æ•ˆè§£å†³ä¸Šè¿°é—®é¢˜ã€‚ã€‚</p><p>RN çš„ list çœŸçš„æ˜¯è®©äººä¸€è¨€éš¾å°½ã€‚ã€‚ä¸çŸ¥é“æ˜¯å¦åŸç”Ÿç»„ä»¶æˆ–è€… flutter å¯¹é•¿åˆ—è¡¨çš„æ”¯æŒä¼šæ›´å¥½ä¸€ç‚¹å‘¢ ğŸ˜‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ReactNative </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title> TypeScript çš„ enum ç±»å‹æ”¶çª„é—®é¢˜</title>
      <link href="/2020/09/21/TypeScript-%E7%9A%84-enum-%E7%B1%BB%E5%9E%8B%E6%94%B6%E7%AA%84%E9%97%AE%E9%A2%98/"/>
      <url>/2020/09/21/TypeScript-%E7%9A%84-enum-%E7%B1%BB%E5%9E%8B%E6%94%B6%E7%AA%84%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>åœ¨é¡¹ç›®ä¸­çœ‹åˆ°ä¸€æ®µå°ä¼™ä¼´å†™çš„ä»£ç ï¼Œç®€åŒ–åå¤§æ¦‚å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">enum A &#123;  &quot;ONE&quot; &#x3D; 1,  &quot;TWO&quot; &#x3D; 2&#125;const a &#x3D; Math.random() &gt; 0.5 ? A.ONE : A.TWOconst b &#x3D; Math.random() &gt; 0.5 ? a : 0if(b &#x3D;&#x3D;&#x3D; 1 || b &#x3D;&#x3D;&#x3D; 2) &#123;&#125;</code></pre><p>æ­¤æ—¶ï¼Œb === 2 å¤„ ts ä¼šæç¤º:</p><pre class="line-numbers language-none"><code class="language-none">This condition will always return &#39;false&#39; since the types &#39;0&#39; and &#39;2&#39; have no overlap.ts(2367)</code></pre><p>ä¸ºä½• TypeScript ä¼šæç¤º 0 ä¸ 2 æ²¡æœ‰é‡åˆçš„åœ°æ–¹å‘¢ï¼Ÿ</p><a id="more"></a><h4 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><p>é¼ æ ‡æ‚¬æµ®åœ¨ b === 1 æ—¶ï¼Œæç¤º b çš„ç±»å‹ä¸º A ï½œ 0 çš„è”åˆç±»å‹ï¼Œè€Œåˆ°äº† b === 2 æ—¶ï¼Œå´å˜æˆäº† <code>b: 0</code>ã€‚é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ TypeScript åœ¨åˆ¤æ–­ b !== 1 æ—¶ï¼Œå°±åˆ¤å®š b ä¸å¯èƒ½ä¸ºç±»å‹ Aï¼Œæ­¤æ—¶å°†ç±»å‹æ”¶çª„ä¸º 0ã€‚è€Œ 0 ä¸å¯èƒ½ assgin ç»™ 2ï¼Œå› æ­¤æŠ¥é”™ã€‚ä¸Šç½‘æœç´¢ä¼¼ä¹ä¹Ÿæ²¡æœ‰å¾—åˆ°ä¸ºä½•æ—¶è¿™ç§æ”¶çª„ç­–ç•¥çš„åŸå› ï¼Œä»…æœ‰ä¸€ä¸ªå¯èƒ½æœ‰å…³è”çš„ <a href="https://github.com/Microsoft/TypeScript/issues/9998">https://github.com/Microsoft/TypeScript/issues/9998</a> , ç„¶è€Œè‡³ä»Šè¿˜æ˜¯ open çš„ã€‚</p><h4 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h4><p>é‚£æˆ‘ä»¬è¦æ€ä¹ˆè§£å†³è¿™ä¸ªæŠ¥é”™å‘¢ï¼Ÿå®é™…ä¸Šæˆ‘ä»¬å°†åˆ¤æ–­çš„å³å€¼æ”¹æˆ enum å³å¯ï¼Œä¸”é€»è¾‘æ›´æ¸…æ™°ï¼Œç»´æŠ¤æ›´ç®€å•ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">if(b &#x3D;&#x3D;&#x3D; A.ONE || b &#x3D;&#x3D;&#x3D; A.TWO) &#123;&#x2F;&#x2F; no error&#125;</code></pre><p>æˆ–è€…ä¸‹é¢è¿™ç§ä¹Ÿå¯ä»¥ï¼ˆä¸æ˜¯å¾ˆæ¨èï¼Œæ²¡æœ‰å‘æŒ¥å‡º enum åº”æœ‰çš„ä½œç”¨ï¼‰</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">if(b as A &#x3D;&#x3D;&#x3D; 1 || b &#x3D;&#x3D;&#x3D; 0) &#123;&#x2F;&#x2F; no error&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°å½•ä¸€æ¬¡bugæ’æŸ¥</title>
      <link href="/2020/09/16/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1bug%E6%8E%92%E6%9F%A5/"/>
      <url>/2020/09/16/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1bug%E6%8E%92%E6%9F%A5/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>æµ‹è¯•åŒå­¦æäº†ä¸€ä¸ªæµ‹è¯•ç¯å¢ƒè¡¨æ ¼æ— æ³•åˆ‡æ¢æ¯é¡µæ¡æ•°çš„ bugã€‚</p><h4 id="æ’æŸ¥è¿‡ç¨‹"><a href="#æ’æŸ¥è¿‡ç¨‹" class="headerlink" title="æ’æŸ¥è¿‡ç¨‹"></a>æ’æŸ¥è¿‡ç¨‹</h4><p>åœ¨æµ‹è¯•ç¯å¢ƒæ“ä½œåå‘ç°ï¼Œç¡®å®å­˜åœ¨è¯¥é—®é¢˜ï¼Œä½†æ˜¯åˆ‡æ¢åˆ°å¯¹åº”æµ‹è¯•åˆ†æ”¯ï¼Œæœ¬åœ°è¿è¡Œï¼Œæœªèƒ½é‡ç°ã€‚</p><a id="more"></a><p>åœ¨æµ‹è¯•ç¯å¢ƒçš„æ“ä½œå‘ç°å®é™…ä¸Šåˆ‡æ¢æ¯é¡µæ¡æ•°çš„å›è°ƒ onShowSizeChange ç¡®å®ä¼šè§¦å‘ï¼Œä½†æ˜¯æ­¤ååˆå˜å›åŸæ¯é¡µæ¡æ•°ã€‚</p><p>å¯¹äºæµ‹è¯•ç¯å¢ƒä¸æœ¬åœ°å¼€å‘çš„è¡¨ç°ä¸ä¸€è‡´ï¼Œåœ¨æ’é™¤äº†å„ç§å¯èƒ½æ€§ä¹‹åï¼ŒçŒœæµ‹æ˜¯ä¾èµ–ç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡´çš„ã€‚</p><p>ç‰ˆæœ¬ä¸ä¸€è‡´å‡ºç°é—®é¢˜æ­¤å‰å·²ç»å‡ºç°è¿‡ä¸€æ¬¡ï¼šæˆ‘æœ¬åœ°çš„æœ‰æ®µä»£ç æç¤ºäº†ä¸€ä¸ª eslint çš„ no-throw-literalï¼Œä½†æ˜¯åˆ«çš„åŒäº‹éƒ½æ²¡æœ‰æŠ¥é”™ï¼Œ eslintrc çš„é…ç½®æ˜¯ä¸€æ ·çš„ã€‚æœ€ç»ˆå‘ç°æ˜¯æˆ‘çš„ umi ç‰ˆæœ¬æ¯”è¾ƒé«˜ï¼Œå…¶ä¸­ä¾èµ–çš„ @typescript-eslint/eslint-plugin åœ¨ 2.13.0 æ–°å¢äº† no-throw-literal è¿™ä¸ªé…ç½®ï¼Œè€Œåˆ«çš„å°ä¼™ä¼´ä»¬çš„ç‰ˆæœ¬ä½äºæ­¤ï¼Œæ•…ä¸ä¼šæŠ¥é”™ã€‚</p><p>å› æ­¤æ‰§è¡Œå‘½ä»¤ <code>npm ci</code> ï¼Œè¯¥å‘½ä»¤ä¼šæŒ‰ç…§ packge-lock.json ä¸­è®°å½•çš„ç‰ˆæœ¬è¿›è¡Œå®‰è£…,ä¸‹é¢æ˜¯è¿™ä¸ªå‘½ä»¤çš„è¯´æ˜</p><blockquote><p>This command is similar to <code>npm-install</code>, except itâ€™s meant to be used in automated environments such as test platforms, continuous integration, and deployment â€“ or any situation where you want to make sure youâ€™re doing a clean install of your dependencies. It can be significantly faster than a regular npm install by skipping certain user-oriented features. It is also more strict than a regular install, which can help catch errors or inconsistencies caused by the incrementally-installed local environments of most npm users.</p></blockquote><p>é‡æ–°å®‰è£…ä¾èµ–ä¹‹åæœç„¶æœ¬åœ°å¯ä»¥é‡ç°è¯¥é—®é¢˜ã€‚</p><p>æ­¤åç»è¿‡ debug å‘ç°ï¼Œåˆ‡æ¢ pageSize ä¼šå…ˆåè§¦å‘ onShowSizeChange å’Œè¡¨æ ¼çš„ onChangeï¼Œè¡¨æ ¼çš„ onChange é‡æ–°å°† pageSize è®¾ç½®å›å»ã€‚</p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>æœ€ç»ˆå¦‚ä½•è§£å†³ä¸Šè¿° bug å°±ä¸èµ˜è¿°äº†ã€‚</p><p>ä¸»è¦æƒ³æ€»ç»“çš„æ˜¯ï¼šé‡åˆ° bugï¼Œå¦‚æœå‡ºç°ä»£ç å’Œè¿è¡Œç¯å¢ƒä¹‹ç±»çš„å„ç§æ¡ä»¶éƒ½ä¸€è‡´ï¼Œä½†æ˜¯è¡¨ç°å°±æ˜¯ä¸ä¸€è‡´çš„æƒ…å†µï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½æ˜¯ä¾èµ–åŒ…çš„ç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡´çš„ ğŸ‘»</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®€æ˜“ redux</title>
      <link href="/2020/09/14/%E7%AE%80%E6%98%93-redux/"/>
      <url>/2020/09/14/%E7%AE%80%E6%98%93-redux/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>Redux å¸¸å¸¸é…åˆ react-redux ä½œä¸ºçŠ¶æ€ç®¡ç†åº”ç”¨åœ¨ React çš„é¡¹ç›®ä¸­ï¼Œå¹¶ä¸”åŸºäº redux å‘å±•å‡ºäº† dva ä¹‹ç±»çš„è¯¸å¤šçŠ¶æ€ç®¡ç†å·¥å…·ã€‚</p><p>è¯´æ¥æƒ­æ„§ï¼Œè™½ç„¶åœ¨é¡¹ç›®ä¸­å¸¸å¸¸ä½¿ç”¨åˆ°ï¼Œä½†æ˜¯å¹¶æœªé˜…è¯»è¿‡ redux çš„æºç ï¼Œäº†è§£å…¶åŸç†ã€‚æœ¬æ–‡ä½œä¸ºå­¦ä¹ ç¬”è®°ï¼Œå¹¶æ ¹æ® redux çš„æ¯”è¾ƒæ ¸å¿ƒçš„ createStore è¿™éƒ¨åˆ†ä»£ç å®ç°ä¸€ä¸ªç®€æ˜“ç‰ˆæœ¬çš„ reduxï¼Œä»¥ä¾¿å°†æ¥å›é¡¾ã€‚</p><a id="more"></a><h4 id="redux-demo"><a href="#redux-demo" class="headerlink" title="redux demo"></a>redux demo</h4><p>redux æä¾›äº†ä½¿ç”¨ demo å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">import &#123; createStore &#125; from &#39;redux&#39;&#x2F;** * è¿™æ˜¯ä¸ª reducerï¼Œçº¯å‡½æ•°ï¼Œç”¨äºæè¿°çŠ¶æ€æ˜¯å¦‚ä½•è½¬å˜çš„ * reducer æ¥æ”¶ state å’Œ action ä½œä¸ºå‚æ•° *&#x2F;function counter(state &#x3D; 0, action) &#123;  switch (action.type) &#123;    case &#39;INCREMENT&#39;:      return state + 1    case &#39;DECREMENT&#39;:      return state - 1    default:      return state  &#125;&#125;&#x2F;&#x2F; createStoreï¼šæ¥æ”¶ reducer ä½œä¸ºå‚æ•°ï¼Œä»¥æ­¤æ„å»ºä¸€ä¸ª storelet store &#x3D; createStore(counter)&#x2F;&#x2F; è®¢é˜… store, æ¯æ¬¡ dispatch çš„æ—¶å€™ï¼Œéƒ½å°†è§¦å‘å›è°ƒstore.subscribe(() &#x3D;&gt; console.log(store.getState()))&#x2F;&#x2F; dispath ä¸€ä¸ª actionstore.dispatch(&#123; type: &#39;INCREMENT&#39; &#125;)</code></pre><h4 id="ç®€åŒ–çš„æ•°æ®æµ"><a href="#ç®€åŒ–çš„æ•°æ®æµ" class="headerlink" title="ç®€åŒ–çš„æ•°æ®æµ"></a>ç®€åŒ–çš„æ•°æ®æµ</h4><img src="https://i.loli.net/2020/11/09/UscH6njLXxCVDvu.png" alt="fiber" style="zoom:50%;" /><p>ä»¥ä¸Šçš„æ•°æ®æµç®€åŒ–äº† combineReducers ç­‰è¿‡ç¨‹</p><h4 id="ç®€æ˜“-redux"><a href="#ç®€æ˜“-redux" class="headerlink" title="ç®€æ˜“ redux"></a>ç®€æ˜“ redux</h4><p>å¯ä»¥çœ‹å‡º redux å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œç®€æ˜“ç‰ˆå®ç°å¦‚ä¸‹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const createStore &#x3D; (reducer) &#x3D;&gt; &#123;  let state  &#x2F;&#x2F; è®¢é˜…çš„å›è°ƒ  let listeners &#x3D; []  &#x2F;&#x2F; è·å– state  const getState &#x3D; () &#x3D;&gt; &#123;    return state  &#125;  const dispatch &#x3D; (action) &#x3D;&gt; &#123;    &#x2F;&#x2F; æ›´æ–° state    state &#x3D; reducer(state, action)    &#x2F;&#x2F; ä¸€æ—¦ dispatch å°±æ‰§è¡Œæ‰€æœ‰è®¢é˜…çš„å›è°ƒ    listeners.forEach((listener) &#x3D;&gt; listener())  &#125;  const subscribe &#x3D; (listener) &#x3D;&gt; &#123;    &#x2F;&#x2F; æ”¶é›†å›è°ƒ    listeners.push(listener)    return () &#x3D;&gt; &#123;      &#x2F;&#x2F; å–æ¶ˆè®¢é˜…      listeners &#x3D; listeners.filter((l) &#x3D;&gt; l !&#x3D;&#x3D; listener)    &#125;  &#125;  return &#123;    getState,    dispatch,    subscribe,  &#125;&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‘Šåˆ«é­”æ³•æ•°å­—</title>
      <link href="/2020/09/12/%E5%91%8A%E5%88%AB%E9%AD%94%E6%B3%95%E6%95%B0%E5%AD%97/"/>
      <url>/2020/09/12/%E5%91%8A%E5%88%AB%E9%AD%94%E6%B3%95%E6%95%B0%E5%AD%97/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ä»¥å¾€çš„å¼€å‘ä¸­å¾€å¾€ä¼šå‡ºç°ç±»ä¼¼ä»¥ä¸‹çš„ä»£ç </p> <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">if(status &#x3D;&#x3D;&#x3D; 1) &#123;   &#x2F;&#x2F; do something&#125; else if(status &#x3D;&#x3D;&#x3D; 2) &#123;   &#x2F;&#x2F; do something&#125; else if (status &#x3D;&#x3D;&#x3D; 3) &#123;  &#x2F;&#x2F; ...&#125;</code></pre><p>ä¸Šé¢ä»£ç ä¸­çš„ <code>1</code>ï¼Œ<code>2</code>ï¼Œ<code>3</code>å°±æ˜¯æ‰€è°“çš„é­”æ³•æ•°å­—ï¼Œå³æ²¡æœ‰æ³¨é‡Šçš„æƒ…å†µä¸‹æˆ‘ä»¬å¾ˆéš¾çŸ¥é“ 1ï¼Œ2ï¼Œ3 ä»£è¡¨çš„åˆ°åº•æ˜¯ä»€ä¹ˆ statusã€‚</p><a id="more"></a><h4 id="å¸¸é‡å¯¹è±¡"><a href="#å¸¸é‡å¯¹è±¡" class="headerlink" title="å¸¸é‡å¯¹è±¡"></a>å¸¸é‡å¯¹è±¡</h4><p>åœ¨ javascript ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›æ•°å­—ç»´æŠ¤åœ¨ä¸€ä¸ªå¸¸é‡å¯¹è±¡ä¸­</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const STATUS &#x3D; &#123;  ERROR: 1,  NORMAL: 2,  SUCCESS: 3&#125;</code></pre><p>ä½¿ç”¨æ—¶å°±å¯ä»¥ä½¿ç”¨ STATUS.ERROR æ¥æ›¿æ¢æ‰ 1ã€‚</p><p>è¿™æ ·å¯ä»¥å¾ˆæ¸…æ™°å°±åˆ†æ¸…æ¥š 1ï¼Œ2ï¼Œ3 è¿™äº›æ•°å€¼å¯¹åº”çš„æ˜¯ä»€ä¹ˆå«ä¹‰ã€‚åŒæ—¶å¦‚æœå°†æ¥ ERROR ä¸å†æ˜¯ 1ï¼Œæˆ‘ä»¬ä¹Ÿåªéœ€è¦ç»´æŠ¤ STATUS å³å¯ã€‚</p><h4 id="Enums"><a href="#Enums" class="headerlink" title="Enums"></a>Enums</h4><h4 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h4><p>è€Œåœ¨ TypeScript ä¸­ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥ä½¿ç”¨æšä¸¾ç±»å‹æ¥ç»´æŠ¤è¿™äº›æ•°å€¼ã€‚</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">enum STATUS &#123;  ERROR &#x3D; 1,  NORMAL,  SUCCESS&#125;</code></pre><p>ä½¿ç”¨æ—¶åŒæ ·æ˜¯ STATUS.ERROR æ›¿æ¢æ‰ 1 å³å¯ã€‚</p><p>å…³äº enums çš„ä½¿ç”¨<a href="https://www.tslang.cn/docs/handbook/enums.html">æ–‡æ¡£</a>é‡Œæè¿°çš„å·²ç»å¾ˆæ¸…æ¥šï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p><h4 id="åå‘æ˜ å°„"><a href="#åå‘æ˜ å°„" class="headerlink" title="åå‘æ˜ å°„"></a>åå‘æ˜ å°„</h4><p>å€¼å¾—ä¸€æçš„æ˜¯ enums æä¾›äº†å¸¸é‡å¯¹è±¡ä¸å…·å¤‡çš„åå‘æ˜ å°„ï¼ˆvalue<code>-&gt;</code>name ï¼‰ã€‚</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">const STATUS &#x3D; &#123;  ERROR: 1,  NORMAL: 2,  SUCCESS: 3&#125;&#x2F;&#x2F; è¾“å‡ºï¼š&quot;ERROR&quot;STATUS[1]</code></pre><p>è¿™æ˜¯å› ä¸º ts å°†ä¸Šè¿°çš„ enums ç¼–è¯‘æˆä»¥ä¸‹ä»£ç </p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">var STATUS;(function (STATUS) &#123;  STATUS[STATUS[&quot;ERROR&quot;] &#x3D; 1] &#x3D; &quot;ERROR&quot;;  STATUS[STATUS[&quot;NORMAL&quot;] &#x3D; 2] &#x3D; &quot;NORMAL&quot;;  STATUS[STATUS[&quot;SUCCESS&quot;] &#x3D; 3] &#x3D; &quot;SUCCESS&quot;;&#125;)(STATUS || (STATUS &#x3D; &#123;&#125;));</code></pre><p>âš ï¸ ä½†å¦‚æœæ˜¯å­—ç¬¦ä¸²æšä¸¾æˆå‘˜åˆ™ä¸ä¼šç”Ÿæˆåå‘æ˜ å°„ã€‚</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">enum STATUS &#123;  ERROR &#x3D; &quot;1&quot;,  NORMAL &#x3D; &quot;2&quot;,  SUCCESS &#x3D; &quot;3&quot;&#125;&#x2F;&#x2F; ç¼–è¯‘åvar STATUS;(function (STATUS) &#123;  STATUS[&quot;ERROR2&quot;] &#x3D; &quot;1&quot;;  STATUS[&quot;NORMAL&quot;] &#x3D; &quot;2&quot;;  sSTATUS[&quot;SUCCESS&quot;] &#x3D; &quot;3&quot;;&#125;)(STATUS || (STATUS &#x3D; &#123;&#125;));</code></pre><p>å¹¶ä¸”å¯¹äºé‡å¤å®šä¹‰çš„æšä¸¾ç±»å‹ï¼Œå°†ä¼šåˆå¹¶æˆå‘˜ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">enum STATUS &#123;  ERROR &#x3D; 1,&#125;enum STATUS &#123;  NORMAL &#x3D; 2,&#125;&#x2F;&#x2F; ç­‰æ•ˆäºenum STATUS &#123;  ERROR &#x3D; 1,  NORMAL &#x3D; 2,&#125;</code></pre><h4 id="const-æšä¸¾"><a href="#const-æšä¸¾" class="headerlink" title="const æšä¸¾"></a>const æšä¸¾</h4><p>å…³äºæšä¸¾ï¼Œè¿˜æœ‰ä¸€ç§ä¸æ˜¯å¸¸è§çš„å†™æ³•</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">const enum STATUS &#123;  ERROR &#x3D; 1,&#125;</code></pre><p>å³å£°æ˜å‰æœ‰ä¸ªå…³é”®å­— constã€‚</p><p>ä¸å¸¸è§„æšä¸¾ä¸åŒçš„åœ°æ–¹åœ¨äº</p><ol><li>const æšä¸¾ä¸ä¼šç¼–è¯‘å‡ºé¢å¤–çš„ä»£ç </li></ol><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">const enum STATUS &#123;  ERROR &#x3D; 1,&#125;console.log(STATUS.ERROR)&#x2F;&#x2F; æœ€ç»ˆçš„ç¼–è¯‘å‡ºçš„ä»£ç ä¸åŒ…å« STATUSconsole.log(1 &#x2F;* ERROR *&#x2F;);</code></pre><ol start="2"><li>ä¹Ÿæ­£å› ä¸ºç¼–è¯‘é˜¶æ®µå°±ä¼šç¡®å®šä¸‹æšä¸¾çš„æˆå‘˜ï¼Œconst æšä¸¾ä¸å¯ä»¥åŒ…å«è®¡ç®—æˆå‘˜</li></ol><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">const geterror &#x3D; () &#x3D;&gt; 3const enum STATUS &#123;  &#x2F;&#x2F; In &#39;const&#39; enum declarations member initializer must be constant expression.  ERROR &#x3D; geterror()&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>React æ³›å‹ç»„ä»¶</title>
      <link href="/2020/09/08/React%20%E6%B3%9B%E5%9E%8B%E7%BB%84%E4%BB%B6/"/>
      <url>/2020/09/08/React%20%E6%B3%9B%E5%9E%8B%E7%BB%84%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>åœºæ™¯ï¼šå°è£…ä¸€ä¸ª antd çš„ Radio ç»„ä»¶æ—¶ï¼Œéœ€è¦ä»çˆ¶ç»„ä»¶è·å–åˆ° value çš„ç±»å‹ã€‚å…¶ props æ¥å£å®šä¹‰å¦‚ä¸‹</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">interface CustomRadioProps&lt;ValueType&gt; &#123;  options: Option&lt;ValueType&gt;[];  value: ValueType;  onChange: (value: ValueType) &#x3D;&gt; void;&#125;</code></pre><p>ä½¿ç”¨æ—¶è¿™é‡Œå‡è®¾ä¼ è¿›å»çš„æ˜¯ä¸ª number ç±»å‹</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">&lt;CustomRadio&lt;number&gt;  onChange&#x3D;&#123;handleTypeChange&#125;  options&#x3D;&#123;[    &#123;      label: &#39;1&#39;,      value: 1,    &#125;,    &#123;      label: &#39;1&#39;,      value: 2,    &#125;,  ]&#125;  value&#x3D;&#123;1&#125;&#x2F;&gt;</code></pre><p>é‚£ä¹ˆè¿™ä¸ª CustomRadioProps ç§°ä¸ºæ³›å‹ç»„ä»¶ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•å®šä¹‰ä¸€ä¸ªæ³›å‹ç»„ä»¶ï¼Ÿ</p><a id="more"></a><h4 id="ç±»ç»„ä»¶"><a href="#ç±»ç»„ä»¶" class="headerlink" title="ç±»ç»„ä»¶"></a>ç±»ç»„ä»¶</h4><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">class CustomRadio&lt;T&gt; extends React.Component&lt;Props&lt;T&gt;&gt; &#123; &#x2F;&#x2F; ...&#125;</code></pre><h4 id="å‡½æ•°ç»„ä»¶"><a href="#å‡½æ•°ç»„ä»¶" class="headerlink" title="å‡½æ•°ç»„ä»¶"></a>å‡½æ•°ç»„ä»¶</h4><p>å¯¹äºç”¨ function å£°æ˜çš„å‡½æ•°å¼ç»„ä»¶å®é™…ä¸Šäºæ³›å‹å‡½æ•°æ˜¯ä¸€æ ·çš„å†™æ³•ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">function CustomRadio&lt;T&gt;(props: IProps&lt;T&gt;) &#123;&#x2F;&#x2F; ...&#125;</code></pre><p>ç„¶è€Œå¯¹äºç”¨ç®­å¤´å‡½æ•°ä¸å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const CustomRadio: React.FunctionComponent&lt;IProps&lt;T&gt;&gt; &#x3D; props &#x3D;&gt; &#123; &#x2F;*...*&#x2F; &#125; </code></pre><p>ç®­å¤´å‡½æ•°ç»„ä»¶æ­£ç¡®çš„å†™æ³•ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const IconRadioGroup &#x3D; &lt;T extends any&gt;(props: IProps&lt;T&gt;) &#x3D;&gt; &#123;&#x2F;&#x2F; ...&#125;</code></pre><p>è¿™é‡Œ T å¿…é¡»è¦ä½¿ç”¨ extends, ç”¨ <code>T extends any</code> æ¥è¡¨æ˜æ¥æ”¶ä»»æ„ç±»å‹ï¼Œå¦‚æœåªèƒ½ number æˆ–è€… stringç±»å‹ï¼Œåˆ™æ”¹æˆ  <code>T extends numberï½œstring</code> å³å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jsè·å–åç¼€å</title>
      <link href="/2020/09/02/js%E8%8E%B7%E5%8F%96%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E5%90%8D/"/>
      <url>/2020/09/02/js%E8%8E%B7%E5%8F%96%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E5%90%8D/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>Code Review çš„æ—¶å€™çœ‹åˆ°å°ä¼™ä¼´æäº¤äº†ä¸€æ®µç”¨äºæå–æ–‡ä»¶æ‹“å±•åçš„ä»£ç ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; æˆªå–å›¾ç‰‡åç¼€ä¿¡æ¯&#x2F;&#x2F; example: &#39;www.baidu.com&#x2F;somepic.jpg?h&#x2F;w&#x2F;&#39;&#x2F;&#x2F; return: &#39;.jpg&#39;const getExtension &#x3D; (url &#x3D; &#39;&#39;) &#x3D;&gt; &#123;  const end &#x3D; url.indexOf(&#39;?&#39;) || undefined;  const start &#x3D; url.lastIndexOf(&#39;.&#39;, end);  return url.substring(start, end);&#125;;</code></pre><p>è¿™ç§å†™æ³•å›ºç„¶æ²¡é”™ï¼Œé‚£ä¹ˆæ˜¯å¦æœ‰åˆ«çš„å†™æ³•å˜?</p><a id="more"></a><h4 id="æ–¹æ¡ˆä¸€"><a href="#æ–¹æ¡ˆä¸€" class="headerlink" title="æ–¹æ¡ˆä¸€"></a>æ–¹æ¡ˆä¸€</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const getExtension &#x3D; (url &#x3D; &#39;&#39;) &#x3D;&gt; &#123;  const extensionName &#x3D; url.split(&#39;.&#39;).pop()  return extensionName ? &#96;.$&#123;extensionName&#125;&#96; : &#39;&#39;&#125;</code></pre><h4 id="æ–¹æ¡ˆäºŒ"><a href="#æ–¹æ¡ˆäºŒ" class="headerlink" title="æ–¹æ¡ˆäºŒ"></a>æ–¹æ¡ˆäºŒ</h4><p>æ­£åˆ™è¡¨è¾¾å¼</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const getExtension &#x3D; (url &#x3D; &#39;&#39;) &#x3D;&gt; &#123;  const matches &#x3D; url.match(&#x2F;.*(\.[^?]+)&#x2F;)  return matches ? matches[1] : &#39;&#39;&#125;</code></pre><p>å¯èƒ½æœ‰äº›åŒå­¦å¯¹æ­£åˆ™ä¸å¤ªç†Ÿæ‚‰ï¼Œä»¥ä¸‹å¯¹è¿™ä¸ªæ­£åˆ™åšä¸€ä¸‹è§£é‡Šï¼š</p><ol><li><code>.*</code>ï¼š . è¡¨ç¤ºéæ¢è¡Œç¬¦å·ï¼Œ * ç”¨äºæ¶ˆè€—å°½å¯èƒ½å¤šçš„å­—ç¬¦</li><li><code>()</code> æ‹¬å·è¡¨ç¤ºæ•è·ç»„ï¼Œè¿™é‡Œ <code>()</code> ä¸­çš„è¡¨è¾¾å¼å°±æ˜¯ç”¨äºæ•è·åç¼€åã€‚</li><li><code>\.</code> è¡¨ç¤º . çš„è½¬ä¹‰</li><li><code>[^\?+]</code>: ^ è¡¨ç¤ºéï¼Œ + è¡¨ç¤ºä¸€ä¸ªæˆ–è€…å¤šä¸ªã€‚å› æ­¤ <code>[^?+]</code> å³è¡¨ç¤ºé ï¼Ÿçš„å¤šä¸ªå­—ç¬¦</li></ol><h4 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h4><p>å¦‚æœæ˜¯åœ¨ node çš„ç¯å¢ƒï¼Œæœ¬åœ°çš„æ–‡ä»¶åå¯ä»¥é€šè¿‡ path æ¨¡å—æä¾›çš„ extname è·å–ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const &#123; extname &#125; &#x3D; require(&#39;path&#39;)console.log(extname(&#39;some-pic.jpg&#39;))&#x2F;&#x2F; .jpg</code></pre><p>é‚£å¦‚æœæ˜¯è¿œç¨‹åœ°å€å‘¢ï¼Ÿå¯ä»¥é€šè¿‡ url æ¨¡å—å¾—åˆ° pathname ä¹‹åå†ç”¨ extname æ¥è·å–ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const &#123; extname &#125; &#x3D; require(&#39;path&#39;)const &#123; parse &#125; &#x3D; require(&#39;url&#39;);const getExtension &#x3D; (url &#x3D; &#39;&#39;) &#x3D;&gt; extname(parse(url).pathname)</code></pre>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TypeScriptä¸­çš„constæ–­è¨€</title>
      <link href="/2020/08/26/TypeScript%E4%B8%AD%E7%9A%84const%E6%96%AD%E8%A8%80/"/>
      <url>/2020/08/26/TypeScript%E4%B8%AD%E7%9A%84const%E6%96%AD%E8%A8%80/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>æœ€è¿‘åœ¨ä½¿ç”¨ ant design çš„ Table ç»„ä»¶ï¼Œé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå®šä¹‰ Table çš„ columns å±æ€§å¦‚ä¸‹ï¼š</p><a id="more"></a><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">const columns: ColumnProps&lt;MyRecord&gt;[] &#x3D; [&#123;  title: &#39;ID&#39;,  dataIndex: &#39;id&#39;,  align: &#39;center&#39;,&#125;]</code></pre><p>æ­¤æ—¶ TS æç¤ºï¼š</p><pre class="line-numbers language-none"><code class="language-none">Types of property &#39;align&#39; are incompatible.        Type &#39;string&#39; is not assignable to type &#39;&quot;right&quot; | &quot;left&quot; | &quot;center&quot; | undefined&#39;.  TS2322</code></pre><h4 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h4><p>ç»è¿‡æŸ¥çœ‹ä»£ç å‘ç°ï¼Œ ColumnProps çš„ align å±æ€§çš„å®é™…ç»§æ‰¿è‡ª ColumnSharedTypeï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">interface ColumnSharedType&lt;RecordType&gt; &#123;    &#x2F;&#x2F; ...    align?: AlignType;&#125;export declare type AlignType &#x3D; &#39;left&#39; | &#39;center&#39; | &#39;right&#39;;</code></pre><p>ä¹Ÿå°±æ˜¯ column ä¸­çš„ align çš„ç±»å‹ä¸º stringï¼Œè€Œ string æ— æ³• cast åˆ° AlignTypeã€‚å³ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">type AlignType &#x3D; &#39;left&#39; | &#39;center&#39; | &#39;right&#39;;let align: AlignType | undefinedlet myAlign &#x3D; &quot;center&quot;&#x2F;&#x2F; Type &#39;string&#39; is not assignable to type &#39;&quot;left&quot; | &quot;right&quot; | &quot;center&quot; | undefined&#39;.ts(2322)align &#x3D; myAlign</code></pre><h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p>TypeScript 3.4 ç‰ˆæœ¬ä»¥ä¸Šæä¾›äº† const æ–­è¨€ï¼Œå¯ä»¥é€šè¿‡ as const æ¥æ¶ˆé™¤ä»¥ä¸ŠæŠ¥é”™ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">const columns: ColumnProps&lt;MyRecord&gt;[] &#x3D; [&#123;  title: &#39;ID&#39;,  dataIndex: &#39;id&#39;,  align: &#39;center&#39; as const,&#125;]</code></pre><h4 id="const-assertions"><a href="#const-assertions" class="headerlink" title="const assertions"></a>const assertions</h4><p>ä»¥ä¸‹å†…å®¹ç¿»è¯‘è‡ª <a href="https://devblogs.microsoft.com/typescript/announcing-typescript-3-4-rc/">https://devblogs.microsoft.com/typescript/announcing-typescript-3-4-rc/</a> ä¸­çš„ <code>const</code> assertionsã€‚(ç¿»è¯‘ä¸åŠ¨çš„åœ°æ–¹ä¼šè´´ä¸ŠåŸæ–‡)</p><p>å½“å£°æ˜ä¸€ä¸ªå¯å˜çš„å˜é‡æˆ–è€…å±æ€§æ—¶ï¼ŒTypeScript ç»å¸¸æ‹“å®½å€¼ä»¥ç¡®ä¿æˆ‘ä»¬å¯ä»¥åœ¨ä¸å†™æ˜ç¡®åˆ‡çš„ç±»å‹çš„æƒ…å†µä¸‹è¿›è¡Œèµ‹å€¼ã€‚</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">let x &#x3D; &quot;hello&quot;;&#x2F;&#x2F; æˆ‘ä»¬å¯ä»¥ç»™ x èµ‹å€¼x &#x3D; &quot;world&quot;;</code></pre><p>ä¸¥æ ¼æ¥è¯´ï¼Œæ¯ä¸€ä¸ªå­—é¢é‡éƒ½æœ‰å…¶å­—é¢ç±»å‹ã€‚ä¸Šé¢çš„ x åœ¨ç±»å‹æ¨æ–­æ—¶ï¼Œç”± <code>&quot;hello&quot;</code> ç±»å‹è½¬ä¸ºæ›´ä¸º widen çš„ <code>string</code> ç±»å‹ã€‚</p><p>ç›¸å¯¹è€Œè¨€ï¼Œå¦‚æœ x åŸå§‹å­—é¢é‡ç±»å‹ä¸º â€œhelloâ€ï¼Œ é‚£ä¹ˆæˆ‘ä»¬å°±æ— æ³•å°† x èµ‹å€¼ä¸º â€œworldâ€:</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">let x: &quot;hello&quot; &#x3D; &quot;hello&quot;;&#x2F;&#x2F; error!x &#x3D; &quot;world&quot;;</code></pre><p>ä¸Šé¢çš„æƒ…å†µçœ‹èµ·æ¥æ¯”è¾ƒæç«¯ï¼Œä½†æ˜¯åœ¨ä¸€äº›æƒ…å†µä¸‹æ¯”è¾ƒæœ‰ç”¨çš„ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬ç»å¸¸åˆ›å»ºä¸€ä¸ªè”åˆå±æ€§çš„å¯¹è±¡ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">type Shape &#x3D;    | &#123; kind: &quot;circle&quot;, radius: number &#125;    | &#123; kind: &quot;square&quot;, sideLength: number &#125;function getShapes(): readonly Shape[] &#123;    let result &#x3D; [        &#123; kind: &quot;circle&quot;, radius: 100, &#125;,        &#123; kind: &quot;square&quot;, sideLength: 50, &#125;,    ];        &#x2F;&#x2F; Some terrible error message because TypeScript inferred    &#x2F;&#x2F; &#39;kind&#39; to have the type &#39;string&#39; instead of    &#x2F;&#x2F; either &#39;&quot;circle&quot;&#39; or &#39;&quot;square&quot;&#39;.    return result;&#125;</code></pre><p>å¯ä¿®æ”¹æ€§æ˜¯ TypeScript æ–­å®šä»€ä¹ˆæ—¶å€™ widen ç±»å‹çš„é‡è¦å› ç´ ï¼Œè€Œéåˆ†ææ‰€æœ‰ä»£ç ã€‚ï¼ˆMutability is one of the best heuristics of intent which TypeScript can use to determine when to widen (rather than analyzing our entire program).ï¼‰</p><p>æ­£å¦‚ä¸Šè¿°ä¾‹å­ï¼Œä¸å¹¸çš„æ˜¯ï¼ŒJavaScript ä¸­çš„å±æ€§é»˜è®¤å¯ä¿®æ”¹ã€‚è¿™æ„å‘³ç€ç»å¸¸ä¼šæœ‰ä¸å¿…è¦çš„ widen ç±»å‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç‰¹å®šçš„åœ°æ–¹å¯¹ç±»å‹è¿›è¡Œç¡®åˆ‡çš„å£°æ˜ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">function getShapes(): readonly Shape[] &#123;  &#x2F;&#x2F; This explicit annotation gives a hint  &#x2F;&#x2F; to avoid widening in the first place.  let result: readonly Shape[] &#x3D; [  &#123; kind: &quot;circle&quot;, radius: 100, &#125;,  &#123; kind: &quot;square&quot;, sideLength: 50, &#125;,  ];  return result;&#125;</code></pre><p>ä¸Šè¿°çš„æ–¹æ³•å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯å½“æ•°æ®ç»“æ„è¶Šæ¥è¶Šå¤æ‚çš„æ—¶å€™ï¼Œè¿™ç§æ–¹å¼å°†ä¼šæ˜¾çš„ç¬¨é‡ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒTypeScript 3.4 ä¸ºå­—é¢å€¼å¼•å…¥äº† const æ–­è¨€ã€‚å®ƒçš„è¯­æ³•æ˜¯ä¸€ç§ç±»å‹æ–­è¨€ï¼Œä¾‹å¦‚ <code>123 as const</code>ã€‚å½“æˆ‘ä»¬è¿™ä¹ˆä½¿ç”¨çš„æ—¶å€™ï¼Œæ„å‘³ç€ï¼š</p><ol><li>å­—é¢é‡ç±»å‹ä¸ä¼šè¢« widenï¼Œå¦‚ä¸ä¼šä» â€œhelloâ€ å˜æˆ string</li><li>å¯¹è±¡å­—é¢é‡çš„å±æ€§å€¼ä¸ºåªè¯»</li><li>æ•°ç»„å­—é¢é‡å˜æˆåªè¯»å…ƒç»„</li></ol><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">&#x2F;&#x2F; Type &#39;10&#39;let x &#x3D; 10 as const;&#x2F;&#x2F; Type &#39;readonly [10, 20]&#39;let y &#x3D; [10, 20] as const;&#x2F;&#x2F; Type &#39;&#123; readonly text: &quot;hello&quot; &#125;&#39;let z &#x3D; &#123; text: &quot;hello&quot; &#125; as const;</code></pre><p>åœ¨ tsx æ–‡ä»¶ä»¥å¤–ï¼Œè¿˜å¯ä»¥è¿™ä¹ˆä½¿ç”¨ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">&#x2F;&#x2F; Type &#39;10&#39;let x &#x3D; &lt;const&gt;10;&#x2F;&#x2F; Type &#39;readonly [10, 20]&#39;let y &#x3D; &lt;const&gt;[10, 20];&#x2F;&#x2F; Type &#39;&#123; readonly text: &quot;hello&quot; &#125;&#39;let z &#x3D; &lt;const&gt;&#123; text: &quot;hello&quot; &#125;;</code></pre><p>This feature often means that types that would otherwise be used just to hint immutability to the compiler can often be omitted.</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">&#x2F;&#x2F; Works with no types referenced or declared.&#x2F;&#x2F; We only needed a single const assertion.function getShapes() &#123;    let result &#x3D; [        &#123; kind: &quot;circle&quot;, radius: 100, &#125;,        &#123; kind: &quot;square&quot;, sideLength: 50, &#125;,    ] as const;        return result;&#125;for (const shape of getShapes()) &#123;    &#x2F;&#x2F; Narrows perfectly!    if (shape.kind &#x3D;&#x3D;&#x3D; &quot;circle&quot;) &#123;        console.log(&quot;Circle radius&quot;, shape.radius);    &#125;    else &#123;        console.log(&quot;Square side length&quot;, shape.sideLength);    &#125;&#125;</code></pre><p>æ³¨æ„ä¸Šé¢æ— éœ€ç±»å‹å£°æ˜ï¼Œconst æ–­è¨€å…è®¸ ts ä½¿ç”¨æœ€ç²¾ç¡®çš„è¡¨è¾¾å¼ç±»å‹ã€‚</p><h5 id="è­¦å‘Š"><a href="#è­¦å‘Š" class="headerlink" title="è­¦å‘Š"></a>è­¦å‘Š</h5><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œconst æ–­è¨€åªèƒ½ä½¿ç”¨åœ¨ç®€å•çš„å­—é¢è¡¨è¾¾å¼ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">&#x2F;&#x2F; Error!&#x2F;&#x2F;   A &#39;const&#39; assertion can only be applied to a string, number, boolean, array, or object literal.let a &#x3D; (Math.random() &lt; 0.5 ? 0 : 1) as const;&#x2F;&#x2F; Works!let b &#x3D; Math.random() &lt; 0.5 ?    0 as const :    1 as const;</code></pre><p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œconst ä¸ä¼šå°†è¡¨è¾¾å¼è½¬å˜ä¸ºå®Œå…¨ä¸å¯å˜ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">et arr &#x3D; [1, 2, 3, 4];let foo &#x3D; &#123;    name: &quot;foo&quot;,    contents: arr,&#125;;foo.name &#x3D; &quot;bar&quot;;   &#x2F;&#x2F; error!foo.contents &#x3D; [];  &#x2F;&#x2F; error!foo.contents.push(5); &#x2F;&#x2F; ...works!</code></pre>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸å˜çš„æ‰¿è¯º Promise</title>
      <link href="/2020/08/25/%E4%B8%8D%E5%8F%98%E7%9A%84%E6%89%BF%E8%AF%BA%20Promise/"/>
      <url>/2020/08/25/%E4%B8%8D%E5%8F%98%E7%9A%84%E6%89%BF%E8%AF%BA%20Promise/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>Promise æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥è§£å†³å‰ç«¯çš„å›è°ƒåœ°ç‹±ã€‚ä»¥ä¸‹æ ¹æ® <a href="https://es6.ruanyifeng.com/?search=promise&x=0&y=0#docs/promise">ES6 å…¥é—¨</a> ç®€å•è¿‡ä¸€ä¸‹ Promise çš„åŸºç¡€åŠä¸ªäººçš„ä¸€äº›è§è§£è¡¥å……ï¼ŒåŒæ—¶å°è¯•å®ç°ä¸€ä¸ªç¬¦åˆ PromiseA+ è§„èŒƒçš„ Promiseã€‚</p> <a id="more"></a><h4 id="Promise-åŸºç¡€"><a href="#Promise-åŸºç¡€" class="headerlink" title="Promise åŸºç¡€"></a>Promise åŸºç¡€</h4><h5 id="Promise-çš„çŠ¶æ€"><a href="#Promise-çš„çŠ¶æ€" class="headerlink" title="Promise çš„çŠ¶æ€"></a>Promise çš„çŠ¶æ€</h5><p>Promise åªæœ‰ä¸‰ç§çŠ¶æ€ï¼š<code>pending</code>ï¼ˆè¿›è¡Œä¸­ï¼‰ï¼Œ<code>fulfilled</code>ï¼ˆå·²æˆåŠŸï¼‰å’Œ <code>rejected</code>ï¼ˆå·²å¤±è´¥ï¼‰ã€‚</p><p>Promise çš„çŠ¶æ€æ”¹å˜åªæœ‰ä¸¤ç§æƒ…å†µï¼š</p><p><code>pending</code> åˆ° <code>fulfilled</code> ä»¥åŠ <code>pending</code> åˆ° <code>rejected</code>ã€‚å½“çŠ¶æ€å˜æˆ  <code>fulfilled</code> æˆ– <code>rejected</code>æ—¶ï¼Œæˆ‘ä»¬å°±ç§°è¿™ä¸ª Promise  <code>resolved</code>ã€‚</p><p>âš ï¸ æˆ‘ä»¬é€šå¸¸è¯´çš„ resolved ä»…æŒ‡ä»£ <code>fulfilled</code>ï¼Œä¸åŒ…æ‹¬ <code>rejected</code>ã€‚</p><h5 id="æ„é€ ä¸€ä¸ª-Promise"><a href="#æ„é€ ä¸€ä¸ª-Promise" class="headerlink" title="æ„é€ ä¸€ä¸ª Promise"></a>æ„é€ ä¸€ä¸ª Promise</h5><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const promise &#x3D; new Promise(function(resolve, reject) &#123;  &#x2F;&#x2F; ... some code  if (&#x2F;* å¼‚æ­¥æ“ä½œæˆåŠŸ *&#x2F;)&#123;    resolve(value);  &#125; else &#123;    reject(error);  &#125;&#125;);</code></pre><h5 id="promise-then"><a href="#promise-then" class="headerlink" title="promise.then"></a>promise.then</h5><p>Promise çš„å®ä¾‹æ‹¥æœ‰ then æ–¹æ³•ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">promise.then(function(value) &#123;  &#x2F;&#x2F; success&#125;, function(error) &#123;  &#x2F;&#x2F; failure&#125;);</code></pre><p>âš ï¸  Promise æ–°å»ºåç«‹å³æ‰§è¡Œï¼Œè€Œ then æ–¹æ³•åˆ™å±äºå¾®ä»»åŠ¡çš„å›è°ƒï¼Œæ‰§è¡Œæ—¶æœºä¸ºå®ä»»åŠ¡æ‰§è¡Œä¹‹åï¼Œå…·ä½“çš„äº‹ä»¶å¾ªç¯æœºåˆ¶åé¢å¼€æ–°å‘æ€»ç»“ã€‚</p><h5 id="resolve"><a href="#resolve" class="headerlink" title="resolve"></a>resolve</h5><p>æ„é€  Promise æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•° resolve å‡½æ•°æ‰€æ¥æ”¶çš„å‚æ•°ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæ™®é€šçš„å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª promiseã€‚å¦‚æœæ¥æ”¶çš„æ˜¯ä¸€ä¸ª promise å®ä¾‹ï¼Œé‚£ä¹ˆ promise çš„çŠ¶æ€å–å†³äº resolve æ¥æ”¶çš„ promise çš„çŠ¶æ€ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const p1 &#x3D; new Promise(function (resolve, reject) &#123;  setTimeout(() &#x3D;&gt; reject(new Error(&#39;fail&#39;)), 3000)&#125;)const p2 &#x3D; new Promise(function (resolve, reject) &#123;  setTimeout(() &#x3D;&gt; resolve(p1), 1000)&#125;)p2  .then(result &#x3D;&gt; console.log(result))  .catch(error &#x3D;&gt; console.log(error))&#x2F;&#x2F; 3s åè¾“å‡ºï¼šError: fail</code></pre><p>è¿™æ—¶<code>p1</code>çš„çŠ¶æ€å°±ä¼šä¼ é€’ç»™<code>p2</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>p1</code>çš„çŠ¶æ€å†³å®šäº†<code>p2</code>çš„çŠ¶æ€ã€‚å¦‚æœ<code>p1</code>çš„çŠ¶æ€æ˜¯<code>pending</code>ï¼Œé‚£ä¹ˆ<code>p2</code>çš„å›è°ƒå‡½æ•°å°±ä¼šç­‰å¾…<code>p1</code>çš„çŠ¶æ€æ”¹å˜ï¼›å¦‚æœ<code>p1</code>çš„çŠ¶æ€å·²ç»æ˜¯<code>resolved</code>æˆ–è€…<code>rejected</code>ï¼Œé‚£ä¹ˆ<code>p2</code>çš„å›è°ƒå‡½æ•°å°†ä¼šç«‹åˆ»æ‰§è¡Œã€‚</p><h5 id="resolve-ä¸-return"><a href="#resolve-ä¸-return" class="headerlink" title="resolve ä¸ return"></a>resolve ä¸ return</h5><p>è°ƒç”¨<code>resolve</code>æˆ–<code>reject</code>å¹¶ä¸ä¼šç»ˆç»“ Promise çš„å‚æ•°å‡½æ•°çš„æ‰§è¡Œï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">new Promise((resolve, reject) &#x3D;&gt; &#123;  resolve(1);  console.log(2);&#125;).then(r &#x3D;&gt; &#123;  console.log(r);&#125;);&#x2F;&#x2F; 2&#x2F;&#x2F; 1</code></pre><p>ä¸€èˆ¬æ¥è¯´ï¼Œè°ƒç”¨<code>resolve</code>æˆ–<code>reject</code>ä»¥åï¼ŒPromise çš„ä½¿å‘½å°±å®Œæˆäº†ï¼Œåç»§æ“ä½œåº”è¯¥æ”¾åˆ°<code>then</code>æ–¹æ³•é‡Œé¢ï¼Œè€Œä¸åº”è¯¥ç›´æ¥å†™åœ¨<code>resolve</code>æˆ–<code>reject</code>çš„åé¢ã€‚æ‰€ä»¥ï¼Œæœ€å¥½åœ¨å®ƒä»¬å‰é¢åŠ ä¸Š<code>return</code>:</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">new Promise((resolve, reject) &#x3D;&gt; &#123;  return resolve(1);  &#x2F;&#x2F; åé¢çš„è¯­å¥ä¸ä¼šæ‰§è¡Œ  console.log(2);&#125;)</code></pre><h5 id="catch"><a href="#catch" class="headerlink" title=".catch"></a>.catch</h5><ol><li><p><code>Promise.prototype.catch()</code>æ–¹æ³•æ˜¯<code>.then(null | undefined, rejection)</code>ï¼Œç”¨äºæŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶çš„å›è°ƒå‡½æ•°ã€‚</p></li><li><p>Promise å¯¹è±¡çš„é”™è¯¯å…·æœ‰â€œå†’æ³¡â€æ€§è´¨ï¼Œä¼šä¸€ç›´å‘åä¼ é€’ï¼Œç›´åˆ°è¢«æ•è·ä¸ºæ­¢ï¼Œå³é”™è¯¯æ€»æ˜¯ä¼šè¢«ä¸‹ä¸€ä¸ª<code>catch</code>è¯­å¥æ•è·ã€‚</p></li><li><p><code>catch()</code>æ–¹æ³•è¿”å›çš„è¿˜æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå› æ­¤åé¢è¿˜å¯ä»¥æ¥ç€è°ƒç”¨<code>then()</code>ä¸ <code>catch()</code> æ–¹æ³•ã€‚</p></li><li><p>promise å†…éƒ¨çš„é”™è¯¯ä¸ä¼šæŠ›åˆ°å¤–å±‚ï¼Œå› æ­¤ <code>try/catch</code> æ— æ³•æ•è·ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">try &#123;   const p2 &#x3D; new Promise((resolve, reject) &#x3D;&gt; &#123;        throw &#39;err&#39;    &#125;)    console.log(&#39;out&#39;)&#125; catch(e) &#123;    console.log(&#39;catch you&#39;, e)&#125;&#x2F;&#x2F; out&#x2F;&#x2F; æœªæ•è·çš„å¼‚å¸¸ï¼šUncaught (in promise) err</code></pre><p>å› æ­¤æœ€å¥½ promise åéƒ½ç”¨ catch æ¥æ•è·ã€‚</p></li></ol><h5 id="finally"><a href="#finally" class="headerlink" title=".finally()"></a>.finally()</h5><ul><li>ES2018 å¼•å…¥ï¼Œå³ä¸ç®¡ Promise å¯¹è±¡æœ€åçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œã€‚</li><li><code>finally</code>æ–¹æ³•çš„å›è°ƒå‡½æ•°ä¸æ¥å—ä»»ä½•å‚æ•°</li></ul><h4 id="æ‰‹å†™ä¸€ä¸ªç®€æ˜“çš„-Promise"><a href="#æ‰‹å†™ä¸€ä¸ªç®€æ˜“çš„-Promise" class="headerlink" title="æ‰‹å†™ä¸€ä¸ªç®€æ˜“çš„ Promise"></a>æ‰‹å†™ä¸€ä¸ªç®€æ˜“çš„ Promise</h4><p>æ‰‹å†™ä¸€ä¸ªç¬¦åˆ PromiseA+ è§„èŒƒçš„ Promise å¹¶ä¸ç®€å•ï¼Œå¯ä»¥å…ˆç®€å•æ ¹æ®ä¸Šè¿° promise çš„åŸºæœ¬åŠŸèƒ½å®ç°ä¸€ä¸ª<strong>ç®€æ˜“ç‰ˆæœ¬</strong>ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const PENDING &#x3D; &#39;pending&#39;const RESOLVED &#x3D; &#39;resolved&#39;const REJECTED &#x3D; &#39;rejected&#39;class MyPromise &#123;  constructor(fn) &#123;    this.state &#x3D; PENDING    &#x2F;&#x2F; æ”¶é›† .then ä¸­çš„ resolve çš„å›è°ƒå‡½æ•°    this.resolveCallbacks &#x3D; []    &#x2F;&#x2F; æ”¶é›† .then ä¸­çš„ reject çš„å›è°ƒå‡½æ•°    this.rejectCallbacks &#x3D; []    &#x2F;&#x2F; resolve(result)    this.result &#x3D; null    &#x2F;&#x2F; reject(reason)    this.reason &#x3D; null    &#x2F;&#x2F; ç”±äº fn æœ‰å¯èƒ½å¼‚å¸¸ï¼Œéœ€è¦æ•è·    try &#123;      &#x2F;&#x2F; Promise ä¸€å®ä¾‹åŒ–å°±æ‰§è¡Œä¼ å…¥çš„ fn      &#x2F;&#x2F; æ³¨æ„æ­¤å¤„å°†å‡½æ•°å½“ä½œå‚æ•°ä¼ å…¥ï¼Œéœ€è¦ bind ç»‘å®šä¸Šä¸‹æ–‡      &#x2F;&#x2F; æˆ–è€… resolve &#x2F; reject ç”¨ç®­å¤´å‡½æ•°å®ç°      fn(this.resolve.bind(this), this.reject.bind(this))    &#125; catch (error) &#123;      this.reject(error)    &#125;  &#125;  resolve(result) &#123;    if (this.state &#x3D;&#x3D;&#x3D; PENDING) &#123;      &#x2F;&#x2F; ä¿®æ”¹çŠ¶æ€      this.state &#x3D; RESOLVED      this.result &#x3D; result      &#x2F;&#x2F; æ‰§è¡Œ then ä¸­çš„ resolve å›è°ƒå‡½æ•°      this.resolveCallbacks.forEach((cb) &#x3D;&gt; cb(result))    &#125;  &#125;  reject(reason) &#123;    if (this.state &#x3D;&#x3D;&#x3D; PENDING) &#123;      &#x2F;&#x2F; ä¿®æ”¹çŠ¶æ€      this.state &#x3D; REJECTED      this.reason &#x3D; reason      &#x2F;&#x2F; æ‰§è¡Œ then ä¸­çš„ reject å›è°ƒå‡½æ•°      this.rejectCallbacks.forEach((cb) &#x3D;&gt; cb(reason))    &#125;  &#125;  then(onFulfilled, onRejected) &#123;    &#x2F;&#x2F; è°ƒç”¨ .then æ—¶å¦‚æœè¿˜åœ¨ pending åˆ™å°†å›è°ƒå…ˆå­˜èµ·æ¥ï¼Œç­‰å¾… resolve åæ‰§è¡Œ    if (this.state &#x3D;&#x3D;&#x3D; PENDING) &#123;      &#x2F;&#x2F; æ”¶é›†å›è°ƒ      this.resolveCallbacks.push(onFulfilled)      this.rejectCallbacks.push(onRejected)    &#125;    &#x2F;&#x2F; å¦‚æœè°ƒç”¨ .then æ—¶å·²ç» resolve &#x2F; reject, é‚£ä¹ˆç›´æ¥æ‰§è¡Œå¯¹åº”çš„å›è°ƒ    if (this.state &#x3D;&#x3D;&#x3D; RESOLVED) &#123;      onFulfilled(this.result)    &#125;    if (this.state &#x3D;&#x3D;&#x3D; REJECTED) &#123;      onRejected(this.reason)    &#125;  &#125;&#125;</code></pre><p>æµ‹è¯•ä»£ç ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const myPromise &#x3D; new MyPromise((resolve, reject) &#x3D;&gt; &#123;  setTimeout(() &#x3D;&gt; &#123;    resolve(&#39;resolved&#39;)  &#125;, 3000)&#125;)myPromise.then(  (result) &#x3D;&gt; &#123;    console.log(result)  &#125;,  (reason) &#x3D;&gt; &#123;    console.log(reason)  &#125;)</code></pre><p>Promise çš„è®¾è®¡æ€è·¯å®é™…ä¸Šå°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ï¼šæ”¶é›†å›è°ƒå‡½æ•°ï¼Œè§¦å‘é€šçŸ¥ï¼Œä¾æ¬¡æ‰§è¡Œå›è°ƒã€‚</p><p>ä¸Šè¿°ç‰ˆæœ¬è¿˜æœªèƒ½è¾¾åˆ° Promise / A+ çš„è§„èŒƒï¼Œæ¯”å¦‚ é“¾å¼è°ƒç”¨ ç­‰ã€‚</p><h4 id="ç¬¦åˆ-Promise-A-çš„-Promise"><a href="#ç¬¦åˆ-Promise-A-çš„-Promise" class="headerlink" title="ç¬¦åˆ Promise / A+ çš„ Promise"></a>ç¬¦åˆ Promise / A+ çš„ Promise</h4><p>å‚è€ƒ <a href="https://promisesaplus.com/">Promise / A+</a> ï¼Œä»¥ä¸‹è¿˜éœ€è¦è¡¥å……ä¸‹é¢å‡ ç‚¹ï¼š</p><ol><li>then æ–¹æ³•çš„å‚æ•°å¯é€‰</li><li><code>onFulfilled</code> å’Œ <code>onRejected</code>æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ <code>setTimeout</code> æˆ– <code>setImmediate</code> ä¹‹ç±»çš„â€œå®ä»»åŠ¡â€æœºåˆ¶ï¼Œæˆ–è€…ä½¿ç”¨è¯¸å¦‚ <code>MutationObserver</code> æˆ– <code>process.nextTick</code> ä¹‹ç±»çš„â€œå¾®ä»»åŠ¡â€æœºåˆ¶æ¥å®ç°ã€‚</li><li>é“¾å¼è°ƒç”¨ ä¸ promise è§£å†³æ­¥éª¤</li></ol><h5 id="å€¼ç©¿é€"><a href="#å€¼ç©¿é€" class="headerlink" title="å€¼ç©¿é€"></a>å€¼ç©¿é€</h5><p>é’ˆå¯¹ then çš„å‚æ•°å¯é€‰è¿™ä¸€ç‚¹ï¼Œå¦‚æœ <code>onFulfilled</code>  å’Œ <code>onRejectd</code> ä¸æ˜¯å‡½æ•°ï¼Œåˆ™ä¼šè¢«å¿½ç•¥ï¼Œå¹¶ä¸”å°†å€¼ä¼ é€’ç»™ä¸‹ä¸€ä¸ª thenã€‚å³æ‰€è°“çš„å€¼ç©¿é€ï¼Œå¯¹ <code>then</code> è¿›è¡Œæ”¹é€ :</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">then(onFulfilled, onRejected) &#123;  &#x2F;&#x2F; å¦‚æœä¸æ˜¯å‡½æ•°ï¼Œä¼ é€’ result    onFulfilled &#x3D;      typeof onFulfilled &#x3D;&#x3D;&#x3D; &#39;function&#39; ? onFulfilled : (result) &#x3D;&gt; result  &#x2F;&#x2F; å¦‚æœä¸æ˜¯å‡½æ•°ï¼ŒæŠ›å‡º reason    onRejected &#x3D;      typeof onRejected &#x3D;&#x3D;&#x3D; &#39;function&#39;        ? onRejected        : (reason) &#x3D;&gt; &#123;            throw reason          &#125;  &#x2F;&#x2F; ... if (this.state &#x3D;&#x3D;&#x3D; PENDING) ... &#125;</code></pre><p>å½“ç„¶å½“å‰çš„ç®€æ˜“ç‰ˆ promise è¿˜ä¸æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œå€¼ç©¿é€ä¹Ÿå°±æ— ä»è°ˆèµ·ã€‚</p><h5 id="å¼‚æ­¥æ‰§è¡Œ"><a href="#å¼‚æ­¥æ‰§è¡Œ" class="headerlink" title="å¼‚æ­¥æ‰§è¡Œ"></a>å¼‚æ­¥æ‰§è¡Œ</h5><p>åœ¨å®ç°é“¾å¼è°ƒç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬å®Œå–„ä»£ç ï¼Œä½¿å¾—<code>onFulfilled</code> å’Œ <code>onRejected</code>æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚</p><p>å½“å‰æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">var myPromise &#x3D; new MyPromise((resolve, reject) &#x3D;&gt; &#123;  resolve(1)&#125;)myPromise.then(  (val) &#x3D;&gt; &#123;    console.log(val)  &#125;,  (val) &#x3D;&gt; &#123;    console.log(val)  &#125;)console.log(2)</code></pre><p>ç°è¾“å‡º 1 å†è¾“å‡º 2ï¼Œæ˜¾ç„¶ä¸æ˜¯å¼‚æ­¥çš„ã€‚æ ¹æ® Promise/ A+ çš„è§„èŒƒï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ setTimeout æ¥æ”¹é€  resolve å’Œ reject ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; ...resolve(result) &#123;  &#x2F;&#x2F; é€šè¿‡ setTimeout æ¨¡æ‹Ÿå¼‚æ­¥  setTimeout(() &#x3D;&gt; &#123;    if (this.state &#x3D;&#x3D;&#x3D; PENDING) &#123;      &#x2F;&#x2F; ...    &#125;  &#125;)&#125;reject(reason) &#123;    &#x2F;&#x2F; é€šè¿‡ setTimeout æ¨¡æ‹Ÿå¼‚æ­¥  setTimeout(() &#x3D;&gt; &#123;    if (this.state &#x3D;&#x3D;&#x3D; PENDING) &#123;       &#x2F;&#x2F; ...    &#125;  &#125;)&#125;&#x2F;&#x2F; ...</code></pre><p>è‡³æ­¤ï¼Œè¾“å‡ºé¡ºåºå°†æ˜¯ 2, 1ã€‚ ç¬¦åˆé¢„æœŸ</p><h5 id="é“¾å¼è°ƒç”¨"><a href="#é“¾å¼è°ƒç”¨" class="headerlink" title="é“¾å¼è°ƒç”¨"></a>é“¾å¼è°ƒç”¨</h5><p>ç°åœ¨æ¥å®ç°é“¾å¼è°ƒç”¨ï¼š</p><ol><li><code>then</code> éœ€è¦è¿”å›ä¸€ä¸ª Promise</li><li><code>then</code> æ‹¿åˆ°ä¸Šä¸€æ¬¡ then çš„è¿”å›å€¼</li><li>å¦‚æœ then è¿”å›çš„æ˜¯ä¸€ä¸ª Promise åˆ™éœ€è¦ç­‰å¾…è¯¥ promise çŠ¶æ€å‘ç”Ÿå˜åŒ–åå†æ‰§è¡Œä¸‹ä¸€ä¸ª then</li></ol><p>promise2: æˆ‘ä»¬å°† then è¿”å›çš„ promise å‘½åä¸º promise2, å³ <code>promise2 = promise1.then(onFulfilled, onRejected);</code></p><p>x: å°† onFulfilled æˆ–è€… onRejected çš„è¿”å›å€¼å‘½åä¸º xï¼Œè¿™ä¸ª x å¯ä»¥æ˜¯ä¸€ä¸ª thenableã€‚</p><p>resolutionProcedure: promise è§£å†³æ­¥éª¤ã€‚å¦‚æœ <code>x</code> å…·æœ‰ thenable ç‰¹æ€§ï¼Œæˆ‘ä»¬å°±å‡è®¾ <code>x</code> çš„è¡Œä¸ºè‡³å°‘æœ‰ç‚¹åƒ promiseï¼Œå®ƒå°†è¯•å›¾ä½¿ promise æ¥æ”¶ <code>x</code> çš„çŠ¶æ€ã€‚å¦åˆ™ï¼Œå®ƒä½¿ç”¨å€¼ <code>x</code> æ‰§è¡Œ <code>promise</code>ã€‚ä¹‹æ‰€ä»¥æ˜¯ thenable æ˜¯ä¸ºäº†å¯ä»¥å…¼å®¹åˆ«çš„ promiseï¼ˆä¾‹å¦‚ fetchï¼‰ã€‚å®é™…ä¸Šè¿™ä¸ªæ–¹æ³•åœ¨ Promise / A+ ä¸­æœ‰å¾ˆå¤šæƒ…å†µåˆ†å‰ï¼Œæˆ‘ä»¬å…ˆç®€åŒ–æˆä»¥ä¸‹ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; åˆ†ç±»è®¨è®ºè¿”å›å€¼,å¦‚æœæ˜¯Promise,é‚£ä¹ˆç­‰å¾…PromiseçŠ¶æ€å˜æ›´, å¦åˆ™ç›´æ¥resolvex instanceof MyPromise ? x.then(resolve, reject) : resolve(x)</code></pre><p>ç°åœ¨çš„ Promise å®Œæ•´ä»£ç å¦‚ä¸‹ï¼Œ<strong>æ¥è¿‘å®Œå…¨ä½“ç‰ˆæœ¬</strong>ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const PENDING &#x3D; &#39;pending&#39;const RESOLVED &#x3D; &#39;resolved&#39;const REJECTED &#x3D; &#39;rejected&#39;class MyPromise &#123;  constructor(fn) &#123;    this.state &#x3D; PENDING    &#x2F;&#x2F; æ”¶é›† .then ä¸­çš„ resolve çš„å›è°ƒå‡½æ•°    this.resolveCallbacks &#x3D; []    &#x2F;&#x2F; æ”¶é›† .then ä¸­çš„ reject çš„å›è°ƒå‡½æ•°    this.rejectCallbacks &#x3D; []    &#x2F;&#x2F; resolve(result)    this.result &#x3D; null    &#x2F;&#x2F; reject(reason)    this.reason &#x3D; null    &#x2F;&#x2F; ç”±äº fn æœ‰å¯èƒ½å¼‚å¸¸ï¼Œéœ€è¦æ•è·    try &#123;      &#x2F;&#x2F; Promise ä¸€å®ä¾‹åŒ–å°±æ‰§è¡Œä¼ å…¥çš„ fn      &#x2F;&#x2F; æ³¨æ„æ­¤å¤„å°†å‡½æ•°å½“ä½œå‚æ•°ä¼ å…¥ï¼Œéœ€è¦ bind ç»‘å®šä¸Šä¸‹æ–‡      &#x2F;&#x2F; æˆ–è€… resolve &#x2F; reject ç”¨ç®­å¤´å‡½æ•°å®ç°      fn(this.resolve.bind(this), this.reject.bind(this))    &#125; catch (error) &#123;      this.reject(error)    &#125;  &#125;  resolve(result) &#123;    setTimeout(() &#x3D;&gt; &#123;      if (this.state &#x3D;&#x3D;&#x3D; PENDING) &#123;        &#x2F;&#x2F; ä¿®æ”¹çŠ¶æ€        this.state &#x3D; RESOLVED        this.result &#x3D; result        &#x2F;&#x2F; æ‰§è¡Œ then ä¸­çš„ resolve å›è°ƒå‡½æ•°        this.resolveCallbacks.forEach((cb) &#x3D;&gt; cb(result))      &#125;    &#125;)  &#125;  reject(reason) &#123;    setTimeout(() &#x3D;&gt; &#123;      if (this.state &#x3D;&#x3D;&#x3D; PENDING) &#123;        &#x2F;&#x2F; ä¿®æ”¹çŠ¶æ€        this.state &#x3D; REJECTED        this.reason &#x3D; reason        &#x2F;&#x2F; æ‰§è¡Œ then ä¸­çš„ reject å›è°ƒå‡½æ•°        this.rejectCallbacks.forEach((cb) &#x3D;&gt; cb(reason))      &#125;    &#125;)  &#125;  then(onFulfilled, onRejected) &#123;    &#x2F;&#x2F; å¦‚æœä¸æ˜¯å‡½æ•°ï¼Œä¼ é€’ result    onFulfilled &#x3D;      typeof onFulfilled &#x3D;&#x3D;&#x3D; &#39;function&#39; ? onFulfilled : (result) &#x3D;&gt; result    &#x2F;&#x2F; å¦‚æœä¸æ˜¯å‡½æ•°ï¼ŒæŠ›å‡º reason    onRejected &#x3D;      typeof onRejected &#x3D;&#x3D;&#x3D; &#39;function&#39;        ? onRejected        : (reason) &#x3D;&gt; &#123;            throw reason          &#125;    &#x2F;&#x2F; è°ƒç”¨ .then æ—¶å¦‚æœè¿˜åœ¨ pending åˆ™å°†å›è°ƒå…ˆå­˜èµ·æ¥ï¼Œç­‰å¾… resolve åæ‰§è¡Œ    if (this.state &#x3D;&#x3D;&#x3D; PENDING) &#123;      const promise2 &#x3D; new MyPromise((resolve, reject) &#x3D;&gt; &#123;        const resolvedCallBack &#x3D; () &#x3D;&gt; &#123;          try &#123;            const x &#x3D; onFulfilled(this.result)            &#x2F;&#x2F; ç®€åŒ–é€»è¾‘çš„ resolutionProcedure            x instanceof MyPromise ? x.then(resolve, reject) : resolve(x)            &#x2F;&#x2F; resolutionProcedure(promise2, x, resolve, reject)          &#125; catch (error) &#123;            reject(error)          &#125;        &#125;        const rejectCallBack &#x3D; () &#x3D;&gt; &#123;          try &#123;            const x &#x3D; onRejected(this.result)            &#x2F;&#x2F; ç®€åŒ–é€»è¾‘çš„ resolutionProcedure            x instanceof MyPromise ? x.then(resolve, reject) : resolve(x)            &#x2F;&#x2F; resolutionProcedure(promise2, x, resolve, reject)          &#125; catch (error) &#123;            reject(error)          &#125;        &#125;        &#x2F;&#x2F; æ”¶é›†å›è°ƒ        this.resolveCallbacks.push(resolvedCallBack)        this.rejectCallbacks.push(onRejected)      &#125;)      return promise2    &#125;    &#x2F;&#x2F; å¦‚æœè°ƒç”¨ .then æ—¶å·²ç» resolve &#x2F; reject, é‚£ä¹ˆç›´æ¥æ‰§è¡Œå¯¹åº”çš„å›è°ƒ    if (this.state &#x3D;&#x3D;&#x3D; RESOLVED) &#123;      onFulfilled(this.result)    &#125;    if (this.state &#x3D;&#x3D;&#x3D; REJECTED) &#123;      onRejected(this.reason)    &#125;  &#125;&#125;</code></pre><h5 id="resolutionProcedure"><a href="#resolutionProcedure" class="headerlink" title="resolutionProcedure"></a>resolutionProcedure</h5><p>æœ€åæ ¹æ® Promise / A+ çš„è§„èŒƒæ¥å®Œå–„ resolutionProcedureï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ç³»åˆ—çš„åˆ¤æ–­ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const resolutionProcedure &#x3D; (promise2, x, resolve, reject) &#x3D;&gt; &#123;  if (promise2 &#x3D;&#x3D;&#x3D; x) &#123;    return reject(new TypeError(&#39;Error&#39;))  &#125;  if (x instanceof MyPromise) &#123;    x.then(function(value) &#123;        resolutionProcedure(promise2, value, resolve, reject)    &#125;, reject)&#125;  let called &#x3D; false  if (x !&#x3D;&#x3D; null &amp;&amp; (typeof x &#x3D;&#x3D;&#x3D; &#39;object&#39; || typeof x &#x3D;&#x3D;&#x3D; &#39;function&#39;)) &#123;    try &#123;      let then &#x3D; x.then      if (typeof then &#x3D;&#x3D;&#x3D; &#39;function&#39;) &#123;        then.call(          x,          y &#x3D;&gt; &#123;            if (called) return            called &#x3D; true            resolutionProcedure(promise2, y, resolve, reject)          &#125;,          e &#x3D;&gt; &#123;            if (called) return            called &#x3D; true            reject(e)          &#125;        )      &#125; else &#123;        resolve(x)      &#125;    &#125; catch (e) &#123;      if (called) return      called &#x3D; true      reject(e)    &#125;  &#125; else &#123;    resolve(x)  &#125;&#125;</code></pre><h4 id="ç¬¦åˆ-Promise-A-çš„-Promise-1"><a href="#ç¬¦åˆ-Promise-A-çš„-Promise-1" class="headerlink" title="ç¬¦åˆ Promise / A+ çš„ Promise"></a>ç¬¦åˆ Promise / A+ çš„ Promise</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const PENDING &#x3D; &#39;pending&#39;const RESOLVED &#x3D; &#39;resolved&#39;const REJECTED &#x3D; &#39;rejected&#39;const resolutionProcedure &#x3D; (promise2, x, resolve, reject) &#x3D;&gt; &#123;  if (promise2 &#x3D;&#x3D;&#x3D; x) &#123;    return reject(new TypeError(&#39;Error&#39;))  &#125;  if (x instanceof MyPromise) &#123;    x.then(function (value) &#123;      resolutionProcedure(promise2, value, resolve, reject)    &#125;, reject)  &#125;  let called &#x3D; false  if (x !&#x3D;&#x3D; null &amp;&amp; (typeof x &#x3D;&#x3D;&#x3D; &#39;object&#39; || typeof x &#x3D;&#x3D;&#x3D; &#39;function&#39;)) &#123;    try &#123;      let then &#x3D; x.then      if (typeof then &#x3D;&#x3D;&#x3D; &#39;function&#39;) &#123;        then.call(          x,          (y) &#x3D;&gt; &#123;            if (called) return            called &#x3D; true            resolutionProcedure(promise2, y, resolve, reject)          &#125;,          (e) &#x3D;&gt; &#123;            if (called) return            called &#x3D; true            reject(e)          &#125;        )      &#125; else &#123;        resolve(x)      &#125;    &#125; catch (e) &#123;      if (called) return      called &#x3D; true      reject(e)    &#125;  &#125; else &#123;    resolve(x)  &#125;&#125;class MyPromise &#123;  constructor(fn) &#123;    this.state &#x3D; PENDING    &#x2F;&#x2F; æ”¶é›† .then ä¸­çš„ resolve çš„å›è°ƒå‡½æ•°    this.resolveCallbacks &#x3D; []    &#x2F;&#x2F; æ”¶é›† .then ä¸­çš„ reject çš„å›è°ƒå‡½æ•°    this.rejectCallbacks &#x3D; []    &#x2F;&#x2F; resolve(result)    this.result &#x3D; null    &#x2F;&#x2F; reject(reason)    this.reason &#x3D; null    &#x2F;&#x2F; ç”±äº fn æœ‰å¯èƒ½å¼‚å¸¸ï¼Œéœ€è¦æ•è·    try &#123;      &#x2F;&#x2F; Promise ä¸€å®ä¾‹åŒ–å°±æ‰§è¡Œä¼ å…¥çš„ fn      &#x2F;&#x2F; æ³¨æ„æ­¤å¤„å°†å‡½æ•°å½“ä½œå‚æ•°ä¼ å…¥ï¼Œéœ€è¦ bind ç»‘å®šä¸Šä¸‹æ–‡      &#x2F;&#x2F; æˆ–è€… resolve &#x2F; reject ç”¨ç®­å¤´å‡½æ•°å®ç°      fn(this.resolve.bind(this), this.reject.bind(this))    &#125; catch (error) &#123;      this.reject(error)    &#125;  &#125;  resolve(result) &#123;    setTimeout(() &#x3D;&gt; &#123;      if (this.state &#x3D;&#x3D;&#x3D; PENDING) &#123;        &#x2F;&#x2F; ä¿®æ”¹çŠ¶æ€        this.state &#x3D; RESOLVED        this.result &#x3D; result        &#x2F;&#x2F; æ‰§è¡Œ then ä¸­çš„ resolve å›è°ƒå‡½æ•°        this.resolveCallbacks.forEach((cb) &#x3D;&gt; cb(result))      &#125;    &#125;)  &#125;  reject(reason) &#123;    setTimeout(() &#x3D;&gt; &#123;      if (this.state &#x3D;&#x3D;&#x3D; PENDING) &#123;        &#x2F;&#x2F; ä¿®æ”¹çŠ¶æ€        this.state &#x3D; REJECTED        this.reason &#x3D; reason        &#x2F;&#x2F; æ‰§è¡Œ then ä¸­çš„ reject å›è°ƒå‡½æ•°        this.rejectCallbacks.forEach((cb) &#x3D;&gt; cb(reason))      &#125;    &#125;)  &#125;  then(onFulfilled, onRejected) &#123;    &#x2F;&#x2F; å¦‚æœä¸æ˜¯å‡½æ•°ï¼Œä¼ é€’ result    onFulfilled &#x3D;      typeof onFulfilled &#x3D;&#x3D;&#x3D; &#39;function&#39; ? onFulfilled : (result) &#x3D;&gt; result    &#x2F;&#x2F; å¦‚æœä¸æ˜¯å‡½æ•°ï¼ŒæŠ›å‡º reason    onRejected &#x3D;      typeof onRejected &#x3D;&#x3D;&#x3D; &#39;function&#39;        ? onRejected        : (reason) &#x3D;&gt; &#123;            throw reason          &#125;    &#x2F;&#x2F; è°ƒç”¨ .then æ—¶å¦‚æœè¿˜åœ¨ pending åˆ™å°†å›è°ƒå…ˆå­˜èµ·æ¥ï¼Œç­‰å¾… resolve åæ‰§è¡Œ    if (this.state &#x3D;&#x3D;&#x3D; PENDING) &#123;      const promise2 &#x3D; new MyPromise((resolve, reject) &#x3D;&gt; &#123;        const resolvedCallBack &#x3D; () &#x3D;&gt; &#123;          try &#123;            const x &#x3D; onFulfilled(this.result)            resolutionProcedure(promise2, x, resolve, reject)          &#125; catch (error) &#123;            reject(error)          &#125;        &#125;        const rejectCallBack &#x3D; () &#x3D;&gt; &#123;          try &#123;            const x &#x3D; onRejected(this.result)            resolutionProcedure(promise2, x, resolve, reject)          &#125; catch (error) &#123;            reject(error)          &#125;        &#125;        &#x2F;&#x2F; æ”¶é›†å›è°ƒ        this.resolveCallbacks.push(resolvedCallBack)        this.rejectCallbacks.push(onRejected)      &#125;)      return promise2    &#125;    &#x2F;&#x2F; å¦‚æœè°ƒç”¨ .then æ—¶å·²ç» resolve &#x2F; reject, é‚£ä¹ˆç›´æ¥æ‰§è¡Œå¯¹åº”çš„å›è°ƒ    if (this.state &#x3D;&#x3D;&#x3D; RESOLVED) &#123;      onFulfilled(this.result)    &#125;    if (this.state &#x3D;&#x3D;&#x3D; REJECTED) &#123;      onRejected(this.reason)    &#125;  &#125;&#125;</code></pre><p>è‡³æ­¤æˆ‘ä»¬å®Œæˆäº†ä¸€ä¸ª ç¬¦åˆ Promise / A+ çš„ Promiseï¼Œå®é™…ä¸Š Promise è¿˜ä¼šæä¾›ä¸€äº›å¦‚ <code>.all</code>, <code>.race</code> ä¹‹ç±»çš„ apiï¼Œè¿™é‡Œä¹Ÿå®ç°ä¸€ä¸‹ã€‚</p><h4 id="Promise-all"><a href="#Promise-all" class="headerlink" title="Promise.all"></a>Promise.all</h4><p>Promise.all æ¥æ”¶å¤šä¸ª Promise å®ä¾‹ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚ä¾‹å¦‚ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const p &#x3D; Promise.all([p1, p2, p3])</code></pre><p>ä¸Šè¿°çš„ p1, p2, p3 éƒ½æ˜¯ Promise å®ä¾‹ï¼Œå¦‚æœä¸æ˜¯åˆ™ä¼šç”¨ Promise.resolve è½¬æˆ promiseã€‚æ­¤å¤–ï¼Œ<code>Promise.all()</code>æ–¹æ³•çš„å‚æ•°å¯ä»¥ä¸æ˜¯æ•°ç»„ï¼Œä½†å¿…é¡»å…·æœ‰ Iterator æ¥å£ï¼Œä¸”è¿”å›çš„æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ Promise å®ä¾‹ã€‚</p><p><code>p</code>çš„çŠ¶æ€ç”±<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>å†³å®šï¼Œåˆ†æˆä¸¤ç§æƒ…å†µã€‚</p><p>ï¼ˆ1ï¼‰åªæœ‰<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>çš„çŠ¶æ€éƒ½å˜æˆ<code>fulfilled</code>ï¼Œ<code>p</code>çš„çŠ¶æ€æ‰ä¼šå˜æˆ<code>fulfilled</code>ï¼Œæ­¤æ—¶<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>çš„è¿”å›å€¼ç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚</p><p>ï¼ˆ2ï¼‰åªè¦<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>ä¹‹ä¸­æœ‰ä¸€ä¸ªè¢«<code>rejected</code>ï¼Œ<code>p</code>çš„çŠ¶æ€å°±å˜æˆ<code>rejected</code>ï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªè¢«<code>reject</code>çš„å®ä¾‹çš„è¿”å›å€¼ï¼Œä¼šä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚</p><p>å®ç°å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class MyPromise &#123;  &#x2F;&#x2F; ...  all(arr) &#123;    &#x2F;&#x2F; ç”¨äºå­˜å‚¨è¿”å›å€¼    let list &#x3D; []    &#x2F;&#x2F; è®°å½• resolve äº†å¤šå°‘ä¸ª promise    let length &#x3D; 0    &#x2F;&#x2F; æ‰§è¡Œ promise çš„è¿‡ç¨‹ä¸­æ˜¯å¦æœ‰å¼‚å¸¸    let hasError &#x3D; false    &#x2F;&#x2F; è¿”å›ä¸€ä¸ªæ–°çš„ Promise    return new MyPromise((resolve, reject) &#x3D;&gt; &#123;      for (let i &#x3D; 0; i &lt; arr.length; i++) &#123;        &#x2F;&#x2F; åˆ¤æ–­å…ƒç´ æ˜¯å¦ä¸º MyPromiseï¼Œ å¦åˆ™ resolve        const p &#x3D;          arr[i] instanceof MyPromise ? arr[i] : MyPromise.resolve(arr[i])        p.then((data) &#x3D;&gt; &#123;          list[i] &#x3D; data          length++          if (length &#x3D;&#x3D;&#x3D; arr.length) &#123;            &#x2F;&#x2F; å¦‚æœå…¨éƒ¨ promise éƒ½ resolved            resolve(list)          &#125;        &#125;).catch((error) &#x3D;&gt; &#123;          if (!hasError) &#123;            &#x2F;&#x2F; ç¬¬ä¸€ä¸ªè¢« reject çš„å®ä¾‹çš„è¿”å›å€¼ï¼Œä¼šä¼ é€’ç»™ p çš„å›è°ƒå‡½æ•°            reject(error)          &#125;          hasErr &#x3D; true        &#125;)      &#125;    &#125;)  &#125;  &#x2F;&#x2F; ...&#125;</code></pre><h4 id="Promise-race"><a href="#Promise-race" class="headerlink" title="Promise.race"></a>Promise.race</h4><p>Promise.race()`æ–¹æ³•åŒæ ·æ˜¯å°†å¤šä¸ª Promise å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const p &#x3D; Promise.race([p1, p2, p3]);</code></pre><p>åªè¦<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>ä¹‹ä¸­æœ‰ä¸€ä¸ªå®ä¾‹ç‡å…ˆæ”¹å˜çŠ¶æ€ï¼Œ<code>p</code>çš„çŠ¶æ€å°±è·Ÿç€æ”¹å˜ã€‚é‚£ä¸ªç‡å…ˆæ”¹å˜çš„ Promise å®ä¾‹çš„è¿”å›å€¼ï¼Œå°±ä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class MyPromise &#123;  &#x2F;&#x2F; ...  race(arr) &#123;    &#x2F;&#x2F; æ˜¯å¦æœ‰ç»“æœ    let hasResult &#x3D; false    &#x2F;&#x2F; è¿”å›ä¸€ä¸ªæ–°çš„ Promise    return new MyPromise((resolve, reject) &#x3D;&gt; &#123;      for (let i &#x3D; 0; i &lt; arr.length; i++) &#123;        &#x2F;&#x2F; åˆ¤æ–­å…ƒç´ æ˜¯å¦ä¸º MyPromiseï¼Œ å¦åˆ™ resolve        const p &#x3D;          arr[i] instanceof MyPromise ? arr[i] : MyPromise.resolve(arr[i])        p.then((data) &#x3D;&gt; &#123;          if (!hasResult) &#123;            resolve(data)          &#125;          hasResult &#x3D; true        &#125;).catch((error) &#x3D;&gt; &#123;          if (!hasResult) &#123;            reject(error)          &#125;          hasResult &#x3D; true        &#125;)      &#125;    &#125;)  &#125;  &#x2F;&#x2F; ...&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>svg å›¾ç‰‡çš„ä¸Šä¼ ä¸‹è½½</title>
      <link href="/2020/08/17/svg%20%E5%9B%BE%E7%89%87%E7%9A%84%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD/"/>
      <url>/2020/08/17/svg%20%E5%9B%BE%E7%89%87%E7%9A%84%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>æœ€è¿‘æœ‰ä¸ªéœ€æ±‚ï¼š</p><ol><li>æ ¹æ®ä¼ å…¥çš„ code ç”Ÿæˆæ¡å½¢ç  svg å›¾ç‰‡</li><li>å°† svg å›¾ç‰‡ä¸Šä¼ è‡³ cdn</li><li>å±•ç¤ºå›¾ç‰‡æ—¶éœ€è¦ç‚¹å‡»æŒ‰é’®åä¿å­˜è‡³æœ¬åœ°</li></ol><a id="more"></a><h4 id="ç”Ÿæˆæ¡å½¢ç "><a href="#ç”Ÿæˆæ¡å½¢ç " class="headerlink" title="ç”Ÿæˆæ¡å½¢ç "></a>ç”Ÿæˆæ¡å½¢ç </h4><p>è¿™é‡Œå€ŸåŠ©ä¸€ä¸ªå¼€æºçš„ä»“åº“</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">import JsBarcode from &#39;jsbarcode&#39;;const generateBarcode &#x3D; async (barcode, options &#x3D; &#123;&#125;) &#x3D;&gt; &#123;  &#x2F;&#x2F; åˆ›å»ºä¸€ä¸ª svg å…ƒç´   const svg &#x3D; document.createElementNS(&#39;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&#39;, &#39;svg&#39;);  &#x2F;&#x2F; ç”šè‡³å®½é«˜  svg.setAttribute(&#39;width&#39;, &#96;$&#123;width&#125;px&#96;);  svg.setAttribute(&#39;height&#39;, &#96;$&#123;height&#125;px&#96;);  &#x2F;&#x2F; ç”Ÿæˆæ¡å½¢ç  svg çš„å›¾ç‰‡  JsBarcode(svg, barcode, options);  return svg&#125;</code></pre><h4 id="å›¾ç‰‡ä¸Šä¼ "><a href="#å›¾ç‰‡ä¸Šä¼ " class="headerlink" title="å›¾ç‰‡ä¸Šä¼ "></a>å›¾ç‰‡ä¸Šä¼ </h4><h5 id="svg-è½¬-canvas"><a href="#svg-è½¬-canvas" class="headerlink" title="svg è½¬ canvas"></a>svg è½¬ canvas</h5><p>ç”±äºæœåŠ¡ç«¯åŒå­¦æä¾›çš„æ¥å£åªæ”¯æŒ canvasï¼Œå› æ­¤é¦–å…ˆè¦å°† svg è½¬æˆ canvasï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const svgToCanvas &#x3D; (svg) &#x3D;&gt; &#123;  &#x2F;&#x2F; svg.outerHTML è·å– svg å…ƒç´ çš„ html å­—ç¬¦ä¸²  &#x2F;&#x2F; btoa å°† svg è½¬æˆ base64const href &#x3D; &#96;data:image&#x2F;svg+xml;base64,$&#123;window.btoa(    unescape(encodeURIComponent(svg.outerHTML)),  )&#125;&#96;;  &#x2F;&#x2F; æ„å»ºä¸€ä¸ª Image  const img &#x3D; new Image();  img.width &#x3D; width;  img.height &#x3D; height;    img.onload &#x3D; () &#x3D;&gt; &#123;    &#x2F;&#x2F; æ„å»ºä¸€ä¸ª canvas    const canvas &#x3D; document.createElement(&#39;canvas&#39;);    const ctx &#x3D; canvas.getContext(&#39;2d&#39;);    ctx.fillRect(0, 0, width, height);    &#x2F;&#x2F; å°† å›¾ç‰‡ç”»åˆ° canvas ä¸­    ctx.drawImage(img, 0, 0, width, height);    &#x2F;&#x2F; è½¬æˆ jpeg çš„ base64 const dataURI &#x3D; canvas.toDataURL(&#39;image&#x2F;jpeg&#39;);    &#x2F;&#x2F; ä¸Šä¼     upload(dataURI);  &#125;   img.src &#x3D; href;&#125;</code></pre><h5 id="Data-URL"><a href="#Data-URL" class="headerlink" title="Data URL"></a>Data URL</h5><p>é€šè¿‡ `canvas.toDataURL å°† canvas è½¬æˆ Data URLï¼Œä¸€æ®µ Data URL ç”± 4 ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">data:[&lt;mediatype&gt;][;base64],&lt;data&gt;&#x2F;&#x2F; ä¾‹å¦‚ï¼š &quot;data:image&#x2F;png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAADElEQVQImWNgoBMAAABpAAFEI8ARAAAAAElFTkSuQmCC&quot;</code></pre><h5 id="Base64çš„è§£ç ä¸ç¼–ç "><a href="#Base64çš„è§£ç ä¸ç¼–ç " class="headerlink" title="Base64çš„è§£ç ä¸ç¼–ç "></a>Base64çš„è§£ç ä¸ç¼–ç </h5><p><code>atob()</code> å‡½æ•°èƒ½å¤Ÿè§£ç é€šè¿‡base-64ç¼–ç çš„å­—ç¬¦ä¸²æ•°æ®ã€‚</p><p><code>btoa()</code> å‡½æ•°èƒ½å¤Ÿä»äºŒè¿›åˆ¶æ•°æ®â€œå­—ç¬¦ä¸²â€åˆ›å»ºä¸€ä¸ªbase-64ç¼–ç çš„ASCIIå­—ç¬¦ä¸²ã€‚</p><h5 id="Base64-è½¬-Blob"><a href="#Base64-è½¬-Blob" class="headerlink" title="Base64 è½¬ Blob"></a>Base64 è½¬ Blob</h5><p>ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶éœ€è¦å°† base64 è½¬æˆ Blob å¯¹è±¡ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><p>######Base64 è½¬ Blob ç¬¬ä¸€ç§æ–¹æ³•ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">function dataURItoBlob(dataURI: string) &#123;  &#x2F;&#x2F; é€šè¿‡ atob è½¬å› string  const byteString &#x3D; atob(dataURI.split(&#39;,&#39;)[1]);  &#x2F;&#x2F; è·å¾—æ–‡ä»¶ç±»å‹  const mimeString &#x3D; dataURI.split(&#39;,&#39;)[0].split(&#39;:&#39;)[1].split(&#39;;&#39;)[0];  &#x2F;&#x2F; è½¬æˆ   const ab &#x3D; new ArrayBuffer(byteString.length);  const ia &#x3D; new Uint8Array(ab);  for (let i &#x3D; 0; i &lt; byteString.length; i++) &#123;    ia[i] &#x3D; byteString.charCodeAt(i);  &#125;&#x2F;&#x2F; è½¬æˆ blob  const bb &#x3D; new Blob([ab], &#123; type: mimeString &#125;);  return bb;&#125;</code></pre><p> æ€è·¯ï¼š</p><ol><li>æ‹†è§£ data uriï¼Œé€šè¿‡ atob å°† base64 è§£ç æˆå­—ç¬¦ä¸²</li><li>æ‹†è§£ data uriï¼Œè·å¾—å›¾ç‰‡çš„æ ¼å¼</li><li>åˆ›å»ºä¸€ä¸ª arraybuffer</li><li>é€šè¿‡TypedArrayï¼ˆè¿™é‡Œä½¿ç”¨ Uint8Arrayï¼‰å°†å­—ç¬¦ä¸²çš„å†…å®¹å†™å…¥ arraybuffer </li><li>å°† array buffer è½¬æˆ blob</li></ol><h6 id="Base64-è½¬-Blob-ç¬¬äºŒç§æ–¹æ³•ï¼š"><a href="#Base64-è½¬-Blob-ç¬¬äºŒç§æ–¹æ³•ï¼š" class="headerlink" title="Base64 è½¬ Blob ç¬¬äºŒç§æ–¹æ³•ï¼š"></a>Base64 è½¬ Blob ç¬¬äºŒç§æ–¹æ³•ï¼š</h6><p>é€šè¿‡ <code>fetch</code> å°† dataURI è½¬æˆ blobï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">const bb &#x3D; await fetch(dataURI).then((res) &#x3D;&gt; res.blob())</code></pre><h5 id="ä¸Šä¼ å›¾ç‰‡"><a href="#ä¸Šä¼ å›¾ç‰‡" class="headerlink" title="ä¸Šä¼ å›¾ç‰‡"></a>ä¸Šä¼ å›¾ç‰‡</h5><p>æ„é€  FormData ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const upload &#x3D; (dataURI: string) &#x3D;&gt; &#123;  &#x2F;&#x2F; åˆ›å»ºformå¯¹è±¡const formData &#x3D; new FormData();  &#x2F;&#x2F; é€šè¿‡ append å‘ form å¯¹è±¡æ·»åŠ æ•°æ®  formData.append(&#39;file&#39;, dataURItoBlob(dataURI));  const &#123; data &#125; &#x3D; await axios.post(&#39;&#x2F;api&#x2F;upload&#39;, formData, &#123;    headers: &#123;      &#39;Content-Type&#39;: &#39;multipart&#x2F;form-data&#39;,      &#39;X-Requested-With&#39;: &#39;XMLHttpRequest&#39;,    &#125;,  &#125;);&#125;</code></pre><h5 id="ä¸‹è½½å›¾ç‰‡"><a href="#ä¸‹è½½å›¾ç‰‡" class="headerlink" title="ä¸‹è½½å›¾ç‰‡"></a>ä¸‹è½½å›¾ç‰‡</h5><p>ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const download &#x3D; (fileUrl, name) &#x3D;&gt; &#123;  const x &#x3D; new XMLHttpRequest();  x.open(&#39;GET&#39;, fileUrl, true);  x.responseType &#x3D; &#39;blob&#39;;  x.onload &#x3D; () &#x3D;&gt; &#123;    &#x2F;&#x2F; è½¬ä¸º objectUrl    const url &#x3D; window.URL.createObjectURL(x.response);    &#x2F;&#x2F; æ„å»ºä¸€ä¸ª a æ ‡ç­¾    const a &#x3D; document.createElement(&#39;a&#39;);    a.href &#x3D; url;    a.download &#x3D; name;    a.click();  &#125;;  x.send();&#125;;</code></pre><p>åˆ©ç”¨ a æ ‡ç­¾çš„ download å±æ€§å¯ä»¥å®ç°å›¾ç‰‡çš„ä¸‹è½½ï¼Œä½†æ˜¯æœ‰ä¸ªé™åˆ¶æ˜¯ href å¿…é¡»æ˜¯åŒæºçš„åœ°å€ï¼Œå¦åˆ™æ— æ³•ä¸‹è½½ã€‚</p><p>å› æ­¤è¿™é‡Œé€šè¿‡ get è¯·æ±‚è·å¾—å›¾ç‰‡çš„ Blob æ ¼å¼ï¼Œå¹¶ç”¨ window.URL.createObjectURL å°† Blob è½¬æˆ objectUrl è§£å†³äº†è·¨åŸŸé—®é¢˜ã€‚ä¹‹åå°±å¯ä»¥ç”¨ a æ ‡ç­¾çš„ download å±æ€§ä¸‹è½½æ–‡ä»¶ã€‚</p><h4 id="è¡¥å……å‡ ä¸ªæ¦‚å¿µ"><a href="#è¡¥å……å‡ ä¸ªæ¦‚å¿µ" class="headerlink" title="è¡¥å……å‡ ä¸ªæ¦‚å¿µ"></a>è¡¥å……å‡ ä¸ªæ¦‚å¿µ</h4><h5 id="blob"><a href="#blob" class="headerlink" title="blob"></a>blob</h5><p>ä¸Šä¼ å›¾ç‰‡æ—¶ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªå‡½æ•° dataURItoBlobï¼Œ é€šè¿‡è¿™ä¸ªå‡½æ•°æ¥å°† base64 è½¬ä¸º Blobï¼Œæœ€ç»ˆä¸Šä¼ ç»™æ¥å£çš„ formData ä¸­çš„ file ä¹Ÿæ˜¯ä¸€ä¸ª Blob å¯¹è±¡ã€‚</p><p>ä»€ä¹ˆæ˜¯ Blob å¯¹è±¡ï¼Ÿ</p><blockquote><p>ä¸€ä¸ª <strong>Blob</strong>å¯¹è±¡è¡¨ç¤ºä¸€ä¸ªä¸å¯å˜çš„, åŸå§‹æ•°æ®çš„ç±»ä¼¼æ–‡ä»¶å¯¹è±¡ã€‚Blob è¡¨ç¤ºçš„ä¸ä¸€å®šæ˜¯JavaScriptåŸç”Ÿæ ¼å¼çš„æ•°æ®ã€‚<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/File"><code>File</code></a> æ¥å£åŸºäº<code>Blob</code>ï¼Œç»§æ‰¿äº† blob çš„åŠŸèƒ½å¹¶å°†å…¶æ‰©å±•ä½¿å…¶æ”¯æŒç”¨æˆ·ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚</p></blockquote><p>Blob å±äº web æä¾›çš„ apiï¼Œå› æ­¤ mdn ä¸Šè¯´çš„ Blob è¡¨ç¤ºçš„ä¸ä¸€å®šæ˜¯JavaScriptåŸç”Ÿæ ¼å¼çš„æ•°æ®ã€‚</p><h5 id="File"><a href="#File" class="headerlink" title="File"></a>File</h5><p>File ç»§æ‰¿è‡ª Blobï¼Œå¯ä»¥çœ‹ä½œæ˜¯ç‰¹æ®Šçš„ Blobã€‚å¸¸è§çš„è·å¾— File å¯¹è±¡çš„æ–¹æ³•æœ‰ <code>input</code> æ ‡ç­¾ä¸Šé€‰æ‹©æ–‡ä»¶åè¿”å›çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FileList"><code>FileList</code></a> å¯¹è±¡ã€‚</p><h5 id="Blob-è½¬-URL"><a href="#Blob-è½¬-URL" class="headerlink" title="Blob è½¬ URL"></a>Blob è½¬ URL</h5><p>åœ¨ä¸‹è½½æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡ get è¯·æ±‚è·å¾—äº†å›¾ç‰‡çš„ blob æ ¼å¼ï¼Œä¹‹åé€šè¿‡ URL.createObjectURL è½¬æˆ objectUrlï¼Œè¿™æ ·å°±å¯ä»¥åƒæ™®é€šçš„ urlï¼Œèµ‹å€¼ç»™ img çš„ src å±æ€§æˆ–è€… a æ ‡ç­¾çš„ href å±æ€§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æºç å±‚é¢è§£è¯»Vueå“åº”å¼åŸç†</title>
      <link href="/2020/08/11/%E6%BA%90%E7%A0%81%E5%B1%82%E9%9D%A2%E8%A7%A3%E8%AF%BBVue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86/"/>
      <url>/2020/08/11/%E6%BA%90%E7%A0%81%E5%B1%82%E9%9D%A2%E8%A7%A3%E8%AF%BBVue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ Vueï¼ˆä»¥ä¸‹å‡æŒ‡çš„æ˜¯ 2.x ç‰ˆæœ¬ï¼‰ ä¸­ï¼Œæ•°æ®æ¨¡å‹ä»…ä»…æ˜¯æ™®é€šçš„ JavaScript å¯¹è±¡ï¼Œå½“ä½ ä¿®æ”¹å®ƒä»¬æ—¶ï¼Œè§†å›¾ä¼šè¿›è¡Œæ›´æ–°ï¼Œè¿™å°±æ˜¯ Vue çš„å“åº”å¼ç³»ç»Ÿï¼Œå…¶è®¾è®¡æ¨¡å¼å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ã€‚</p><a id="more"></a><h4 id="æ€è·¯æ¢³ç†"><a href="#æ€è·¯æ¢³ç†" class="headerlink" title="æ€è·¯æ¢³ç†"></a>æ€è·¯æ¢³ç†</h4><p>ä»¥ä¸‹ä¸ºé˜…è¯»æºç æ—¶ï¼Œå¯¹å“åº”å¼å®ç°åŸç†çš„ç†è§£ï¼Œä¸ºäº†æ€è·¯æ›´æ¸…æ™°ï¼Œä»…è€ƒè™‘æœ€ç®€å•çš„æƒ…å†µï¼Œå¹¶ä¸”å¯èƒ½ä¼šçœç•¥æˆ–ä¿®æ”¹éƒ¨åˆ†ä»£ç ã€‚</p><p>é¦–å…ˆï¼Œé¡ºç€ vue çš„ç”Ÿå‘½å‘¨æœŸå¼€å§‹ï¼š</p><h5 id="beforeCreate-ä¸-created"><a href="#beforeCreate-ä¸-created" class="headerlink" title="beforeCreate ä¸ created"></a>beforeCreate ä¸ created</h5><p>é¦–å…ˆ åœ¨ _init æ–¹æ³•ä¸­æ‰§è¡Œ beforeCreate ä¸ created ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Vue.prototype._init &#x3D; function (options?: Object) &#123;  &#x2F;&#x2F; ...  callHook(vm, &#39;beforeCreate&#39;)  &#x2F;&#x2F; ...  initState(vm)  &#x2F;&#x2F; ...  callHook(vm, &#39;created&#39;)  &#x2F;&#x2F; ...&#125;</code></pre><p>è®°ä½è¿™é‡Œæ‰§è¡Œäº†ä¸€ä¸ªæ–¹æ³•ï¼š <code>initState</code></p><p>#####initState</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">export function initState (vm: Component) &#123;&#x2F;&#x2F; ç•¥ï¼š...åˆå§‹åŒ– propsï¼Œmethods ç­‰  if (opts.data) &#123;    initData(vm)  &#125; else &#123;    observe(vm._data &#x3D; &#123;&#125;, true &#x2F;* asRootData *&#x2F;)  &#125;  &#x2F;&#x2F; ç•¥ï¼š...åˆå§‹åŒ– computedï¼Œwatch ç­‰&#125;</code></pre><p>è¿™é‡Œçš„ initData ä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">function initData (vm: Component) &#123;  &#x2F;&#x2F; ç•¥ï¼š...å°† data çš„æ¯ä¸ªå±æ€§éƒ½æŒ‚åœ¨ vm ä¸Š,è¿™æ ·å¯ä»¥é€šè¿‡ this.xx ç›´æ¥è®¿é—®åˆ°  &#x2F;&#x2F; observe data  observe(data, true &#x2F;* asRootData *&#x2F;)&#125;</code></pre><p>è®°ä½ <code>observe</code> è¿™ä¸ªæ–¹æ³•ã€‚</p><h5 id="observe"><a href="#observe" class="headerlink" title="observe"></a>observe</h5><p><code>observe</code>  ç”¨äºåˆ›å»ºä¸€ä¸ª observer å®ä¾‹ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">export function observe (value: any, asRootData: ?boolean): Observer | void &#123;  let ob: Observer | void  &#x2F;&#x2F; åˆ¤æ–­æ˜¯å¦å·²ç» observe è¿‡ï¼Œæ˜¯çš„è¯ç›´æ¥è¿”å›  if (hasOwn(value, &#39;__ob__&#39;) &amp;&amp; value.__ob__ instanceof Observer) &#123;    &#x2F;&#x2F; observer æœ€ç»ˆä¼šæŒ‚åœ¨ value çš„ __ob__ å±æ€§ä¸Šï¼Œå› æ­¤å¯ä»¥è¿™ä¹ˆåˆ¤æ–­æ˜¯å¦  observe è¿‡ï¼Œè¯¦æƒ…çœ‹ Observer çš„ä»£ç     ob &#x3D; value.__ob__  &#125; else if (...) &#123;    &#x2F;&#x2F; å¦åˆ™æ»¡è¶³ä¸€ç³»åˆ—æ¡ä»¶çš„æƒ…å†µä¸‹å°±ä¼šé‡æ–°å®ä¾‹åŒ–ä¸€ä¸ª observer    ob &#x3D; new Observer(value)  &#125;  return ob&#125;</code></pre><p>å®ä¾‹åŒ–  observer çš„è¿‡ç¨‹ä¸­å®é™…ä¸Šä¼šå°†ä¼ å…¥å¯¹è±¡çš„æ¯ä¸ªå±æ€§é€šè¿‡ <code>defineReactive</code> æ–¹æ³•è½¬æˆå“åº”å¼ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">export class Observer &#123;  constructor (value: any) &#123;    this.value &#x3D; value    &#x2F;&#x2F; åˆå§‹åŒ–æ•°æ®æ¨¡å‹çš„ dep å®ä¾‹    this.dep &#x3D; new Dep()    &#x2F;&#x2F; observer æœ€ç»ˆä¼šæŒ‚åœ¨ value çš„ __ob__ å±æ€§ä¸Š    def(value, &#39;__ob__&#39;, this)    if (Array.isArray(value)) &#123;      &#x2F;&#x2F; ç•¥ï¼š...é‡å†™ value çš„ä¸€äº›æ•°ç»„æ–¹æ³•      &#x2F;&#x2F; ç•¥ï¼š...éå†æ•°ç»„å…ƒç´ å¹¶ observe    &#125; else &#123;      this.walk(value)    &#125;  &#125;    walk (obj: Object) &#123;    const keys &#x3D; Object.keys(obj)    for (let i &#x3D; 0; i &lt; keys.length; i++) &#123;       &#x2F;&#x2F; éå†ä¼ å…¥çš„æ¯ä¸ªå±æ€§ï¼Œå¹¶ç”¨ defineReactive è½¬æˆå“åº”å¼      defineReactive(obj, keys[i])    &#125;  &#125;&#125;</code></pre><h5 id="defineReactive"><a href="#defineReactive" class="headerlink" title="defineReactive"></a>defineReactive</h5><p>ä¸Šé¢ä»£ç ä¸­æœ€æ ¸å¿ƒçš„ä¸€ä¸ªå‡½æ•°æ˜¯ <code>defineReactive</code>ï¼Œåšäº†ä»¥ä¸‹å‡ ä»¶äº‹æƒ…ï¼š</p><ol><li>åˆå§‹åŒ–ç›®æ ‡å±æ€§çš„ dep å®ä¾‹ï¼Œè¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªå‘å¸ƒè€…</li><li>å¯¹è¯¥å±æ€§çš„å­å¯¹è±¡é€’å½’è°ƒç”¨ observe</li><li>é€šè¿‡<code>Object.defineProperty</code>åŠ«æŒè¯¥å±æ€§çš„ getter ä¸ setterï¼š</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">export function defineReactive (  obj: Object,  key: string,  val: any,) &#123;  &#x2F;&#x2F; åˆå§‹åŒ–ç›®æ ‡å±æ€§çš„ dep å®ä¾‹  const dep &#x3D; new Dep()&#x2F;&#x2F; ç•¥ï¼š... ä¸€äº›å®¹é”™åˆ¤æ–­  &#x2F;&#x2F; ç•¥ï¼š... ä¸€äº›åˆå§‹åŒ–    &#x2F;&#x2F; é€’å½’ observe  let childOb &#x3D; !shallow &amp;&amp; observe(val)  &#x2F;&#x2F; åŠ«æŒ get ä¸ set  Object.defineProperty(obj, key, &#123;    enumerable: true,    configurable: true,    get: function reactiveGetter () &#123;      &#x2F;&#x2F; ...ä¸€æ—¦è·å–è¯¥å±æ€§å°±ä¼šè¿›è¡Œä¾èµ–æ”¶é›†    &#125;,    set: function reactiveSetter (newVal) &#123;      &#x2F;&#x2F; ...ä¸€æ—¦è®¾ç½®äº†æ–°å€¼å°±ä¼šæ´¾å‘æ›´æ–°    &#125;  &#125;)&#125;</code></pre><p>è¿™é‡Œå°±ç”¨åˆ°äº†è§‚å¯Ÿè€…æ¨¡å¼ï¼šå½“è¿™ä¸ªå±æ€§æ›´æ–°æ—¶ï¼Œä¼šé€šè¿‡å‘å¸ƒè€…é€šçŸ¥åˆ°è§‚å¯Ÿè€…ï¼Œè¿™äº›è§‚å¯Ÿè€…æ”¶åˆ°é€šçŸ¥åæ›´æ–°è§†å›¾ã€‚è¿™é‡Œå‘å¸ƒè€…å®é™…ä¸Šæ˜¯<code>Dep</code> å®ä¾‹ï¼Œè§‚å¯Ÿè€…å®é™…ä¸Šæ˜¯ <code>Watcher</code> å®ä¾‹ï¼Œå®ƒçš„ <code>update</code> æ–¹æ³•å¯ä»¥æ›´æ–°è§†å›¾ã€‚</p><p>æ‰€ä»¥ï¼Œä¾èµ–æ”¶é›†å®é™…ä¸Šå°±æ˜¯å°†<code>Wathcer</code> å®ä¾‹æ·»åŠ åˆ° <code>Dep</code> å®ä¾‹çš„è§‚å¯Ÿè€…åˆ—è¡¨ã€‚</p><p>reactiveGetter å’Œ reactiveSetter è¿™ä¸¤ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°æˆ‘ä»¬å…ˆæ”¾ä¸€è¾¹ï¼Œè¿™é‡Œåªéœ€è¦çŸ¥é“å¤§æ¦‚çš„ä½œç”¨å³å¯ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»ã€‚æˆ‘ä»¬ç°åœ¨æ¥çœ‹çœ‹ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘ get å‘¢ï¼Ÿç­”æ¡ˆæ˜¯åœ¨æŒ‚è½½ç»„ä»¶çš„æ—¶å€™ã€‚</p><h5 id="beforeMount-ä¸-mounted"><a href="#beforeMount-ä¸-mounted" class="headerlink" title="beforeMount ä¸ mounted"></a>beforeMount ä¸ mounted</h5><p>ç„¶åæ˜¯åœ¨ mountComponent ä¸­æ‰§è¡Œ  beforeMount ä»¥åŠ mountedï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">export function mountComponent (  vm: Component,  el: ?Element,  hydrating?: boolean): Component &#123;  &#x2F;&#x2F; ...  callHook(vm, &#39;beforeMount&#39;)  &#x2F;&#x2F; ç•¥ï¼š...è¿™é‡Œæœ‰ä¸ªéç”Ÿäº§ç¯å¢ƒçš„åˆ¤æ–­ï¼Œè¿™é‡Œä¸è€ƒè™‘ç®€åŒ–æˆå¦‚ä¸‹ï¼š  let updateComponent &#x3D; () &#x3D;&gt; &#123;      vm._update(vm._render(), hydrating)   &#125;  &#x2F;&#x2F; è¿™é‡Œå®ä¾‹åŒ– Watcherï¼šå¯ä»¥çœ‹ä½œæ˜¯æ›´æ–°è§†å›¾ç”¨çš„è§‚å¯Ÿè€…ï¼Œè¿™é‡Œçœç•¥ä¸€äº›å‚æ•°  new Watcher(vm, updateComponent)  &#x2F;&#x2F; ...ä»…è€ƒè™‘ new Vue çš„æƒ…å†µï¼Œä»£ç ç®€åŒ–å¦‚ä¸‹  callHook(vm, &#39;mounted&#39;)  return vm&#125;</code></pre><p>æŒ‚è½½ç»„ä»¶çš„æ—¶å€™å°±ä¼šå®ä¾‹åŒ–ä¸€ä¸ª <code>Watcher</code></p><h5 id="Watcher"><a href="#Watcher" class="headerlink" title="Watcher"></a>Watcher</h5><p>å½“æˆ‘ä»¬å®ä¾‹åŒ– Watcher çš„æ—¶å€™ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">let uid &#x3D; 0export default class Watcher &#123;  constructor (    vm: Component,    expOrFn: string | Function,  ) &#123;    &#x2F;&#x2F; ç•¥ï¼š...ä¸€äº›åˆå§‹åŒ–    this.deps &#x3D; []    this.newDeps &#x3D; []    this.depIds &#x3D; new Set()    this.newDepIds &#x3D; new Set()    &#x2F;&#x2F; ç•¥ï¼š...ä¸€äº›åˆå§‹åŒ–    &#x2F;&#x2F; ç•¥ï¼š...å¯¹ this.getter çš„ä¸€äº›åˆå§‹åŒ–    if (this.computed) &#123;      &#x2F;&#x2F; computed çš„æƒ…å†µï¼Œæœ¬æ–‡æš‚ä¸è€ƒè™‘    &#125; else &#123;      &#x2F;&#x2F; åˆå§‹åŒ–æ—¶å°±ä¼šæ‰§è¡Œ get æ–¹æ³•      this.value &#x3D; this.get()    &#125;  &#125;  get () &#123;    &#x2F;&#x2F; pushTarget ç”¨äºå°† watcher å®ä¾‹æŒ‚åˆ° Dep çš„ target è¿™ä¸ªé™æ€å±æ€§ä¸Š    pushTarget(this)    let value    const vm &#x3D; this.vm    try &#123;      &#x2F;&#x2F; æ­¤æ—¶çš„ this.getter å®é™…ä¸Šå°±æ˜¯ updateComponent      value &#x3D; this.getter.call(vm, vm)    &#125; catch (e) &#123;      &#x2F;&#x2F; ç•¥ï¼š...é”™è¯¯å¤„ç†    &#125; finally &#123;      &#x2F;&#x2F; ç•¥ï¼š...é€’å½’è®¿é—® valueï¼Œè§¦å‘å®ƒæ‰€æœ‰å­é¡¹çš„ getter      this.cleanupDeps()    &#125;    return value  &#125;  &#x2F;&#x2F; ...&#125;</code></pre><p><code>pushTarget</code> å°† <code>watcher</code> å®ä¾‹æŒ‚åˆ° <code>Dep</code> çš„ <code>target</code> è¿™ä¸ªé™æ€å±æ€§, ç”¨äº <code>Dep</code> å†…éƒ¨å¯ä»¥è®¿é—®åˆ°ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">function pushTarget (_target: ?Watcher) &#123;&#x2F;&#x2F; ...  Dep.target &#x3D; _target&#125;</code></pre><p>æ¥ç€è°ƒç”¨ <code>this.getter</code>, è¿™é‡Œçš„ <code>this.getter</code> å®é™…ä¸Šå°±æ˜¯ <code>updateComponent</code>:</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">vm._update(vm._render(), hydrating)</code></pre><p><code>vm._render()</code> ä¼šç”Ÿæˆ VNodeï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šè®¿é—® vm ä¸Šçš„æ•°æ®ï¼Œè‡³æ­¤å°±ä¼šè§¦å‘æ•°æ®å¯¹è±¡çš„ getterï¼Œè¿›è¡Œä¾èµ–æ”¶é›†ã€‚</p><h5 id="æ€è·¯å°ç»“"><a href="#æ€è·¯å°ç»“" class="headerlink" title="æ€è·¯å°ç»“"></a>æ€è·¯å°ç»“</h5><p>è‡³æ­¤æˆ‘ä»¬å…ˆæ¢³ç†ä¸€ä¸‹è¿™ä¸€æ•´ä¸ªè¿‡ç¨‹ï¼Œä»¥å…é—å¿˜ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">beforeCreate &#x3D;&gt; initState -&gt; observe -&gt; new Observer  -&gt; defineReactiveï¼šå®ä¾‹åŒ– Depï¼ŒåŠ«æŒå¯¹è±¡å±æ€§ getter ä¸ setter&#x3D;&gt; created&#x3D;&gt; beforeMount  å®ä¾‹åŒ– Watcher -&gt; å°† watcher å®ä¾‹ç»‘å®šåˆ° Dep.targetï¼Œå¹¶è§¦å‘å¯¹è±¡å±æ€§çš„ getterï¼Œæ”¶é›†ä¾èµ–&#x3D;&gt; mounted&#x3D;&gt; å½“æ•°æ®æ¨¡å‹å˜æ›´æ—¶ï¼Œè§¦å‘ setterï¼Œæ›´æ–°è§†å›¾</code></pre><p>åœ¨ defineReactive ä¸­æœ‰ä¸ªå…³é”®çš„æ­¥éª¤æ˜¯å®ä¾‹åŒ– <code>Dep</code>ã€‚</p><h5 id="Dep"><a href="#Dep" class="headerlink" title="Dep"></a>Dep</h5><p>ä¸Šé¢è¯´è¿‡ Dep å®ä¾‹æ˜¯ä¸€ä¸ªå‘å¸ƒè€…ï¼Œå…¶ä»£ç å…¶å®å¾ˆç®€å•ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">export default class Dep &#123;  constructor () &#123;    this.subs &#x3D; []  &#125;    addSub (sub: Watcher) &#123;    this.subs.push(sub)  &#125;  removeSub (sub: Watcher) &#123;    remove(this.subs, sub)  &#125;  depend () &#123;    if (Dep.target) &#123;      &#x2F;&#x2F; è¿™é‡Œå°† Dep.target å³ watcher æ·»åŠ åˆ° subs é‡Œ      Dep.target.addDep(this)    &#125;  &#125;  notify () &#123;    &#x2F;&#x2F; å‘å¸ƒé€šçŸ¥    const subs &#x3D; this.subs.slice()    for (let i &#x3D; 0, l &#x3D; subs.length; i &lt; l; i++) &#123;      subs[i].update()    &#125;  &#125;&#125;</code></pre><p>æˆ‘ä»¬æœ€ç»ˆè°ƒç”¨çš„æ˜¯ <code>depend</code>æ–¹æ³•æ¥æ·»åŠ è§‚å¯Ÿè€…ï¼Œå³<code>Dep.target.addDep</code>ï¼Œæˆ‘ä»¬çŸ¥é“æ­¤æ—¶ Dep.target å®é™…ä¸Šå°±æ˜¯ watcher å®ä¾‹ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; ...addDep (dep: Dep) &#123;  const id &#x3D; dep.id  if (!this.newDepIds.has(id)) &#123;    &#x2F;&#x2F; å°†å‘å¸ƒè€… id æ·»åŠ åˆ° this.newDepIds    this.newDepIds.add(id)    &#x2F;&#x2F; å°†å‘å¸ƒè€… æ·»åŠ åˆ° this.newDeps    this.newDeps.push(dep)    if (!this.depIds.has(id)) &#123;      &#x2F;&#x2F; å¦‚æœæ—§çš„ å‘å¸ƒè€…id åˆ—è¡¨ä¸­æ²¡æœ‰è¿™ä¸ªå‘å¸ƒè€… idï¼Œé‚£ä¹ˆå°±æ·»åŠ åˆ°å‘å¸ƒè€…çš„è§‚å¯Ÿè€…åˆ—è¡¨ä¸­      dep.addSub(this)    &#125;  &#125;&#125;&#x2F;&#x2F; ...</code></pre><p>è€Œåœ¨ watcher ä¸­ï¼Œæœ€ç»ˆè¿˜æ˜¯è°ƒç”¨äº†ä¼ å…¥çš„ dep å®ä¾‹çš„ addSub æ¥æ·»åŠ åˆ° dep çš„è§‚å¯Ÿè€…åˆ—è¡¨ä¸­ã€‚ä¹‹æ‰€ä»¥è¿™ä¹ˆè®¾è®¡ï¼Œå…¶åŸå› æ˜¯ä¸ºäº†èƒ½åœ¨ watcher ä¸­ç»´æŠ¤ä¸€ä¸ªè‡ªå·±è®¢é˜…çš„å‘å¸ƒè€…åˆ—è¡¨ã€‚</p><p>é‚£ä¹ˆ watcher ä¸­çš„å‘å¸ƒè€…åˆ—è¡¨æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿè¿˜è®°å¾— Watcher å®ä¾‹åŒ–çš„æœ€åä¼šè°ƒç”¨  <code>this.cleanupDeps()</code> å—ï¼Ÿ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">cleanupDeps () &#123;  let i &#x3D; this.deps.length  while (i--) &#123;    const dep &#x3D; this.deps[i]    if (!this.newDepIds.has(dep.id)) &#123;      dep.removeSub(this)    &#125;  &#125;  let tmp &#x3D; this.depIds  this.depIds &#x3D; this.newDepIds  this.newDepIds &#x3D; tmp  this.newDepIds.clear()  tmp &#x3D; this.deps  this.deps &#x3D; this.newDeps  this.newDeps &#x3D; tmp  this.newDeps.length &#x3D; 0&#125;</code></pre><p>è¿™ä¸ªå‡½æ•°å®é™…ä¸Šçš„ä½œç”¨æ˜¯ï¼š</p><ol><li><p>å¦‚æœæ— éœ€å†è§‚å¯Ÿï¼Œåˆ™ä»å‘å¸ƒè€…çš„è§‚å¯Ÿè€…åˆ—è¡¨ä¸­ç§»é™¤</p></li><li><p>å°†æœ¬æ¬¡çš„å‘å¸ƒè€… id åˆ—è¡¨è®°å½•åœ¨ this.depsIds ä¸­ï¼Œæ¸…ç©º this.newDepIds</p></li><li><p>å°†æœ¬æ¬¡çš„å‘å¸ƒè€…åˆ—è¡¨è®°å½•åœ¨ this.deps ä¸­ï¼Œæ¸…ç©º this.newDeps</p><p>é‚£ä¹ˆå…·ä½“æ˜¯å¦‚ä½•å°†å¯¹è±¡å±æ€§è½¬ä¸ºå“åº”å¼çš„å‘¢ï¼Œæˆ‘ä»¬çœ‹çœ‹å…¶å…·ä½“å®ç°ï¼š</p></li></ol><h5 id="reactiveGetter"><a href="#reactiveGetter" class="headerlink" title="reactiveGetter"></a>reactiveGetter</h5><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">function reactiveGetter () &#123;  &#x2F;&#x2F; ...  &#x2F;&#x2F; æ­¤æ—¶çš„ Dep.target å°±æ˜¯ watcherï¼Œå…³äº Dep åé¢ä¼šè¯¦ç»†è§£é‡Š  if (Dep.target) &#123;    &#x2F;&#x2F; è¿™é‡Œä¼šå°† watcher å®ä¾‹æ·»åŠ è¿› dep çš„ subs ä¸­ç»´æŠ¤ï¼Œå³æ”¶é›†ä¾èµ–    dep.depend()    if (childOb) &#123;      &#x2F;&#x2F; å­å¯¹è±¡çš„ä¾èµ–æ”¶é›†      childOb.dep.depend()      &#x2F;&#x2F; ç•¥ï¼š...å¯¹æ•°ç»„çš„ä¸€äº›å¤„ç†    &#125;  &#125;  &#x2F;&#x2F; è¿”å›å±æ€§å€¼  return value&#125;</code></pre><h5 id="reactiveSetter"><a href="#reactiveSetter" class="headerlink" title="reactiveSetter"></a>reactiveSetter</h5><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">function reactiveSetter (newVal) &#123;  &#x2F;&#x2F; valueï¼šå±æ€§å€¼  const value &#x3D; ...  &#x2F;&#x2F; ç•¥ï¼š...ä¸€äº›åˆ¤æ–­æ˜¯å¦è§¦å‘ setter çš„æ¡ä»¶  if (setter) &#123;    setter.call(obj, newVal)  &#125; else &#123;    val &#x3D; newVal  &#125;  &#x2F;&#x2F; è®¾ç½®æ–°å€¼åéœ€è¦é‡æ–° observe  childOb &#x3D; !shallow &amp;&amp; observe(newVal)  &#x2F;&#x2F; å‘å¸ƒé€šçŸ¥  dep.notify()&#125;</code></pre><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>æœ¬æ–‡ç®€åŒ–äº†ä¸€äº›ç»†èŠ‚ï¼Œä½†æ˜¯ Vue çš„å“åº”å¼åŸç†å¤§è‡´å¦‚æ­¤ã€‚å½“ç†è§£äº†åŸç†ä¹‹åï¼Œå¦‚æœåé¢é—å¿˜äº†çš„è¯ï¼Œä»¥ä¸‹ä¸ºé‡è¦çš„è®°å¿†ç‚¹ï¼š</p><ol><li>observeï¼šå®ä¾‹åŒ– Observeï¼Œå‚æ•°ä¸ºæ•°æ®æ¨¡å‹ï¼Œå®ä¾‹åŒ–è¿‡ç¨‹ä¼šè°ƒç”¨éå†å¯¹è±¡å±æ€§è°ƒç”¨ defineReactive</li><li>defineReactiveï¼šå®ä¾‹åŒ– Depï¼ŒåŠ«æŒå¯¹è±¡å±æ€§çš„ getter ä¸ setterï¼Œgetter æ—¶è¿›è¡Œä¾èµ–æ”¶é›†</li><li>åœ¨æŒ‚è½½ç»„ä»¶çš„æ—¶å€™ï¼Œä¼šå®ä¾‹åŒ– Watcherï¼Œæ­¤æ—¶ä¼šè§¦å‘ getter</li><li>å½“æ›´æ–°å¯¹è±¡å±æ€§æ—¶ï¼Œä¼šè°ƒç”¨ Dep å®ä¾‹çš„ notifyï¼Œè§¦å‘ watcher çš„ update</li></ol>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼-JSä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼ä¸å‘å¸ƒè®¢é˜…æ¨¡å¼</title>
      <link href="/2020/08/08/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-JS%E4%B8%AD%E7%9A%84%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E4%B8%8E%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F/"/>
      <url>/2020/08/08/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-JS%E4%B8%AD%E7%9A%84%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E4%B8%8E%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ã€Šdebounceä¸throttleã€‹ ä¸­æåˆ°äº† RxJSï¼Œ RxJS ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µ: Observableï¼ˆå¯è¢«è§‚å¯Ÿè€…ï¼‰ å’Œ Observerï¼ˆè§‚å¯Ÿè€…ï¼‰ï¼ŒRxJS çš„ Observable å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼å’Œè¿­ä»£å™¨æ¨¡å¼çš„ç»„åˆã€‚</p><p>åœ¨ javascript ä¸­ï¼Œè§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼æä¸ºç›¸ä¼¼ï¼Œå› æ­¤æœ¬æ–‡å°†æ¢è®¨è¿™ä¸¤ç§æ¨¡å¼ä»¥åŠå…¶åº”ç”¨ã€‚</p> <a id="more"></a><h4 id="è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver-patternï¼‰"><a href="#è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver-patternï¼‰" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver patternï¼‰"></a>è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver patternï¼‰</h4><blockquote><p>è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œè®©å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬æŸä¸€ä¸ªç›®æ ‡å¯¹è±¡ï¼Œå½“è¿™ä¸ªç›®æ ‡å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡ï¼Œä½¿å®ƒä»¬èƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°ã€‚ â€”â€” Graphic Design Patterns</p></blockquote><p>è§‚å¯Ÿè€…æ¨¡å¼æœ‰ä¸¤ä¸ªå¯¹è±¡ï¼šä¸€ä¸ªæ˜¯è§‚å¯Ÿè€…ï¼Œå¦ä¸€ä¸ªä¸Šé¢æåˆ°çš„ç›®æ ‡å¯¹è±¡å¯ä»¥ç§°ä¸ºæ˜¯å‘å¸ƒè€…ï¼ŒåŸºæœ¬çš„æµç¨‹ä¸ºï¼š</p><ol><li>å‘å¸ƒè€…ç»´æŠ¤ä¸€ä¸ªè§‚å¯Ÿè€…åˆ—è¡¨ï¼Œå¯ä»¥æ·»åŠ æˆ–è€…åˆ é™¤è§‚å¯Ÿè€…</li><li>å½“å‘å¸ƒè€…å‘å¸ƒé€šçŸ¥æ—¶ï¼Œéå†è§‚å¯Ÿè€…åˆ—è¡¨ï¼Œå¹¶è°ƒç”¨è§‚å¯Ÿè€…æä¾›çš„æ–¹æ³•</li></ol><p>å‘å¸ƒè€…çš„å®ç°å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; å‘å¸ƒè€…class Publisher &#123;  constructor() &#123;    &#x2F;&#x2F; ç»´æŠ¤ä¸€ä¸ªè§‚å¯Ÿè€…åˆ—è¡¨    this.observers &#x3D; []      &#125;      &#x2F;&#x2F; æ·»åŠ è§‚å¯Ÿè€…  addObserver(observer) &#123;    this.observers.push(observer)  &#125;  &#x2F;&#x2F; ç§»é™¤è§‚å¯Ÿè€…  removeObserver(observer) &#123;    this.observers &#x3D; this.observers.filter(item &#x3D;&gt; item !&#x3D;&#x3D; observer)  &#125;  &#x2F;&#x2F; å‘å¸ƒé€šçŸ¥  notify() &#123;    this.observers.forEach((item) &#x3D;&gt; &#123;      &#x2F;&#x2F; æ‰§è¡Œè§‚å¯Ÿè€…æä¾›çš„æ–¹æ³•ï¼Œè¿™é‡Œå‡è®¾ä¸º update      item.update()    &#125;)  &#125;&#125;</code></pre><p>è®¢é˜…è€…åˆ™æ¯”è¾ƒç®€å•ï¼Œå®ç°å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class Observer &#123;  constructor(name) &#123;    this.name &#x3D; name  &#125;  update() &#123;    &#x2F;&#x2F; æ›´æ–°çŠ¶æ€    console.log(&#96;observer $&#123;this.name&#125; update&#96;)  &#125;&#125;</code></pre><p>æœ€ç»ˆï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const a &#x3D; new Observer(&#39;a&#39;)const b &#x3D; new Observer(&#39;b&#39;)const c &#x3D; new Observer(&#39;c&#39;)const publisher &#x3D; new Publisher()publisher.addObserver(a)publisher.addObserver(b)publisher.addObserver(c)&#x2F;&#x2F; å‘å¸ƒé€šçŸ¥publisher.notify()&#x2F;&#x2F; a b c</code></pre><p>Vue çš„å“åº”å¼åŸç†å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼çš„ä¸€ä¸ªå…¸å‹åº”ç”¨ï¼Œå…³äº Vue çš„å“åº”å¼ç”±äºç¯‡å¹…åŸå› ï¼Œå°†ä¼šå¦èµ·ä¸€ç¯‡è¯¦ç»†åˆ†æã€‚</p><h4 id="å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆPub-sub-patternï¼‰"><a href="#å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆPub-sub-patternï¼‰" class="headerlink" title="å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆPub-sub patternï¼‰"></a>å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆPub-sub patternï¼‰</h4><p>å‘å¸ƒè®¢é˜…æ¨¡å¼æ˜¯ä»è§‚å¯Ÿè€…æ¨¡å¼å‘å±•è€Œæ¥ï¼Œä¸¤è€…çš„åŒºåˆ«åœ¨äºï¼šè§‚å¯Ÿè€…æ¨¡å¼ä¸­å‘å¸ƒè€…ä¸è§‚å¯Ÿè€…æ˜¯æ¾è€¦åˆï¼Œè€Œå‘å¸ƒè®¢é˜…åˆ™åœ¨å‘å¸ƒè€…ä¸è®¢é˜…è€…ä¸­åŠ å…¥äº†äº‹ä»¶ä¸­å¿ƒå®ç°å‘å¸ƒè€…ä¸è§‚å¯Ÿè€…çš„å®Œå…¨è§£è€¦ã€‚</p><p>ç”¨å‘å¸ƒè®¢é˜…æ¨¡å¼æ¨¡æ‹Ÿäº‹ä»¶ç»‘å®šï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class EventCenter &#123;  constructor() &#123;    this.observers &#x3D; &#123;&#125;  &#125;  addListener(type, fn) &#123;    this.observers[type] &#x3D; [...(this.observers[type] || []), fn]  &#125;  removeListener(type, fn) &#123;    let listeners &#x3D; this.observers[type];    if (!listeners || !listeners.length) return;    this.observers[type] &#x3D; listeners.filter(v &#x3D;&gt; v !&#x3D;&#x3D; fn);  &#125;  dispatchEvent(type) &#123;    let listeners &#x3D; this.observers[type];    if (!listeners || !listeners.length) return;    listeners.forEach(fn &#x3D;&gt; fn());          &#125;&#125;const evtCenter &#x3D; new EventCenter()function handleClick () &#123;  console.log(&#39;click&#39;)&#125;&#x2F;&#x2F; è®¢é˜… click äº‹ä»¶evtCenter.addListener(&#39;click&#39;, handleClick)&#x2F;&#x2F; å‘å¸ƒ click äº‹ä»¶evtCenter.dispatchEvent(&#39;click&#39;)&#x2F;&#x2F; å–æ¶ˆè®¢é˜…evtCenter.removeListener(&#39;click&#39;, handleClick)</code></pre><p>å¯ä»¥çœ‹åˆ°ä¸è§‚å¯Ÿè€…æ¨¡å¼ä¸åŒï¼Œåœ¨å‘å¸ƒè®¢é˜…æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬çš„å‘å¸ƒå’Œè®¢é˜…éƒ½æ˜¯é€šè¿‡äº‹ä»¶ä¸­å¿ƒæ¥è¿›è¡Œè°ƒåº¦çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>debounceä¸throttle</title>
      <link href="/2020/08/06/debounce%E4%B8%8Ethrottle/"/>
      <url>/2020/08/06/debounce%E4%B8%8Ethrottle/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>æµ‹è¯•åŒå­¦æäº†ä¸ª bugï¼Œåœ¨æœç´¢æ¡†ä¸­ç–¯ç‹‚è¾“å…¥æ–‡å­—ï¼Œä¸ä¸€ä¼šå„¿æ¥å£å°±æŠ¥é”™äº†ã€‚è¿™ä¸ª bug å®é™…ä¸Šå°±æ˜¯ç”±äºæ¯è¾“å…¥ä¸€ä¸ªå­—ç¬¦æ—¶ï¼Œå°±å»è¯·æ±‚æ¥å£å¼•èµ·çš„ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const handleSearch &#x3D; () &#x3D;&gt; &#123;&#x2F;&#x2F; ...è¯·æ±‚æ¥å£&#125;&lt;Input onChange&#x3D;&#123;handleSearch&#125; &#x2F;&gt;</code></pre><p>è§£å†³æ–¹æ³•æ˜¯é€šè¿‡ <code>debounce</code> æ¥æ§åˆ¶è¾“å…¥çš„é¢‘ç‡ã€‚</p><p>å®é™…ä¸Š <code>debounce</code> å’Œ <code>throttle</code> è¿™ä¸¤ä¸ªæ¦‚å¿µç»å¸¸æ˜¯ä¸€èµ·å‡ºç°ï¼Œåœ¨å·¥ä½œä¸­ä¹Ÿå¸¸å¸¸ä½¿ç”¨åˆ°ã€‚åœ¨æ—©å¹´æ¥è§¦å‰ç«¯çš„æ—¶å€™ï¼Œé¡¹ç›®é‡Œæœ‰ <code>lodash</code>ï¼Œå› æ­¤ç›´æ¥ä½¿ç”¨å…¶æä¾›çš„  <code>debounce</code> å’Œ <code>throttle</code> ã€‚è€Œåœ¨ä¸€äº›ç®€å•çš„é¡¹ç›®é‡Œï¼Œå¾€å¾€ä¸å¼•å…¥ <code>lodash</code>ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦è‡ªå·±å®ç°ï¼Œäºæ­¤åšä¸ªè®°å½•ã€‚</p><a id="more"></a><h4 id="debounce"><a href="#debounce" class="headerlink" title="debounce"></a>debounce</h4><p><code>debounce</code> ä¹Ÿå°±æ˜¯é˜²æŠ–ï¼Œçœ‹çœ‹ lodash ä¸­ debounce çš„å®šä¹‰ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">_.debounce(func, [wait&#x3D;0], [options&#x3D;&#123;&#125;])</code></pre><p>è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šè·ç¦»ä¸Šæ¬¡è°ƒç”¨åï¼Œå»¶è¿Ÿ <code>wait</code> æ¯«ç§’åè°ƒç”¨<code>func</code>ã€‚</p><p>åœ¨ä¸Šé¢çš„ bug ä¸­ï¼Œå¯¹åŸæœç´¢æ–¹æ³•è¿›è¡Œé˜²æŠ–å¤„ç†åï¼Œä»…å½“ç”¨æˆ·åœæ­¢è¾“å…¥ 300 æ¯«ç§’åï¼Œæ‰è¯·æ±‚æ¥å£è¿›è¡Œæœç´¢ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; åœæ­¢è¾“å…¥ 300 ms åï¼Œè¿›è¡Œæœç´¢_.debounce(handleSearch, 300)</code></pre><p>####throttle</p><p><code>throttle</code> æˆ‘ä»¬ç§°ä¹‹ä¸ºæˆªæµï¼ŒåŒæ ·çœ‹çœ‹ loads ä¸­ throttle çš„å®šä¹‰ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">_.throttle(func, [wait&#x3D;0], [options&#x3D;&#123;&#125;])</code></pre><p>è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æœ€å¤šæ¯ <code>wait</code> æ¯«ç§’è°ƒç”¨ä¸€æ¬¡ <code>func</code>ã€‚</p><p>å¦‚æœå¯¹æœç´¢æ–¹æ³•è¿›è¡Œæˆªæµï¼Œåˆ™æ— è®ºç”¨æˆ·è¾“å…¥å¤šå¿«ï¼Œæ¯ 1 ç§’ä»…è¯·æ±‚ä¸€æ¬¡ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; åœæ­¢è¾“å…¥ 300 ms åï¼Œè¿›è¡Œæœç´¢_.debounce(handleSearch, 1000)</code></pre><h4 id="æ‰‹å†™ä¸€ä¸ª-debounce"><a href="#æ‰‹å†™ä¸€ä¸ª-debounce" class="headerlink" title="æ‰‹å†™ä¸€ä¸ª debounce"></a>æ‰‹å†™ä¸€ä¸ª debounce</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">function debounce(func, wait &#x3D; 0) &#123;  let timeout  return function(...args) &#123;    if(timeout) &#123;      clearTimeout(timeout)    &#125;    timeout &#x3D; setTimeout(() &#x3D;&gt; func.call(this, ...args), wait)  &#125;&#125;</code></pre><p>ç”±äº func è¢«å½“ä½œæ˜¯å‚æ•°ä¼ é€’è¿›æ¥ï¼Œæ³¨æ„ä¸Šé¢çš„ func éœ€è¦ç»‘å®š thisã€‚å¹¶ä¸”åœ¨ä½¿ç”¨æ—¶å¦‚æœæœ‰ this æŒ‡å‘ï¼Œéœ€è¦æ˜¾å¼æŒ‡æ˜ thisï¼Œå¦‚ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const o &#x3D; &#123;  a: 1,  b: function() &#123;      console.log(this.a);  &#125;&#125;const c &#x3D; debounce(o.b).bind(o);</code></pre><p>å¯¹ debounce è¿›ä¸€æ­¥æ‹“å±•ï¼Œå¦‚æœéœ€è¦åœ¨è°ƒç”¨æ—¶ç«‹åˆ»æ‰§è¡Œä¸€æ¬¡ï¼Œåˆ™å¯ä»¥ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">function debounce(func, wait &#x3D; 0, head) &#123;  let timeout;  return function (...args) &#123;    const callNow &#x3D; head &amp;&amp; !timeout;    timeout &amp;&amp; clearTimeout(timeout);    timeout &#x3D; setTimeout(() &#x3D;&gt; &#123;      if(!callNow) &#123;        func.call(this, ...args);      &#125;      timeout &#x3D; null    &#125;, wait);    if (callNow) &#123;      func.call(this, ...args)    &#125;;  &#125;;&#125;</code></pre><h4 id="æ‰‹å†™ä¸€ä¸ª-throttle"><a href="#æ‰‹å†™ä¸€ä¸ª-throttle" class="headerlink" title="æ‰‹å†™ä¸€ä¸ª throttle"></a>æ‰‹å†™ä¸€ä¸ª throttle</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">function throttle(func, timeFrame &#x3D; 0) &#123;  let lastTime &#x3D; 0;  return function () &#123;      const now &#x3D; new Date();      if (now - lastTime &gt;&#x3D; timeFrame) &#123;          func.call(this, ...args);          lastTime &#x3D; now;      &#125;  &#125;;&#125;</code></pre><h4 id="whatâ€™s-more-rxjs"><a href="#whatâ€™s-more-rxjs" class="headerlink" title="whatâ€™s more: rxjs"></a>whatâ€™s more: rxjs</h4><p>æˆªæµå’Œé˜²æŠ–å¾ˆå¤šæ—¶å€™æ˜¯å‡ºç°åœ¨äº‹ä»¶ä¸­çš„ï¼Œä½¿ç”¨ rxjs åˆ™å¯ä»¥ä½¿ç”¨ debounceTime å’Œ throttleTimeï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">import &#123; fromEvent &#125; from &#39;rxjs&#39;;import &#123; debounceTime &#125; from &#39;rxjs&#x2F;operators&#39;;const inputEle &#x3D; document.getElementById(&#39;input&#39;)const inputs &#x3D; fromEvent(inputEle, &#39;input&#39;);const result &#x3D; inputs.pipe(debounceTime(1000));&#x2F;&#x2F; å¦‚æœæ˜¯èŠ‚æµå¯ä½¿ç”¨ throttleTime&#x2F;&#x2F; const result &#x3D; inputs.pipe(throttleTime(1000));result.subscribe(x &#x3D;&gt; console.log(x));</code></pre><h4 id="rxjs-react"><a href="#rxjs-react" class="headerlink" title="rxjs + react"></a>rxjs + react</h4><p>å¦‚æœæ˜¯ react ä¸­çš„äº‹ä»¶éœ€è¦é˜²æŠ–ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ <code>Subject</code> æ¥å®ç°ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import React, &#123; useEffect &#125; from &quot;react&quot;;import &#123; Subject &#125; from &quot;rxjs&quot;;import &quot;rxjs&#x2F;add&#x2F;operator&#x2F;debounceTime&quot;;const value$ &#x3D; new Subject().debounceTime(300);export default function App() &#123;  useEffect(() &#x3D;&gt; &#123;    const subscription &#x3D; value$.subscribe(console.log)      return () &#x3D;&gt; subscription.unsubscribe()  &#125;, [])  const onChange &#x3D; e &#x3D;&gt; &#123;    value$.next(e.target.value);  &#125;;  return (    &lt;div&gt;      &lt;input onChange&#x3D;&#123;onChange&#125; &#x2F;&gt;    &lt;&#x2F;div&gt;  );&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å½“æˆ‘ä»¬è¯´åˆ°æ‰“åŒ…æ—¶ï¼Œæˆ‘ä»¬åœ¨è¯´ä»€ä¹ˆ</title>
      <link href="/2020/07/31/%E5%BD%93%E6%88%91%E4%BB%AC%E8%AF%B4%E5%88%B0%E6%89%93%E5%8C%85%E6%97%B6%EF%BC%8C%E6%88%91%E4%BB%AC%E5%9C%A8%E8%AF%B4%E4%BB%80%E4%B9%88/"/>
      <url>/2020/07/31/%E5%BD%93%E6%88%91%E4%BB%AC%E8%AF%B4%E5%88%B0%E6%89%93%E5%8C%85%E6%97%B6%EF%BC%8C%E6%88%91%E4%BB%AC%E5%9C%A8%E8%AF%B4%E4%BB%80%E4%B9%88/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>ä»æ—©æœŸçš„ grunt (æˆ‘æ¥è§¦å‰ç«¯å¼€å‘çš„æ—¶å€™è¿™ä¸ªå·²ç»è¶‹äºæ²¡è½) åˆ° gulpï¼Œå†åˆ°å¦‚ä»Šçš„ webpackï¼Œrollup ï¼Œparcelï¼Œä»¥åŠ snowpackï¼Œviteï¼Œå¦‚ä»Šçš„å‰ç«¯å·²ç»è„±ç¦»äº†åˆ€è€•ç«ç§çš„æ—¶ä»£ï¼Œå„ç§æ‰“åŒ…å·¥å…·å±‚å‡ºä¸ç©·ã€‚å‰ç«¯é¡¹ç›®åŸºæœ¬ç¦»ä¸å¼€æ‰“åŒ…è¿™ä¸ªè¿‡ç¨‹ã€‚é‚£ä¹ˆå½“æˆ‘ä»¬è¯´åˆ°æ‰“åŒ…ï¼ˆbundleï¼‰æ—¶ï¼Œæˆ‘ä»¬åœ¨è¯´çš„æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>è¿™é‡Œä¸å¯¹ webpack æˆ–è€…è¿™äº›æ‰“åŒ…å·¥å…·çš„ä½¿ç”¨è¿›è¡Œå…·ä½“è¯´æ˜ï¼Œæœ¬æ–‡æƒ³æ¢ç©¶çš„æ˜¯æ‰“åŒ…çš„æœ¬è´¨ã€‚</p><a id="more"></a><h4 id="ä»æ¨¡å—åŒ–è¯´èµ·"><a href="#ä»æ¨¡å—åŒ–è¯´èµ·" class="headerlink" title="ä»æ¨¡å—åŒ–è¯´èµ·"></a>ä»æ¨¡å—åŒ–è¯´èµ·</h4><p>åœ¨æ²¡æœ‰æ¨¡å—åŒ–ä¹‹å‰ï¼Œå‰ç«¯å¼€å‘æ—¶éœ€è¦æ ¼å¤–æ³¨æ„å‘½åå†²çªä»¥åŠæ–‡ä»¶ä¹‹é—´çš„ç›¸äº’ä¾èµ–ï¼Œå‚è€ƒ <a href="https://github.com/seajs/seajs/issues/547#issue-11105836ã€‚">https://github.com/seajs/seajs/issues/547#issue-11105836ã€‚</a></p><p>æ¨¡å—åŒ–å®é™…ä¸Šå°±æ˜¯å°†ç¨‹åºåˆ†è§£æˆç¦»æ•£çš„åŠŸèƒ½å—ï¼Œä½¿ä»£ç æ˜“äºå¤ç”¨ï¼Œç»´æŠ¤å’Œæµ‹è¯•ã€‚å¦‚ less ä¸­é€šè¿‡ @import å¼•å…¥çš„æ ·å¼ï¼ŒES6 Module / CommonJs å¼•å…¥çš„ Js ç­‰éƒ½å¯ä»¥ç§°ä¸ºæ¨¡å—ã€‚</p><p>ç„¶è€Œæµè§ˆå™¨ä¸æ”¯æŒæ¨¡å—åŒ–ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ‰“åŒ…å·¥å…·ï¼Œå°†ä»£ç ä¸­è¯¸å¦‚ require, @import, import è¿›æ¥çš„æ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæˆ–è€…å¤šä¸ªæ–‡ä»¶(å³ bundle)ã€‚</p><h4 id="æ‰“åŒ…çš„æœ¬è´¨"><a href="#æ‰“åŒ…çš„æœ¬è´¨" class="headerlink" title="æ‰“åŒ…çš„æœ¬è´¨"></a>æ‰“åŒ…çš„æœ¬è´¨</h4><p>å‚è€ƒ webpack çš„å®šä¹‰ï¼š</p><blockquote><p>æœ¬è´¨ä¸Šï¼Œ<em>webpack</em> æ˜¯ä¸€ä¸ªç°ä»£ JavaScript åº”ç”¨ç¨‹åºçš„<em>é™æ€æ¨¡å—æ‰“åŒ…å™¨(module bundler)</em>ã€‚å½“ webpack å¤„ç†åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šé€’å½’åœ°æ„å»ºä¸€ä¸ª<em>ä¾èµ–å…³ç³»å›¾(dependency graph)</em>ï¼Œå…¶ä¸­åŒ…å«åº”ç”¨ç¨‹åºéœ€è¦çš„æ¯ä¸ªæ¨¡å—ï¼Œç„¶åå°†æ‰€æœ‰è¿™äº›æ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæˆ–å¤šä¸ª <em>bundle</em>ã€‚</p></blockquote><p>è€Œè‡³äºè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¯¹ä»£ç è¿›è¡Œå‹ç¼©ï¼Œæ··æ·†ç­‰ç­‰åˆ™æ˜¯é”¦ä¸Šæ·»èŠ±çš„åŠŸèƒ½ã€‚</p><h4 id="æ‰“åŒ…çš„è¿‡ç¨‹"><a href="#æ‰“åŒ…çš„è¿‡ç¨‹" class="headerlink" title="æ‰“åŒ…çš„è¿‡ç¨‹"></a>æ‰“åŒ…çš„è¿‡ç¨‹</h4><p>è¿™é‡Œä»¥ webpack ä¸ºä¾‹ï¼š</p><ol><li>åˆå§‹åŒ–ï¼šä»é…ç½®æ–‡ä»¶å’Œ Shell è¯­å¥ä¸­è¯»å–å¹¶åˆå¹¶é…ç½®å‚æ•°</li><li>å¼€å§‹ç¼–è¯‘ï¼šæ ¹æ®ä¸Šé¢å¾—åˆ°çš„å‚æ•°åˆå§‹åŒ– Compilerï¼ŒåŠ è½½æ’ä»¶ï¼ˆPluginsï¼‰ï¼Œæ‰§è¡Œ Compiler çš„ run æ–¹æ³•å¼€å§‹ç¼–è¯‘</li><li>å…¥å£æ–‡ä»¶ï¼šé…ç½®çš„ entry</li><li>ä»å…¥å£æ–‡ä»¶å¼€å§‹ï¼Œé’ˆå¯¹ä¸åŒçš„æ¨¡å—ä½¿ç”¨å¯¹åº”çš„ Loader ç¼–è¯‘ï¼Œå†æ‰¾åˆ°è¯¥æ¨¡å—æ‰€ä¾èµ–çš„æ¨¡å—ï¼Œé€’å½’è¿™ä¸ªæ­¥éª¤</li><li>å®Œæˆç¼–è¯‘ï¼šç»è¿‡ä¸Šè¿°æ­¥éª¤åå¾—åˆ°æ¯ä¸ªæ¨¡å—ç¼–è¯‘åçš„å†…å®¹ä»¥åŠç›¸äº’ä¹‹é—´çš„ä¾èµ–å…³ç³»</li><li>è¾“å‡ºï¼šæ ¹æ®ä¾èµ–å…³ç³»ï¼Œå°†æ¨¡å—ç»„åˆæˆä¸€ä¸ªä¸ªä»£ç å—ï¼ˆChunkï¼‰ï¼Œæœ€åè¾“å‡ºæˆæ–‡ä»¶</li></ol><h4 id="å®ç°ä¸€ä¸ªç®€æ˜“çš„æ‰“åŒ…å·¥å…·"><a href="#å®ç°ä¸€ä¸ªç®€æ˜“çš„æ‰“åŒ…å·¥å…·" class="headerlink" title="å®ç°ä¸€ä¸ªç®€æ˜“çš„æ‰“åŒ…å·¥å…·"></a>å®ç°ä¸€ä¸ªç®€æ˜“çš„æ‰“åŒ…å·¥å…·</h4><p>å‚è€ƒ <a href="https://github.com/ronami">ronami</a>/<strong><a href="https://github.com/ronami/minipack">minipack</a></strong> å®ç°ä¸€ä¸ªæ”¯æŒ ES Module çš„ç®€æ˜“æ‰“åŒ…å·¥å…·ï¼ˆè¿™é‡Œä¸è€ƒè™‘å¾ªç¯ä¾èµ–ç­‰æƒ…å†µï¼‰ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const fs &#x3D; require(&#39;fs&#39;)const path &#x3D; require(&#39;path&#39;)const babylon &#x3D; require(&#39;babylon&#39;)const traverse &#x3D; require(&#39;babel-traverse&#39;).defaultconst &#123; transformFromAst &#125; &#x3D; require(&#39;babel-core&#39;)</code></pre><p>å¼•å…¥ä¸Šè¿°ç›¸å…³ä¾èµ–ï¼š</p><ul><li>babylonï¼šç”Ÿæˆ ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰</li><li>babel-traverseï¼šæ¥åˆ†ææ–‡ä»¶çš„ä¾èµ–</li><li>transformFromAstï¼šå°† AST è½¬ä¸º ES5</li></ul><p><strong>é¦–å…ˆ</strong> å®šä¹‰ä¸€ä¸ªå‡½æ•°ç”¨äºè¯»å–æ–‡ä»¶çš„å†…å®¹å’Œä¾èµ–ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;** * è¯»å–æ–‡ä»¶å†…å®¹å’Œä¾èµ– *&#x2F;function createAsset(filePath) &#123;&#x2F;&#x2F; è¯»å–æ–‡ä»¶å†…å®¹  const content &#x3D; fs.readFileSync(filePath, &#39;utf-8&#39;)  &#x2F;&#x2F; ç”Ÿæˆ AST  const ast &#x3D; babylon.parse(content, &#123;    sourceType: &#39;module&#39;,  &#125;)  &#x2F;&#x2F; å½“å‰æ–‡ä»¶çš„ä¾èµ–å…³ç³»  const dependencies &#x3D; []  traverse(ast, &#123;    &#x2F;&#x2F; å½“é‡åˆ°å¯¼å…¥çš„å£°æ˜æ—¶ï¼Œå°†å…¶å†…å®¹ push åˆ° dependencies é‡Œ    ImportDeclaration: (&#123; node &#125;) &#x3D;&gt; &#123;      dependencies.push(node.source.value)    &#125;,  &#125;)  &#x2F;&#x2F; å°† AST è½¬ä¸º ES5  const &#123; code &#125; &#x3D; transformFromAst(ast, null, &#123;    presets: [&#39;env&#39;],  &#125;)  return &#123;    filePath,    dependencies,    code,  &#125;&#125;</code></pre><p>Asset æ¥å£å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">interface Assets &#123;&#x2F;&#x2F; æ–‡ä»¶è·¯å¾„  filePath: string;  &#x2F;&#x2F; æ–‡ä»¶çš„ä¾èµ–  dependencies: string[];  &#x2F;&#x2F; è½¬ä¸º ES5 åçš„æ–‡ä»¶å†…å®¹  code: string;  &#x2F;&#x2F; ç›¸å¯¹è·¯å¾„  relativePath?: string;&#125;</code></pre><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰ä¸ªæ–‡ä»¶ entry.js ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; entry.jsimport a from &#39;.&#x2F;a.js&#39;console.log(a)</code></pre><p>è¿è¡Œ <code>createAsset(&#39;./entry.js&#39;)</code> å°†ä¼šè¿”å›ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#123;  filePath: &#39;.&#x2F;entry.js&#39;,  dependencies: [ &#39;.&#x2F;a.js&#39; ],  code: &#96;&quot;use strict&quot;;var _a &#x3D; require(&quot;.&#x2F;a.js&quot;);var _a2 &#x3D; _interopRequireDefault(_a);function _interopRequireDefault(obj) &#123; return obj &amp;&amp; obj.__esModule ? obj : &#123; default: obj &#125;; &#125;console.log(_a2.default);&#96;&#125;</code></pre><p><strong>æ¥ç€</strong>å®šä¹‰ä¸€ä¸ªå‡½æ•°ç”¨äºæ„å»ºä¾èµ–å…³ç³»å›¾( dependency graph )ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;** * æ„å»ºä¾èµ–å…³ç³»å›¾ *&#x2F;function createGraph(entry) &#123;  &#x2F;&#x2F; ä»å…¥å£æ–‡ä»¶å¼€å§‹  const entryAsset &#x3D; createAsset(entry);  &#x2F;&#x2F; åˆå§‹æ—¶ï¼Œqueue ä¸­åªæœ‰ entryAsset, ä¹‹ååˆ†æä¾èµ–å…³ç³»ï¼Œä¼šå°†æ–°çš„ Asset push åˆ° queue ä¸­ç”¨äºåˆ†æï¼Œç›´åˆ°åˆ†æå®Œå…¨éƒ¨ä¾èµ–  const queue &#x3D; [entryAsset]  &#x2F;&#x2F; éå†æ‰€æœ‰æ–‡ä»¶ä¾èµ–å…³ç³»  for (const asset of queue) &#123;    &#x2F;&#x2F; è·å¾—æ–‡ä»¶ç›®å½•    const dirname &#x3D; path.dirname(asset.filePath)    &#x2F;&#x2F; éå†å½“å‰æ–‡ä»¶ä¾èµ–å…³ç³»    asset.dependencies.forEach((relativePath) &#x3D;&gt; &#123;      &#x2F;&#x2F; è·å¾—ç»å¯¹è·¯å¾„      const absolutePath &#x3D; path.join(dirname, relativePath)      const childAsset &#x3D; createAsset(absolutePath)      childAsset.relativePath &#x3D; relativePath      &#x2F;&#x2F; å°†å½“å‰æ–‡ä»¶æ‰€ä¾èµ–çš„æ–‡ä»¶çš„ Asset ä¹Ÿ push åˆ° queue ä¸­ç”¨äºéå†      queue.push(childAsset)    &#125;)  &#125;  return queue&#125;</code></pre><p>ä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šï¼Œæœ‰ä¸ª a.js ä»¥åŠ b.js æ–‡ä»¶, è¿è¡Œ <code>createGraph</code>ä¼šè¿”å›ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; a.jsimport b from &#39;.&#x2F;b.js&#39;const a &#x3D; &#39;1&#39;export default a&#x2F;&#x2F; b.jsconst b &#x3D; &#39;2&#39;export default b&#x2F;&#x2F; createGraph(&#39;.&#x2F;entry.js&#39;)[  &#123;    filePath: &#39;.&#x2F;entry.js&#39;,    dependencies: [ &#39;.&#x2F;a.js&#39; ],    code: &#96;&quot;use strict&quot;;var _a &#x3D; require(&quot;.&#x2F;a.js&quot;);var _a2 &#x3D; _interopRequireDefault(_a);function _interopRequireDefault(obj) &#123; return obj &amp;&amp; obj.__esModule ? obj : &#123; default: obj &#125;; &#125;console.log(_a2.default);&#96;  &#125;,  &#123;    filePath: &#39;a.js&#39;,    dependencies: [ &#39;.&#x2F;b.js&#39; ],    code: &#96;&quot;use strict&quot;;Object.defineProperty(exports, &quot;__esModule&quot;, &#123;  value: true&#125;);var _b &#x3D; require(&quot;.&#x2F;b.js&quot;);var _b2 &#x3D; _interopRequireDefault(_b);function _interopRequireDefault(obj) &#123; return obj &amp;&amp; obj.__esModule ? obj : &#123; default: obj &#125;; &#125;var a &#x3D; &#39;1&#39;;exports.default &#x3D; a;&#96;,    relativePath: &#39;.&#x2F;a.js&#39;  &#125;,  &#123;    filePath: &#39;b.js&#39;,    dependencies: [],    code: &#96;&quot;use strict&quot;;Object.defineProperty(exports, &quot;__esModule&quot;, &#123;  value: true&#125;);var b &#x3D; &#39;2&#39;;exports.default &#x3D; b;&#96;,    relativePath: &#39;.&#x2F;b.js&#39;  &#125;]</code></pre><p><strong>æœ€å</strong>å®ç°ä¸€ä¸ªæ‰“åŒ…å‡½æ•°ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">function bundle(entry) &#123;  const graph &#x3D; createGraph(entry)  let modules &#x3D; &#39;&#39;  &#x2F;&#x2F; æ„å»ºå‡½æ•°å‚æ•°  graph.forEach((mod) &#x3D;&gt; &#123;    const filePath &#x3D; mod.relativePath || entry    &#x2F;&#x2F; æ‹¼è£…æˆ modules    modules +&#x3D; &#96;&#39;$&#123;filePath&#125;&#39;: (      function (module, exports, require) &#123; $&#123;mod.code&#125; &#125;    ),&#96;  &#125;)  &#x2F;&#x2F; æœ€ç»ˆç»“æœ  const result &#x3D; &#96;    (function(modules) &#123;&#x2F;&#x2F; ast è½¬ es5 çš„ä»£ç æ˜¯ commonjs é£æ ¼ï¼Œè€Œæµè§ˆå™¨ä¸æ”¯æŒ commonjsï¼Œå› æ­¤è‡ªå®šä¹‰ requireï¼Œä»¥æ–‡ä»¶åä½œä¸º id      function require(id) &#123;        const module &#x3D; &#123; exports : &#123;&#125; &#125;        modules[id](module, module.exports, require)        return module.exports      &#125;&#x2F;&#x2F; å¼•å…¥å…¥å£æ–‡ä»¶ä»£ç       require(&#39;$&#123;entry&#125;&#39;)    &#125;)(&#123;$&#123;modules&#125;&#125;)  &#96;  &#x2F;&#x2F; å½“ç”Ÿæˆçš„å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ä¸­  fs.writeFileSync(&#39;.&#x2F;bundle.js&#39;, result)&#125;ã€€</code></pre><p>æœ€ç»ˆè¾“å‡ºä¸€ä¸ª IIFEï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">;(function (modules) &#123;  function require(id) &#123;    const module &#x3D; &#123; exports: &#123;&#125; &#125;    modules[id](module, module.exports, require)    return module.exports  &#125;  require(&#39;.&#x2F;entry.js&#39;)&#125;)(&#123;  &#39;.&#x2F;entry.js&#39;: function (module, exports, require) &#123;    &#39;use strict&#39;    var _a &#x3D; require(&#39;.&#x2F;a.js&#39;)    var _a2 &#x3D; _interopRequireDefault(_a)    function _interopRequireDefault(obj) &#123;      return obj &amp;&amp; obj.__esModule ? obj : &#123; default: obj &#125;    &#125;    console.log(_a2.default)  &#125;,  &#39;.&#x2F;a.js&#39;: function (module, exports, require) &#123;    &#39;use strict&#39;    Object.defineProperty(exports, &#39;__esModule&#39;, &#123;      value: true,    &#125;)    var _b &#x3D; require(&#39;.&#x2F;b.js&#39;)    var _b2 &#x3D; _interopRequireDefault(_b)    function _interopRequireDefault(obj) &#123;      return obj &amp;&amp; obj.__esModule ? obj : &#123; default: obj &#125;    &#125;    var a &#x3D; &#39;1&#39;    exports.default &#x3D; a  &#125;,  &#39;.&#x2F;b.js&#39;: function (module, exports, require) &#123;    &#39;use strict&#39;    Object.defineProperty(exports, &#39;__esModule&#39;, &#123;      value: true,    &#125;)    var b &#x3D; &#39;2&#39;    exports.default &#x3D; b  &#125;,&#125;)</code></pre>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‰ç«¯å·¥ç¨‹åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼-JSä¸­çš„å•ä¾‹æ¨¡å¼</title>
      <link href="/2020/07/28/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-JS%E4%B8%AD%E7%9A%84%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
      <url>/2020/07/28/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-JS%E4%B8%AD%E7%9A%84%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>æ­¤å‰é¡¹ç›®æœ‰ä¸ª im  æ¨¡å—ï¼Œéœ€è¦ç”¨åˆ° websocketã€‚ä½¿ç”¨ websocket éœ€è¦å»ºç«‹è¿æ¥ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const initWs &#x3D; () &#x3D;&gt; &#123;  const ws &#x3D; new WebSocket(&#39;wss:&#x2F;&#x2F;xxx.com&#39;);  ws.onopen(() &#x3D;&gt; &#123;    console.log(&#39;opened&#39;)  &#125;)  ws.onmessage((evt) &#x3D;&gt; &#123;    console.log(&#39;Received evt&#39;, evt.data)  &#125;)  &#x2F;&#x2F;....  return ws&#125;</code></pre><p>æˆ‘ä»¬è‚¯å®šä¸å¸Œæœ›åœ¨æ¯ä¸ªç”¨åˆ° ws çš„åœ°æ–¹éƒ½é‡å¤åˆå§‹åŒ–ï¼Œå³æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ª WebSocket çš„å®ä¾‹ã€‚</p><a id="more"></a><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const wsA &#x3D; new SingleWs()const wsB &#x3D; new SingleWs()&#x2F;&#x2F; æœ‰æ²¡æœ‰åŠæ³•ä½¿å¾—:wsA instanceof WebSocket &amp;&amp; wsB instanceof WebSocket &amp;&amp; wsA &#x3D;&#x3D;&#x3D; wsB</code></pre><p>é‚£ä¹ˆè¦å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ï¼Ÿå®é™…ä¸Šå°±å¯ä»¥ç”¨åˆ°å•ä¾‹æ¨¡å¼ã€‚ä¸‹é¢åˆ—ä¸¾å‡ ä¸ªå®ç°çš„æ–¹æ³•ï¼š</p><h4 id="ä½¿ç”¨å…¨å±€å˜é‡"><a href="#ä½¿ç”¨å…¨å±€å˜é‡" class="headerlink" title="ä½¿ç”¨å…¨å±€å˜é‡"></a>ä½¿ç”¨å…¨å±€å˜é‡</h4><p>è¿™ä¸ªå¯èƒ½æ˜¯æœ€å®¹æ˜“æƒ³åˆ°çš„ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">window.ws &#x3D; window.ws || initWs()</code></pre><p>å°† ws æŒ‚åœ¨ window å¯¹è±¡ä¸Šï¼Œä½¿ç”¨æ—¶ä¹Ÿç”¨ window.wsï¼Œæ˜¾ç„¶è¿™ä¸ªè§£å†³æ–¹æ¡ˆæœ‰ä¸ªé—®é¢˜æ˜¯éœ€è¦å°å¿ƒ window.ws è¢«è¦†ç›–ã€‚</p><h4 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h4><p>é—­åŒ…å¯ä»¥ä¿æŒå±€éƒ¨å˜é‡ä¿æŒåœ¨å†…å­˜ä¸­ä¸è¢«é”€æ¯ï¼Œé€šè¿‡è¿™ä¸ªç‰¹æ€§å¯ä»¥å°±å¯ä»¥é¿å…æ±¡æŸ“å…¨å±€å˜é‡ï¼Œå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const SingleWs &#x3D; (function() &#123; let ws &#x3D; null; &#x2F;&#x2F; const initWs &#x3D; .... return &#123;   getWs() &#123;     if(!ws) &#123;       ws &#x3D; initWs()     &#125;     return ws   &#125;  &#125;&#125;)()const wsA &#x3D; SingleWs.getWs()const wsB &#x3D; SingleWs.getWs()console.log(wsA instanceof WebSocket &amp;&amp; wsB instanceof WebSocket &amp;&amp; wsA &#x3D;&#x3D;&#x3D; wsB)</code></pre><p>ç„¶è€Œä¸Šé¢çš„å†™æ³•ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œå¦‚ getWs å¯ä»¥è¢«æ”¹å†™ã€‚</p><p>å†™æ³•è¿˜å¯ä»¥è¿›ä¸€æ­¥æ”¹å†™ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const SingleWs &#x3D; (function() &#123; let ws &#x3D; null; &#x2F;&#x2F; const initWs &#x3D; ....  return () &#x3D;&gt; &#123;    if(!ws) &#123;      ws &#x3D; initWs()    &#125;    return ws  &#125;&#125;)()&#x2F;&#x2F; è¿™é‡Œçš„ new å¯ä»¥ä¸å†™const wsA &#x3D; new SingleWs()const wsB &#x3D; new SingleWs()wsA instanceof WebSocket &amp;&amp; wsB instanceof WebSocket &amp;&amp; wsA &#x3D;&#x3D;&#x3D; wsB</code></pre><h4 id="æ¨¡å—åŒ–"><a href="#æ¨¡å—åŒ–" class="headerlink" title="æ¨¡å—åŒ–"></a>æ¨¡å—åŒ–</h4><p>é€šè¿‡æ¨¡å—åŒ–ä¹Ÿèƒ½å®ç°ä¸Šè¿°çš„æ•ˆæœï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; ws.jslet ws &#x3D; null&#x2F;&#x2F; const initWs &#x3D; ....function SingleWs() &#123;  if (ws) &#123;    return ws  &#125;  ws &#x3D; initWs()  return ws&#125;export default SingleWs</code></pre><h4 id="é€šè¿‡-class-çš„é™æ€å±æ€§æ¥å®ç°"><a href="#é€šè¿‡-class-çš„é™æ€å±æ€§æ¥å®ç°" class="headerlink" title="é€šè¿‡ class çš„é™æ€å±æ€§æ¥å®ç°"></a>é€šè¿‡ class çš„é™æ€å±æ€§æ¥å®ç°</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class SingleWs &#123;  constructor() &#123;    if (!SingleWs.instance) &#123;      SingleWs.instance &#x3D; this.initWs()    &#125;    return SingleWs.instance  &#125;  initWs() &#123;    &#x2F;&#x2F; ...      &#125;&#125;const wsA &#x3D; new SingleWs()const wsB &#x3D; new SingleWs()console.log(wsA instanceof WebSocket &amp;&amp; wsB instanceof WebSocket &amp;&amp; wsA &#x3D;&#x3D;&#x3D; wsB)</code></pre><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>JS ä¸­çš„å•ä¾‹æ¨¡å¼ï¼š</p><ol><li>å®ä¾‹åŒ–æ—¶ï¼Œåˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨å®ä¾‹ã€‚</li><li>å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆå§‹åŒ–ï¼Œå¹¶å°†ç”Ÿæˆçš„å®ä¾‹å­˜å‚¨èµ·æ¥ã€‚</li><li>å­˜å‚¨çš„æ–¹æ³•å¯ä»¥æ˜¯å…¨å±€å˜é‡ï¼Œé—­åŒ…ï¼Œæ¨¡å—ä»¥åŠç±»çš„é™æ€å±æ€§ã€‚</li><li>å¦‚æœå·²ç»å­˜åœ¨å®ä¾‹ï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å›è¯¥å®ä¾‹ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€è¯‘ã€‘ReactHooks-å¹¶éé»‘é­”æ³•ï¼Œæœ¬è´¨æ˜¯æ•°ç»„</title>
      <link href="/2020/07/26/%E3%80%90%E8%AF%91%E3%80%91ReactHooks-%E5%B9%B6%E9%9D%9E%E9%BB%91%E9%AD%94%E6%B3%95%EF%BC%8C%E6%9C%AC%E8%B4%A8%E6%98%AF%E6%95%B0%E7%BB%84/"/>
      <url>/2020/07/26/%E3%80%90%E8%AF%91%E3%80%91ReactHooks-%E5%B9%B6%E9%9D%9E%E9%BB%91%E9%AD%94%E6%B3%95%EF%BC%8C%E6%9C%AC%E8%B4%A8%E6%98%AF%E6%95%B0%E7%BB%84/</url>
      
        <content type="html"><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>æœ¬æ–‡ç¿»è¯‘è‡ª <a href="https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e">React hooks: not magic, just arrays</a>ï¼Œè¯¥æ–‡ç« å¾ˆå¥½çš„é˜é‡Šäº† react hooks åŸç†ï¼Œæˆ‘å°†ä¿æŒåŸæ–‡çš„æ„æ€è¿›è¡Œç¿»è¯‘ï¼Œå¦‚æœ‰è‡ªå·±æ„Ÿè§‰ä¸æ¸…æ¥šçš„åœ°æ–¹å°†ä¼šåœ¨æ‹¬å·ä¸­æ³¨æ˜ã€‚ä»¥ä¸‹ä¸ºç¿»è¯‘å†…å®¹ã€‚</p><p>æˆ‘æ˜¯ hooks api çš„å¿ å®ç²‰ä¸ã€‚ç„¶è€Œ hooks åœ¨ä½¿ç”¨æ—¶å´æœ‰ä¸€äº›<a href="https://reactjs.org/docs/hooks-rules.html">å¥‡æ€ªçš„çº¦æŸ</a>ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ç»™å°è¯•å»ç†è§£è¿™äº›è§„åˆ™ç”±æ¥çš„äººæä¾›ä¸€ä¸ªäº†æ¨¡å‹ï¼Œç”¨äºæ€è€ƒå¦‚ä½•å»ä½¿ç”¨è¿™äº›æ–° apiã€‚</p><a id="more"></a><h4 id="hooks-çš„è§„åˆ™"><a href="#hooks-çš„è§„åˆ™" class="headerlink" title="hooks çš„è§„åˆ™"></a>hooks çš„è§„åˆ™</h4><p>åœ¨ <a href="https://reactjs.org/docs/hooks-rules.html">hooks proposal documentation</a> çš„æçº²ä¸­ï¼ŒReact æ ¸å¿ƒå›¢é˜Ÿè§„å®šäº†ä¸¤æ¡å¼€å‘è€…åœ¨ä½¿ç”¨ hooks æ—¶éœ€è¦éµå®ˆçš„ä¸»è¦è§„åˆ™ï¼š</p><ul><li>ä¸è¦åœ¨å¾ªç¯ï¼Œæ¡ä»¶æˆ–è€…æ˜¯åµŒå¥—å‡½æ•°ä¸­ä½¿ç”¨ hooks</li><li>åªèƒ½åœ¨ React Functions ä¸­æ‰èƒ½ä½¿ç”¨ hooks</li></ul><p>åè€…æˆ‘è®¤ä¸ºæ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚è¦å°†è¡Œä¸ºé™„åŠ åˆ°å‡½æ•°å¼ç»„ä»¶ä¸Šï¼Œä½ éœ€è¦èƒ½å¤Ÿä»¥æŸç§æ–¹å¼å°†è¯¥è¡Œä¸ºä¸ç»„ä»¶å…³è”èµ·æ¥ã€‚ï¼ˆåŸæ–‡ä¸ºï¼š To attach behaviour to a functional component you need to be able to associate that behaviour with the component somehow. ä¸å¤ªç†è§£ä½œè€…æƒ³è¡¨è¾¾çš„æ„æ€ï¼‰</p><p>å‰è€…æˆ‘è®¤ä¸ºä¼šæ¯”è¾ƒè®©äººå›°æƒ‘ï¼Œå› ä¸ºåƒè¿™æ ·ä½¿ç”¨ api å¯èƒ½çœ‹èµ·æ¥ä¸å¤ªè‡ªç„¶ã€‚è€Œè¿™æ­£æ˜¯æˆ‘ä»Šå¤©æƒ³è¦æ¢è®¨çš„å†…å®¹ã€‚</p><h4 id="hooks-çš„çŠ¶æ€ç®¡ç†éƒ½æ˜¯åŸºäºæ•°ç»„"><a href="#hooks-çš„çŠ¶æ€ç®¡ç†éƒ½æ˜¯åŸºäºæ•°ç»„" class="headerlink" title="hooks çš„çŠ¶æ€ç®¡ç†éƒ½æ˜¯åŸºäºæ•°ç»„"></a>hooks çš„çŠ¶æ€ç®¡ç†éƒ½æ˜¯åŸºäºæ•°ç»„</h4><p>ä¸ºäº†æ›´æ¸…æ™°åœ°ç†è§£å¿ƒæ™ºæ¨¡å‹ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„ hooks apiã€‚</p><p><strong>æ³¨æ„è¿™åªæ˜¯ API çš„ä¸€ç§å¯èƒ½çš„å®ç°æ–¹å¼åŠçŒœæƒ³ï¼Œç”¨äºè®©ä½ ç†è§£ï¼Œè€Œé API çœŸæ­£çš„å†…éƒ¨å®ç°æ–¹å¼</strong></p><h4 id="æˆ‘ä»¬å¦‚ä½•å®ç°-useState"><a href="#æˆ‘ä»¬å¦‚ä½•å®ç°-useState" class="headerlink" title="æˆ‘ä»¬å¦‚ä½•å®ç° useState?"></a>æˆ‘ä»¬å¦‚ä½•å®ç° <code>useState</code>?</h4><p>è®©æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªå®ä¾‹æ¥æ¼”ç¤ºå¦‚ä½•å®ç°ä¸€ä¸ª state hookã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç»„ä»¶ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">function RenderFunctionComponent() &#123;  const [firstName, setFirstName] &#x3D; useState(&quot;Rudi&quot;);  const [lastName, setLastName] &#x3D; useState(&quot;Yardley&quot;);  return (    &lt;Button onClick&#x3D;&#123;() &#x3D;&gt; setFirstName(&quot;Fred&quot;)&#125;&gt;Fred&lt;&#x2F;Button&gt;  );&#125;</code></pre><p>è¿™ä¸ª Hooks api èƒŒåçš„æ€æƒ³æ˜¯ï¼Œä½ å¯ä»¥ç”¨ hook å‡½æ•°è¿”å›çš„æ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ ä½œä¸º setter æ–¹æ³•ï¼Œè¿™ä¸ª setter æ–¹æ³•å¯ä»¥æ§åˆ¶è¢« hook ç®¡ç†çš„çŠ¶æ€ã€‚</p><h4 id="é‚£ä¹ˆ-React-æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸ªçš„å‘¢ï¼Ÿ"><a href="#é‚£ä¹ˆ-React-æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸ªçš„å‘¢ï¼Ÿ" class="headerlink" title="é‚£ä¹ˆ React æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸ªçš„å‘¢ï¼Ÿ"></a>é‚£ä¹ˆ React æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸ªçš„å‘¢ï¼Ÿ</h4><p>è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªåœ¨ React å†…éƒ¨æ˜¯å¦‚ä½•è¿ä½œçš„ã€‚ä»¥ä¸‹å†…å®¹å°†åœ¨ç‰¹å®šç»„ä»¶çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚è¿™å°±æ˜¯è¯´æ•°æ®å­˜å‚¨åœ¨è¦æ¸²æŸ“çš„ç»„ä»¶çš„ä¸Šä¸€å±‚ã€‚è¿™ä¸ª state ä¸ä¸å…¶ä»–ç»„ä»¶å…±äº«ï¼Œä½†æ˜¯ç»´æŠ¤åœ¨ä¸€ä¸ªå¯ä»¥ç”¨äºè¯¥ç»„ä»¶åç»­æ¸²æŸ“çš„ä½œç”¨åŸŸå†…ã€‚ï¼ˆåŸæ–‡ï¼šThe following would work within the execution context for rendering a particular component. That means that the data stored here lives one level outside of the component being rendered. This state is not shared with other components but it is maintained in a scope that is accessible to subsequent rendering of the specific componentï¼‰</p><ol><li><p>åˆå§‹åŒ–</p><p>åˆ›å»ºä¸¤ä¸ªç©ºæ•°ç»„ï¼š<code>setter</code> å’Œ <code>state</code></p><p>å°†æŒ‡é’ˆè®¾ç½®ä¸º 0</p><p><img src="https://miro.medium.com/max/1280/1*LAZDuAEm7nbcx0vWVKJJ2w.png" alt="Image for post"></p></li><li><p>é¦–æ¬¡æ¸²æŸ“</p><p>é¦–æ¬¡è¿è¡Œè¯¥ç»„ä»¶ã€‚</p><p>æ¯æ¬¡è°ƒç”¨ <code>useState</code> ï¼Œå¦‚æœæ˜¯é¦–æ¬¡è¿è¡Œï¼Œåˆ™ push ä¸€ä¸ª setter æ–¹æ³•ï¼ˆç»‘å®šåˆ°æŒ‡é’ˆçš„ä½ç½®ï¼‰åˆ° setters æ•°ç»„ä¸­ï¼Œå¹¶ä¸” push ä¸€äº› state åˆ° state æ•°ç»„ä¸­ã€‚</p><p><img src="https://miro.medium.com/max/1260/1*8TpWnrL-Jqh7PymLWKXbWg.png" alt="Image for post"></p></li><li><p>åç»­æ¸²æŸ“</p><p>æ¯æ¬¡åç»­æ¸²æŸ“ï¼ŒæŒ‡é’ˆå°†è¢«é‡ç½®ï¼Œç„¶åä»å„ä¸ªæ•°ç»„ä¸­è¯»å–å¯¹åº”çš„å€¼ã€‚</p><p><img src="https://miro.medium.com/max/1254/1*qtwvPWj-K3PkLQ6SzE2u8w.png" alt="Image for post"></p></li><li><p>äº‹ä»¶å¤„ç†</p><p>æ¯ä¸€ä¸ª setter éƒ½ä¿å­˜ä¸€ä¸ªå¯¹åº”çš„æŒ‡é’ˆä½ç½®çš„å¼•ç”¨ï¼Œå› æ­¤è§¦å‘ä»»æ„ä¸€ä¸ª <code>setter</code> éƒ½å¯ä»¥ä¿®æ”¹ state æ•°ç»„ä¸­å¯¹åº”æŒ‡é’ˆä½ç½®çš„ stateã€‚</p><p><img src="https://miro.medium.com/max/1260/1*3L8YJnn5eV5ev1FuN6rKSQ.png" alt="Image for post"></p></li></ol><h4 id="ç®€å•çš„å®ç°-And-the-naive-implementation"><a href="#ç®€å•çš„å®ç°-And-the-naive-implementation" class="headerlink" title="ç®€å•çš„å®ç°(And the naive implementation)"></a>ç®€å•çš„å®ç°(And the naive implementation)</h4><p>ä¸‹é¢æ˜¯ç®€å•çš„ä»£ç æ¼”ç¤ºï¼š</p><p><strong>æ³¨æ„ï¼šè¿™ä¸ä»£è¡¨ hooks çš„å®é™…å®ç°ï¼Œä½†æ˜¯åº”è¯¥èƒ½ç»™ä½ ä¸€ä¸ªç†è§£ hooks å·¥ä½œåŸç†çš„æ€è·¯ã€‚è¿™å°±æ˜¯æˆ‘ä¸ºä»€ä¹ˆä½¿ç”¨å—çº§å˜é‡çš„åŸå› ï¼ˆåŸæ–‡ï¼š That is why we are using module level vars etcï¼‰</strong></p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">let state &#x3D; [];let setters &#x3D; [];let firstRun &#x3D; true;let cursor &#x3D; 0;function createSetter(cursor) &#123;  return function setterWithCursor(newVal) &#123;    state[cursor] &#x3D; newVal;  &#125;;&#125;&#x2F;&#x2F; This is the pseudocode for the useState helperexport function useState(initVal) &#123;  if (firstRun) &#123;    state.push(initVal);    setters.push(createSetter(cursor));    firstRun &#x3D; false;  &#125;  const setter &#x3D; setters[cursor];  const value &#x3D; state[cursor];  cursor++;  return [value, setter];&#125;&#x2F;&#x2F; Our component code that uses hooksfunction RenderFunctionComponent() &#123;  const [firstName, setFirstName] &#x3D; useState(&quot;Rudi&quot;); &#x2F;&#x2F; cursor: 0  const [lastName, setLastName] &#x3D; useState(&quot;Yardley&quot;); &#x2F;&#x2F; cursor: 1  return (    &lt;div&gt;      &lt;Button onClick&#x3D;&#123;() &#x3D;&gt; setFirstName(&quot;Richard&quot;)&#125;&gt;Richard&lt;&#x2F;Button&gt;      &lt;Button onClick&#x3D;&#123;() &#x3D;&gt; setFirstName(&quot;Fred&quot;)&#125;&gt;Fred&lt;&#x2F;Button&gt;    &lt;&#x2F;div&gt;  );&#125;&#x2F;&#x2F; This is sort of simulating Reacts rendering cyclefunction MyComponent() &#123;  cursor &#x3D; 0; &#x2F;&#x2F; resetting the cursor  return &lt;RenderFunctionComponent &#x2F;&gt;; &#x2F;&#x2F; render&#125;console.log(state); &#x2F;&#x2F; Pre-render: []MyComponent();console.log(state); &#x2F;&#x2F; First-render: [&#39;Rudi&#39;, &#39;Yardley&#39;]MyComponent();console.log(state); &#x2F;&#x2F; Subsequent-render: [&#39;Rudi&#39;, &#39;Yardley&#39;]&#x2F;&#x2F; click the &#39;Fred&#39; buttonconsole.log(state); &#x2F;&#x2F; After-click: [&#39;Fred&#39;, &#39;Yardley&#39;]</code></pre><h4 id="ä¸ºä»€ä¹ˆé¡ºåºå¾ˆé‡è¦ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆé¡ºåºå¾ˆé‡è¦ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆé¡ºåºå¾ˆé‡è¦ï¼Ÿ"></a>ä¸ºä»€ä¹ˆé¡ºåºå¾ˆé‡è¦ï¼Ÿ</h4><p>ç°åœ¨å¦‚æœåœ¨ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸé‡Œï¼Œæˆ‘ä»¬åŸºäºå¤–éƒ¨çš„å› ç´ æˆ–è€…ç»„ä»¶çŠ¶æ€æ”¹å˜äº† hooks çš„é¡ºåºï¼Œå°†ä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼Ÿ</p><p>è®©æˆ‘ä»¬è¯•è¯•çœ‹ react ä¸å»ºè®®æˆ‘ä»¬åšçš„äº‹æƒ…ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">let firstRender &#x3D; true;function RenderFunctionComponent() &#123;  let initName;  if(firstRender)&#123;    [initName] &#x3D; useState(&quot;Rudi&quot;);    firstRender &#x3D; false;  &#125;  const [firstName, setFirstName] &#x3D; useState(initName);  const [lastName, setLastName] &#x3D; useState(&quot;Yardley&quot;);  return (    &lt;Button onClick&#x3D;&#123;() &#x3D;&gt; setFirstName(&quot;Fred&quot;)&#125;&gt;Fred&lt;&#x2F;Button&gt;  );&#125;</code></pre><p>æˆ‘ä»¬åœ¨ä¸€ä¸ªæ¡ä»¶è¯­å¥ä¸­ä½¿ç”¨äº† <code>useState</code>ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹é€ æˆäº†ä»€ä¹ˆæ ·çš„ç ´åï¼š</p><h4 id="åç»„ä»¶çš„ç¬¬ä¸€æ¬¡æ¸²æŸ“"><a href="#åç»„ä»¶çš„ç¬¬ä¸€æ¬¡æ¸²æŸ“" class="headerlink" title="åç»„ä»¶çš„ç¬¬ä¸€æ¬¡æ¸²æŸ“"></a>åç»„ä»¶çš„ç¬¬ä¸€æ¬¡æ¸²æŸ“</h4><p><img src="https://miro.medium.com/max/1270/1*C4IA_Y7v6eoptZTBspRszQ.png" alt="Image for post"></p><p>åœ¨è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬çš„å®ä¾‹å˜é‡ <code>firstName</code> å’Œ <code>lastName</code> æŒ‡å‘çš„æ­£ç¡®çš„æ•°æ®ï¼Œä½†æ˜¯æˆ‘ä»¬çœ‹çœ‹ç¬¬äºŒæ¬¡æ¸²æŸ“å‘ç”Ÿäº†ä»€ä¹ˆï¼š</p><h4 id="åç»„ä»¶çš„ç¬¬äºŒæ¬¡æ¸²æŸ“"><a href="#åç»„ä»¶çš„ç¬¬äºŒæ¬¡æ¸²æŸ“" class="headerlink" title="åç»„ä»¶çš„ç¬¬äºŒæ¬¡æ¸²æŸ“"></a>åç»„ä»¶çš„ç¬¬äºŒæ¬¡æ¸²æŸ“</h4><p><img src="https://miro.medium.com/max/1274/1*aK7jIm6oOeHJqgWnNXt8Ig.png" alt="Image for post"></p><p>ç°åœ¨æˆ‘ä»¬çš„ state å­˜å‚¨å‡ºç°å¼‚å¸¸ï¼Œ <code>firstName</code> å’Œ <code>lastName</code> éƒ½æŒ‡å‘ â€œRudiâ€ã€‚ä¸Šè¿°æ˜æ˜¾é”™è¯¯çš„æ“ä½œç»™äº†æˆ‘ä»¬ä¸€ä¸ªæ€è·¯ï¼šä¸ºä»€ä¹ˆ hooks è¦å¦‚æ­¤è§„å®šã€‚</p><blockquote><p>The React team are stipulating the usage rules because not following them will lead to inconsistent data</p></blockquote><h4 id="æƒ³æƒ³-hooks-æ“ä½œä¸€ç³»åˆ—çš„æ•°ç»„ï¼Œé‚£ä¹ˆä½ å°±ä¸ä¼šæ‰“ç ´è§„åˆ™äº†ï¼ˆThink-about-hooks-manipulating-a-set-of-arrays-and-you-wont-break-the-rulesï¼‰"><a href="#æƒ³æƒ³-hooks-æ“ä½œä¸€ç³»åˆ—çš„æ•°ç»„ï¼Œé‚£ä¹ˆä½ å°±ä¸ä¼šæ‰“ç ´è§„åˆ™äº†ï¼ˆThink-about-hooks-manipulating-a-set-of-arrays-and-you-wont-break-the-rulesï¼‰" class="headerlink" title="æƒ³æƒ³ hooks æ“ä½œä¸€ç³»åˆ—çš„æ•°ç»„ï¼Œé‚£ä¹ˆä½ å°±ä¸ä¼šæ‰“ç ´è§„åˆ™äº†ï¼ˆThink about hooks manipulating a set of arrays and you wont break the rulesï¼‰"></a>æƒ³æƒ³ hooks æ“ä½œä¸€ç³»åˆ—çš„æ•°ç»„ï¼Œé‚£ä¹ˆä½ å°±ä¸ä¼šæ‰“ç ´è§„åˆ™äº†ï¼ˆThink about hooks manipulating a set of arrays and you wont break the rulesï¼‰</h4><p>ç°åœ¨åº”è¯¥èƒ½å¾ˆæ¸…æ™°ç†è§£ä¸ºä»€ä¹ˆä¸èƒ½åœ¨æ¡ä»¶æˆ–è€…å¾ªç¯è¯­å¥ä¸­ä½¿ç”¨ <code>use</code> hook äº†ï¼šå› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†æŒ‡é’ˆæŒ‡å‘äº†æ•°ç»„ï¼Œå¦‚æœåœ¨ render çš„æ—¶å€™æ”¹å˜äº†é¡ºåºï¼Œé‚£ä¹ˆæŒ‡é’ˆå°±ä¸èƒ½å¯¹åº”æ­£ç¡®çš„æ•°æ®ï¼Œæ‰€ä»¥è°ƒç”¨ use ä¹Ÿä¸ä¼šæŒ‡å‘æ­£ç¡®çš„æ•°æ®å’Œ setterã€‚</p><p>å› æ­¤ï¼Œè¯€çªå°±æ˜¯å°† hooks æƒ³åƒæˆç”¨æ’å®šçš„æŒ‡é’ˆæ¥ç®¡ç†ä¸€ç³»åˆ—æ•°ç»„ã€‚å¦‚æœèƒ½åšåˆ°è¿™ä¸ªï¼Œé‚£ä¹ˆä¸€åˆ‡å°±èƒ½æŒ‰é¢„æœŸè¿›è¡Œã€‚</p><h4 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h4><p>å¸Œæœ›æˆ‘å·²ç»å°±å¦‚ä½•æ€è€ƒ hooks api çš„å·¥ä½œåŸç†æŒ‡å‡ºäº†ä¸€ä¸ªæ¸…æ™°çš„å¿ƒæ™ºæ¨¡å‹ã€‚ï¼ˆåé¢å°±å·ä¸ªæ‡’ä¸ç¿»è¯‘äº†ï¼ŒåŸºæœ¬æ˜¯ä¸Šè¿°è§‚ç‚¹çš„é‡å¤å¼ºè°ƒã€‚ï¼‰</p><p>Hopefully I have laid out a clearer mental model for how to think about what is going on under the hood with the new hooks API. Remember the true value here is being able to group concerns together so being careful about order and using the hooks API will have a high payoff.</p><p>Hooks is an effective plugin API for React Components. There is a reason why people are excited about this and if you think about this kind of model where state exists as a set of arrays then you should not find yourselves breaking the rules around their usage.</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‰ç«¯å¸¸è§çš„å®‰å…¨é—®é¢˜æ±‡æ€»</title>
      <link href="/2020/07/23/%E5%89%8D%E7%AB%AF%E5%B8%B8%E8%A7%81%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/"/>
      <url>/2020/07/23/%E5%89%8D%E7%AB%AF%E5%B8%B8%E8%A7%81%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>æœ€è¿‘å®‰å…¨éƒ¨é—¨çš„å°ä¼™ä¼´æäº†ä¸€ä¸ªå‰ç«¯å®‰å…¨çš„æ¼æ´ï¼Œæƒ³åˆ°å‰ç«¯å¼€å‘è¿‡ç¨‹ä¸­æœ‰æ—¶å€™å¾€å¾€è¿½æ±‚å¼€å‘æ•ˆç‡ï¼Œå¿½ç•¥æ‰ä¸€äº›å®‰å…¨é—®é¢˜ï¼Œä»¥ä¸‹ç®€å•æ€»ç»“ä¸€äº›è‡ªå·±é‡åˆ°è¿‡çš„ä»¥åŠä¸€äº›å¸¸è§çš„æ”»å‡»æ‰‹æ®µï¼Œä»¥è‡ªæŸ¥è‡ªçœã€‚</p><a id="more"></a><h4 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h4><p>å›åˆ°å®‰å…¨éƒ¨é—¨æå‡ºçš„æ¼æ´ï¼Œåœºæ™¯è¿˜åŸå¦‚ä¸‹ï¼š<br>è¿™æ˜¯ä¸€ä¸ªè€é¡¹ç›®ï¼Œå±•ç¤ºæ–‡ç« ç”¨ï¼Œé¡µé¢è·¯ç”±ä¸º <a href="http://xxx/article/:id?these-are-queriesï¼Œnode">http://xxx/article/:id?these-are-queriesï¼Œnode</a> å±‚æ”¶åˆ°è¿™ä¸ª url åï¼Œè¿”å›è¿”å›è¯¥æ–‡ç«  htmlï¼Œå†…å®¹åˆ™åŒ…æ‹¬äº†ã€æ¨èæ–‡ç« ã€‘ï¼Œ è€Œæ¨èæ–‡ç« çš„é“¾æ¥åˆ™æ˜¯æ ¹æ® url çš„å€¼æ¥çš„ï¼Œä»…å˜åŒ– idã€‚æ­¤æ—¶å¦‚æœåœ¨ url ä¸Šçš„ query ä¸Šæ„é€ ä¸€æ®µæ¶æ„è„šæœ¬ï¼Œç„¶åå¼•å¯¼ç”¨æˆ·æ‰“å¼€ï¼Œé‚£ä¹ˆç”¨æˆ·æ‰“å¼€é¡µé¢åå°±ä¼šè¿è¡Œè¯¥æ¶æ„è„šæœ¬ã€‚<br>ä¸Šè¿°æ­£æ˜¯ä¸€ä¸ªå…¸å‹çš„ XSS æ”»å‡»ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p><blockquote><p>XSSæ˜¯è·¨ç«™è„šæœ¬æ”»å‡»(Cross Site Scripting)ï¼Œä¸ºä¸å’Œå±‚å æ ·å¼è¡¨(Cascading Style Sheets, CSS)çš„ç¼©å†™æ··æ·†ï¼Œæ•…å°†è·¨ç«™è„šæœ¬æ”»å‡»ç¼©å†™ä¸ºXSSã€‚æ¶æ„æ”»å‡»è€…å¾€Webé¡µé¢é‡Œæ’å…¥æ¶æ„Scriptä»£ç ï¼Œå½“ç”¨æˆ·æµè§ˆè¯¥é¡µä¹‹æ—¶ï¼ŒåµŒå…¥å…¶ä¸­Webé‡Œé¢çš„Scriptä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ¶æ„æ”»å‡»ç”¨æˆ·çš„ç›®çš„ã€‚</p></blockquote><p>XSS çš„æœ¬è´¨æ˜¯ä¿¡ä»»äº†æŸäº›ä¸å®‰å…¨çš„è¾“å…¥ï¼Œå¯¼è‡´æ¶æ„ä»£ç æ··å…¥æ­£å¸¸ä»£ç ï¼Œè¿›è€Œå‘ç”Ÿçš„æ”»å‡»è¡Œä¸ºã€‚å¸¸è§çš„ä¸å®‰å…¨è¾“å…¥æœ‰ï¼š</p><ol><li>ä¸Šé¢æåˆ°çš„ url å‚æ•°ï¼Œè¿™ç§éœ€è¦è¯±å¯¼ç”¨æˆ·å–ç‚¹å‡»</li><li>ç”¨æˆ·è¾“å…¥çš„å†…å®¹ï¼Œæ¯”å¦‚ç”¨æˆ·å‘è¡¨è¯„è®º</li><li>ç¬¬ä¸‰æ–¹çš„é“¾æ¥ç­‰</li></ol><p>é˜²èŒƒçš„æ–¹æ³•é€šå¸¸æ˜¯ï¼šå¯¹ç”¨æˆ·è¾“å…¥å†…å®¹å’ŒæœåŠ¡ç«¯è¿”å›å†…å®¹è¿›è¡Œè¿‡æ»¤å’Œè½¬è¯‘ã€‚</p><h4 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h4><p>CSRF æ”»å‡»å¸¸è§çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>ç”¨æˆ·ç™»å½•ä½ çš„ç½‘ç«™ï¼Œäº§ç”Ÿç™»å½•å‡­è¯ï¼Œå¦‚ cookie</li><li>ç”¨æˆ·è¢«<strong>è¯±å¯¼</strong>ç™»å½•åˆ°æ¶æ„ç½‘ç«™</li><li>æ¶æ„ç½‘ç«™æºå¸¦åˆšåˆšåœ¨æµè§ˆå™¨äº§ç”Ÿçš„å‡­è¯å‘ä½ çš„æœåŠ¡å™¨å‘é€ä¸€ä¸ªæ¶æ„è¯·æ±‚</li><li>ä½ çš„æœåŠ¡å™¨æ— æ³•è¯†åˆ«æ˜¯å¦æ¶æ„è¯·æ±‚ï¼Œè¯·æ±‚å®Œæˆï¼Œç”¨æˆ·å—å®³ã€‚</li></ol><p>ä¸ä¸Šé¢æåˆ°çš„ XSS æ”»å‡»æœ‰ä¸ªæ˜æ˜¾çš„åŒºåˆ«åœ¨äºï¼šCSRF æ”»å‡»å‘ç”Ÿåœ¨æ¶æ„ç½‘ç«™ï¼Œè€Œä¸æ˜¯è¢«æ”»å‡»çš„ç½‘ç«™ã€‚è€Œè¿™ä¹Ÿä½¿å¾—æ”»å‡»è€…å¹¶ä¸èƒ½è·å–åˆ°å—å®³è€…çš„ç™»å½•å‡­è¯ï¼Œä»…ä»…åªèƒ½ä½¿ç”¨ã€‚<br>é˜²èŒƒçš„æ–¹æ³•é€šå¸¸æ˜¯ï¼š</p><ol><li>è¯·æ±‚ url æ·»åŠ  token æˆ–è€…æ˜¯åœ¨ http è¯·æ±‚å¤´è‡ªå®šä¹‰å±æ€§è¿›è¡ŒéªŒè¯</li><li>åŒæºæ£€æµ‹ï¼Œé€šè¿‡è§£æ è¯·æ±‚å¤´ä¸­çš„ referer åˆ¤æ–­è¯·æ±‚æ¥æº</li><li>Samesiteï¼ŒGoogle èµ·è‰äº†ä¸€ä»½è‰æ¡ˆæ¥æ”¹è¿› HTTP åè®®ï¼Œä¸º Set-Cookie å“åº”å¤´æ–°å¢ Samesite å±æ€§ï¼Œç”¨äºæ ‡æ˜ Cookie æ˜¯å¦èƒ½ä½œç”¨äºå…¶ä»–ç½‘ç«™ï¼Œç›®å‰å…¼å®¹æ€§è¿˜ä¸æ˜¯å¾ˆå¥½ã€‚</li></ol><h4 id="Iframe"><a href="#Iframe" class="headerlink" title="Iframe"></a>Iframe</h4><p>å½“æˆ‘ä»¬ä½¿ç”¨ iframe åŠ è½½ç¬¬ä¸‰æ–¹ç½‘ç«™æ—¶ï¼Œç¬¬ä¸‰æ–¹ç½‘ç«™å¯ä»¥å¯¹æˆ‘ä»¬çš„ç½‘ç«™æ‰§è¡Œæ¶æ„æ“ä½œï¼Œå¦‚æ“ä½œDOMï¼ŒåŠ è½½ js ç­‰ã€‚<br>é˜²èŒƒçš„æ–¹æ³•æ˜¯é€šè¿‡è®¾ç½® sandbox å±æ€§æ§åˆ¶ iframe çš„æ“ä½œæƒé™ã€‚</p><h4 id="opener"><a href="#opener" class="headerlink" title="opener"></a>opener</h4><p>æˆ‘ä»¬åœ¨é€šå¸¸é€šè¿‡ä»¥ä¸‹å†™æ³•åœ¨ æ–° tab ä¸‹æ‰“å¼€é“¾æ¥ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">1. &lt;a target&#x3D;&#39;_blank&#39; href&#x3D;&#39;new-site.com&#39;&gt;2. window.open(&#39;new-site.com&#39;)</code></pre><p>ä¸Šè¿°ä¸¤ç§å†™æ³•çš„é—®é¢˜åœ¨äºï¼Œ <code>new-site.com</code> æ˜¯å¯ä»¥é€šè¿‡ <code>window.opener</code> æ¥æ‹¿åˆ°æºé¡µé¢çš„ <code>window</code> å¯¹è±¡ï¼Œè¿›è€Œè¿›è¡Œæ¶æ„æ“ä½œã€‚<br>é˜²èŒƒçš„æ–¹æ³•é€šå¸¸æ˜¯ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">1. &lt;a target&#x3D;&quot;_blank&quot; href&#x3D;&quot;new-site.com&quot; rel&#x3D;&quot;noopener noreferrer nofollow&quot;&gt;aæ ‡ç­¾è·³è½¬url&lt;&#x2F;a&gt;2. function openurl(url) &#123;    var newTab &#x3D; window.open();    newTab.opener &#x3D; null;    newTab.location &#x3D; url;&#125;</code></pre><h5 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h5><ul><li><p><a href="https://tech.meituan.com/2018/09/27/fe-security.html">å‰ç«¯å®‰å…¨ç³»åˆ—ï¼ˆä¸€ï¼‰ï¼šå¦‚ä½•é˜²æ­¢XSSæ”»å‡»ï¼Ÿ</a></p></li><li><p><a href="https://tech.meituan.com/2018/10/11/fe-security-csrf.html">å‰ç«¯å®‰å…¨ç³»åˆ—ï¼ˆäºŒï¼‰ï¼šå¦‚ä½•é˜²æ­¢CSRFæ”»å‡»ï¼Ÿ</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RN é¿å‘æŒ‡åŒ—</title>
      <link href="/2020/07/21/RN%20%E9%81%BF%E5%9D%91%E6%8C%87%E5%8C%97/"/>
      <url>/2020/07/21/RN%20%E9%81%BF%E5%9D%91%E6%8C%87%E5%8C%97/</url>
      
        <content type="html"><![CDATA[<p>è®°å½•å¹³æ—¶å¼€å‘ rn æ—¶é‡åˆ°çš„é—®é¢˜ï¼Œç‰¹æŒ‡ 0.59 ç‰ˆæœ¬ï¼Œä¸åŒç‰ˆæœ¬å¯èƒ½æƒ…å†µä¸åŒï¼Œä»…ä¾›å‚è€ƒã€‚</p><a id="more"></a><h5 id="ä¸€åƒç´ é—®é¢˜"><a href="#ä¸€åƒç´ é—®é¢˜" class="headerlink" title="ä¸€åƒç´ é—®é¢˜"></a>ä¸€åƒç´ é—®é¢˜</h5><p>rn è§£å†³ä¸€åƒç´ å¾ˆç®€å•ï¼Œåªéœ€è¦  <code>StyleSheet.hairlineWidth</code> å³å¯è§£å†³ã€‚</p><h5 id="TextInput-ç»„ä»¶"><a href="#TextInput-ç»„ä»¶" class="headerlink" title="TextInput  ç»„ä»¶"></a>TextInput  ç»„ä»¶</h5><p>è‡ªå¸¦å†…è¾¹è·ï¼Œå¤šè¡Œæ–‡å­—æ—¶æ–‡å­—å±…ä¸­å±•ç¤ºï¼Œæƒ³è¦æ¶ˆé™¤éœ€è¦è®¾ç½®æ ·å¼å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">&#x2F;&#x2F; æ–‡å­—å‘ä¸Šå¯¹é½textAlignVertical: &#39;top&#39;&#x2F;&#x2F; æ¶ˆé™¤å†…è¾¹è·padding: 0</code></pre><p>Placeholder åœ¨ ios å’Œ android ä¸‹é»˜è®¤é¢œè‰²è¡¨ç°ä¸ä¸€è‡´ï¼Œå¯ä»¥é€šè¿‡ <code>placeholderTextColor</code>  å±æ€§è¿›è¡Œè®¾ç½®ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">placeholderTextColor&#x3D;&quot;#CCCCCC&quot;</code></pre><h5 id="é˜´å½±"><a href="#é˜´å½±" class="headerlink" title="é˜´å½±"></a>é˜´å½±</h5><p>å› ä¸ºè®¾è®¡ç†å¿µçš„é—®é¢˜ï¼Œandroid ä¸‹å‡ ä¹æ— æ³•å®ç°å’Œ ios ä¸€è‡´çš„é˜´å½±æ•ˆæœã€‚è€Œ flutter åŸºäº skia å¼•æ“æ¸²æŸ“ï¼Œåº”è¯¥ä¼šæœ‰æ¯”è¾ƒå¥½çš„è¡¨ç°ï¼Ÿæœ‰ç©ºå°è¯•ä¸‹ã€‚ ğŸ¤”</p><h5 id="border-è™šçº¿"><a href="#border-è™šçº¿" class="headerlink" title="border è™šçº¿"></a>border è™šçº¿</h5><p>border è™šçº¿ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜, android ä¸Šå®æµ‹æ— æ•ˆï¼Œè¯¦æƒ…çœ‹ <a href="https://github.com/facebook/react-native/issues/17251">issue</a>ã€‚è§£å†³æ–¹æ¡ˆæ˜¯å¾ªç¯ä¸€ä¸ª pattern ç„¶å overhidden æ‰ï¼Œåˆå¤šäº†ä¸€ä¸ªè®©æˆ‘æƒ³å°è¯• flutter çš„ç†ç”± ğŸ˜‚</p><h5 id="å¤šè¡Œæ–‡å­—"><a href="#å¤šè¡Œæ–‡å­—" class="headerlink" title="å¤šè¡Œæ–‡å­—"></a>å¤šè¡Œæ–‡å­—</h5><p>å¤šè¡Œæ–‡å­—åœ¨ android æœºå‹ä¸‹æœ‰å¯èƒ½ä¼šå‡ºç°é«˜åº¦ä¸å¤Ÿå¯¼è‡´æ–‡å­—è¢«æˆªæ‰çš„é—®é¢˜ï¼Œè§£å†³æ–¹æ³•ï¼šè®¾ç½®  <code>lineHeight</code></p><h5 id="å®ç°ä¸åŒå­—å·çš„æ–‡å­—åº•éƒ¨å¯¹é½"><a href="#å®ç°ä¸åŒå­—å·çš„æ–‡å­—åº•éƒ¨å¯¹é½" class="headerlink" title="å®ç°ä¸åŒå­—å·çš„æ–‡å­—åº•éƒ¨å¯¹é½"></a>å®ç°ä¸åŒå­—å·çš„æ–‡å­—åº•éƒ¨å¯¹é½</h5><p>ä¾‹å¦‚ Â¥500 æƒ³è¦ Â¥ å­—å·å°ä¸€ç‚¹ï¼Œè€Œ 500 å­—å·å¤§ä¸€ç‚¹ï¼Œä½†æ˜¯éœ€è¦åº•éƒ¨å¯¹é½ï¼Œåˆ™å¯ä»¥ç”¨ Text åŒ…è£¹èµ·æ¥ï¼Œå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">&lt;Text&gt;  &lt;Text style&#x3D;&#123;&#123; fontSize: 12 &#125;&#125;&gt;Â¥&lt;&#x2F;Text&gt;  &lt;Text style&#x3D;&#123;&#123; fontSize: 20 &#125;&#125;&gt;500&lt;&#x2F;Text&gt;&lt;&#x2F;Text&gt;</code></pre><h5 id="Text-ç»„ä»¶æ ·å¼ç»§æ‰¿"><a href="#Text-ç»„ä»¶æ ·å¼ç»§æ‰¿" class="headerlink" title="Text ç»„ä»¶æ ·å¼ç»§æ‰¿"></a>Text ç»„ä»¶æ ·å¼ç»§æ‰¿</h5><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œcss å¦‚æœæƒ³è®¾ç½®é»˜è®¤çš„å…¨å±€æ ·å¼ç›¸å½“ç®€å•ï¼Œæ¯”å¦‚å­—ä½“é¢œè‰²é»˜è®¤ä¸º â€˜#323232â€™ , åªè¦åœ¨ body ä¸Šè®¾ç½®ä¸€ä¸‹ <code>color: #323232</code> å³å¯ ï¼Œç„¶è€Œå¯¹äº RN æ¥è¯´åˆ™æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š</p><ol><li><p>å°†åŸç”Ÿ Text æ›¿æ¢æˆè‡ªå®šä¹‰ Text ç»„ä»¶ï¼ˆå®˜æ–¹æ¨èï¼‰</p><blockquote><p>The recommended way to use consistent fonts and sizes across your application is to create a component <code>MyAppText</code> that includes them and use this component across your app</p></blockquote><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import React from &#39;react&#39;;import &#123; TextProps, StyleSheet, Text &#125; from &#39;react-native&#39;;const styles &#x3D; StyleSheet.create(&#123;  defaultStyle: &#123;    color: &#39;#323232&#39;,  &#125;,&#125;);export default function CustomText(props: TextProps &amp; &#123; children?: any &#125;) &#123;  const &#123; style, ...restProps &#125; &#x3D; props;  return (    &lt;Text style&#x3D;&#123;[styles.defaultStyle, style]&#125; &#123;...restProps&#125;&gt;      &#123;props.children&#125;    &lt;&#x2F;Text&gt;  );&#125;</code></pre></li><li><p>å‚è€ƒ <a href="https://github.com/Ajackster">Ajackster</a>/<strong><a href="https://github.com/Ajackster/react-native-global-props">react-native-global-props</a></strong> çš„å®ç°ï¼Œåœ¨é¡¹ç›®å…¥å£ä½ç½®ï¼Œä¿®æ”¹ç»„ä»¶çš„ render æ–¹æ³•ã€‚</p></li></ol><p>æ–¹æ¡ˆäºŒè™½ç„¶æ–¹ä¾¿ï¼Œä½†ä¸æ˜¯å®˜æ–¹è§£æ³•ï¼Œä¸‡ä¸€æœ‰å‘å°± GG äº†ã€‚è€Œæ–¹æ¡ˆä¸€å¦‚æœæ˜¯å·²æœ‰é¡¹ç›®ï¼Œåˆ™éœ€è¦æ‰¹é‡ä¿®æ”¹ä»£ç ã€‚<br>è¿™é‡Œé¡ºä¾¿æä¸€ä¸‹åœ¨ vscode é‡Œæ‰¹é‡æ›¿æ¢çš„æ–¹æ³•ï¼š</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; å°†æ­£åˆ™ï¼Œå¤§å°å†™ï¼Œå…¨åŒ¹é… ä¸‰ä¸ªæŒ‰é’®ç‚¹äº®find: Text(,|\s)(.*react-native&#39;;)replace: $2\nimport Text from &#39;Your&#x2F;Text&#39;;</code></pre><p>ä¸€å¼€å§‹æˆ‘æ˜¯è¿™ä¹ˆå†™çš„ï¼Œåªè€ƒè™‘åˆ°äº†å•è¡Œï¼Œç»“æœä¸‹é¢è¿™ç§æƒ…å†µæ²¡æœ‰æ›¿æ¢æ‰ï¼š</p><pre class="line-numbers language-none"><code class="language-none">import &#123;  StyleSheet,  ViewStyle,  View,  Text,  Image,  TouchableOpacity,&#125; from &#39;react-native&#39;;</code></pre><p>åé¢æ¢æˆ <code>\sText[,|\s]\n?([\s\S]*&#39;react-native&#39;;)</code> åœ¨æµè§ˆå™¨é‡Œå¯ä»¥åŒ¹é…ä¸Šï¼Œä½†æ˜¯ vscode æ— æ³•åŒ¹é… ğŸ¤”ã€‚ æœ€åç®€å•å†™ä¸ªè„šæœ¬è¡¥å…¨ä¸Šé¢çš„æ¼ç½‘ä¹‹é±¼:</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const fs &#x3D; require(&#39;fs&#39;);const util &#x3D; require(&#39;util&#39;);const path &#x3D; require(&#39;path&#39;);const glob &#x3D; require(&#39;glob&#39;);const replace &#x3D; async () &#x3D;&gt; &#123;  try &#123;    glob(&#39;src&#x2F;**&#x2F;*.tsx&#39;, &#123;&#125;, function (er, files) &#123;      const reg &#x3D; &#x2F;\sText[,|\s]\n?([\s\S]*&#39;react-native&#39;;)&#x2F;;      files.forEach(async (file) &#x3D;&gt; &#123;        const content &#x3D; await util.promisify(fs.readFile)(file, &#39;utf8&#39;);        const newContent &#x3D; content.replace(reg, (m, p1) &#x3D;&gt; &#123;          return &#96; $&#123;p1.trim()&#125;import Text from &#39;@&#x2F;components&#x2F;Text&#39;;&#96;;        &#125;);        await util.promisify(fs.writeFile)(file, newContent, &#39;utf8&#39;);      &#125;);    &#125;);  &#125; catch (error) &#123;    console.log(error);  &#125;&#125;;replace();</code></pre><p>ğŸ¤” ä¸Šé¢ CustomText çš„å†™æ³•æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå³åµŒå¥— Text çš„æ ·å¼å¦‚æœæ˜¯è‡ªå®šä¹‰ç»„ä»¶ä¸­é»˜è®¤çš„æ ·å¼ï¼Œå°†ä¸ä¼šè¢«ç»§æ‰¿:</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">&lt;Text style&#x3D;&#123;&#123; color: &#39;red&#39; &#125;&#125;&gt;  &lt;Text&gt;red&lt;&#x2F;Text&gt;  &lt;Text&gt;red&lt;&#x2F;Text&gt;&lt;&#x2F;Text&gt;&lt;CustomText style&#x3D;&#123;&#123; color: &#39;red&#39; &#125;&#125;&gt;  &lt;CustomText&gt;not red&lt;&#x2F;Text&gt;  &lt;CustomText&gt;not red&lt;&#x2F;Text&gt;&lt;&#x2F;CustomText&gt;</code></pre><p>æ”¹è‰¯ç‰ˆï¼š </p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import React, &#123; Children, isValidElement, cloneElement &#125; from &#39;react&#39;;import &#123; TextProps, StyleSheet, Text &#125; from &#39;react-native&#39;;const styles &#x3D; StyleSheet.create(&#123;  defaultStyle: &#123;    color: &#39;#323232&#39;,  &#125;,&#125;);export default function CustomText(  props: TextProps &amp; &#123; children?: any; useDefaultStyle?: boolean &#125;,) &#123;  const &#123; style, useDefaultStyle &#x3D; true, ...restProps &#125; &#x3D; props;  const newStyle &#x3D; useDefaultStyle ? [styles.defaultStyle, style] : style;  const childrenWithProps &#x3D; Children.map(props.children, (child) &#x3D;&gt; &#123;    if (isValidElement(child)) &#123;     &#x2F;&#x2F; å¦‚æœå­å…ƒç´ æ˜¯ä¸ªç»„ä»¶ï¼Œåˆ™å­ç»„ä»¶ä¸ä½¿ç”¨é»˜è®¤ style      return cloneElement(child as React.ReactElement&lt;any&gt;, &#123;        useDefaultStyle: false,      &#125;);    &#125;    return child;  &#125;);  return (    &lt;Text style&#x3D;&#123;newStyle&#125; &#123;...restProps&#125;&gt;      &#123;childrenWithProps&#125;    &lt;&#x2F;Text&gt;  );&#125;</code></pre><ul><li><p><a href="https://github.com/ptomasroos/react-native-scrollable-tab-view">react-native-scrollable-tab-view</a></p><p><a href="https://github.com/ptomasroos/react-native-scrollable-tab-view">react-native-scrollable-tab-view</a> ç»„ä»¶ä½œä¸º ScrollView çš„å­ç»„ä»¶æ—¶ä¸å¯ç”¨ï¼Œä¼šå‡ºç° tab é€‰ä¸­ä¸ä¸€è‡´ï¼Œtab content æ— æ³•æ’‘å¼€çš„ç°è±¡ï¼Œè¯¦æƒ…çœ‹ï¼š<a href="https://github.com/ptomasroos/react-native-scrollable-tab-view/issues/982">https://github.com/ptomasroos/react-native-scrollable-tab-view/issues/982</a></p></li><li><p>è®¾ç½®ç¯å¢ƒå˜é‡<br>é€šå¸¸æˆ‘ä»¬çš„ web é¡¹ç›®å¯ä»¥åœ¨ npm script é‡Œé€šè¿‡è®¾ç½® NODE_ENV æ¥è®¾ç½®ä¸åŒçš„ç¯å¢ƒå˜é‡ã€‚æ¯”å¦‚ <code>NODE_ENV=develope node index.js</code>, ä¹‹åå¯ä»¥åœ¨ä»£ç ä¸­é€šè¿‡ <code>process.env.NODE_ENV</code> æ¥åˆ¤æ–­å…·ä½“æ˜¯å“ªä¸ªç¯å¢ƒã€‚rn é¡¹ç›®è¦è¾¾åˆ°åŒæ ·çš„ç›®çš„ï¼Œåˆ™éœ€è¦é¢å¤–å®‰è£… babel æ’ä»¶ <a href="https://www.npmjs.com/package/babel-plugin-transform-inline-environment-variables">babel-plugin-transform-inline-environment-variables</a>ï¼ˆæˆ–è€…å¯ä»¥é€šè¿‡ <a href="https://github.com/luggit/react-native-config">react-native-config</a>ï¼Œä¸è¿‡è¿™ä¸ªæ–¹æ³•æ²¡æœ‰å»éªŒè¯ï¼Œå› ä¸ºä½äº 6.x ç‰ˆæœ¬çš„éœ€è¦å®¢æˆ·ç«¯ linkï¼‰</p></li></ul><h5 id="ScrollView-ä¸-Keyboard"><a href="#ScrollView-ä¸-Keyboard" class="headerlink" title="ScrollView ä¸ Keyboard"></a>ScrollView ä¸ Keyboard</h5><p>åœºæ™¯ï¼š å½“ ScrollView / FlatList / SectionList ä¸­åŒ…å«è¾“å…¥æ¡†æ—¶ï¼Œç‚¹å‡»è¾“å…¥æ¡†å”¤èµ·é”®ç›˜ã€‚å¦‚æœæ­¤æ—¶è¾“å…¥æ¡†å³ä¾§æœ‰æ¸…é™¤è¾“å…¥çš„æŒ‰é’®ï¼Œç‚¹å‡»æ—¶é¦–å…ˆä¼šå°†é”®ç›˜æ”¶èµ·ï¼Œä¹‹åå†æ¬¡ç‚¹å‡»æ‰ä¼šæ‰§è¡Œ onPressã€‚</p><p>æ–¹æ¡ˆï¼šå°† <code>keyboardShouldPersistTaps</code> å±æ€§è®¾ç½®ä¸º <code>always</code>ï¼Œç‚¹å‡»æ¸…é™¤è¾“å…¥çš„æŒ‰é’®ï¼Œé”®ç›˜ä¸ä¼šè‡ªåŠ¨æ”¶èµ·ã€‚</p><h5 id="iOS-Text"><a href="#iOS-Text" class="headerlink" title="iOS Text"></a>iOS Text</h5><p>ios çš„ Text ç»„ä»¶ <code>borderRadius</code> | <code>textAlignVertical</code> å±æ€§æ— æ•ˆï¼Œåªèƒ½å¤–å±‚å†åŒ…ä¸ª View</p><h5 id="Border"><a href="#Border" class="headerlink" title="Border"></a>Border</h5><p>RN çš„ç›’æ¨¡å‹æ˜¯ border-box, å³ å®½é«˜åŒ…æ‹¬äº† padding å’Œ borderã€‚</p><p>åœ¨å¼€å‘ä¸­å‘ç°å¦‚æœå®¹å™¨å…·æœ‰ backgroundColor ä¸ borderRadius åï¼Œè®¾ç½®ä¸€ä¸ªä¸åŒé¢œè‰²çš„ border, è¯¥å®¹å™¨å¤–å›´ä¼šæœ‰ä¸€å±‚æµ…æµ…çš„ backgroundColor æè¾¹ï¼ˆç›®å‰ä»… ios æœ‰è¿™ç§æƒ…å†µï¼‰è§£å†³æ–¹æ¡ˆï¼šåœ¨å®¹å™¨å¤–å±‚å†åŒ…ä¸€ä¸ª Viewï¼Œè®¾ç½® border æ ·å¼</p><h5 id="FlatList-çš„-onViewableItemsChanged"><a href="#FlatList-çš„-onViewableItemsChanged" class="headerlink" title="FlatList çš„ onViewableItemsChanged"></a>FlatList çš„ onViewableItemsChanged</h5><p>onViewableItemsChanged çš„æ–¹æ³•åœ¨ FlatList çš„ç”Ÿå‘½å‘¨æœŸä¸­ä¸å¯ä»¥æ”¹å˜ï¼Œå¦åˆ™æŠ¥é”™ï¼š</p><pre class="line-numbers language-none"><code class="language-none">Invariant Violation: Changing onViewableItemsChanged on the fly is not supported</code></pre><p>å¦‚æœæ˜¯ç±»ç»„ä»¶ï¼Œå¯ä»¥åœ¨ constructor ä¸­å®šä¹‰è¯¥æ–¹æ³•ï¼Œå¦‚æœæ˜¯å‡½æ•°ç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡ useRef åŒ…è£¹è¯¥æ–¹æ³•ã€‚</p><h5 id="ç­‰å®½å­—ä½“"><a href="#ç­‰å®½å­—ä½“" class="headerlink" title="ç­‰å®½å­—ä½“"></a>ç­‰å®½å­—ä½“</h5><p>å¦‚æœå­—ä½“ä¸æ˜¯ç­‰å®½çš„è¯ï¼Œå€’è®¡æ—¶ç»„ä»¶ä¼šäº§ç”Ÿå®½åº¦æŠ–åŠ¨ã€‚ios å’Œ å®‰å“å¹³å°çš„å­—ä½“å¹¶ä¸é€šç”¨ï¼Œå‚è€ƒ <a href="https://github.com/react-native-training/react-native-fontsã€‚">https://github.com/react-native-training/react-native-fontsã€‚</a> æƒ³è¦è®¾ç½®ç­‰å®½å­—ä½“å¯ä»¥è®¾ç½® Text å¦‚ä¸‹æ ·å¼å±æ€§ï¼š</p><pre class="line-numbers language-none"><code class="language-none">fontVariant: [&#39;tabular-nums&#39;] &#x2F;&#x2F; ä»… IOSfontFamily: Platform.OS &#x3D;&#x3D;&#x3D; &#39;android&#39; ? &#39;monospace&#39; : undefined &#x2F;&#x2F; å¦‚æœæ˜¯å®‰å“åˆ™è®¾ç½®å­—ä½“ä¸º monospace</code></pre><p>æ³¨æ„å¦‚æœ fontFamily æŒ‡å®šçš„å­—ä½“ä¸å­˜åœ¨ï¼Œåˆ™é¡µé¢å°†æŠ¥é”™</p><h5 id="è½®æ’­å›¾"><a href="#è½®æ’­å›¾" class="headerlink" title="è½®æ’­å›¾"></a>è½®æ’­å›¾</h5><p>è½®æ’­å›¾ä¸€å¼€å§‹ç”¨çš„æ˜¯ç¤¾åŒºé‡Œ star æ•°æ¯”è¾ƒé«˜çš„ <a href="https://github.com/leecade/react-native-swiper/issues/932">https://github.com/leecade/react-native-swiper/issues/932</a> ï¼Œ</p><p>â˜ ï¸ ä½†æ˜¯è¿™ä¸ªç»„ä»¶å­˜åœ¨ä¸€ä¸ªå‘ï¼šå¦‚æœ loop ä¸º trueï¼Œrerender çš„æ—¶å€™ï¼Œä¼šå…ˆå±•ç¤ºæœ€åä¸€é¡¹ï¼Œå†é—ªå›åˆ°ç¬¬ä¸€é¡¹ã€‚è¿™ä¸ª bug å­˜åœ¨å¥½å‡ å¹´äº†ï¼Œæäº†å¾ˆå¤š issueï¼Œéƒ½æ²¡æœ‰è§£å†³æ‰ï¼Œä¾‹å¦‚ <a href="https://github.com/leecade/react-native-swiper/issues/932">https://github.com/leecade/react-native-swiper/issues/932</a> </p><p>ç”±äºé¡¹ç›®æ¯”è¾ƒç´§å¼ ï¼Œåˆæ²¡æœ‰æ—¶é—´è‡ªå·±å»å®ç°ä¸€ä¸ªï¼Œåé¢å‘ç° <a href="https://github.com/f111fei/react-native-banner-carousel">https://github.com/f111fei/react-native-banner-carousel</a> è¿™ä¸ªä»“åº“ä¸å­˜åœ¨è¯¥é—®é¢˜ã€‚åç»­è¿˜æ˜¯éœ€è¦è‡ªå·±å»ç ”ç©¶ä¸€ä¸‹ rn çš„è½®æ’­å›¾å®ç°æ–¹æ¡ˆã€‚</p><h5 id="stickyHeaderIndices"><a href="#stickyHeaderIndices" class="headerlink" title="stickyHeaderIndices"></a>stickyHeaderIndices</h5><p>ScrollView æä¾› stickyHeaderIndices å¯ä»¥æŒ‡å®šæ»šåŠ¨æ—¶å¸é¡¶çš„ç»„ä»¶ç´¢å¼•</p><p>â˜ ï¸ è¿™ä¸ªå±æ€§å¦‚æœæ˜¯åŠ¨æ€çš„ä¼šå¯¼è‡´ ScrollView æ— æ³•æ­£å¸¸æ¸²æŸ“ï¼Œè§ // <a href="https://github.com/facebook/react-native/issues/25157">https://github.com/facebook/react-native/issues/25157</a> ï¼Œè§£å†³çš„æ–¹æ³•æ˜¯å°† removeClippedSubviews è®¾ç½®æˆ false </p><h5 id="å…³é—­å¼¹çª—ä¸è·³è½¬æ–°é¡µé¢"><a href="#å…³é—­å¼¹çª—ä¸è·³è½¬æ–°é¡µé¢" class="headerlink" title="å…³é—­å¼¹çª—ä¸è·³è½¬æ–°é¡µé¢"></a>å…³é—­å¼¹çª—ä¸è·³è½¬æ–°é¡µé¢</h5><p>åœ¨æˆ‘ä»¬çš„ ios å®¢æˆ·ç«¯å‘ç°ä¸€ä¸ªé—®é¢˜ï¼šç‚¹å‡»ä¸€ä¸ª Modal ä¸­çš„å†…å®¹åï¼Œå…³é—­è¯¥ modal å¹¶æ‰“å¼€ä¸€ä¸ªæ–°çš„ webviewï¼Œæ­¤æ—¶æœ‰å¾ˆå¤§æ¦‚ç‡æ— æ³•æ‰“å¼€æ–° webviewã€‚</p><p>çŒœæµ‹æ˜¯ç”±äºå…³é—­ modal çš„åŠ¨ç”»å½±å“åˆ°æ‰“å¼€æ–° webviewï¼ˆä¸æ¸…æ¥šæ˜¯å¦ ios åŸç”Ÿå°±æ˜¯å¦‚æ­¤ï¼‰</p><p>è§£å†³æ–¹æ¡ˆå°±æ˜¯å»¶è¿Ÿ 300ms åå†æ‰“å¼€æ–° webview</p><h4 id="SectionList-scrollToLocation"><a href="#SectionList-scrollToLocation" class="headerlink" title="SectionList scrollToLocation"></a>SectionList scrollToLocation</h4><p>åœ¨ stickySectionHeadersEnabled ä¸º true çš„æ—¶å€™ï¼Œä»¥ä¸‹ä»£ç çš„ä½œç”¨æ˜¯æ»šåŠ¨åˆ°ç¬¬ä¸€ä¸ª section çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ä½†æ˜¯åœ¨ ios å’Œ android å¹³å°è¡¨ç°ä¸ä¸€è‡´ï¼Œios ä¼šè®¤ä¸º sticky å…ƒç´ éœ€è¦å ä½ç½®ï¼Œè€Œå®‰å“åˆ™ä¸å ä½ï¼Œå¯¼è‡´å®‰å“ä¸‹åˆ—è¡¨ä¼šè¢«é®æŒ¡ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">sectionListRef.current.scrollToLocation(&#123;  sectionIndex: 0,  itemIndex: 0,&#125;);</code></pre><p>è§£å†³æ–¹æ¡ˆï¼šæ ¹æ®å¹³å°æ·»åŠ  viewOffset å±æ€§ï¼Œè®¾ç½®æ»šåŠ¨åç§»é‡ã€‚</p><h4 id="FlatList-æ€§èƒ½ä¼˜åŒ–"><a href="#FlatList-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="FlatList æ€§èƒ½ä¼˜åŒ–"></a>FlatList æ€§èƒ½ä¼˜åŒ–</h4><p>RN çš„é•¿åˆ—è¡¨æ€§èƒ½ä¸€å‘ä¸å¤ªå¥½ï¼Œå³ä½¿ç”¨äº† FlatList ä¾ç„¶è¦æ³¨æ„æ€§èƒ½ä¼˜åŒ–ã€‚æ¯”å¦‚åˆ—è¡¨é¡¹ä¸­å¦‚æœæœ‰å›¾ç‰‡ï¼Œé‚£ä¹ˆè¦æ³¨æ„å‹ç¼©å¤§å°ç­‰ã€‚</p><p>æœªå®Œå¾…ç»­ï½</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ReactNative </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°å½•ä¸€æ¬¡æ­å»º react é¡¹ç›®é‡åˆ°çš„å‘</title>
      <link href="/2020/07/20/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E6%90%AD%E5%BB%BA%20react%20%E9%A1%B9%E7%9B%AE%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/"/>
      <url>/2020/07/20/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E6%90%AD%E5%BB%BA%20react%20%E9%A1%B9%E7%9B%AE%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/</url>
      
        <content type="html"><![CDATA[<h5 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h5><p>ç”µå•†é¡¹ç›®éœ€è¦æ­å»ºä¸€ä¸ª h5 é¡¹ç›®ã€‚è¿™é‡Œç®€å•è®°å½•ä¸€ä¸‹æ­å»ºè¿‡ç¨‹é‡åˆ°çš„å‘ï¼Œä½œä¸ºæ€»ç»“ã€‚</p><a id="more"></a><p>ui æ¡†æ¶ï¼šä¸ºäº†ç»Ÿä¸€ ui æ¡†æ¶ï¼Œå› æ­¤é€‰æ‹©ä½¿ç”¨ antd-mobileã€‚<br>æ‰“åŒ…ï¼šparceljs åœ¨æ­¤å‰çš„é¡¹ç›®ä¸­å·²ç»ä½¿ç”¨è¿‡å¾ˆå¤šæ¬¡äº†ï¼Œæ‰“åŒ…é€Ÿåº¦è¾ƒ cra å¿«ï¼Œä¸”é…ç½®ç®€å•ï¼Œå› æ­¤æ‹Ÿç”¨ parcelã€‚<br>tsï¼šå¤šäººé¡¹ç›®è¿˜æ˜¯ä¸Š tsï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ã€‚<br>å¾ˆå¿«å°±æ­å»ºå¥½ demoï¼Œæ¥ç€å°±å¼€å§‹é‡åˆ°ä¸€äº›é—®é¢˜ã€‚</p><h5 id="antd-mobile-æŒ‰éœ€åŠ è½½"><a href="#antd-mobile-æŒ‰éœ€åŠ è½½" class="headerlink" title="antd-mobile æŒ‰éœ€åŠ è½½"></a>antd-mobile æŒ‰éœ€åŠ è½½</h5><p>antd-mobile æŒ‰éœ€åŠ è½½æ¨èä½¿ç”¨ <a href="https://github.com/ant-design/babel-plugin-import">babel-plugin-import</a></p><pre class="line-numbers language-json" data-language="json"><code class="language-json">&#x2F;&#x2F; .babelrc or babel-loader option&#123;  &quot;plugins&quot;: [    [&quot;import&quot;, &#123; &quot;libraryName&quot;: &quot;antd-mobile&quot;, &quot;style&quot;: &quot;css&quot; &#125;] &#x2F;&#x2F; &#96;style: true&#96; ä¼šåŠ è½½ less æ–‡ä»¶  ]&#125;</code></pre><p>æ­¤å‰ parcel å®é™…ä¸Šå†…ç½®æ”¯æŒäº† tsï¼Œç›´æ¥è½¬æˆ es5 äº†ï¼Œå› æ­¤æ­¤å‰æ²¡æœ‰é¢å¤–å†é…ç½® babelã€‚<br>ğŸ¤” babel-plugin-import åªæ”¯æŒ es6 module å†™æ³•çš„ä»£ç ï¼Œçœ‹æ¥éœ€è¦å…ˆæŠŠ ts è½¬æˆ es6 ç„¶ååœ¨é€šè¿‡ babel è½¬æˆ es5ï¼Œ æ²¡é—®é¢˜ï¼Œå®‰æ’ï½ äºæ˜¯ï¼š</p><ol><li><p>æ–°å¢ .babelrc</p></li><li><p>ä¿®æ”¹ tsconfig çš„ module ä¸º <code>es6</code></p><pre class="line-numbers language-json" data-language="json"><code class="language-json">&#123;  &quot;compilerOptions&quot;: &#123;    &quot;module&quot;: &quot;ES6&quot;  &#125;&#125;</code></pre><p>é¡¹ç›®å¯åŠ¨ï¼Œæ²¡é—®é¢˜ã€‚ä½†æ˜¯ vscode å¼€å§‹æŠ¥é”™ï¼š</p></li></ol><pre class="line-numbers language-tsx" data-language="tsx"><code class="language-tsx">import React from &#39;react&#39;&#x2F;&#x2F; Module &#39;&quot;&#x2F;node_modules&#x2F;@types&#x2F;react&#x2F;index&quot;&#39; can only be default-imported using the &#39;allowSyntheticDefaultImports&#39; flag</code></pre><p>æ ¹æœ¬åŸå› æ˜¯ç”±äº react å¯¼å‡ºå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">module.exports &#x3D; require(&#39;react.development.js&#39;)</code></pre><p>è€Œé</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module.exports.default &#x3D; require(&#39;react.development.js&#39;)</code></pre><p>Babel ä¼šåœ¨ commonjs æ ¼å¼æ·»åŠ  default å¯¼å‡ºï¼Œé‚£æˆ‘ä»¬è¦åšçš„å°±æ˜¯è®© ts ä¸è¦æç¤ºè¿™ç§ç±»å‹çš„æŠ¥é”™ï¼š</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">&#123;  &quot;compilerOptions&quot;: &#123;    &quot;allowSyntheticDefaultImports&quot;: true    &#x2F;&#x2F; ...  &#125;&#125;</code></pre><p>ğŸ¤” ä¸è¿‡ä¸ºä»€ä¹ˆä¸€å¼€å§‹ parcel ä¸ä¼šæŠ¥é”™å‘¢ï¼Ÿ</p><p>æ¥ä¸‹æ¥è·¯ç”±åŠ¨æ€å¼•å…¥ç»„ä»¶å¼€å§‹æŠ¥é”™ï¼š</p><pre class="line-numbers language-tsx" data-language="tsx"><code class="language-tsx">import React, &#123; Suspense, lazy &#125; from &#39;react&#39;const List &#x3D; lazy(() &#x3D;&gt; import(&#39;.&#x2F;modules&#x2F;List&#39;))&#x2F;&#x2F; Dynamic imports are only supported when the &#39;--module&#39; flag is set to &#39;es2020&#39;, &#39;esnext&#39;, &#39;commonjs&#39;, &#39;amd&#39;, &#39;system&#39;, or &#39;umd&#39;.</code></pre><p>çœ‹æ¥ <code>es6</code> æ˜¯ä¸æ”¯æŒ import() è¯­æ³•, é‚£å¥½åŠï¼Œå°† module æ”¹æˆ <code>esnext</code>ï¼š</p><pre class="line-numbers language-none"><code class="language-none">&#123;&quot;compilerOptions&quot;: &#123;    &quot;module&quot;: &quot;ESNext&quot;,  &#125;&#125;</code></pre><p>æ¥ä¸‹æ¥å¼•å…¥ anti-mobile ç»„ä»¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">import &#123; List &#125; from &#39;antd-mobile&#39;&#x2F;&#x2F; Cannot find module &#39;antd-mobile&#39; or its corresponding type declarations.</code></pre><p>æ­¤æ—¶æç¤ºæ‰¾ä¸åˆ°å¯¹åº”çš„æ¨¡å—å£°æ˜ï¼Œ æ­¤æ—¶æˆ‘çš„å†…å¿ƒæ˜¯å´©æºƒçš„ï¼Œçœ‹èµ·æ¥åº”è¯¥æ˜¯æ¨¡å—è§£æè·¯å¾„ä¸å¯¹ï¼Œå› æ­¤åœ¨ tsconfig ä¸­æ˜¾å¼é…ç½® <code>moduleResolution</code>:</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">&#123;  &quot;compilerOptions&quot;: &#123;    &quot;moduleResolution&quot;: &quot;Node&quot;    &#x2F;&#x2F; ...  &#125;&#125;</code></pre><p>ä¸å†æŠ¥é”™äº†ï¼Œçœ‹çœ‹ ts æ–‡æ¡£çš„è§£é‡Šå§ï¼Œts å…±æœ‰ä¸¤ç§å¯ç”¨çš„æ¨¡å—è§£æç­–ç•¥ï¼š<a href="https://www.tslang.cn/docs/handbook/module-resolution.html#node">Node</a>å’Œ<a href="https://www.tslang.cn/docs/handbook/module-resolution.html#classic">Classic</a></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module &#x3D;&#x3D;&#x3D; &quot;AMD&quot; or &quot;System&quot; or &quot;ES6&quot; ? &quot;Classic&quot; : &quot;Node&quot;</code></pre><p>ğŸ¤” æŒ‰ç†è¯´ module ä¸º esnext çš„è¯å²‚ä¸æ˜¯åº”è¯¥æŒ‰ node ç­–ç•¥è§£æï¼Ÿä½†æ˜¯ç›®å‰çœ‹æ¥ä¼¼ä¹ä¸æ˜¯è¿™æ ·çš„ï¼Ÿ</p><h5 id="é…ç½®-antd-mobile-ä¸»é¢˜"><a href="#é…ç½®-antd-mobile-ä¸»é¢˜" class="headerlink" title="é…ç½® antd-mobile ä¸»é¢˜"></a>é…ç½® antd-mobile ä¸»é¢˜</h5><p>æ¥ä¸‹æ¥éœ€è¦é…ç½®ä¸»é¢˜ï¼Œanti-mobile æ¨èä½¿ç”¨ <a href="http://lesscss.org/usage/#using-less-in-the-browser-modify-variables">modifyVars</a> æ¥é…ç½®ä¸»é¢˜ã€‚<br>å°† .babelrc æ”¹æˆåšä¸€ä¸‹è°ƒæ•´ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#123;    ...    &quot;plugins&quot;: [        [&quot;import&quot;, &#123;&quot;libraryName&quot;: &quot;antd-mobile&quot;, &quot;style&quot;: true&#125;],        ...    ]&#125;</code></pre><p>æŒ‰ç…§ webpack çš„ç»éªŒï¼Œæ­¤æ—¶éœ€è¦å¼€å¯ <code>javascriptEnabled: true</code>é—®é¢˜æ¥äº† parcel å†…ç½®æ”¯æŒ less ï¼Œé‚£æˆ‘ä»¬è¦åœ¨å“ªé‡Œå»é…ç½® less å‘¢ï¼Ÿæ ¹æ® <a href="https://github.com/parcel-bundler/parcel/issues/907">issue</a> æåˆ°å¯ä»¥ç”¨ .lessrc æ–‡ä»¶æ¥é…ç½®ï¼Œä½†æ˜¯æˆ‘ç»è¿‡å°è¯•å‘ç°å…¶å®æ˜¯æ— æ•ˆçš„ã€‚ã€‚<br>è‡³æ­¤åŸºæœ¬æ”¾å¼ƒ parcelã€‚parcel åœ¨å¿«é€Ÿæ­å»ºå®éªŒæ€§é¡¹ç›®æ—¶ç¡®å®æœ‰ä¸€å®šçš„ä¼˜åŠ¿ï¼Œä¸è¿‡ç”Ÿæ€ç¡®å®ä¸å¦‚ webpackï¼Œç”±æ­¤è½¬å‘ä½¿ç”¨ create-react-app</p><h5 id="create-react-app"><a href="#create-react-app" class="headerlink" title="create-react-app"></a>create-react-app</h5><p>ä½¿ç”¨ cra å¾ˆå¿«ä¹Ÿå»ºå¥½ demoï¼Œè§£å†³å¦‚ä½•è®© cra åˆ›å»ºçš„é¡¹ç›®æ”¯æŒ less ï¼Œè¿™ä¸ªç®€å•ï¼š<br>é€šè¿‡ <code>customize-cra</code> æä¾›çš„ <code>addLessLoader</code> æ–¹æ³•å³å¯ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº† <code>fixBabelImports</code> å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ·»åŠ  babel-plugin-import é…ç½®ï¼š</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">const &#123; override, fixBabelImports, addLessLoader &#125; &#x3D; require(&#39;customize-cra&#39;)module.exports &#x3D; override(  fixBabelImports(&#39;import&#39;, &#123;    libraryName: &#39;antd-mobile&#39;,    style: true,  &#125;),  addLessLoader(&#123;    lessOptions: &#123;      javascriptEnabled: true,      modifyVars: &#123;        &#39;@brand-primary&#39;: &#39;#ff74b9&#39;,        &#39;brand-primary-tap&#39;: &#39;#ff9cca&#39;,      &#125;,    &#125;,  &#125;))</code></pre><h5 id="åˆ«å"><a href="#åˆ«å" class="headerlink" title="åˆ«å"></a>åˆ«å</h5><p>æ¥ç€æ˜¯é…ç½®è·¯å¾„åˆ«åé‡åˆ°çš„é—®é¢˜ï¼Œé€šè¿‡ <code>customize-cra</code> æä¾›çš„ <code>addWebpackAlias</code> å¯ä»¥é…ç½®åˆ«åï¼Œä½†æ˜¯ typescript ä¸€ç›´æ— æ³•è§£æå¯¹åº”åˆ«åï¼Œé‚£ä¹ˆåº”è¯¥åªéœ€è¦é…ç½®å¥½ ts çš„ paths å°±è¡Œäº†å§ï¼š</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">&#123;  &quot;compilerOptions&quot;: &#123;    &quot;baseUrl&quot;: &quot;.&quot;,    &quot;paths&quot;: &#123;      &quot;@&#x2F;*&quot;: [&quot;.&#x2F;src&#x2F;*&quot;]    &#125;    &#x2F;&#x2F; ...  &#125;&#125;</code></pre><p>vscode ä¸å†æŠ¥é”™äº†,æ¥ä¸‹æ¥å°±æ˜¯è§è¯å¥‡è¿¹çš„æ—¶åˆ»äº†<code>npm run start</code>ï¼š<br>æ§åˆ¶å°æ˜¾ç¤º <code>- compilerOptions.paths must not be set (aliased imports are not supported)</code> å¹¶ä¸” cra ä¼šè‡ªåŠ¨æŠŠ tscongfig ä¸­çš„ paths ç§»é™¤æ‰ ğŸ˜‚<br>æ ¹æ® <a href="https://github.com/timarney/react-app-rewired/issues/375">issue</a>ï¼Œä½¿ç”¨å°† baseUrl å’Œ paths çš„é…ç½®ç§»åŠ¨åˆ°å•ç‹¬çš„æ–‡ä»¶åï¼Œåœ¨ tsconfig é‡Œé€šè¿‡ extends çš„æ–¹å¼ç»§æ‰¿ï¼Œè™½ç„¶æ§åˆ¶å°ä¾ç„¶æç¤ºé”™è¯¯ï¼Œä½†æ˜¯åˆ«åå¯ä»¥ç”Ÿæ•ˆã€‚</p><h5 id="mini-css-extract-plugin"><a href="#mini-css-extract-plugin" class="headerlink" title="mini-css-extract-plugin"></a>mini-css-extract-plugin</h5><p>åœ¨ build æ—¶ï¼Œmini-css-extract-plugin æç¤º Conflicting orderï¼Œ é”™è¯¯ä½ç½®åœ¨ antd-mobile çš„æ ·å¼æ–‡ä»¶ã€‚æ ¹æ® <a href="https://github.com/ant-design/ant-design/issues/14895">issue</a> ä»¥åŠ <a href="https://github.com/webpack-contrib/mini-css-extract-plugin/issues/250"> issue </a>çœ‹æ¥è¿™ä¸ªé—®é¢˜ä¸»è¦æ˜¯ç”±äºæ‡’åŠ è½½åŠ ä¸Š antd ç»„ä»¶å¯¼å…¥é¡ºåºä¸ä¸€è‡´å¯¼è‡´çš„ï¼Œç›®å‰çœ‹æ¥æ— éœ€è§£å†³ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
