<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>RNç€‘å¸ƒæµ</title>
      <link href="/2020/10/20/RN%E7%80%91%E5%B8%83%E6%B5%81/"/>
      <url>/2020/10/20/RN%E7%80%91%E5%B8%83%E6%B5%81/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>ç”µå•†ä»¥åŠå›¾ç‰‡ç½‘ç«™ç»å¸¸å¯ä»¥çœ‹åˆ°ç€‘å¸ƒæµçš„åˆ—è¡¨ï¼Œå³å¤šåˆ—ç­‰å®½çš„åˆ—è¡¨ï¼Œä½†æ˜¯æ¯ä¸€åˆ—ä¸­çš„å…ƒç´ é«˜åº¦ä¸ä¸€å®šä¸€è‡´ã€‚è¿™åœ¨ web æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„è®¾è®¡ä¸”æœ‰å¾ˆå¤šç»„ä»¶å¯ä¾›ä½¿ç”¨ï¼Œè€Œåœ¨ ReactNative ä¸­ï¼Œå°‘æœ‰æˆç†Ÿçš„ç€‘å¸ƒæµç»„ä»¶ï¼Œå¤§å¤šæ•°ç»„ä»¶è¦ä¹ˆæ˜¯å¤šå¹´å‰ç»´æŠ¤çš„ï¼Œè¦ä¹ˆ star æ•°è¾ƒå°‘ï¼Œæˆ–è€…å¹²è„†æœ‰ä¸€äº›ä¸ç»´æŠ¤äº†ï¼Œæ€»ä¹‹å°±æ˜¯ç”¨ç€ä¸æ”¾å¿ƒã€‚å› æ­¤åœ¨äº§å“åŒå­¦çš„è¦æ±‚ä¸‹ï¼Œå°è¯•æ¥å®ç°ä¸€ä¸ª RN ç€‘å¸ƒæµç»„ä»¶ã€‚</p><a id="more"></a><h4 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h4><ol><li><p>æ”¯æŒä¸Šæ‹‰åŠ è½½ï¼Œä¸‹æ‹‰åˆ·æ–°</p></li><li><p>æ”¯æŒå¤šåˆ—å¯å®šåˆ¶</p></li><li><p>æ€§èƒ½å°½é‡å¥½</p></li><li><p>è‡ªå®šä¹‰å…ƒç´ </p></li><li><p>æ•ˆæœå¤§æ¦‚å¦‚å›¾ ï¼ŒåŸè®¾è®¡ç¨¿å°±ä¸è´´äº†ï¼Œä»èŠ±ç“£æˆªä¸ªå›¾</p><img src="https://i.loli.net/2020/10/20/8gxisTetz1qOYG4.png" alt="image.png"></li></ol><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><ol><li>æ•´ä¸ªç€‘å¸ƒæµé€šè¿‡ FlatList æ¥å®ç°ï¼Œé€šè¿‡è®¾ç½® columnsNum ä¸ renderItemï¼Œå°†æ¯ä¸€åˆ—åˆåˆ†åˆ«æ¸²æŸ“æˆä¸€ä¸ª FlatListã€‚å†…å±‚å¹¶åˆ—çš„ FlatList ä¸ä¼šäº§ç”Ÿå¤šä½™çš„æ»šåŠ¨æ¡ï¼Œå³ä»–ä»¬çš„é«˜åº¦ä¼šè¢«æœ€é•¿çš„åˆ—æ’‘å¼€ï¼Œæ»šåŠ¨æ—¶æ˜¯å¤–å±‚çš„ FlatListã€‚</li><li>åˆ¤æ–­æ¯ä¸€é¡¹åº”è¯¥å±äºå“ªä¸€åˆ—ï¼Œ å¦‚æœé¡¹çš„é«˜åº¦ä¸èƒ½æå‰è·å¾—ï¼Œé‚£ä¹ˆè¦åœ¨é¡¹çš„ onLayout æ—¶è·å–é«˜åº¦ï¼Œä¹‹ååˆ¤æ–­ä¸‹ä¸€é¡¹</li></ol>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ReactNative </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>react-native é€šè®¯å½•å­—æ¯åˆ—è¡¨</title>
      <link href="/2020/09/22/react-native-%E9%80%9A%E8%AE%AF%E5%BD%95%E5%AD%97%E6%AF%8D%E5%88%97%E8%A1%A8/"/>
      <url>/2020/09/22/react-native-%E9%80%9A%E8%AE%AF%E5%BD%95%E5%AD%97%E6%AF%8D%E5%88%97%E8%A1%A8/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>éœ€æ±‚ï¼šå®ç°ä¸€ä¸ªé€‰æ‹©å¿«é€’çš„é¡µé¢ï¼Œæ“ä½œç±»ä¼¼äºé€šè®¯å½•ï¼Œè®¾è®¡å›¾å¦‚ä¸‹</p><img src="https://i.loli.net/2020/10/20/OwH5A3bRgSuiBKt.png" alt="image.png" style="zoom: 50%"><p>ä¸ŠåŠéƒ¨åˆ†çš„æœç´¢äº¤äº’åŠå®ç°è¿™é‡Œå°±ä¸èµ˜è¿°ï¼Œé‡ç‚¹æ¢è®¨å­—æ¯åˆ—è¡¨çš„å®ç°ã€‚</p><a id="more"></a><p>éœ€è¦å®ç°çš„ç‚¹ï¼š</p><ol><li>ä¸»åˆ—è¡¨åˆ†ç»„ï¼Œå¤´éƒ¨ä¸å¸é¡¶</li><li>å­—æ¯åˆ—è¡¨å¯ä»¥æ»‘åŠ¨æˆ–ç‚¹å‡»ï¼Œå˜æ›´å½“å‰é€‰ä¸­çš„å­—æ¯ï¼Œä¸”ä¸»åˆ—è¡¨è·Ÿéšæ»‘åŠ¨å®šä½</li><li>ä¸»åˆ—è¡¨æ»šåŠ¨æ—¶ï¼Œå­—æ¯åˆ—è¡¨å½“å‰é€‰ä¸­çš„å­—æ¯å¯¹åº”å˜åŒ–</li></ol><p>æœç´¢äº†ç›®å‰å·²æœ‰çš„å¼€æºç»„ä»¶ï¼Œè¦ä¹ˆæœ€åä¸€æ¬¡æ›´æ–°çš„æ—¶é—´ä¹Ÿæ¯”è¾ƒä¹…è¿œï¼Œè¦ä¹ˆä¸é€‚ç”¨äºæˆ‘ä»¬çš„åœºæ™¯ï¼Œè¦ä¹ˆ star æ•°é‡ä¸å¤š ğŸ˜‚ã€‚å› æ­¤æ‰“ç®—é‡æ–°é€ ä¸ªè½®å­ï¼Œå³ä½¿å°†æ¥æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä¹Ÿèƒ½è‡ªè¡Œç»´æŠ¤ã€‚</p><h4 id="AlphabetList"><a href="#AlphabetList" class="headerlink" title="AlphabetList"></a>AlphabetList</h4><p>å°†æˆ‘ä»¬çš„ç»„ä»¶å‘½åä¸º AlphabetListï¼Œå®ƒå°†æ¥æ”¶ä¸€ä¸ª dataSource ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;AlphabetList dataSource&#x3D;&#123;dataSource&#125; &#x2F;&gt;</span><br></pre></td></tr></table></figure><p>dataSource çš„ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> IListItem &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  value: <span class="built_in">string</span> | <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> ISectionItem &#123;</span><br><span class="line">sectionKey: <span class="built_in">string</span>;</span><br><span class="line">data: &#123;</span><br><span class="line">name: <span class="built_in">string</span>;</span><br><span class="line">value: <span class="built_in">string</span></span><br><span class="line">&#125;[]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> DataSource: SectionItem[]</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    sectionKey: <span class="string">'å¸¸'</span>,</span><br><span class="line">    data: [</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">'é¡ºä¸°ç‰©æµ'</span>,</span><br><span class="line">        value: <span class="string">'1'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">'äº¬ä¸œå¿«é€’'</span>,</span><br><span class="line">        value: <span class="string">'2'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    sectionKey: <span class="string">'A'</span>,</span><br><span class="line">    data: [</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">'å®‰èƒ½ç‰©æµ'</span>,</span><br><span class="line">        value: <span class="string">'3'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">'æ¾³å¤§åˆ©äºšé‚®æ”¿'</span>,</span><br><span class="line">        value: <span class="string">'4'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>AlphabetList çš„ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;View&gt;</span><br><span class="line">  &#123;&#x2F;* ä¸»åˆ—è¡¨ *&#x2F;&#125;</span><br><span class="line">  &lt;MainList &#x2F;&gt;</span><br><span class="line">  &#123;&#x2F;* å³ä¾§å­—æ¯åˆ—è¡¨ *&#x2F;&#125;</span><br><span class="line">  &lt;SideBar &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;View&gt;</span><br></pre></td></tr></table></figure><h4 id="MainList"><a href="#MainList" class="headerlink" title="MainList"></a>MainList</h4><p>ä¸»åˆ—è¡¨åˆ†ç»„ Mainï¼Œé‚£ä¹ˆä½¿ç”¨ SectionList æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ç”¨ FlatList æ¥å®ç°ï¼‰</p><p>å½“æ»šåŠ¨ MainList æ—¶ï¼Œé€šè¿‡ <code>onListViewableItemsChanged</code> çš„å›è°ƒå¯ä»¥å¾—åˆ°å½“å‰çª—å£å¯è§†çš„åˆ†ç»„ï¼Œä»è€Œæ”¹å˜å½“å‰é€‰ä¸­çš„å­—æ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">const MainList &#x3D; (&#123;</span><br><span class="line">    dataSource,</span><br><span class="line">    onMainListViewableItemsChanged,</span><br><span class="line">  &#125;) &#x3D;&gt; &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;SectionList</span><br><span class="line">      renderItem&#x3D;&#123;(&#123; item &#125;) &#x3D;&gt; (&lt;ListItem item&#x3D;&#123;item&#125; &#x2F;&gt;)&#125;</span><br><span class="line">      renderSectionHeader&#x3D;&#123;(&#123; section &#125;) &#x3D;&gt; &lt;SectionHeader section&#x3D;&#123;section&#125; &#x2F;&gt;&#125;</span><br><span class="line">      keyExtractor&#x3D;&#123;(item) &#x3D;&gt; &#96;$&#123;item.value&#125;&#96;&#125;</span><br><span class="line">      sections&#x3D;&#123;dataSource&#125;</span><br><span class="line">      stickySectionHeadersEnabled&#x3D;&#123;false&#125;</span><br><span class="line">      onViewableItemsChanged&#x3D;&#123;onMainListViewableItemsChanged&#125;</span><br><span class="line">    &#x2F;&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default MainList;</span><br></pre></td></tr></table></figure><p>åœ¨ AlphabetList ä¸­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">const AlphabetList &#x3D; (&#123; dataSource &#125;: IProps) &#x3D;&gt; &#123;</span><br><span class="line">  &#x2F;&#x2F; å³ä¾§å­—æ¯è¡¨åˆ—è¡¨</span><br><span class="line">  const letterlist &#x3D; dataSource.map((item) &#x3D;&gt; &#123;</span><br><span class="line">    return item.sectionKey;</span><br><span class="line">  &#125;);</span><br><span class="line">  const [currentSectionKey, setCurrentSectionKey] &#x3D; useState(letterlist);</span><br><span class="line">  const onMainListViewableItemsChanged &#x3D; (info: &#123;</span><br><span class="line">    viewableItems: ViewToken[];</span><br><span class="line">  &#125;) &#x3D;&gt; &#123;</span><br><span class="line">    &#x2F;&#x2F; å°†é€‰ä¸­çš„å­—æ¯è®¾ç½®ä¸ºå½“å‰ç¬¬ä¸€ä¸ªå¯è§ section çš„ sectionKey</span><br><span class="line">    setCurrentSectionKey(info.viewableItems[0].section.sectionKey);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;View style&#x3D;&#123;styles.container&#125;&gt;</span><br><span class="line">      &#123;&#x2F;* ä¸»åˆ—è¡¨ start *&#x2F;&#125;</span><br><span class="line">      &lt;MainList</span><br><span class="line">        dataSource&#x3D;&#123;dataSource&#125;</span><br><span class="line">        onMainListTouchStart&#x3D;&#123;() &#x3D;&gt; setCurrentResponder(&#39;mainList&#39;)&#125;</span><br><span class="line">        onMainListViewableItemsChanged&#x3D;&#123;onMainListViewableItemsChanged&#125;</span><br><span class="line">      &#x2F;&gt;</span><br><span class="line">      &#123;&#x2F;* ä¸»åˆ—è¡¨ end *&#x2F;&#125;</span><br><span class="line">      &#123;&#x2F;* å³ä¾§å­—æ¯åˆ—è¡¨ start *&#x2F;&#125;</span><br><span class="line">      &lt;SideBar &#x2F;&gt;</span><br><span class="line">      &#123;&#x2F;* å³ä¾§å­—æ¯åˆ—è¡¨ end *&#x2F;&#125;</span><br><span class="line">    &lt;&#x2F;View&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">export default AlphabetList;</span><br></pre></td></tr></table></figure><h4 id="SideBar"><a href="#SideBar" class="headerlink" title="SideBar"></a>SideBar</h4><p>ä¾§è¾¹æ çš„å®ç°æ¯”èµ·æ¥åˆ™è¦å¤æ‚ä¸€äº›ï¼Œè¿™é‡Œä½¿ç”¨ä¸€ä¸ªç»å¯¹å®šä½çš„ FlatListï¼Œå®é™…ä¸Šç®€å•ä½¿ç”¨ View å»å®ç°ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">const SideBar &#x3D; (&#123;</span><br><span class="line">  letterlist,</span><br><span class="line">  &#x2F;&#x2F; å›è°ƒ</span><br><span class="line">  handleSideBarItemRespond,</span><br><span class="line">  currentSectionKey</span><br><span class="line">&#125;: IProps) &#x3D;&gt; &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;FlatList</span><br><span class="line">      style&#x3D;&#123;styles.wrap&#125;</span><br><span class="line">      scrollEnabled&#x3D;&#123;false&#125;</span><br><span class="line">      data&#x3D;&#123;letterlist&#125;</span><br><span class="line">      renderItem&#x3D;&#123;(&#123; item, index &#125;) &#x3D;&gt; (</span><br><span class="line">        &lt;Item</span><br><span class="line">          item&#x3D;&#123;item&#125;</span><br><span class="line">          handleSideBarItemRespond&#x3D;&#123;handleSideBarItemRespond&#125;</span><br><span class="line">          letterlist&#x3D;&#123;letterlist&#125;</span><br><span class="line">        &#x2F;&gt;</span><br><span class="line">      )&#125;</span><br><span class="line">      keyExtractor&#x3D;&#123;item &#x3D;&gt; item&#125;</span><br><span class="line">    &#x2F;&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¸€å¼€å§‹æˆ‘çš„æƒ³æ³•æ˜¯é€šè¿‡ç›‘å¬ Item çš„ onPress | onPressIn ï¼Œä»ä¸€é¡¹æ»‘åŠ¨åˆ°å¦ä¸€é¡¹çš„æ—¶å€™ï¼Œä¾æ¬¡è§¦å‘äº‹ä»¶ï¼Œå®éªŒåå‘ç°ï¼Œåœ¨é‡Šæ”¾æ‰‹åŠ¿ä¹‹å‰ï¼Œä»…ä¼šæœ‰ä¸€ä¸ªå“åº”çš„å…ƒç´ ã€‚</p><p>è¿™é‡Œå°±å¾—æä¸€ä¸‹ RN çš„æ‰‹åŠ¿ç³»ç»Ÿäº†ã€‚</p><h5 id="Responder"><a href="#Responder" class="headerlink" title="Responder"></a>Responder</h5><p>åœ¨ React Native ä¸­ï¼Œå“åº”æ‰‹åŠ¿çš„åŸºæœ¬å•ä½æ˜¯<code>responder</code>ï¼Œå¹¶ä¸”ä»…æœ‰ä¸€ä¸ª <code>responder</code> æ‹¥æœ‰æ§åˆ¶æƒã€‚åœ¨ View ä¸Šæœ‰è¿™äº›å±æ€§ï¼š</p><ol><li>onStartShouldSetResponderï¼šç‚¹å‡»æ—¶æ˜¯å¦å˜æˆä¸€ä¸ª responder</li><li>onMoveShouldSetResponderï¼šæ»‘åŠ¨æ—¶æ˜¯å¦å˜æˆä¸€ä¸ª responder</li><li>onResponderGrantï¼š ç‚¹å‡»æ—¶çš„å›è°ƒ</li><li>onResponderMoveï¼šç§»åŠ¨æ—¶çš„å›è°ƒ</li><li>onResponderTerminationRequestï¼šå½“åˆ«çš„å…ƒç´ å¸Œæœ›æˆä¸º responder æ—¶ï¼Œæ˜¯å¦è¦é‡Šæ”¾å½“å‰çš„ responderï¼Ÿ</li><li>onResponderReleaseï¼šå½“ reponder é‡Šæ”¾æ—¶çš„å›è°ƒ</li><li>ç­‰ç­‰</li></ol><p>é€šè¿‡ä¸Šè¿°è¿™äº› API æˆ‘ä»¬å°±èƒ½å¾ˆå®¹æ˜“çš„å®ç°ä¸€äº›æ‰‹åŠ¿ã€‚åˆæ¬¡ä¹‹å¤–ï¼ŒRN è¿˜æä¾›äº†æ›´é«˜çº§çš„æŠ½è±¡ PanResponderï¼Œå®ƒå¯ä»¥ç»™æˆ‘ä»¬æä¾›æ›´å¤šæ‰‹åŠ¿ä¿¡æ¯ï¼Œè¿™é‡Œä¸å±•å¼€è§£é‡Šã€‚</p><p>ä¸è¿‡å½“æˆ‘å°è¯•åœ¨æ¯ä¸ª Item ä¸Šè®¾ç½®æ‰‹åŠ¿å“åº”ï¼Œå¹¶ä¸”è®¾ç½®  onResponderTerminationRequest ä¸º <code>() =&gt; true</code>ï¼Œæ‰‹åŠ¿ä¾ç„¶æ²¡æœ‰åœ¨åˆ‡æ¢ Item æ—¶é‡Šæ”¾åŸ responderã€‚</p><p>å› æ­¤åªèƒ½é€šè¿‡è®¡ç®—é«˜åº¦æ¥è·å–æ»‘åŠ¨æ—¶å½“å‰çš„å­—æ¯</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// evt.nativeEvent.pageY: è§¦æ‘¸äº‹ä»¶çš„ pageY</span></span><br><span class="line"><span class="comment">// sideBarTop: SideBar çš„ pageY</span></span><br><span class="line"><span class="comment">// letterHeightï¼šæ¯ä¸ªå­—æ¯çš„é«˜åº¦</span></span><br><span class="line"><span class="keyword">const</span> index = <span class="built_in">Math</span>.floor((evt.nativeEvent.pageY - sideBarTop) / letterHeight);</span><br></pre></td></tr></table></figure><p>è¦è·å–å…ƒç´ è·ç¦»å±å¹•çš„é«˜åº¦ï¼Œå¯ä»¥åœ¨ onLayout çš„æ—¶å€™ï¼Œè°ƒç”¨ measure æ¥è·å–ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">const SideBar &#x3D; (&#123;</span><br><span class="line">  letterlist,</span><br><span class="line">  handleSideBarItemRespond,</span><br><span class="line">  currentSectionKey,</span><br><span class="line">  letterHeight,</span><br><span class="line">&#125;: IProps) &#x3D;&gt; &#123;</span><br><span class="line">  const [sideBarTop, setSideBarTop] &#x3D; useState(0);</span><br><span class="line">  const sideBarRef &#x3D; useRef&lt;View&gt;(null);</span><br><span class="line">  const measure &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">    if (sideBarRef.current) &#123;</span><br><span class="line">      sideBarRef.current.measure((x, y, width, height, pageX, pageY) &#x3D;&gt; &#123;</span><br><span class="line">        setSideBarTop(pageY);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  return (</span><br><span class="line">    &lt;View onLayout&#x3D;&#123;measure&#125; ref&#x3D;&#123;sideBarRef&#125;&gt;</span><br><span class="line">      &lt;FlatList&lt;string&gt;</span><br><span class="line">        &#x2F;&#x2F; ...</span><br><span class="line">      &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;View&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯ Item çš„å®ç°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">const Item &#x3D; (&#123;</span><br><span class="line">  item,</span><br><span class="line">  handleSideBarItemRespond,</span><br><span class="line">  isCurrentSectionKey,</span><br><span class="line">  letterlist,</span><br><span class="line">  letterHeight,</span><br><span class="line">  sideBarTop,</span><br><span class="line">&#125;: &#123;</span><br><span class="line">  item: string;</span><br><span class="line">  isFirst: boolean;</span><br><span class="line">  handleSideBarItemRespond: (item: string) &#x3D;&gt; void;</span><br><span class="line">  letterlist: string[];</span><br><span class="line">  letterHeight: number;</span><br><span class="line">  sideBarTop?: number;</span><br><span class="line">&#125;) &#x3D;&gt; &#123;</span><br><span class="line">  const panResponder &#x3D; PanResponder.create(&#123;</span><br><span class="line">    onStartShouldSetPanResponderCapture: () &#x3D;&gt; true,</span><br><span class="line">    onStartShouldSetPanResponder: () &#x3D;&gt; true,</span><br><span class="line">    &#x2F;&#x2F; å°è¯•é€šè¿‡ onResponderTerminationRequest æ¥ç»ˆæ­¢æ‰‹åŠ¿ï¼Œå‘ç°ä¸ç”Ÿæ•ˆï¼Œåªèƒ½é€šè¿‡è®¡ç®—åç§»é‡æ¥è·å–å½“å‰é€‰ä¸­</span><br><span class="line">    onPanResponderTerminationRequest: () &#x3D;&gt; true,</span><br><span class="line">    onPanResponderGrant: () &#x3D;&gt; &#123;</span><br><span class="line">      handleSideBarItemRespond(item);</span><br><span class="line">    &#125;,</span><br><span class="line">    onPanResponderMove: (evt, gs) &#x3D;&gt; &#123;</span><br><span class="line">      if (!sideBarTop) &#123;</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">      const index &#x3D; Math.floor(</span><br><span class="line">        (evt.nativeEvent.pageY - sideBarTop) &#x2F; letterHeight,</span><br><span class="line">      );</span><br><span class="line">      if (index &gt;&#x3D; 0 &amp;&amp; index &lt; letterlist.length) &#123;</span><br><span class="line">        &#x2F;&#x2F; è§¦å‘ä¾§è¾¹å­—æ¯é€‰ä¸­çš„å›è°ƒ</span><br><span class="line">        handleSideBarItemRespond(letterlist[index]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;View &#123;...panResponder.panHandlers&#125;&gt;</span><br><span class="line">      &lt;Text&gt;</span><br><span class="line">        &#123;item&#125;</span><br><span class="line">      &lt;&#x2F;Text&gt;</span><br><span class="line">    &lt;&#x2F;View&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œä¾§è¾¹æ çš„é€»è¾‘å·²ç»å®Œæˆã€‚ç°åœ¨å¤„ç†ä¾§è¾¹æ äº‹ä»¶çš„å›è°ƒé€»è¾‘, ä¸»è¦é€šè¿‡ scrollToLocation æ¥å®ç°åˆ—è¡¨æ»šåŠ¨åˆ°å¯¹åº”çš„ä½ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">const AlphabetList &#x3D; (&#123; dataSource, companyList, onCompanySelect &#125;: IProps) &#x3D;&gt; &#123;</span><br><span class="line">  &#x2F;&#x2F; ...</span><br><span class="line">  const mainListRef &#x3D; useRef&lt;SectionList&lt;IListItem&gt;&gt;(null);</span><br><span class="line">  const handleSideBarItemRespond &#x3D; (item: string) &#x3D;&gt; &#123;</span><br><span class="line">    if (!mainListRef.current) &#123;</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line">  &#x2F;&#x2F; è®°å½•å½“å‰é€‰ä¸­çš„å­—æ¯</span><br><span class="line">    setCurrentSectionKey(item);</span><br><span class="line">    mainListRef.current.scrollToLocation(&#123;</span><br><span class="line">      sectionIndex: dataSource.findIndex((data) &#x3D;&gt; data.sectionKey &#x3D;&#x3D;&#x3D; item),</span><br><span class="line">      itemIndex: 0,</span><br><span class="line">      animated: false,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;View style&#x3D;&#123;styles.container&#125;&gt;</span><br><span class="line">      &#123;&#x2F;* ä¸»åˆ—è¡¨ start *&#x2F;&#125;</span><br><span class="line">      &lt;MainList</span><br><span class="line">        &#x2F;&#x2F; ...</span><br><span class="line">        ref&#x3D;&#123;mainListRef&#125;</span><br><span class="line">      &#x2F;&gt;</span><br><span class="line">      &#x2F;&#x2F; ...</span><br><span class="line">    &lt;&#x2F;View&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéœ€è¦é€šè¿‡ React.forwardRef è·å–åˆ° MainList çš„ ref</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">const MainList: React.ForwardRefRenderFunction&lt;</span><br><span class="line">  SectionList&lt;IListItem&gt;,</span><br><span class="line">  IProps</span><br><span class="line">&gt; &#x3D; (</span><br><span class="line">  &#123;</span><br><span class="line">    dataSource,</span><br><span class="line">    &#x2F;&#x2F; ...</span><br><span class="line">  &#125;,</span><br><span class="line">  ref,</span><br><span class="line">) &#x3D;&gt; &#123;</span><br><span class="line"> &#x2F;&#x2F; ...</span><br><span class="line">  return (</span><br><span class="line">    &lt;SectionList</span><br><span class="line">      &#x2F;&#x2F; ...</span><br><span class="line">      ref&#x3D;&#123;ref&#125;</span><br><span class="line">    &#x2F;&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line">export default React.forwardRef(MainList)</span><br></pre></td></tr></table></figure><p>åˆ°è¿™ä¸€æ­¥ï¼Œå·²ç»åŸºæœ¬å®Œæˆäº†ä¸€ä¸ªé€šè®¯å½•å­—æ¯åˆ—è¡¨ã€‚</p><h4 id="å…¶ä»–ç»†èŠ‚"><a href="#å…¶ä»–ç»†èŠ‚" class="headerlink" title="å…¶ä»–ç»†èŠ‚"></a>å…¶ä»–ç»†èŠ‚</h4><p>åœ¨å®Œæˆä¸Šè¿°åŠŸèƒ½åï¼Œç”±äºç‚¹å‡»ä¾§è¾¹æ ä¼šæ»šåŠ¨ä¸»åˆ—è¡¨ï¼Œæ­¤æ—¶ä¹Ÿä¼šè§¦å‘ MainList çš„ onViewableItemsChangedï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªæ ‡è¯†æ¥åŒºåˆ†æ˜¯ä»€ä¹ˆåŠ¨ä½œè§¦å‘çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">const AlphabetList &#x3D; (&#123; dataSource, companyList, onCompanySelect &#125;: IProps) &#x3D;&gt; &#123;</span><br><span class="line">  &#x2F;&#x2F; æ ‡è¯†ä½ï¼šç”¨äºåŒºåˆ†å½“å‰çš„æ“ä½œæ˜¯ç”±ä»€ä¹ˆè§¦å‘çš„</span><br><span class="line">  const [currentResponder, setCurrentResponder] &#x3D; useState(&#39;&#39;);</span><br><span class="line">  const mainListRef &#x3D; useRef&lt;SectionList&lt;IListItem&gt;&gt;(null);</span><br><span class="line">  &#x2F;&#x2F; å³ä¾§å­—æ¯è¡¨åˆ—è¡¨</span><br><span class="line">  const letterlist &#x3D; dataSource.map((item) &#x3D;&gt; &#123;</span><br><span class="line">    return item.sectionKey;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  const [currentSectionKey, setCurrentSectionKey] &#x3D; useState(letterlist[0]);</span><br><span class="line"></span><br><span class="line">  const handleSideBarItemRespond &#x3D; (item: string) &#x3D;&gt; &#123;</span><br><span class="line">    if (!mainListRef.current) &#123;</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line">    setCurrentResponder(&#39;sideBar&#39;);</span><br><span class="line">  &#x2F;&#x2F; ...</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  const onMainListViewableItemsChanged &#x3D; (info: &#123;</span><br><span class="line">    viewableItems: ViewToken[];</span><br><span class="line">  &#125;) &#x3D;&gt; &#123;</span><br><span class="line">    if (</span><br><span class="line">      &#x2F;&#x2F; ä¾§è¾¹æ è§¦å‘çš„æ»šåŠ¨åˆ™ä¸è§¦å‘</span><br><span class="line">      currentResponder &#x3D;&#x3D;&#x3D; &#39;sideBar&#39; ||</span><br><span class="line">      !info.viewableItems[0].section.sectionKey</span><br><span class="line">    ) &#123;</span><br><span class="line">      return;</span><br><span class="line">    &#125;</span><br><span class="line">    setCurrentSectionKey(info.viewableItems[0].section.sectionKey);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;View style&#x3D;&#123;styles.container&#125;&gt;</span><br><span class="line">      &#123;&#x2F;* ä¸»åˆ—è¡¨ start *&#x2F;&#125;</span><br><span class="line">      &lt;MainList</span><br><span class="line">       &#x2F;&#x2F; ...</span><br><span class="line">        onMainListTouchStart&#x3D;&#123;() &#x3D;&gt; setCurrentResponder(&#39;mainList&#39;)&#125;</span><br><span class="line">        &#x2F;&#x2F; ...</span><br><span class="line">      &#x2F;&gt;</span><br><span class="line">      &#123;&#x2F;* ä¸»åˆ—è¡¨ end *&#x2F;&#125;</span><br><span class="line">      &#x2F;&#x2F; ...</span><br><span class="line">    &lt;&#x2F;View&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="è¸©å‘"><a href="#è¸©å‘" class="headerlink" title="è¸©å‘"></a>è¸©å‘</h4><p>åŠŸèƒ½æ˜¯åŸºæœ¬ä¸Šå®Œæˆäº†ï¼Œç„¶è€Œç”±äºè¿™é‡Œçš„æ•°æ®é‡æ¯”è¾ƒå¤šï¼Œå¤§æ¦‚æœ‰ 600 æ¡æ•°æ®ï¼Œä¸”ç”±äº SectionList ä¹Ÿæ˜¯åŸºäº VirtualListï¼Œå› æ­¤å¯¼è‡´äº†ä»¥ä¸‹é•¿åˆ—è¡¨å›ºæœ‰çš„å‡ ä¸ªé—®é¢˜ï¼š</p><ol><li>å¿«é€Ÿæ»šåŠ¨ MainListï¼Œå½“ SectionList æ¥ä¸åŠæ¸²æŸ“æ—¶ï¼Œä¼šå¯¼è‡´å±å¹•ç©ºç™½</li><li>å½“ä½¿ç”¨ scrollToLocation æ—¶ï¼Œå¦‚æœå®šä½åˆ°æ¥ä¸åŠæ¸²æŸ“çš„åŒºåŸŸï¼Œå°†ä¼šæŠ¥é”™ï¼Œæç¤ºéœ€è¦è®¾ç½® getItemLayout å±æ€§ï¼Œè¿™ä¸ªå±æ€§æ˜¯ç”¨äºè®¡ç®—ä¸»åˆ—è¡¨æ¯ä¸€é¡¹é«˜åº¦ä»¥åŠåç§»é‡çš„</li></ol><p>åœ¨å°è¯•äº†ä¸€äº›ä¼˜åŒ–çš„æ‰‹æ®µåï¼Œå¦‚ React.memo, initialNumToRenderï¼ŒgetItemLayout ç­‰å±æ€§ä¾ç„¶æ— æ³•æœ‰æ•ˆè§£å†³ä¸Šè¿°é—®é¢˜ã€‚ã€‚</p><p>RN çš„ list çœŸçš„æ˜¯è®©äººä¸€è¨€éš¾å°½ã€‚ã€‚ä¸çŸ¥é“æ˜¯å¦åŸç”Ÿç»„ä»¶æˆ–è€… flutter å¯¹é•¿åˆ—è¡¨çš„æ”¯æŒä¼šæ›´å¥½ä¸€ç‚¹å‘¢ ğŸ˜‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ReactNative </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title> TypeScript çš„ enum ç±»å‹æ”¶çª„é—®é¢˜</title>
      <link href="/2020/09/21/TypeScript-%E7%9A%84-enum-%E7%B1%BB%E5%9E%8B%E6%94%B6%E7%AA%84%E9%97%AE%E9%A2%98/"/>
      <url>/2020/09/21/TypeScript-%E7%9A%84-enum-%E7%B1%BB%E5%9E%8B%E6%94%B6%E7%AA%84%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>åœ¨é¡¹ç›®ä¸­çœ‹åˆ°ä¸€æ®µå°ä¼™ä¼´å†™çš„ä»£ç ï¼Œç®€åŒ–åå¤§æ¦‚å¦‚ä¸‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> A &#123;</span><br><span class="line">  <span class="string">"ONE"</span> = <span class="number">1</span>,</span><br><span class="line">  <span class="string">"TWO"</span> = <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="built_in">Math</span>.random() &gt; <span class="number">0.5</span> ? A.ONE : A.TWO</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> b = <span class="built_in">Math</span>.random() &gt; <span class="number">0.5</span> ? a : <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(b === <span class="number">1</span> || b === <span class="number">2</span>) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œb === 2 å¤„ ts ä¼šæç¤º:</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This condition will <span class="keyword">always</span> <span class="keyword">return</span> <span class="string">'false'</span> since the <span class="keyword">types</span> <span class="string">'0'</span> <span class="keyword">and</span> <span class="string">'2'</span> have <span class="keyword">no</span> overlap.ts(<span class="number">2367</span>)</span><br></pre></td></tr></table></figure><p>ä¸ºä½• TypeScript ä¼šæç¤º 0 ä¸ 2 æ²¡æœ‰é‡åˆçš„åœ°æ–¹å‘¢ï¼Ÿ</p><a id="more"></a><h4 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><p>é¼ æ ‡æ‚¬æµ®åœ¨ b === 1 æ—¶ï¼Œæç¤º b çš„ç±»å‹ä¸º A ï½œ 0 çš„è”åˆç±»å‹ï¼Œè€Œåˆ°äº† b === 2 æ—¶ï¼Œå´å˜æˆäº† <code>b: 0</code>ã€‚é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ TypeScript åœ¨åˆ¤æ–­ b !== 1 æ—¶ï¼Œå°±åˆ¤å®š b ä¸å¯èƒ½ä¸ºç±»å‹ Aï¼Œæ­¤æ—¶å°†ç±»å‹æ”¶çª„ä¸º 0ã€‚è€Œ 0 ä¸å¯èƒ½ assgin ç»™ 2ï¼Œå› æ­¤æŠ¥é”™ã€‚ä¸Šç½‘æœç´¢ä¼¼ä¹ä¹Ÿæ²¡æœ‰å¾—åˆ°ä¸ºä½•æ—¶è¿™ç§æ”¶çª„ç­–ç•¥çš„åŸå› ï¼Œä»…æœ‰ä¸€ä¸ªå¯èƒ½æœ‰å…³è”çš„ <a href="https://github.com/Microsoft/TypeScript/issues/9998" target="_blank" rel="noopener">https://github.com/Microsoft/TypeScript/issues/9998</a> , ç„¶è€Œè‡³ä»Šè¿˜æ˜¯ open çš„ã€‚</p><h4 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h4><p>é‚£æˆ‘ä»¬è¦æ€ä¹ˆè§£å†³è¿™ä¸ªæŠ¥é”™å‘¢ï¼Ÿå®é™…ä¸Šæˆ‘ä»¬å°†åˆ¤æ–­çš„å³å€¼æ”¹æˆ enum å³å¯ï¼Œä¸”é€»è¾‘æ›´æ¸…æ™°ï¼Œç»´æŠ¤æ›´ç®€å•ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(b === A.ONE || b === A.TWO) &#123;</span><br><span class="line"><span class="comment">// no error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ–è€…ä¸‹é¢è¿™ç§ä¹Ÿå¯ä»¥ï¼ˆä¸æ˜¯å¾ˆæ¨èï¼Œæ²¡æœ‰å‘æŒ¥å‡º enum åº”æœ‰çš„ä½œç”¨ï¼‰</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(b <span class="keyword">as</span> A === <span class="number">1</span> || b === <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">// no error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äº cookie</title>
      <link href="/2020/09/21/%E5%85%B3%E4%BA%8E-cookie/"/>
      <url>/2020/09/21/%E5%85%B3%E4%BA%8E-cookie/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>ç›®å‰åœ¨æˆ‘ä»¬çš„åå°é¡¹ç›®ä¸­ï¼Œç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ä¸»è¦æ˜¯å­˜æ”¾åœ¨ cookie ä¸­ã€‚è¯»å†™ cookie çš„è¿‡ç¨‹ä¸»è¦æ˜¯æœåŠ¡ç«¯çš„å·¥ä½œï¼Œæ‰€ä»¥å‰ç«¯è´Ÿè´£ä¸šåŠ¡çš„åŒå­¦æœ‰å¯èƒ½æ¥è§¦ä¸åˆ°ï¼Œä½†æ˜¯ cookie åˆä¸ç½‘ç»œå®Œå…¨ï¼Œè·¨åŸŸï¼Œä»£ç†ç­‰ç­‰è¯¸å¤šæ¦‚å¿µæœ‰å…³è”ï¼Œå› æ­¤äºæœ¬æ–‡è®°å½•æˆ‘æ‰€äº†è§£çš„ cookieã€‚</p><h4 id="æœ¬åœ°å¼€å‘ä»£ç†"><a href="#æœ¬åœ°å¼€å‘ä»£ç†" class="headerlink" title="æœ¬åœ°å¼€å‘ä»£ç†"></a>æœ¬åœ°å¼€å‘ä»£ç†</h4><p>æœ¬åœ°å¼€å‘æ—¶é€šå¸¸ä¼šå°†æ¥å£ä»£ç†åˆ°æµ‹è¯•ç¯å¢ƒ</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°å½•ä¸€æ¬¡bugæ’æŸ¥</title>
      <link href="/2020/09/16/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1bug%E6%8E%92%E6%9F%A5/"/>
      <url>/2020/09/16/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1bug%E6%8E%92%E6%9F%A5/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>æµ‹è¯•åŒå­¦æäº†ä¸€ä¸ªæµ‹è¯•ç¯å¢ƒè¡¨æ ¼æ— æ³•åˆ‡æ¢æ¯é¡µæ¡æ•°çš„ bugã€‚</p><h4 id="æ’æŸ¥è¿‡ç¨‹"><a href="#æ’æŸ¥è¿‡ç¨‹" class="headerlink" title="æ’æŸ¥è¿‡ç¨‹"></a>æ’æŸ¥è¿‡ç¨‹</h4><p>åœ¨æµ‹è¯•ç¯å¢ƒæ“ä½œåå‘ç°ï¼Œç¡®å®å­˜åœ¨è¯¥é—®é¢˜ï¼Œä½†æ˜¯åˆ‡æ¢åˆ°å¯¹åº”æµ‹è¯•åˆ†æ”¯ï¼Œæœ¬åœ°è¿è¡Œï¼Œæœªèƒ½é‡ç°ã€‚</p><a id="more"></a><p>åœ¨æµ‹è¯•ç¯å¢ƒçš„æ“ä½œå‘ç°å®é™…ä¸Šåˆ‡æ¢æ¯é¡µæ¡æ•°çš„å›è°ƒ onShowSizeChange ç¡®å®ä¼šè§¦å‘ï¼Œä½†æ˜¯æ­¤ååˆå˜å›åŸæ¯é¡µæ¡æ•°ã€‚</p><p>å¯¹äºæµ‹è¯•ç¯å¢ƒä¸æœ¬åœ°å¼€å‘çš„è¡¨ç°ä¸ä¸€è‡´ï¼Œåœ¨æ’é™¤äº†å„ç§å¯èƒ½æ€§ä¹‹åï¼ŒçŒœæµ‹æ˜¯ä¾èµ–ç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡´çš„ã€‚</p><p>ç‰ˆæœ¬ä¸ä¸€è‡´å‡ºç°é—®é¢˜æ­¤å‰å·²ç»å‡ºç°è¿‡ä¸€æ¬¡ï¼šæˆ‘æœ¬åœ°çš„æœ‰æ®µä»£ç æç¤ºäº†ä¸€ä¸ª eslint çš„ no-throw-literalï¼Œä½†æ˜¯åˆ«çš„åŒäº‹éƒ½æ²¡æœ‰æŠ¥é”™ï¼Œ eslintrc çš„é…ç½®æ˜¯ä¸€æ ·çš„ã€‚æœ€ç»ˆå‘ç°æ˜¯æˆ‘çš„ umi ç‰ˆæœ¬æ¯”è¾ƒé«˜ï¼Œå…¶ä¸­ä¾èµ–çš„ @typescript-eslint/eslint-plugin åœ¨ 2.13.0 æ–°å¢äº† no-throw-literal è¿™ä¸ªé…ç½®ï¼Œè€Œåˆ«çš„å°ä¼™ä¼´ä»¬çš„ç‰ˆæœ¬ä½äºæ­¤ï¼Œæ•…ä¸ä¼šæŠ¥é”™ã€‚</p><p>å› æ­¤æ‰§è¡Œå‘½ä»¤ <code>npm ci</code> ï¼Œè¯¥å‘½ä»¤ä¼šæŒ‰ç…§ packge-lock.json ä¸­è®°å½•çš„ç‰ˆæœ¬è¿›è¡Œå®‰è£…,ä¸‹é¢æ˜¯è¿™ä¸ªå‘½ä»¤çš„è¯´æ˜</p><blockquote><p>This command is similar to <code>npm-install</code>, except itâ€™s meant to be used in automated environments such as test platforms, continuous integration, and deployment â€“ or any situation where you want to make sure youâ€™re doing a clean install of your dependencies. It can be significantly faster than a regular npm install by skipping certain user-oriented features. It is also more strict than a regular install, which can help catch errors or inconsistencies caused by the incrementally-installed local environments of most npm users.</p></blockquote><p>é‡æ–°å®‰è£…ä¾èµ–ä¹‹åæœç„¶æœ¬åœ°å¯ä»¥é‡ç°è¯¥é—®é¢˜ã€‚</p><p>æ­¤åç»è¿‡ debug å‘ç°ï¼Œåˆ‡æ¢ pageSize ä¼šå…ˆåè§¦å‘ onShowSizeChange å’Œè¡¨æ ¼çš„ onChangeï¼Œè¡¨æ ¼çš„ onChange é‡æ–°å°† pageSize è®¾ç½®å›å»ã€‚</p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>æœ€ç»ˆå¦‚ä½•è§£å†³ä¸Šè¿° bug å°±ä¸èµ˜è¿°äº†ã€‚</p><p>ä¸»è¦æƒ³æ€»ç»“çš„æ˜¯ï¼šé‡åˆ° bugï¼Œå¦‚æœå‡ºç°ä»£ç å’Œè¿è¡Œç¯å¢ƒä¹‹ç±»çš„å„ç§æ¡ä»¶éƒ½ä¸€è‡´ï¼Œä½†æ˜¯è¡¨ç°å°±æ˜¯ä¸ä¸€è‡´çš„æƒ…å†µï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½æ˜¯ä¾èµ–åŒ…çš„ç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡´çš„ ğŸ‘»</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®€æ˜“ redux</title>
      <link href="/2020/09/14/%E7%AE%80%E6%98%93-redux/"/>
      <url>/2020/09/14/%E7%AE%80%E6%98%93-redux/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>Redux å¸¸å¸¸é…åˆ react-redux ä½œä¸ºçŠ¶æ€ç®¡ç†åº”ç”¨åœ¨ React çš„é¡¹ç›®ä¸­ï¼Œå¹¶ä¸”åŸºäº redux å‘å±•å‡ºäº† dva ä¹‹ç±»çš„è¯¸å¤šçŠ¶æ€ç®¡ç†å·¥å…·ã€‚</p><p>è¯´æ¥æƒ­æ„§ï¼Œè™½ç„¶åœ¨é¡¹ç›®ä¸­å¸¸å¸¸ä½¿ç”¨åˆ°ï¼Œä½†æ˜¯å¹¶æœªé˜…è¯»è¿‡ redux çš„æºç ï¼Œäº†è§£å…¶åŸç†ã€‚æœ¬æ–‡ä½œä¸ºå­¦ä¹ ç¬”è®°ï¼Œå¹¶æ ¹æ® redux çš„æ¯”è¾ƒæ ¸å¿ƒçš„ createStore è¿™éƒ¨åˆ†ä»£ç å®ç°ä¸€ä¸ªç®€æ˜“ç‰ˆæœ¬çš„ reduxï¼Œä»¥ä¾¿å°†æ¥å›é¡¾ã€‚</p><a id="more"></a><h4 id="redux-demo"><a href="#redux-demo" class="headerlink" title="redux demo"></a>redux demo</h4><p>redux æä¾›äº†ä½¿ç”¨ demo å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¿™æ˜¯ä¸ª reducerï¼Œçº¯å‡½æ•°ï¼Œç”¨äºæè¿°çŠ¶æ€æ˜¯å¦‚ä½•è½¬å˜çš„</span></span><br><span class="line"><span class="comment"> * reducer æ¥æ”¶ state å’Œ action ä½œä¸ºå‚æ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">counter</span>(<span class="params">state = <span class="number">0</span>, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'INCREMENT'</span>:</span><br><span class="line">      <span class="keyword">return</span> state + <span class="number">1</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'DECREMENT'</span>:</span><br><span class="line">      <span class="keyword">return</span> state - <span class="number">1</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// createStoreï¼šæ¥æ”¶ reducer ä½œä¸ºå‚æ•°ï¼Œä»¥æ­¤æ„å»ºä¸€ä¸ª store</span></span><br><span class="line"><span class="keyword">let</span> store = createStore(counter)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¢é˜… store, æ¯æ¬¡ dispatch çš„æ—¶å€™ï¼Œéƒ½å°†è§¦å‘å›è°ƒ</span></span><br><span class="line">store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(store.getState()))</span><br><span class="line"></span><br><span class="line"><span class="comment">// dispath ä¸€ä¸ª action</span></span><br><span class="line">store.dispatch(&#123; <span class="attr">type</span>: <span class="string">'INCREMENT'</span> &#125;)</span><br></pre></td></tr></table></figure><h4 id="ç®€åŒ–çš„æ•°æ®æµ"><a href="#ç®€åŒ–çš„æ•°æ®æµ" class="headerlink" title="ç®€åŒ–çš„æ•°æ®æµ"></a>ç®€åŒ–çš„æ•°æ®æµ</h4><img src="https://images.gitee.com/uploads/images/2020/0914/154038_ccc93a28_1748283.png" alt="fiber" style="zoom:50%;" /><p>ä»¥ä¸Šçš„æ•°æ®æµç®€åŒ–äº† combineReducers ç­‰è¿‡ç¨‹</p><h4 id="ç®€æ˜“-redux"><a href="#ç®€æ˜“-redux" class="headerlink" title="ç®€æ˜“ redux"></a>ç®€æ˜“ redux</h4><p>å¯ä»¥çœ‹å‡º redux å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œç®€æ˜“ç‰ˆå®ç°å¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createStore = <span class="function">(<span class="params">reducer</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> state</span><br><span class="line">  <span class="comment">// è®¢é˜…çš„å›è°ƒ</span></span><br><span class="line">  <span class="keyword">let</span> listeners = []</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è·å– state</span></span><br><span class="line">  <span class="keyword">const</span> getState = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æ›´æ–° state</span></span><br><span class="line">    state = reducer(state, action)</span><br><span class="line">    <span class="comment">// ä¸€æ—¦ dispatch å°±æ‰§è¡Œæ‰€æœ‰è®¢é˜…çš„å›è°ƒ</span></span><br><span class="line">    listeners.forEach(<span class="function">(<span class="params">listener</span>) =&gt;</span> listener())</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> subscribe = <span class="function">(<span class="params">listener</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æ”¶é›†å›è°ƒ</span></span><br><span class="line">    listeners.push(listener)</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// å–æ¶ˆè®¢é˜…</span></span><br><span class="line">      listeners = listeners.filter(<span class="function">(<span class="params">l</span>) =&gt;</span> l !== listener)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    getState,</span><br><span class="line">    dispatch,</span><br><span class="line">    subscribe,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‘Šåˆ«é­”æ³•æ•°å­—</title>
      <link href="/2020/09/12/%E5%91%8A%E5%88%AB%E9%AD%94%E6%B3%95%E6%95%B0%E5%AD%97/"/>
      <url>/2020/09/12/%E5%91%8A%E5%88%AB%E9%AD%94%E6%B3%95%E6%95%B0%E5%AD%97/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ä»¥å¾€çš„å¼€å‘ä¸­å¾€å¾€ä¼šå‡ºç°ç±»ä¼¼ä»¥ä¸‹çš„ä»£ç </p> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(status === <span class="number">1</span>) &#123;</span><br><span class="line">   <span class="comment">// do something</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(status === <span class="number">2</span>) &#123;</span><br><span class="line">   <span class="comment">// do something</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (status === <span class="number">3</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­çš„ <code>1</code>ï¼Œ<code>2</code>ï¼Œ<code>3</code>å°±æ˜¯æ‰€è°“çš„é­”æ³•æ•°å­—ï¼Œå³æ²¡æœ‰æ³¨é‡Šçš„æƒ…å†µä¸‹æˆ‘ä»¬å¾ˆéš¾çŸ¥é“ 1ï¼Œ2ï¼Œ3 ä»£è¡¨çš„åˆ°åº•æ˜¯ä»€ä¹ˆ statusã€‚</p><a id="more"></a><h4 id="å¸¸é‡å¯¹è±¡"><a href="#å¸¸é‡å¯¹è±¡" class="headerlink" title="å¸¸é‡å¯¹è±¡"></a>å¸¸é‡å¯¹è±¡</h4><p>åœ¨ javascript ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›æ•°å­—ç»´æŠ¤åœ¨ä¸€ä¸ªå¸¸é‡å¯¹è±¡ä¸­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> STATUS = &#123;</span><br><span class="line">  ERROR: <span class="number">1</span>,</span><br><span class="line">  NORMAL: <span class="number">2</span>,</span><br><span class="line">  SUCCESS: <span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ—¶å°±å¯ä»¥ä½¿ç”¨ STATUS.ERROR æ¥æ›¿æ¢æ‰ 1ã€‚</p><p>è¿™æ ·å¯ä»¥å¾ˆæ¸…æ™°å°±åˆ†æ¸…æ¥š 1ï¼Œ2ï¼Œ3 è¿™äº›æ•°å€¼å¯¹åº”çš„æ˜¯ä»€ä¹ˆå«ä¹‰ã€‚åŒæ—¶å¦‚æœå°†æ¥ ERROR ä¸å†æ˜¯ 1ï¼Œæˆ‘ä»¬ä¹Ÿåªéœ€è¦ç»´æŠ¤ STATUS å³å¯ã€‚</p><h4 id="Enums"><a href="#Enums" class="headerlink" title="Enums"></a>Enums</h4><h4 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h4><p>è€Œåœ¨ TypeScript ä¸­ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥ä½¿ç”¨æšä¸¾ç±»å‹æ¥ç»´æŠ¤è¿™äº›æ•°å€¼ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> STATUS &#123;</span><br><span class="line">  ERROR = <span class="number">1</span>,</span><br><span class="line">  NORMAL,</span><br><span class="line">  SUCCESS</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ—¶åŒæ ·æ˜¯ STATUS.ERROR æ›¿æ¢æ‰ 1 å³å¯ã€‚</p><p>å…³äº enums çš„ä½¿ç”¨<a href="https://www.tslang.cn/docs/handbook/enums.html" target="_blank" rel="noopener">æ–‡æ¡£</a>é‡Œæè¿°çš„å·²ç»å¾ˆæ¸…æ¥šï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p><h4 id="åå‘æ˜ å°„"><a href="#åå‘æ˜ å°„" class="headerlink" title="åå‘æ˜ å°„"></a>åå‘æ˜ å°„</h4><p>å€¼å¾—ä¸€æçš„æ˜¯ enums æä¾›äº†å¸¸é‡å¯¹è±¡ä¸å…·å¤‡çš„åå‘æ˜ å°„ï¼ˆvalue<code>-&gt;</code>name ï¼‰ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> STATUS = &#123;</span><br><span class="line">  ERROR: <span class="number">1</span>,</span><br><span class="line">  NORMAL: <span class="number">2</span>,</span><br><span class="line">  SUCCESS: <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºï¼š"ERROR"</span></span><br><span class="line">STATUS[<span class="number">1</span>]</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸º ts å°†ä¸Šè¿°çš„ enums ç¼–è¯‘æˆä»¥ä¸‹ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> STATUS;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">STATUS</span>) </span>&#123;</span><br><span class="line">  STATUS[STATUS[<span class="string">"ERROR"</span>] = <span class="number">1</span>] = <span class="string">"ERROR"</span>;</span><br><span class="line">  STATUS[STATUS[<span class="string">"NORMAL"</span>] = <span class="number">2</span>] = <span class="string">"NORMAL"</span>;</span><br><span class="line">  STATUS[STATUS[<span class="string">"SUCCESS"</span>] = <span class="number">3</span>] = <span class="string">"SUCCESS"</span>;</span><br><span class="line">&#125;)(STATUS || (STATUS = &#123;&#125;));</span><br></pre></td></tr></table></figure><p>âš ï¸ ä½†å¦‚æœæ˜¯å­—ç¬¦ä¸²æšä¸¾æˆå‘˜åˆ™ä¸ä¼šç”Ÿæˆåå‘æ˜ å°„ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> STATUS &#123;</span><br><span class="line">  ERROR = <span class="string">"1"</span>,</span><br><span class="line">  NORMAL = <span class="string">"2"</span>,</span><br><span class="line">  SUCCESS = <span class="string">"3"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç¼–è¯‘å</span></span><br><span class="line"><span class="keyword">var</span> STATUS;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">STATUS</span>) </span>&#123;</span><br><span class="line">  STATUS[<span class="string">"ERROR2"</span>] = <span class="string">"1"</span>;</span><br><span class="line">  STATUS[<span class="string">"NORMAL"</span>] = <span class="string">"2"</span>;</span><br><span class="line">  sSTATUS[<span class="string">"SUCCESS"</span>] = <span class="string">"3"</span>;</span><br><span class="line">&#125;)(STATUS || (STATUS = &#123;&#125;));</span><br></pre></td></tr></table></figure><p>å¹¶ä¸”å¯¹äºé‡å¤å®šä¹‰çš„æšä¸¾ç±»å‹ï¼Œå°†ä¼šåˆå¹¶æˆå‘˜ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> STATUS &#123;</span><br><span class="line">  ERROR = <span class="number">1</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> STATUS &#123;</span><br><span class="line">  NORMAL = <span class="number">2</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç­‰æ•ˆäº</span></span><br><span class="line"><span class="keyword">enum</span> STATUS &#123;</span><br><span class="line">  ERROR = <span class="number">1</span>,</span><br><span class="line">  NORMAL = <span class="number">2</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="const-æšä¸¾"><a href="#const-æšä¸¾" class="headerlink" title="const æšä¸¾"></a>const æšä¸¾</h4><p>å…³äºæšä¸¾ï¼Œè¿˜æœ‰ä¸€ç§ä¸æ˜¯å¸¸è§çš„å†™æ³•</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">enum</span> STATUS &#123;</span><br><span class="line">  ERROR = <span class="number">1</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å³å£°æ˜å‰æœ‰ä¸ªå…³é”®å­— constã€‚</p><p>ä¸å¸¸è§„æšä¸¾ä¸åŒçš„åœ°æ–¹åœ¨äº</p><ol><li>const æšä¸¾ä¸ä¼šç¼–è¯‘å‡ºé¢å¤–çš„ä»£ç </li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">enum</span> STATUS &#123;</span><br><span class="line">  ERROR = <span class="number">1</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(STATUS.ERROR)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€ç»ˆçš„ç¼–è¯‘å‡ºçš„ä»£ç ä¸åŒ…å« STATUS</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span> <span class="comment">/* ERROR */</span>);</span><br></pre></td></tr></table></figure><ol start="2"><li>ä¹Ÿæ­£å› ä¸ºç¼–è¯‘é˜¶æ®µå°±ä¼šç¡®å®šä¸‹æšä¸¾çš„æˆå‘˜ï¼Œconst æšä¸¾ä¸å¯ä»¥åŒ…å«è®¡ç®—æˆå‘˜</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> geterror = <span class="function"><span class="params">()</span> =&gt;</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">enum</span> STATUS &#123;</span><br><span class="line">  <span class="comment">// In 'const' enum declarations member initializer must be constant expression.</span></span><br><span class="line">  ERROR = geterror()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºå›¾ç‰‡</title>
      <link href="/2020/09/11/%E5%85%B3%E4%BA%8E%E5%9B%BE%E7%89%87/"/>
      <url>/2020/09/11/%E5%85%B3%E4%BA%8E%E5%9B%BE%E7%89%87/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>React æ³›å‹ç»„ä»¶</title>
      <link href="/2020/09/08/React%20%E6%B3%9B%E5%9E%8B%E7%BB%84%E4%BB%B6/"/>
      <url>/2020/09/08/React%20%E6%B3%9B%E5%9E%8B%E7%BB%84%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>åœºæ™¯ï¼šå°è£…ä¸€ä¸ª antd çš„ Radio ç»„ä»¶æ—¶ï¼Œéœ€è¦ä»çˆ¶ç»„ä»¶è·å–åˆ° value çš„ç±»å‹ã€‚å…¶ props æ¥å£å®šä¹‰å¦‚ä¸‹</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> CustomRadioProps&lt;ValueType&gt; &#123;</span><br><span class="line">  options: Option&lt;ValueType&gt;[];</span><br><span class="line">  value: ValueType;</span><br><span class="line">  onChange: <span class="function">(<span class="params">value: ValueType</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ—¶è¿™é‡Œå‡è®¾ä¼ è¿›å»çš„æ˜¯ä¸ª number ç±»å‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;CustomRadio&lt;number&gt;</span><br><span class="line">  onChange&#x3D;&#123;handleTypeChange&#125;</span><br><span class="line">  options&#x3D;&#123;[</span><br><span class="line">    &#123;</span><br><span class="line">      label: &#39;1&#39;,</span><br><span class="line">      value: 1,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      label: &#39;1&#39;,</span><br><span class="line">      value: 2,</span><br><span class="line">    &#125;,</span><br><span class="line">  ]&#125;</span><br><span class="line">  value&#x3D;&#123;1&#125;</span><br><span class="line">&#x2F;&gt;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆè¿™ä¸ª CustomRadioProps ç§°ä¸ºæ³›å‹ç»„ä»¶ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•å®šä¹‰ä¸€ä¸ªæ³›å‹ç»„ä»¶ï¼Ÿ</p><a id="more"></a><h4 id="ç±»ç»„ä»¶"><a href="#ç±»ç»„ä»¶" class="headerlink" title="ç±»ç»„ä»¶"></a>ç±»ç»„ä»¶</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class CustomRadio&lt;T&gt; extends React.Component&lt;Props&lt;T&gt;&gt; &#123; </span><br><span class="line">&#x2F;&#x2F; ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å‡½æ•°ç»„ä»¶"><a href="#å‡½æ•°ç»„ä»¶" class="headerlink" title="å‡½æ•°ç»„ä»¶"></a>å‡½æ•°ç»„ä»¶</h4><p>å¯¹äºç”¨ function å£°æ˜çš„å‡½æ•°å¼ç»„ä»¶å®é™…ä¸Šäºæ³›å‹å‡½æ•°æ˜¯ä¸€æ ·çš„å†™æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CustomRadio</span>&lt;<span class="title">T</span>&gt;(<span class="params">props: IProps&lt;T&gt;</span>) </span>&#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶è€Œå¯¹äºç”¨ç®­å¤´å‡½æ•°ä¸å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const CustomRadio: React.FunctionComponent&lt;IProps&lt;T&gt;&gt; &#x3D; props &#x3D;&gt; &#123; &#x2F;*...*&#x2F; &#125;</span><br></pre></td></tr></table></figure><p>ç®­å¤´å‡½æ•°ç»„ä»¶æ­£ç¡®çš„å†™æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const IconRadioGroup &#x3D; &lt;T extends any&gt;(props: IProps&lt;T&gt;) &#x3D;&gt; &#123;</span><br><span class="line">&#x2F;&#x2F; ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ T å¿…é¡»è¦ä½¿ç”¨ extends, ç”¨ <code>T extends any</code> æ¥è¡¨æ˜æ¥æ”¶ä»»æ„ç±»å‹ï¼Œå¦‚æœåªèƒ½ number æˆ–è€… stringç±»å‹ï¼Œåˆ™æ”¹æˆ  <code>T extends numberï½œstring</code> å³å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jsè·å–åç¼€å</title>
      <link href="/2020/09/02/js%E8%8E%B7%E5%8F%96%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E5%90%8D/"/>
      <url>/2020/09/02/js%E8%8E%B7%E5%8F%96%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E5%90%8D/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>Code Review çš„æ—¶å€™çœ‹åˆ°å°ä¼™ä¼´æäº¤äº†ä¸€æ®µç”¨äºæå–æ–‡ä»¶æ‹“å±•åçš„ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æˆªå–å›¾ç‰‡åç¼€ä¿¡æ¯</span></span><br><span class="line"><span class="comment">// example: 'www.baidu.com/somepic.jpg?h/w/'</span></span><br><span class="line"><span class="comment">// return: '.jpg'</span></span><br><span class="line"><span class="keyword">const</span> getExtension = <span class="function">(<span class="params">url = <span class="string">''</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> end = url.indexOf(<span class="string">'?'</span>) || <span class="literal">undefined</span>;</span><br><span class="line">  <span class="keyword">const</span> start = url.lastIndexOf(<span class="string">'.'</span>, end);</span><br><span class="line">  <span class="keyword">return</span> url.substring(start, end);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™ç§å†™æ³•å›ºç„¶æ²¡é”™ï¼Œé‚£ä¹ˆæ˜¯å¦æœ‰åˆ«çš„å†™æ³•å˜?</p><a id="more"></a><h4 id="æ–¹æ¡ˆä¸€"><a href="#æ–¹æ¡ˆä¸€" class="headerlink" title="æ–¹æ¡ˆä¸€"></a>æ–¹æ¡ˆä¸€</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getExtension = <span class="function">(<span class="params">url = <span class="string">''</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> extensionName = url.split(<span class="string">'.'</span>).pop()</span><br><span class="line">  <span class="keyword">return</span> extensionName ? <span class="string">`.<span class="subst">$&#123;extensionName&#125;</span>`</span> : <span class="string">''</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ–¹æ¡ˆäºŒ"><a href="#æ–¹æ¡ˆäºŒ" class="headerlink" title="æ–¹æ¡ˆäºŒ"></a>æ–¹æ¡ˆäºŒ</h4><p>æ­£åˆ™è¡¨è¾¾å¼</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getExtension = <span class="function">(<span class="params">url = <span class="string">''</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> matches = url.match(<span class="regexp">/.*(\.[^?]+)/</span>)</span><br><span class="line">  <span class="keyword">return</span> matches ? matches[<span class="number">1</span>] : <span class="string">''</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯èƒ½æœ‰äº›åŒå­¦å¯¹æ­£åˆ™ä¸å¤ªç†Ÿæ‚‰ï¼Œä»¥ä¸‹å¯¹è¿™ä¸ªæ­£åˆ™åšä¸€ä¸‹è§£é‡Šï¼š</p><ol><li><code>.*</code>ï¼š . è¡¨ç¤ºéæ¢è¡Œç¬¦å·ï¼Œ * ç”¨äºæ¶ˆè€—å°½å¯èƒ½å¤šçš„å­—ç¬¦</li><li><code>()</code> æ‹¬å·è¡¨ç¤ºæ•è·ç»„ï¼Œè¿™é‡Œ <code>()</code> ä¸­çš„è¡¨è¾¾å¼å°±æ˜¯ç”¨äºæ•è·åç¼€åã€‚</li><li><code>\.</code> è¡¨ç¤º . çš„è½¬ä¹‰</li><li><code>[^\?+]</code>: ^ è¡¨ç¤ºéï¼Œ + è¡¨ç¤ºä¸€ä¸ªæˆ–è€…å¤šä¸ªã€‚å› æ­¤ <code>[^?+]</code> å³è¡¨ç¤ºé ï¼Ÿçš„å¤šä¸ªå­—ç¬¦</li></ol><h4 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h4><p>å¦‚æœæ˜¯åœ¨ node çš„ç¯å¢ƒï¼Œæœ¬åœ°çš„æ–‡ä»¶åå¯ä»¥é€šè¿‡ path æ¨¡å—æä¾›çš„ extname è·å–ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; extname &#125; = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(extname(<span class="string">'some-pic.jpg'</span>))</span><br><span class="line"><span class="comment">// .jpg</span></span><br></pre></td></tr></table></figure><p>é‚£å¦‚æœæ˜¯è¿œç¨‹åœ°å€å‘¢ï¼Ÿå¯ä»¥é€šè¿‡ url æ¨¡å—å¾—åˆ° pathname ä¹‹åå†ç”¨ extname æ¥è·å–ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; extname &#125; = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; parse &#125; = <span class="built_in">require</span>(<span class="string">'url'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getExtension = <span class="function">(<span class="params">url = <span class="string">''</span></span>) =&gt;</span> extname(parse(url).pathname)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TypeScriptä¸­çš„constæ–­è¨€</title>
      <link href="/2020/08/26/TypeScript%E4%B8%AD%E7%9A%84const%E6%96%AD%E8%A8%80/"/>
      <url>/2020/08/26/TypeScript%E4%B8%AD%E7%9A%84const%E6%96%AD%E8%A8%80/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>æœ€è¿‘åœ¨ä½¿ç”¨ ant design çš„ Table ç»„ä»¶ï¼Œé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå®šä¹‰ Table çš„ columns å±æ€§å¦‚ä¸‹ï¼š</p><a id="more"></a><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> columns: ColumnProps&lt;MyRecord&gt;[] = [&#123;</span><br><span class="line">  title: <span class="string">'ID'</span>,</span><br><span class="line">  dataIndex: <span class="string">'id'</span>,</span><br><span class="line">  align: <span class="string">'center'</span>,</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ TS æç¤ºï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Types of property <span class="string">'align'</span> are incompatible.</span><br><span class="line">       <span class="built_in"> Type </span><span class="string">'string'</span> is <span class="keyword">not</span> assignable <span class="keyword">to</span><span class="built_in"> type </span><span class="string">'"right" | "left" | "center" | undefined'</span>.  TS2322</span><br></pre></td></tr></table></figure><h4 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h4><p>ç»è¿‡æŸ¥çœ‹ä»£ç å‘ç°ï¼Œ ColumnProps çš„ align å±æ€§çš„å®é™…ç»§æ‰¿è‡ª ColumnSharedTypeï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> ColumnSharedType&lt;RecordType&gt; &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    align?: AlignType;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">declare</span> <span class="keyword">type</span> AlignType = <span class="string">'left'</span> | <span class="string">'center'</span> | <span class="string">'right'</span>;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯ column ä¸­çš„ align çš„ç±»å‹ä¸º stringï¼Œè€Œ string æ— æ³• cast åˆ° AlignTypeã€‚å³ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> AlignType = <span class="string">'left'</span> | <span class="string">'center'</span> | <span class="string">'right'</span>;</span><br><span class="line"><span class="keyword">let</span> align: AlignType | <span class="literal">undefined</span></span><br><span class="line"><span class="keyword">let</span> myAlign = <span class="string">"center"</span></span><br><span class="line"><span class="comment">// Type 'string' is not assignable to type '"left" | "right" | "center" | undefined'.ts(2322)</span></span><br><span class="line">align = myAlign</span><br></pre></td></tr></table></figure><h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p>TypeScript 3.4 ç‰ˆæœ¬ä»¥ä¸Šæä¾›äº† const æ–­è¨€ï¼Œå¯ä»¥é€šè¿‡ as const æ¥æ¶ˆé™¤ä»¥ä¸ŠæŠ¥é”™ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> columns: ColumnProps&lt;MyRecord&gt;[] = [&#123;</span><br><span class="line">  title: <span class="string">'ID'</span>,</span><br><span class="line">  dataIndex: <span class="string">'id'</span>,</span><br><span class="line">  align: <span class="string">'center'</span> <span class="keyword">as</span> <span class="keyword">const</span>,</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure><h4 id="const-assertions"><a href="#const-assertions" class="headerlink" title="const assertions"></a>const assertions</h4><p>ä»¥ä¸‹å†…å®¹ç¿»è¯‘è‡ª <a href="https://devblogs.microsoft.com/typescript/announcing-typescript-3-4-rc/" target="_blank" rel="noopener">https://devblogs.microsoft.com/typescript/announcing-typescript-3-4-rc/</a> ä¸­çš„ <code>const</code> assertionsã€‚(ç¿»è¯‘ä¸åŠ¨çš„åœ°æ–¹ä¼šè´´ä¸ŠåŸæ–‡)</p><p>å½“å£°æ˜ä¸€ä¸ªå¯å˜çš„å˜é‡æˆ–è€…å±æ€§æ—¶ï¼ŒTypeScript ç»å¸¸æ‹“å®½å€¼ä»¥ç¡®ä¿æˆ‘ä»¬å¯ä»¥åœ¨ä¸å†™æ˜ç¡®åˆ‡çš„ç±»å‹çš„æƒ…å†µä¸‹è¿›è¡Œèµ‹å€¼ã€‚</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x = <span class="string">"hello"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ‘ä»¬å¯ä»¥ç»™ x èµ‹å€¼</span></span><br><span class="line">x = <span class="string">"world"</span>;</span><br></pre></td></tr></table></figure><p>ä¸¥æ ¼æ¥è¯´ï¼Œæ¯ä¸€ä¸ªå­—é¢é‡éƒ½æœ‰å…¶å­—é¢ç±»å‹ã€‚ä¸Šé¢çš„ x åœ¨ç±»å‹æ¨æ–­æ—¶ï¼Œç”± <code>&quot;hello&quot;</code> ç±»å‹è½¬ä¸ºæ›´ä¸º widen çš„ <code>string</code> ç±»å‹ã€‚</p><p>ç›¸å¯¹è€Œè¨€ï¼Œå¦‚æœ x åŸå§‹å­—é¢é‡ç±»å‹ä¸º â€œhelloâ€ï¼Œ é‚£ä¹ˆæˆ‘ä»¬å°±æ— æ³•å°† x èµ‹å€¼ä¸º â€œworldâ€:</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x: <span class="string">"hello"</span> = <span class="string">"hello"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// error!</span></span><br><span class="line">x = <span class="string">"world"</span>;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æƒ…å†µçœ‹èµ·æ¥æ¯”è¾ƒæç«¯ï¼Œä½†æ˜¯åœ¨ä¸€äº›æƒ…å†µä¸‹æ¯”è¾ƒæœ‰ç”¨çš„ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬ç»å¸¸åˆ›å»ºä¸€ä¸ªè”åˆå±æ€§çš„å¯¹è±¡ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Shape =</span><br><span class="line">    | &#123; kind: <span class="string">"circle"</span>, radius: <span class="built_in">number</span> &#125;</span><br><span class="line">    | &#123; kind: <span class="string">"square"</span>, sideLength: <span class="built_in">number</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getShapes</span>(<span class="params"></span>): <span class="title">readonly</span> <span class="title">Shape</span>[] </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result = [</span><br><span class="line">        &#123; kind: <span class="string">"circle"</span>, radius: <span class="number">100</span>, &#125;,</span><br><span class="line">        &#123; kind: <span class="string">"square"</span>, sideLength: <span class="number">50</span>, &#125;,</span><br><span class="line">    ];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Some terrible error message because TypeScript inferred</span></span><br><span class="line">    <span class="comment">// 'kind' to have the type 'string' instead of</span></span><br><span class="line">    <span class="comment">// either '"circle"' or '"square"'.</span></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä¿®æ”¹æ€§æ˜¯ TypeScript æ–­å®šä»€ä¹ˆæ—¶å€™ widen ç±»å‹çš„é‡è¦å› ç´ ï¼Œè€Œéåˆ†ææ‰€æœ‰ä»£ç ã€‚ï¼ˆMutability is one of the best heuristics of intent which TypeScript can use to determine when to widen (rather than analyzing our entire program).ï¼‰</p><p>æ­£å¦‚ä¸Šè¿°ä¾‹å­ï¼Œä¸å¹¸çš„æ˜¯ï¼ŒJavaScript ä¸­çš„å±æ€§é»˜è®¤å¯ä¿®æ”¹ã€‚è¿™æ„å‘³ç€ç»å¸¸ä¼šæœ‰ä¸å¿…è¦çš„ widen ç±»å‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç‰¹å®šçš„åœ°æ–¹å¯¹ç±»å‹è¿›è¡Œç¡®åˆ‡çš„å£°æ˜ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getShapes</span>(<span class="params"></span>): <span class="title">readonly</span> <span class="title">Shape</span>[] </span>&#123;</span><br><span class="line">  <span class="comment">// This explicit annotation gives a hint</span></span><br><span class="line">  <span class="comment">// to avoid widening in the first place.</span></span><br><span class="line">  <span class="keyword">let</span> result: readonly Shape[] = [</span><br><span class="line">  &#123; kind: <span class="string">"circle"</span>, radius: <span class="number">100</span>, &#125;,</span><br><span class="line">  &#123; kind: <span class="string">"square"</span>, sideLength: <span class="number">50</span>, &#125;,</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°çš„æ–¹æ³•å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯å½“æ•°æ®ç»“æ„è¶Šæ¥è¶Šå¤æ‚çš„æ—¶å€™ï¼Œè¿™ç§æ–¹å¼å°†ä¼šæ˜¾çš„ç¬¨é‡ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒTypeScript 3.4 ä¸ºå­—é¢å€¼å¼•å…¥äº† const æ–­è¨€ã€‚å®ƒçš„è¯­æ³•æ˜¯ä¸€ç§ç±»å‹æ–­è¨€ï¼Œä¾‹å¦‚ <code>123 as const</code>ã€‚å½“æˆ‘ä»¬è¿™ä¹ˆä½¿ç”¨çš„æ—¶å€™ï¼Œæ„å‘³ç€ï¼š</p><ol><li>å­—é¢é‡ç±»å‹ä¸ä¼šè¢« widenï¼Œå¦‚ä¸ä¼šä» â€œhelloâ€ å˜æˆ string</li><li>å¯¹è±¡å­—é¢é‡çš„å±æ€§å€¼ä¸ºåªè¯»</li><li>æ•°ç»„å­—é¢é‡å˜æˆåªè¯»å…ƒç»„</li></ol><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Type '10'</span></span><br><span class="line"><span class="keyword">let</span> x = <span class="number">10</span> <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Type 'readonly [10, 20]'</span></span><br><span class="line"><span class="keyword">let</span> y = [<span class="number">10</span>, <span class="number">20</span>] <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Type '&#123; readonly text: "hello" &#125;'</span></span><br><span class="line"><span class="keyword">let</span> z = &#123; text: <span class="string">"hello"</span> &#125; <span class="keyword">as</span> <span class="keyword">const</span>;</span><br></pre></td></tr></table></figure><p>åœ¨ tsx æ–‡ä»¶ä»¥å¤–ï¼Œè¿˜å¯ä»¥è¿™ä¹ˆä½¿ç”¨ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Type '10'</span></span><br><span class="line"><span class="keyword">let</span> x = &lt;<span class="keyword">const</span>&gt;<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Type 'readonly [10, 20]'</span></span><br><span class="line"><span class="keyword">let</span> y = &lt;<span class="keyword">const</span>&gt;[<span class="number">10</span>, <span class="number">20</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Type '&#123; readonly text: "hello" &#125;'</span></span><br><span class="line"><span class="keyword">let</span> z = &lt;<span class="keyword">const</span>&gt;&#123; text: <span class="string">"hello"</span> &#125;;</span><br></pre></td></tr></table></figure><p>This feature often means that types that would otherwise be used just to hint immutability to the compiler can often be omitted.</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Works with no types referenced or declared.</span></span><br><span class="line"><span class="comment">// We only needed a single const assertion.</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getShapes</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> result = [</span><br><span class="line">        &#123; kind: <span class="string">"circle"</span>, radius: <span class="number">100</span>, &#125;,</span><br><span class="line">        &#123; kind: <span class="string">"square"</span>, sideLength: <span class="number">50</span>, &#125;,</span><br><span class="line">    ] <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> shape of getShapes()) &#123;</span><br><span class="line">    <span class="comment">// Narrows perfectly!</span></span><br><span class="line">    <span class="keyword">if</span> (shape.kind === <span class="string">"circle"</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Circle radius"</span>, shape.radius);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Square side length"</span>, shape.sideLength);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ä¸Šé¢æ— éœ€ç±»å‹å£°æ˜ï¼Œconst æ–­è¨€å…è®¸ ts ä½¿ç”¨æœ€ç²¾ç¡®çš„è¡¨è¾¾å¼ç±»å‹ã€‚</p><h5 id="è­¦å‘Š"><a href="#è­¦å‘Š" class="headerlink" title="è­¦å‘Š"></a>è­¦å‘Š</h5><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œconst æ–­è¨€åªèƒ½ä½¿ç”¨åœ¨ç®€å•çš„å­—é¢è¡¨è¾¾å¼ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Error!</span></span><br><span class="line"><span class="comment">//   A 'const' assertion can only be applied to a string, number, boolean, array, or object literal.</span></span><br><span class="line"><span class="keyword">let</span> a = (<span class="built_in">Math</span>.random() &lt; <span class="number">0.5</span> ? <span class="number">0</span> : <span class="number">1</span>) <span class="keyword">as</span> <span class="keyword">const</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Works!</span></span><br><span class="line"><span class="keyword">let</span> b = <span class="built_in">Math</span>.random() &lt; <span class="number">0.5</span> ?</span><br><span class="line">    <span class="number">0</span> <span class="keyword">as</span> <span class="keyword">const</span> :</span><br><span class="line">    <span class="number">1</span> <span class="keyword">as</span> <span class="keyword">const</span>;</span><br></pre></td></tr></table></figure><p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œconst ä¸ä¼šå°†è¡¨è¾¾å¼è½¬å˜ä¸ºå®Œå…¨ä¸å¯å˜ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">et arr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> foo = &#123;</span><br><span class="line">    name: <span class="string">"foo"</span>,</span><br><span class="line">    contents: arr,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">foo.name = <span class="string">"bar"</span>;   <span class="comment">// error!</span></span><br><span class="line">foo.contents = [];  <span class="comment">// error!</span></span><br><span class="line"></span><br><span class="line">foo.contents.push(<span class="number">5</span>); <span class="comment">// ...works!</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸å˜çš„æ‰¿è¯º Promise</title>
      <link href="/2020/08/25/%E4%B8%8D%E5%8F%98%E7%9A%84%E6%89%BF%E8%AF%BA%20Promise/"/>
      <url>/2020/08/25/%E4%B8%8D%E5%8F%98%E7%9A%84%E6%89%BF%E8%AF%BA%20Promise/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>Promise æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥è§£å†³å‰ç«¯çš„å›è°ƒåœ°ç‹±ã€‚ä»¥ä¸‹æ ¹æ® <a href="https://es6.ruanyifeng.com/?search=promise&x=0&y=0#docs/promise" target="_blank" rel="noopener">ES6 å…¥é—¨</a> ç®€å•è¿‡ä¸€ä¸‹ Promise çš„åŸºç¡€åŠä¸ªäººçš„ä¸€äº›è§è§£è¡¥å……ï¼ŒåŒæ—¶å°è¯•å®ç°ä¸€ä¸ªç¬¦åˆ PromiseA+ è§„èŒƒçš„ Promiseã€‚</p> <a id="more"></a><h4 id="Promise-åŸºç¡€"><a href="#Promise-åŸºç¡€" class="headerlink" title="Promise åŸºç¡€"></a>Promise åŸºç¡€</h4><h5 id="Promise-çš„çŠ¶æ€"><a href="#Promise-çš„çŠ¶æ€" class="headerlink" title="Promise çš„çŠ¶æ€"></a>Promise çš„çŠ¶æ€</h5><p>Promise åªæœ‰ä¸‰ç§çŠ¶æ€ï¼š<code>pending</code>ï¼ˆè¿›è¡Œä¸­ï¼‰ï¼Œ<code>fulfilled</code>ï¼ˆå·²æˆåŠŸï¼‰å’Œ <code>rejected</code>ï¼ˆå·²å¤±è´¥ï¼‰ã€‚</p><p>Promise çš„çŠ¶æ€æ”¹å˜åªæœ‰ä¸¤ç§æƒ…å†µï¼š</p><p><code>pending</code> åˆ° <code>fulfilled</code> ä»¥åŠ <code>pending</code> åˆ° <code>rejected</code>ã€‚å½“çŠ¶æ€å˜æˆ  <code>fulfilled</code> æˆ– <code>rejected</code>æ—¶ï¼Œæˆ‘ä»¬å°±ç§°è¿™ä¸ª Promise  <code>resolved</code>ã€‚</p><p>âš ï¸ æˆ‘ä»¬é€šå¸¸è¯´çš„ resolved ä»…æŒ‡ä»£ <code>fulfilled</code>ï¼Œä¸åŒ…æ‹¬ <code>rejected</code>ã€‚</p><h5 id="æ„é€ ä¸€ä¸ª-Promise"><a href="#æ„é€ ä¸€ä¸ª-Promise" class="headerlink" title="æ„é€ ä¸€ä¸ª Promise"></a>æ„é€ ä¸€ä¸ª Promise</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ... some code</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="comment">/* å¼‚æ­¥æ“ä½œæˆåŠŸ */</span>)&#123;</span><br><span class="line">    resolve(value);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="promise-then"><a href="#promise-then" class="headerlink" title="promise.then"></a>promise.then</h5><p>Promise çš„å®ä¾‹æ‹¥æœ‰ then æ–¹æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">promise.then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// success</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// failure</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>âš ï¸  Promise æ–°å»ºåç«‹å³æ‰§è¡Œï¼Œè€Œ then æ–¹æ³•åˆ™å±äºå¾®ä»»åŠ¡çš„å›è°ƒï¼Œæ‰§è¡Œæ—¶æœºä¸ºå®ä»»åŠ¡æ‰§è¡Œä¹‹åï¼Œå…·ä½“çš„äº‹ä»¶å¾ªç¯æœºåˆ¶åé¢å¼€æ–°å‘æ€»ç»“ã€‚</p><h5 id="resolve"><a href="#resolve" class="headerlink" title="resolve"></a>resolve</h5><p>æ„é€  Promise æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•° resolve å‡½æ•°æ‰€æ¥æ”¶çš„å‚æ•°ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæ™®é€šçš„å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª promiseã€‚å¦‚æœæ¥æ”¶çš„æ˜¯ä¸€ä¸ª promise å®ä¾‹ï¼Œé‚£ä¹ˆ promise çš„çŠ¶æ€å–å†³äº resolve æ¥æ”¶çš„ promise çš„çŠ¶æ€ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'fail'</span>)), <span class="number">3000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> resolve(p1), <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">p2</span><br><span class="line">  .then(<span class="function"><span class="params">result</span> =&gt;</span> <span class="built_in">console</span>.log(result))</span><br><span class="line">  .catch(<span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">console</span>.log(error))</span><br><span class="line"><span class="comment">// 3s åè¾“å‡ºï¼šError: fail</span></span><br></pre></td></tr></table></figure><p>è¿™æ—¶<code>p1</code>çš„çŠ¶æ€å°±ä¼šä¼ é€’ç»™<code>p2</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>p1</code>çš„çŠ¶æ€å†³å®šäº†<code>p2</code>çš„çŠ¶æ€ã€‚å¦‚æœ<code>p1</code>çš„çŠ¶æ€æ˜¯<code>pending</code>ï¼Œé‚£ä¹ˆ<code>p2</code>çš„å›è°ƒå‡½æ•°å°±ä¼šç­‰å¾…<code>p1</code>çš„çŠ¶æ€æ”¹å˜ï¼›å¦‚æœ<code>p1</code>çš„çŠ¶æ€å·²ç»æ˜¯<code>resolved</code>æˆ–è€…<code>rejected</code>ï¼Œé‚£ä¹ˆ<code>p2</code>çš„å›è°ƒå‡½æ•°å°†ä¼šç«‹åˆ»æ‰§è¡Œã€‚</p><h5 id="resolve-ä¸-return"><a href="#resolve-ä¸-return" class="headerlink" title="resolve ä¸ return"></a>resolve ä¸ return</h5><p>è°ƒç”¨<code>resolve</code>æˆ–<code>reject</code>å¹¶ä¸ä¼šç»ˆç»“ Promise çš„å‚æ•°å‡½æ•°çš„æ‰§è¡Œï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="number">1</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="params">r</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(r);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 1</span></span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æ¥è¯´ï¼Œè°ƒç”¨<code>resolve</code>æˆ–<code>reject</code>ä»¥åï¼ŒPromise çš„ä½¿å‘½å°±å®Œæˆäº†ï¼Œåç»§æ“ä½œåº”è¯¥æ”¾åˆ°<code>then</code>æ–¹æ³•é‡Œé¢ï¼Œè€Œä¸åº”è¯¥ç›´æ¥å†™åœ¨<code>resolve</code>æˆ–<code>reject</code>çš„åé¢ã€‚æ‰€ä»¥ï¼Œæœ€å¥½åœ¨å®ƒä»¬å‰é¢åŠ ä¸Š<code>return</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> resolve(<span class="number">1</span>);</span><br><span class="line">  <span class="comment">// åé¢çš„è¯­å¥ä¸ä¼šæ‰§è¡Œ</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h5 id="catch"><a href="#catch" class="headerlink" title=".catch"></a>.catch</h5><ol><li><p><code>Promise.prototype.catch()</code>æ–¹æ³•æ˜¯<code>.then(null | undefined, rejection)</code>ï¼Œç”¨äºæŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶çš„å›è°ƒå‡½æ•°ã€‚</p></li><li><p>Promise å¯¹è±¡çš„é”™è¯¯å…·æœ‰â€œå†’æ³¡â€æ€§è´¨ï¼Œä¼šä¸€ç›´å‘åä¼ é€’ï¼Œç›´åˆ°è¢«æ•è·ä¸ºæ­¢ï¼Œå³é”™è¯¯æ€»æ˜¯ä¼šè¢«ä¸‹ä¸€ä¸ª<code>catch</code>è¯­å¥æ•è·ã€‚</p></li><li><p><code>catch()</code>æ–¹æ³•è¿”å›çš„è¿˜æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå› æ­¤åé¢è¿˜å¯ä»¥æ¥ç€è°ƒç”¨<code>then()</code>ä¸ <code>catch()</code> æ–¹æ³•ã€‚</p></li><li><p>promise å†…éƒ¨çš„é”™è¯¯ä¸ä¼šæŠ›åˆ°å¤–å±‚ï¼Œå› æ­¤ <code>try/catch</code> æ— æ³•æ•è·ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">   <span class="keyword">const</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="string">'err'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'out'</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'catch you'</span>, e)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// out</span></span><br><span class="line"><span class="comment">// æœªæ•è·çš„å¼‚å¸¸ï¼šUncaught (in promise) err</span></span><br></pre></td></tr></table></figure><p>å› æ­¤æœ€å¥½ promise åéƒ½ç”¨ catch æ¥æ•è·ã€‚</p></li></ol><h5 id="finally"><a href="#finally" class="headerlink" title=".finally()"></a>.finally()</h5><ul><li>ES2018 å¼•å…¥ï¼Œå³ä¸ç®¡ Promise å¯¹è±¡æœ€åçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œã€‚</li><li><code>finally</code>æ–¹æ³•çš„å›è°ƒå‡½æ•°ä¸æ¥å—ä»»ä½•å‚æ•°</li></ul><h4 id="æ‰‹å†™ä¸€ä¸ªç®€æ˜“çš„-Promise"><a href="#æ‰‹å†™ä¸€ä¸ªç®€æ˜“çš„-Promise" class="headerlink" title="æ‰‹å†™ä¸€ä¸ªç®€æ˜“çš„ Promise"></a>æ‰‹å†™ä¸€ä¸ªç®€æ˜“çš„ Promise</h4><p>æ‰‹å†™ä¸€ä¸ªç¬¦åˆ PromiseA+ è§„èŒƒçš„ Promise å¹¶ä¸ç®€å•ï¼Œå¯ä»¥å…ˆç®€å•æ ¹æ®ä¸Šè¿° promise çš„åŸºæœ¬åŠŸèƒ½å®ç°ä¸€ä¸ª<strong>ç®€æ˜“ç‰ˆæœ¬</strong>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> PENDING = <span class="string">'pending'</span></span><br><span class="line"><span class="keyword">const</span> RESOLVED = <span class="string">'resolved'</span></span><br><span class="line"><span class="keyword">const</span> REJECTED = <span class="string">'rejected'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPromise</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(fn) &#123;</span><br><span class="line">    <span class="keyword">this</span>.state = PENDING</span><br><span class="line">    <span class="comment">// æ”¶é›† .then ä¸­çš„ resolve çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">    <span class="keyword">this</span>.resolveCallbacks = []</span><br><span class="line">    <span class="comment">// æ”¶é›† .then ä¸­çš„ reject çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">    <span class="keyword">this</span>.rejectCallbacks = []</span><br><span class="line">    <span class="comment">// resolve(result)</span></span><br><span class="line">    <span class="keyword">this</span>.result = <span class="literal">null</span></span><br><span class="line">    <span class="comment">// reject(reason)</span></span><br><span class="line">    <span class="keyword">this</span>.reason = <span class="literal">null</span></span><br><span class="line">    <span class="comment">// ç”±äº fn æœ‰å¯èƒ½å¼‚å¸¸ï¼Œéœ€è¦æ•è·</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// Promise ä¸€å®ä¾‹åŒ–å°±æ‰§è¡Œä¼ å…¥çš„ fn</span></span><br><span class="line">      <span class="comment">// æ³¨æ„æ­¤å¤„å°†å‡½æ•°å½“ä½œå‚æ•°ä¼ å…¥ï¼Œéœ€è¦ bind ç»‘å®šä¸Šä¸‹æ–‡</span></span><br><span class="line">      <span class="comment">// æˆ–è€… resolve / reject ç”¨ç®­å¤´å‡½æ•°å®ç°</span></span><br><span class="line">      fn(<span class="keyword">this</span>.resolve.bind(<span class="keyword">this</span>), <span class="keyword">this</span>.reject.bind(<span class="keyword">this</span>))</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="keyword">this</span>.reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  resolve(result) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state === PENDING) &#123;</span><br><span class="line">      <span class="comment">// ä¿®æ”¹çŠ¶æ€</span></span><br><span class="line">      <span class="keyword">this</span>.state = RESOLVED</span><br><span class="line">      <span class="keyword">this</span>.result = result</span><br><span class="line">      <span class="comment">// æ‰§è¡Œ then ä¸­çš„ resolve å›è°ƒå‡½æ•°</span></span><br><span class="line">      <span class="keyword">this</span>.resolveCallbacks.forEach(<span class="function">(<span class="params">cb</span>) =&gt;</span> cb(result))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  reject(reason) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state === PENDING) &#123;</span><br><span class="line">      <span class="comment">// ä¿®æ”¹çŠ¶æ€</span></span><br><span class="line">      <span class="keyword">this</span>.state = REJECTED</span><br><span class="line">      <span class="keyword">this</span>.reason = reason</span><br><span class="line">      <span class="comment">// æ‰§è¡Œ then ä¸­çš„ reject å›è°ƒå‡½æ•°</span></span><br><span class="line">      <span class="keyword">this</span>.rejectCallbacks.forEach(<span class="function">(<span class="params">cb</span>) =&gt;</span> cb(reason))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  then(onFulfilled, onRejected) &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨ .then æ—¶å¦‚æœè¿˜åœ¨ pending åˆ™å°†å›è°ƒå…ˆå­˜èµ·æ¥ï¼Œç­‰å¾… resolve åæ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state === PENDING) &#123;</span><br><span class="line">      <span class="comment">// æ”¶é›†å›è°ƒ</span></span><br><span class="line">      <span class="keyword">this</span>.resolveCallbacks.push(onFulfilled)</span><br><span class="line">      <span class="keyword">this</span>.rejectCallbacks.push(onRejected)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœè°ƒç”¨ .then æ—¶å·²ç» resolve / reject, é‚£ä¹ˆç›´æ¥æ‰§è¡Œå¯¹åº”çš„å›è°ƒ</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state === RESOLVED) &#123;</span><br><span class="line">      onFulfilled(<span class="keyword">this</span>.result)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state === REJECTED) &#123;</span><br><span class="line">      onRejected(<span class="keyword">this</span>.reason)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myPromise = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">'resolved'</span>)</span><br><span class="line">  &#125;, <span class="number">3000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">myPromise.then(</span><br><span class="line">  (result) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result)</span><br><span class="line">  &#125;,</span><br><span class="line">  (reason) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(reason)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>Promise çš„è®¾è®¡æ€è·¯å®é™…ä¸Šå°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ï¼šæ”¶é›†å›è°ƒå‡½æ•°ï¼Œè§¦å‘é€šçŸ¥ï¼Œä¾æ¬¡æ‰§è¡Œå›è°ƒã€‚</p><p>ä¸Šè¿°ç‰ˆæœ¬è¿˜æœªèƒ½è¾¾åˆ° Promise / A+ çš„è§„èŒƒï¼Œæ¯”å¦‚ é“¾å¼è°ƒç”¨ ç­‰ã€‚</p><h4 id="ç¬¦åˆ-Promise-A-çš„-Promise"><a href="#ç¬¦åˆ-Promise-A-çš„-Promise" class="headerlink" title="ç¬¦åˆ Promise / A+ çš„ Promise"></a>ç¬¦åˆ Promise / A+ çš„ Promise</h4><p>å‚è€ƒ <a href="https://promisesaplus.com/" target="_blank" rel="noopener">Promise / A+</a> ï¼Œä»¥ä¸‹è¿˜éœ€è¦è¡¥å……ä¸‹é¢å‡ ç‚¹ï¼š</p><ol><li>then æ–¹æ³•çš„å‚æ•°å¯é€‰</li><li><code>onFulfilled</code> å’Œ <code>onRejected</code>æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ <code>setTimeout</code> æˆ– <code>setImmediate</code> ä¹‹ç±»çš„â€œå®ä»»åŠ¡â€æœºåˆ¶ï¼Œæˆ–è€…ä½¿ç”¨è¯¸å¦‚ <code>MutationObserver</code> æˆ– <code>process.nextTick</code> ä¹‹ç±»çš„â€œå¾®ä»»åŠ¡â€æœºåˆ¶æ¥å®ç°ã€‚</li><li>é“¾å¼è°ƒç”¨ ä¸ promise è§£å†³æ­¥éª¤</li></ol><h5 id="å€¼ç©¿é€"><a href="#å€¼ç©¿é€" class="headerlink" title="å€¼ç©¿é€"></a>å€¼ç©¿é€</h5><p>é’ˆå¯¹ then çš„å‚æ•°å¯é€‰è¿™ä¸€ç‚¹ï¼Œå¦‚æœ <code>onFulfilled</code>  å’Œ <code>onRejectd</code> ä¸æ˜¯å‡½æ•°ï¼Œåˆ™ä¼šè¢«å¿½ç•¥ï¼Œå¹¶ä¸”å°†å€¼ä¼ é€’ç»™ä¸‹ä¸€ä¸ª thenã€‚å³æ‰€è°“çš„å€¼ç©¿é€ï¼Œå¯¹ <code>then</code> è¿›è¡Œæ”¹é€ :</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">then(onFulfilled, onRejected) &#123;</span><br><span class="line">  <span class="comment">// å¦‚æœä¸æ˜¯å‡½æ•°ï¼Œä¼ é€’ result</span></span><br><span class="line">    onFulfilled =</span><br><span class="line">      <span class="keyword">typeof</span> onFulfilled === <span class="string">'function'</span> ? onFulfilled : <span class="function">(<span class="params">result</span>) =&gt;</span> result</span><br><span class="line">  <span class="comment">// å¦‚æœä¸æ˜¯å‡½æ•°ï¼ŒæŠ›å‡º reason</span></span><br><span class="line">    onRejected =</span><br><span class="line">      <span class="keyword">typeof</span> onRejected === <span class="string">'function'</span></span><br><span class="line">        ? onRejected</span><br><span class="line">        : <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> reason</span><br><span class="line">          &#125;</span><br><span class="line">  <span class="comment">// ... if (this.state === PENDING) ... </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç„¶å½“å‰çš„ç®€æ˜“ç‰ˆ promise è¿˜ä¸æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œå€¼ç©¿é€ä¹Ÿå°±æ— ä»è°ˆèµ·ã€‚</p><h5 id="å¼‚æ­¥æ‰§è¡Œ"><a href="#å¼‚æ­¥æ‰§è¡Œ" class="headerlink" title="å¼‚æ­¥æ‰§è¡Œ"></a>å¼‚æ­¥æ‰§è¡Œ</h5><p>åœ¨å®ç°é“¾å¼è°ƒç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬å®Œå–„ä»£ç ï¼Œä½¿å¾—<code>onFulfilled</code> å’Œ <code>onRejected</code>æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚</p><p>å½“å‰æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myPromise = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="number">1</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">myPromise.then(</span><br><span class="line">  (val) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(val)</span><br><span class="line">  &#125;,</span><br><span class="line">  (val) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(val)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">2</span>)</span><br></pre></td></tr></table></figure><p>ç°è¾“å‡º 1 å†è¾“å‡º 2ï¼Œæ˜¾ç„¶ä¸æ˜¯å¼‚æ­¥çš„ã€‚æ ¹æ® Promise/ A+ çš„è§„èŒƒï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ setTimeout æ¥æ”¹é€  resolve å’Œ reject ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">resolve(result) &#123;</span><br><span class="line">  <span class="comment">// é€šè¿‡ setTimeout æ¨¡æ‹Ÿå¼‚æ­¥</span></span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state === PENDING) &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">reject(reason) &#123;</span><br><span class="line">    <span class="comment">// é€šè¿‡ setTimeout æ¨¡æ‹Ÿå¼‚æ­¥</span></span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state === PENDING) &#123;</span><br><span class="line">       <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œè¾“å‡ºé¡ºåºå°†æ˜¯ 2, 1ã€‚ ç¬¦åˆé¢„æœŸ</p><h5 id="é“¾å¼è°ƒç”¨"><a href="#é“¾å¼è°ƒç”¨" class="headerlink" title="é“¾å¼è°ƒç”¨"></a>é“¾å¼è°ƒç”¨</h5><p>ç°åœ¨æ¥å®ç°é“¾å¼è°ƒç”¨ï¼š</p><ol><li><code>then</code> éœ€è¦è¿”å›ä¸€ä¸ª Promise</li><li><code>then</code> æ‹¿åˆ°ä¸Šä¸€æ¬¡ then çš„è¿”å›å€¼</li><li>å¦‚æœ then è¿”å›çš„æ˜¯ä¸€ä¸ª Promise åˆ™éœ€è¦ç­‰å¾…è¯¥ promise çŠ¶æ€å‘ç”Ÿå˜åŒ–åå†æ‰§è¡Œä¸‹ä¸€ä¸ª then</li></ol><p>promise2: æˆ‘ä»¬å°† then è¿”å›çš„ promise å‘½åä¸º promise2, å³ <code>promise2 = promise1.then(onFulfilled, onRejected);</code></p><p>x: å°† onFulfilled æˆ–è€… onRejected çš„è¿”å›å€¼å‘½åä¸º xï¼Œè¿™ä¸ª x å¯ä»¥æ˜¯ä¸€ä¸ª thenableã€‚</p><p>resolutionProcedure: promise è§£å†³æ­¥éª¤ã€‚å¦‚æœ <code>x</code> å…·æœ‰ thenable ç‰¹æ€§ï¼Œæˆ‘ä»¬å°±å‡è®¾ <code>x</code> çš„è¡Œä¸ºè‡³å°‘æœ‰ç‚¹åƒ promiseï¼Œå®ƒå°†è¯•å›¾ä½¿ promise æ¥æ”¶ <code>x</code> çš„çŠ¶æ€ã€‚å¦åˆ™ï¼Œå®ƒä½¿ç”¨å€¼ <code>x</code> æ‰§è¡Œ <code>promise</code>ã€‚ä¹‹æ‰€ä»¥æ˜¯ thenable æ˜¯ä¸ºäº†å¯ä»¥å…¼å®¹åˆ«çš„ promiseï¼ˆä¾‹å¦‚ fetchï¼‰ã€‚å®é™…ä¸Šè¿™ä¸ªæ–¹æ³•åœ¨ Promise / A+ ä¸­æœ‰å¾ˆå¤šæƒ…å†µåˆ†å‰ï¼Œæˆ‘ä»¬å…ˆç®€åŒ–æˆä»¥ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ†ç±»è®¨è®ºè¿”å›å€¼,å¦‚æœæ˜¯Promise,é‚£ä¹ˆç­‰å¾…PromiseçŠ¶æ€å˜æ›´, å¦åˆ™ç›´æ¥resolve</span></span><br><span class="line">x <span class="keyword">instanceof</span> MyPromise ? x.then(resolve, reject) : resolve(x)</span><br></pre></td></tr></table></figure><p>ç°åœ¨çš„ Promise å®Œæ•´ä»£ç å¦‚ä¸‹ï¼Œ<strong>æ¥è¿‘å®Œå…¨ä½“ç‰ˆæœ¬</strong>ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> PENDING = <span class="string">'pending'</span></span><br><span class="line"><span class="keyword">const</span> RESOLVED = <span class="string">'resolved'</span></span><br><span class="line"><span class="keyword">const</span> REJECTED = <span class="string">'rejected'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPromise</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(fn) &#123;</span><br><span class="line">    <span class="keyword">this</span>.state = PENDING</span><br><span class="line">    <span class="comment">// æ”¶é›† .then ä¸­çš„ resolve çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">    <span class="keyword">this</span>.resolveCallbacks = []</span><br><span class="line">    <span class="comment">// æ”¶é›† .then ä¸­çš„ reject çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">    <span class="keyword">this</span>.rejectCallbacks = []</span><br><span class="line">    <span class="comment">// resolve(result)</span></span><br><span class="line">    <span class="keyword">this</span>.result = <span class="literal">null</span></span><br><span class="line">    <span class="comment">// reject(reason)</span></span><br><span class="line">    <span class="keyword">this</span>.reason = <span class="literal">null</span></span><br><span class="line">    <span class="comment">// ç”±äº fn æœ‰å¯èƒ½å¼‚å¸¸ï¼Œéœ€è¦æ•è·</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// Promise ä¸€å®ä¾‹åŒ–å°±æ‰§è¡Œä¼ å…¥çš„ fn</span></span><br><span class="line">      <span class="comment">// æ³¨æ„æ­¤å¤„å°†å‡½æ•°å½“ä½œå‚æ•°ä¼ å…¥ï¼Œéœ€è¦ bind ç»‘å®šä¸Šä¸‹æ–‡</span></span><br><span class="line">      <span class="comment">// æˆ–è€… resolve / reject ç”¨ç®­å¤´å‡½æ•°å®ç°</span></span><br><span class="line">      fn(<span class="keyword">this</span>.resolve.bind(<span class="keyword">this</span>), <span class="keyword">this</span>.reject.bind(<span class="keyword">this</span>))</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="keyword">this</span>.reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  resolve(result) &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.state === PENDING) &#123;</span><br><span class="line">        <span class="comment">// ä¿®æ”¹çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">this</span>.state = RESOLVED</span><br><span class="line">        <span class="keyword">this</span>.result = result</span><br><span class="line">        <span class="comment">// æ‰§è¡Œ then ä¸­çš„ resolve å›è°ƒå‡½æ•°</span></span><br><span class="line">        <span class="keyword">this</span>.resolveCallbacks.forEach(<span class="function">(<span class="params">cb</span>) =&gt;</span> cb(result))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  reject(reason) &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.state === PENDING) &#123;</span><br><span class="line">        <span class="comment">// ä¿®æ”¹çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">this</span>.state = REJECTED</span><br><span class="line">        <span class="keyword">this</span>.reason = reason</span><br><span class="line">        <span class="comment">// æ‰§è¡Œ then ä¸­çš„ reject å›è°ƒå‡½æ•°</span></span><br><span class="line">        <span class="keyword">this</span>.rejectCallbacks.forEach(<span class="function">(<span class="params">cb</span>) =&gt;</span> cb(reason))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  then(onFulfilled, onRejected) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœä¸æ˜¯å‡½æ•°ï¼Œä¼ é€’ result</span></span><br><span class="line">    onFulfilled =</span><br><span class="line">      <span class="keyword">typeof</span> onFulfilled === <span class="string">'function'</span> ? onFulfilled : <span class="function">(<span class="params">result</span>) =&gt;</span> result</span><br><span class="line">    <span class="comment">// å¦‚æœä¸æ˜¯å‡½æ•°ï¼ŒæŠ›å‡º reason</span></span><br><span class="line">    onRejected =</span><br><span class="line">      <span class="keyword">typeof</span> onRejected === <span class="string">'function'</span></span><br><span class="line">        ? onRejected</span><br><span class="line">        : <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> reason</span><br><span class="line">          &#125;</span><br><span class="line">    <span class="comment">// è°ƒç”¨ .then æ—¶å¦‚æœè¿˜åœ¨ pending åˆ™å°†å›è°ƒå…ˆå­˜èµ·æ¥ï¼Œç­‰å¾… resolve åæ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state === PENDING) &#123;</span><br><span class="line">      <span class="keyword">const</span> promise2 = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> resolvedCallBack = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> x = onFulfilled(<span class="keyword">this</span>.result)</span><br><span class="line">            <span class="comment">// ç®€åŒ–é€»è¾‘çš„ resolutionProcedure</span></span><br><span class="line">            x <span class="keyword">instanceof</span> MyPromise ? x.then(resolve, reject) : resolve(x)</span><br><span class="line">            <span class="comment">// resolutionProcedure(promise2, x, resolve, reject)</span></span><br><span class="line">          &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            reject(error)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> rejectCallBack = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> x = onRejected(<span class="keyword">this</span>.result)</span><br><span class="line">            <span class="comment">// ç®€åŒ–é€»è¾‘çš„ resolutionProcedure</span></span><br><span class="line">            x <span class="keyword">instanceof</span> MyPromise ? x.then(resolve, reject) : resolve(x)</span><br><span class="line">            <span class="comment">// resolutionProcedure(promise2, x, resolve, reject)</span></span><br><span class="line">          &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            reject(error)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ”¶é›†å›è°ƒ</span></span><br><span class="line">        <span class="keyword">this</span>.resolveCallbacks.push(resolvedCallBack)</span><br><span class="line">        <span class="keyword">this</span>.rejectCallbacks.push(onRejected)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> promise2</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœè°ƒç”¨ .then æ—¶å·²ç» resolve / reject, é‚£ä¹ˆç›´æ¥æ‰§è¡Œå¯¹åº”çš„å›è°ƒ</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state === RESOLVED) &#123;</span><br><span class="line">      onFulfilled(<span class="keyword">this</span>.result)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state === REJECTED) &#123;</span><br><span class="line">      onRejected(<span class="keyword">this</span>.reason)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="resolutionProcedure"><a href="#resolutionProcedure" class="headerlink" title="resolutionProcedure"></a>resolutionProcedure</h5><p>æœ€åæ ¹æ® Promise / A+ çš„è§„èŒƒæ¥å®Œå–„ resolutionProcedureï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ç³»åˆ—çš„åˆ¤æ–­ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> resolutionProcedure = <span class="function">(<span class="params">promise2, x, resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (promise2 === x) &#123;</span><br><span class="line">    <span class="keyword">return</span> reject(<span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'Error'</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (x <span class="keyword">instanceof</span> MyPromise) &#123;</span><br><span class="line">    x.then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">        resolutionProcedure(promise2, value, resolve, reject)</span><br><span class="line">    &#125;, reject)</span><br><span class="line">&#125;</span><br><span class="line">  <span class="keyword">let</span> called = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">if</span> (x !== <span class="literal">null</span> &amp;&amp; (<span class="keyword">typeof</span> x === <span class="string">'object'</span> || <span class="keyword">typeof</span> x === <span class="string">'function'</span>)) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> then = x.then</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">'function'</span>) &#123;</span><br><span class="line">        then.call(</span><br><span class="line">          x,</span><br><span class="line">          y =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (called) <span class="keyword">return</span></span><br><span class="line">            called = <span class="literal">true</span></span><br><span class="line">            resolutionProcedure(promise2, y, resolve, reject)</span><br><span class="line">          &#125;,</span><br><span class="line">          e =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (called) <span class="keyword">return</span></span><br><span class="line">            called = <span class="literal">true</span></span><br><span class="line">            reject(e)</span><br><span class="line">          &#125;</span><br><span class="line">        )</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        resolve(x)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">if</span> (called) <span class="keyword">return</span></span><br><span class="line">      called = <span class="literal">true</span></span><br><span class="line">      reject(e)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    resolve(x)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç¬¦åˆ-Promise-A-çš„-Promise-1"><a href="#ç¬¦åˆ-Promise-A-çš„-Promise-1" class="headerlink" title="ç¬¦åˆ Promise / A+ çš„ Promise"></a>ç¬¦åˆ Promise / A+ çš„ Promise</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> PENDING = <span class="string">'pending'</span></span><br><span class="line"><span class="keyword">const</span> RESOLVED = <span class="string">'resolved'</span></span><br><span class="line"><span class="keyword">const</span> REJECTED = <span class="string">'rejected'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> resolutionProcedure = <span class="function">(<span class="params">promise2, x, resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (promise2 === x) &#123;</span><br><span class="line">    <span class="keyword">return</span> reject(<span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'Error'</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (x <span class="keyword">instanceof</span> MyPromise) &#123;</span><br><span class="line">    x.then(<span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">      resolutionProcedure(promise2, value, resolve, reject)</span><br><span class="line">    &#125;, reject)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> called = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">if</span> (x !== <span class="literal">null</span> &amp;&amp; (<span class="keyword">typeof</span> x === <span class="string">'object'</span> || <span class="keyword">typeof</span> x === <span class="string">'function'</span>)) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> then = x.then</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">'function'</span>) &#123;</span><br><span class="line">        then.call(</span><br><span class="line">          x,</span><br><span class="line">          (y) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (called) <span class="keyword">return</span></span><br><span class="line">            called = <span class="literal">true</span></span><br><span class="line">            resolutionProcedure(promise2, y, resolve, reject)</span><br><span class="line">          &#125;,</span><br><span class="line">          (e) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (called) <span class="keyword">return</span></span><br><span class="line">            called = <span class="literal">true</span></span><br><span class="line">            reject(e)</span><br><span class="line">          &#125;</span><br><span class="line">        )</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        resolve(x)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">if</span> (called) <span class="keyword">return</span></span><br><span class="line">      called = <span class="literal">true</span></span><br><span class="line">      reject(e)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    resolve(x)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPromise</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(fn) &#123;</span><br><span class="line">    <span class="keyword">this</span>.state = PENDING</span><br><span class="line">    <span class="comment">// æ”¶é›† .then ä¸­çš„ resolve çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">    <span class="keyword">this</span>.resolveCallbacks = []</span><br><span class="line">    <span class="comment">// æ”¶é›† .then ä¸­çš„ reject çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">    <span class="keyword">this</span>.rejectCallbacks = []</span><br><span class="line">    <span class="comment">// resolve(result)</span></span><br><span class="line">    <span class="keyword">this</span>.result = <span class="literal">null</span></span><br><span class="line">    <span class="comment">// reject(reason)</span></span><br><span class="line">    <span class="keyword">this</span>.reason = <span class="literal">null</span></span><br><span class="line">    <span class="comment">// ç”±äº fn æœ‰å¯èƒ½å¼‚å¸¸ï¼Œéœ€è¦æ•è·</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// Promise ä¸€å®ä¾‹åŒ–å°±æ‰§è¡Œä¼ å…¥çš„ fn</span></span><br><span class="line">      <span class="comment">// æ³¨æ„æ­¤å¤„å°†å‡½æ•°å½“ä½œå‚æ•°ä¼ å…¥ï¼Œéœ€è¦ bind ç»‘å®šä¸Šä¸‹æ–‡</span></span><br><span class="line">      <span class="comment">// æˆ–è€… resolve / reject ç”¨ç®­å¤´å‡½æ•°å®ç°</span></span><br><span class="line">      fn(<span class="keyword">this</span>.resolve.bind(<span class="keyword">this</span>), <span class="keyword">this</span>.reject.bind(<span class="keyword">this</span>))</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="keyword">this</span>.reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  resolve(result) &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.state === PENDING) &#123;</span><br><span class="line">        <span class="comment">// ä¿®æ”¹çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">this</span>.state = RESOLVED</span><br><span class="line">        <span class="keyword">this</span>.result = result</span><br><span class="line">        <span class="comment">// æ‰§è¡Œ then ä¸­çš„ resolve å›è°ƒå‡½æ•°</span></span><br><span class="line">        <span class="keyword">this</span>.resolveCallbacks.forEach(<span class="function">(<span class="params">cb</span>) =&gt;</span> cb(result))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  reject(reason) &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.state === PENDING) &#123;</span><br><span class="line">        <span class="comment">// ä¿®æ”¹çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">this</span>.state = REJECTED</span><br><span class="line">        <span class="keyword">this</span>.reason = reason</span><br><span class="line">        <span class="comment">// æ‰§è¡Œ then ä¸­çš„ reject å›è°ƒå‡½æ•°</span></span><br><span class="line">        <span class="keyword">this</span>.rejectCallbacks.forEach(<span class="function">(<span class="params">cb</span>) =&gt;</span> cb(reason))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  then(onFulfilled, onRejected) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœä¸æ˜¯å‡½æ•°ï¼Œä¼ é€’ result</span></span><br><span class="line">    onFulfilled =</span><br><span class="line">      <span class="keyword">typeof</span> onFulfilled === <span class="string">'function'</span> ? onFulfilled : <span class="function">(<span class="params">result</span>) =&gt;</span> result</span><br><span class="line">    <span class="comment">// å¦‚æœä¸æ˜¯å‡½æ•°ï¼ŒæŠ›å‡º reason</span></span><br><span class="line">    onRejected =</span><br><span class="line">      <span class="keyword">typeof</span> onRejected === <span class="string">'function'</span></span><br><span class="line">        ? onRejected</span><br><span class="line">        : <span class="function">(<span class="params">reason</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> reason</span><br><span class="line">          &#125;</span><br><span class="line">    <span class="comment">// è°ƒç”¨ .then æ—¶å¦‚æœè¿˜åœ¨ pending åˆ™å°†å›è°ƒå…ˆå­˜èµ·æ¥ï¼Œç­‰å¾… resolve åæ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state === PENDING) &#123;</span><br><span class="line">      <span class="keyword">const</span> promise2 = <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> resolvedCallBack = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> x = onFulfilled(<span class="keyword">this</span>.result)</span><br><span class="line">            resolutionProcedure(promise2, x, resolve, reject)</span><br><span class="line">          &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            reject(error)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> rejectCallBack = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> x = onRejected(<span class="keyword">this</span>.result)</span><br><span class="line">            resolutionProcedure(promise2, x, resolve, reject)</span><br><span class="line">          &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            reject(error)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ”¶é›†å›è°ƒ</span></span><br><span class="line">        <span class="keyword">this</span>.resolveCallbacks.push(resolvedCallBack)</span><br><span class="line">        <span class="keyword">this</span>.rejectCallbacks.push(onRejected)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> promise2</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœè°ƒç”¨ .then æ—¶å·²ç» resolve / reject, é‚£ä¹ˆç›´æ¥æ‰§è¡Œå¯¹åº”çš„å›è°ƒ</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state === RESOLVED) &#123;</span><br><span class="line">      onFulfilled(<span class="keyword">this</span>.result)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state === REJECTED) &#123;</span><br><span class="line">      onRejected(<span class="keyword">this</span>.reason)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤æˆ‘ä»¬å®Œæˆäº†ä¸€ä¸ª ç¬¦åˆ Promise / A+ çš„ Promiseï¼Œå®é™…ä¸Š Promise è¿˜ä¼šæä¾›ä¸€äº›å¦‚ <code>.all</code>, <code>.race</code> ä¹‹ç±»çš„ apiï¼Œè¿™é‡Œä¹Ÿå®ç°ä¸€ä¸‹ã€‚</p><h4 id="Promise-all"><a href="#Promise-all" class="headerlink" title="Promise.all"></a>Promise.all</h4><p>Promise.all æ¥æ”¶å¤šä¸ª Promise å®ä¾‹ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="built_in">Promise</span>.all([p1, p2, p3])</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°çš„ p1, p2, p3 éƒ½æ˜¯ Promise å®ä¾‹ï¼Œå¦‚æœä¸æ˜¯åˆ™ä¼šç”¨ Promise.resolve è½¬æˆ promiseã€‚æ­¤å¤–ï¼Œ<code>Promise.all()</code>æ–¹æ³•çš„å‚æ•°å¯ä»¥ä¸æ˜¯æ•°ç»„ï¼Œä½†å¿…é¡»å…·æœ‰ Iterator æ¥å£ï¼Œä¸”è¿”å›çš„æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ Promise å®ä¾‹ã€‚</p><p><code>p</code>çš„çŠ¶æ€ç”±<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>å†³å®šï¼Œåˆ†æˆä¸¤ç§æƒ…å†µã€‚</p><p>ï¼ˆ1ï¼‰åªæœ‰<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>çš„çŠ¶æ€éƒ½å˜æˆ<code>fulfilled</code>ï¼Œ<code>p</code>çš„çŠ¶æ€æ‰ä¼šå˜æˆ<code>fulfilled</code>ï¼Œæ­¤æ—¶<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>çš„è¿”å›å€¼ç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚</p><p>ï¼ˆ2ï¼‰åªè¦<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>ä¹‹ä¸­æœ‰ä¸€ä¸ªè¢«<code>rejected</code>ï¼Œ<code>p</code>çš„çŠ¶æ€å°±å˜æˆ<code>rejected</code>ï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªè¢«<code>reject</code>çš„å®ä¾‹çš„è¿”å›å€¼ï¼Œä¼šä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚</p><p>å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPromise</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  all(arr) &#123;</span><br><span class="line">    <span class="comment">// ç”¨äºå­˜å‚¨è¿”å›å€¼</span></span><br><span class="line">    <span class="keyword">let</span> list = []</span><br><span class="line">    <span class="comment">// è®°å½• resolve äº†å¤šå°‘ä¸ª promise</span></span><br><span class="line">    <span class="keyword">let</span> length = <span class="number">0</span></span><br><span class="line">    <span class="comment">// æ‰§è¡Œ promise çš„è¿‡ç¨‹ä¸­æ˜¯å¦æœ‰å¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">let</span> hasError = <span class="literal">false</span></span><br><span class="line">    <span class="comment">// è¿”å›ä¸€ä¸ªæ–°çš„ Promise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­å…ƒç´ æ˜¯å¦ä¸º MyPromiseï¼Œ å¦åˆ™ resolve</span></span><br><span class="line">        <span class="keyword">const</span> p =</span><br><span class="line">          arr[i] <span class="keyword">instanceof</span> MyPromise ? arr[i] : MyPromise.resolve(arr[i])</span><br><span class="line">        p.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">          list[i] = data</span><br><span class="line">          length++</span><br><span class="line">          <span class="keyword">if</span> (length === arr.length) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœå…¨éƒ¨ promise éƒ½ resolved</span></span><br><span class="line">            resolve(list)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;).catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (!hasError) &#123;</span><br><span class="line">            <span class="comment">// ç¬¬ä¸€ä¸ªè¢« reject çš„å®ä¾‹çš„è¿”å›å€¼ï¼Œä¼šä¼ é€’ç»™ p çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">            reject(error)</span><br><span class="line">          &#125;</span><br><span class="line">          hasErr = <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Promise-race"><a href="#Promise-race" class="headerlink" title="Promise.race"></a>Promise.race</h4><p>Promise.race()`æ–¹æ³•åŒæ ·æ˜¯å°†å¤šä¸ª Promise å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> p = <span class="built_in">Promise</span>.race([p1, p2, p3]);</span><br></pre></td></tr></table></figure><p>åªè¦<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>ä¹‹ä¸­æœ‰ä¸€ä¸ªå®ä¾‹ç‡å…ˆæ”¹å˜çŠ¶æ€ï¼Œ<code>p</code>çš„çŠ¶æ€å°±è·Ÿç€æ”¹å˜ã€‚é‚£ä¸ªç‡å…ˆæ”¹å˜çš„ Promise å®ä¾‹çš„è¿”å›å€¼ï¼Œå°±ä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPromise</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  race(arr) &#123;</span><br><span class="line">    <span class="comment">// æ˜¯å¦æœ‰ç»“æœ</span></span><br><span class="line">    <span class="keyword">let</span> hasResult = <span class="literal">false</span></span><br><span class="line">    <span class="comment">// è¿”å›ä¸€ä¸ªæ–°çš„ Promise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­å…ƒç´ æ˜¯å¦ä¸º MyPromiseï¼Œ å¦åˆ™ resolve</span></span><br><span class="line">        <span class="keyword">const</span> p =</span><br><span class="line">          arr[i] <span class="keyword">instanceof</span> MyPromise ? arr[i] : MyPromise.resolve(arr[i])</span><br><span class="line">        p.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (!hasResult) &#123;</span><br><span class="line">            resolve(data)</span><br><span class="line">          &#125;</span><br><span class="line">          hasResult = <span class="literal">true</span></span><br><span class="line">        &#125;).catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (!hasResult) &#123;</span><br><span class="line">            reject(error)</span><br><span class="line">          &#125;</span><br><span class="line">          hasResult = <span class="literal">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>svg å›¾ç‰‡çš„ä¸Šä¼ ä¸‹è½½</title>
      <link href="/2020/08/17/svg%20%E5%9B%BE%E7%89%87%E7%9A%84%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD/"/>
      <url>/2020/08/17/svg%20%E5%9B%BE%E7%89%87%E7%9A%84%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>æœ€è¿‘æœ‰ä¸ªéœ€æ±‚ï¼š</p><ol><li>æ ¹æ®ä¼ å…¥çš„ code ç”Ÿæˆæ¡å½¢ç  svg å›¾ç‰‡</li><li>å°† svg å›¾ç‰‡ä¸Šä¼ è‡³ cdn</li><li>å±•ç¤ºå›¾ç‰‡æ—¶éœ€è¦ç‚¹å‡»æŒ‰é’®åä¿å­˜è‡³æœ¬åœ°</li></ol><a id="more"></a><h4 id="ç”Ÿæˆæ¡å½¢ç "><a href="#ç”Ÿæˆæ¡å½¢ç " class="headerlink" title="ç”Ÿæˆæ¡å½¢ç "></a>ç”Ÿæˆæ¡å½¢ç </h4><p>è¿™é‡Œå€ŸåŠ©ä¸€ä¸ªå¼€æºçš„ä»“åº“</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> JsBarcode <span class="keyword">from</span> <span class="string">'jsbarcode'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> generateBarcode = <span class="keyword">async</span> (barcode, options = &#123;&#125;) =&gt; &#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºä¸€ä¸ª svg å…ƒç´ </span></span><br><span class="line">  <span class="keyword">const</span> svg = <span class="built_in">document</span>.createElementNS(<span class="string">'http://www.w3.org/2000/svg'</span>, <span class="string">'svg'</span>);</span><br><span class="line">  <span class="comment">// ç”šè‡³å®½é«˜</span></span><br><span class="line">  svg.setAttribute(<span class="string">'width'</span>, <span class="string">`<span class="subst">$&#123;width&#125;</span>px`</span>);</span><br><span class="line">  svg.setAttribute(<span class="string">'height'</span>, <span class="string">`<span class="subst">$&#123;height&#125;</span>px`</span>);</span><br><span class="line">  <span class="comment">// ç”Ÿæˆæ¡å½¢ç  svg çš„å›¾ç‰‡</span></span><br><span class="line">  JsBarcode(svg, barcode, options);</span><br><span class="line">  <span class="keyword">return</span> svg</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å›¾ç‰‡ä¸Šä¼ "><a href="#å›¾ç‰‡ä¸Šä¼ " class="headerlink" title="å›¾ç‰‡ä¸Šä¼ "></a>å›¾ç‰‡ä¸Šä¼ </h4><h5 id="svg-è½¬-canvas"><a href="#svg-è½¬-canvas" class="headerlink" title="svg è½¬ canvas"></a>svg è½¬ canvas</h5><p>ç”±äºæœåŠ¡ç«¯åŒå­¦æä¾›çš„æ¥å£åªæ”¯æŒ canvasï¼Œå› æ­¤é¦–å…ˆè¦å°† svg è½¬æˆ canvasï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> svgToCanvas = <span class="function">(<span class="params">svg</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// svg.outerHTML è·å– svg å…ƒç´ çš„ html å­—ç¬¦ä¸²</span></span><br><span class="line">  <span class="comment">// btoa å°† svg è½¬æˆ base64</span></span><br><span class="line"><span class="keyword">const</span> href = <span class="string">`data:image/svg+xml;base64,<span class="subst">$&#123;<span class="built_in">window</span>.btoa(</span></span></span><br><span class="line"><span class="string"><span class="subst">    <span class="built_in">unescape</span>(<span class="built_in">encodeURIComponent</span>(svg.outerHTML)),</span></span></span><br><span class="line"><span class="string"><span class="subst">  )&#125;</span>`</span>;</span><br><span class="line">  <span class="comment">// æ„å»ºä¸€ä¸ª Image</span></span><br><span class="line">  <span class="keyword">const</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">  img.width = width;</span><br><span class="line">  img.height = height;</span><br><span class="line">  </span><br><span class="line">  img.onload = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æ„å»ºä¸€ä¸ª canvas</span></span><br><span class="line">    <span class="keyword">const</span> canvas = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>);</span><br><span class="line">    <span class="keyword">const</span> ctx = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">    ctx.fillRect(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">    <span class="comment">// å°† å›¾ç‰‡ç”»åˆ° canvas ä¸­</span></span><br><span class="line">    ctx.drawImage(img, <span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">    <span class="comment">// è½¬æˆ jpeg çš„ base64</span></span><br><span class="line"> <span class="keyword">const</span> dataURI = canvas.toDataURL(<span class="string">'image/jpeg'</span>);</span><br><span class="line">    <span class="comment">// ä¸Šä¼ </span></span><br><span class="line">    upload(dataURI);</span><br><span class="line">  &#125; </span><br><span class="line">  img.src = href;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Data-URL"><a href="#Data-URL" class="headerlink" title="Data URL"></a>Data URL</h5><p>é€šè¿‡ `canvas.toDataURL å°† canvas è½¬æˆ Data URLï¼Œä¸€æ®µ Data URL ç”± 4 ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data:[&lt;mediatype&gt;][;base64],&lt;data&gt;</span><br><span class="line">// ä¾‹å¦‚ï¼š "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAADElEQVQImWNgoBMAAABpAAFEI8ARAAAAAElFTkSuQmCC"</span><br></pre></td></tr></table></figure><h5 id="Base64çš„è§£ç ä¸ç¼–ç "><a href="#Base64çš„è§£ç ä¸ç¼–ç " class="headerlink" title="Base64çš„è§£ç ä¸ç¼–ç "></a>Base64çš„è§£ç ä¸ç¼–ç </h5><p><code>atob()</code> å‡½æ•°èƒ½å¤Ÿè§£ç é€šè¿‡base-64ç¼–ç çš„å­—ç¬¦ä¸²æ•°æ®ã€‚</p><p><code>btoa()</code> å‡½æ•°èƒ½å¤Ÿä»äºŒè¿›åˆ¶æ•°æ®â€œå­—ç¬¦ä¸²â€åˆ›å»ºä¸€ä¸ªbase-64ç¼–ç çš„ASCIIå­—ç¬¦ä¸²ã€‚</p><h5 id="Base64-è½¬-Blob"><a href="#Base64-è½¬-Blob" class="headerlink" title="Base64 è½¬ Blob"></a>Base64 è½¬ Blob</h5><p>ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶éœ€è¦å°† base64 è½¬æˆ Blob å¯¹è±¡ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><p>######Base64 è½¬ Blob ç¬¬ä¸€ç§æ–¹æ³•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dataURItoBlob</span>(<span class="params">dataURI: string</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// é€šè¿‡ atob è½¬å› string</span></span><br><span class="line">  <span class="keyword">const</span> byteString = atob(dataURI.split(<span class="string">','</span>)[<span class="number">1</span>]);</span><br><span class="line">  <span class="comment">// è·å¾—æ–‡ä»¶ç±»å‹</span></span><br><span class="line">  <span class="keyword">const</span> mimeString = dataURI.split(<span class="string">','</span>)[<span class="number">0</span>].split(<span class="string">':'</span>)[<span class="number">1</span>].split(<span class="string">';'</span>)[<span class="number">0</span>];</span><br><span class="line">  <span class="comment">// è½¬æˆ </span></span><br><span class="line">  <span class="keyword">const</span> ab = <span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(byteString.length);</span><br><span class="line">  <span class="keyword">const</span> ia = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(ab);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; byteString.length; i++) &#123;</span><br><span class="line">    ia[i] = byteString.charCodeAt(i);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// è½¬æˆ blob</span></span><br><span class="line">  <span class="keyword">const</span> bb = <span class="keyword">new</span> Blob([ab], &#123; <span class="attr">type</span>: mimeString &#125;);</span><br><span class="line">  <span class="keyword">return</span> bb;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> æ€è·¯ï¼š</p><ol><li>æ‹†è§£ data uriï¼Œé€šè¿‡ atob å°† base64 è§£ç æˆå­—ç¬¦ä¸²</li><li>æ‹†è§£ data uriï¼Œè·å¾—å›¾ç‰‡çš„æ ¼å¼</li><li>åˆ›å»ºä¸€ä¸ª arraybuffer</li><li>é€šè¿‡TypedArrayï¼ˆè¿™é‡Œä½¿ç”¨ Uint8Arrayï¼‰å°†å­—ç¬¦ä¸²çš„å†…å®¹å†™å…¥ arraybuffer </li><li>å°† array buffer è½¬æˆ blob</li></ol><h6 id="Base64-è½¬-Blob-ç¬¬äºŒç§æ–¹æ³•ï¼š"><a href="#Base64-è½¬-Blob-ç¬¬äºŒç§æ–¹æ³•ï¼š" class="headerlink" title="Base64 è½¬ Blob ç¬¬äºŒç§æ–¹æ³•ï¼š"></a>Base64 è½¬ Blob ç¬¬äºŒç§æ–¹æ³•ï¼š</h6><p>é€šè¿‡ <code>fetch</code> å°† dataURI è½¬æˆ blobï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bb = <span class="keyword">await</span> fetch(dataURI).then(<span class="function">(<span class="params">res</span>) =&gt;</span> res.blob())</span><br></pre></td></tr></table></figure><h5 id="ä¸Šä¼ å›¾ç‰‡"><a href="#ä¸Šä¼ å›¾ç‰‡" class="headerlink" title="ä¸Šä¼ å›¾ç‰‡"></a>ä¸Šä¼ å›¾ç‰‡</h5><p>æ„é€  FormData ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> upload = <span class="function">(<span class="params">dataURI: string</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºformå¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">  <span class="comment">// é€šè¿‡ append å‘ form å¯¹è±¡æ·»åŠ æ•°æ®</span></span><br><span class="line">  formData.append(<span class="string">'file'</span>, dataURItoBlob(dataURI));</span><br><span class="line">  <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> axios.post(<span class="string">'/api/upload'</span>, formData, &#123;</span><br><span class="line">    headers: &#123;</span><br><span class="line">      <span class="string">'Content-Type'</span>: <span class="string">'multipart/form-data'</span>,</span><br><span class="line">      <span class="string">'X-Requested-With'</span>: <span class="string">'XMLHttpRequest'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="ä¸‹è½½å›¾ç‰‡"><a href="#ä¸‹è½½å›¾ç‰‡" class="headerlink" title="ä¸‹è½½å›¾ç‰‡"></a>ä¸‹è½½å›¾ç‰‡</h5><p>ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> download = <span class="function">(<span class="params">fileUrl, name</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> x = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">  x.open(<span class="string">'GET'</span>, fileUrl, <span class="literal">true</span>);</span><br><span class="line">  x.responseType = <span class="string">'blob'</span>;</span><br><span class="line">  x.onload = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è½¬ä¸º objectUrl</span></span><br><span class="line">    <span class="keyword">const</span> url = <span class="built_in">window</span>.URL.createObjectURL(x.response);</span><br><span class="line">    <span class="comment">// æ„å»ºä¸€ä¸ª a æ ‡ç­¾</span></span><br><span class="line">    <span class="keyword">const</span> a = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>);</span><br><span class="line">    a.href = url;</span><br><span class="line">    a.download = name;</span><br><span class="line">    a.click();</span><br><span class="line">  &#125;;</span><br><span class="line">  x.send();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨ a æ ‡ç­¾çš„ download å±æ€§å¯ä»¥å®ç°å›¾ç‰‡çš„ä¸‹è½½ï¼Œä½†æ˜¯æœ‰ä¸ªé™åˆ¶æ˜¯ href å¿…é¡»æ˜¯åŒæºçš„åœ°å€ï¼Œå¦åˆ™æ— æ³•ä¸‹è½½ã€‚</p><p>å› æ­¤è¿™é‡Œé€šè¿‡ get è¯·æ±‚è·å¾—å›¾ç‰‡çš„ Blob æ ¼å¼ï¼Œå¹¶ç”¨ window.URL.createObjectURL å°† Blob è½¬æˆ objectUrl è§£å†³äº†è·¨åŸŸé—®é¢˜ã€‚ä¹‹åå°±å¯ä»¥ç”¨ a æ ‡ç­¾çš„ download å±æ€§ä¸‹è½½æ–‡ä»¶ã€‚</p><h4 id="è¡¥å……å‡ ä¸ªæ¦‚å¿µ"><a href="#è¡¥å……å‡ ä¸ªæ¦‚å¿µ" class="headerlink" title="è¡¥å……å‡ ä¸ªæ¦‚å¿µ"></a>è¡¥å……å‡ ä¸ªæ¦‚å¿µ</h4><h5 id="blob"><a href="#blob" class="headerlink" title="blob"></a>blob</h5><p>ä¸Šä¼ å›¾ç‰‡æ—¶ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªå‡½æ•° dataURItoBlobï¼Œ é€šè¿‡è¿™ä¸ªå‡½æ•°æ¥å°† base64 è½¬ä¸º Blobï¼Œæœ€ç»ˆä¸Šä¼ ç»™æ¥å£çš„ formData ä¸­çš„ file ä¹Ÿæ˜¯ä¸€ä¸ª Blob å¯¹è±¡ã€‚</p><p>ä»€ä¹ˆæ˜¯ Blob å¯¹è±¡ï¼Ÿ</p><blockquote><p>ä¸€ä¸ª <strong>Blob</strong>å¯¹è±¡è¡¨ç¤ºä¸€ä¸ªä¸å¯å˜çš„, åŸå§‹æ•°æ®çš„ç±»ä¼¼æ–‡ä»¶å¯¹è±¡ã€‚Blob è¡¨ç¤ºçš„ä¸ä¸€å®šæ˜¯JavaScriptåŸç”Ÿæ ¼å¼çš„æ•°æ®ã€‚<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/File" target="_blank" rel="noopener"><code>File</code></a> æ¥å£åŸºäº<code>Blob</code>ï¼Œç»§æ‰¿äº† blob çš„åŠŸèƒ½å¹¶å°†å…¶æ‰©å±•ä½¿å…¶æ”¯æŒç”¨æˆ·ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚</p></blockquote><p>Blob å±äº web æä¾›çš„ apiï¼Œå› æ­¤ mdn ä¸Šè¯´çš„ Blob è¡¨ç¤ºçš„ä¸ä¸€å®šæ˜¯JavaScriptåŸç”Ÿæ ¼å¼çš„æ•°æ®ã€‚</p><h5 id="File"><a href="#File" class="headerlink" title="File"></a>File</h5><p>File ç»§æ‰¿è‡ª Blobï¼Œå¯ä»¥çœ‹ä½œæ˜¯ç‰¹æ®Šçš„ Blobã€‚å¸¸è§çš„è·å¾— File å¯¹è±¡çš„æ–¹æ³•æœ‰ <code>input</code> æ ‡ç­¾ä¸Šé€‰æ‹©æ–‡ä»¶åè¿”å›çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FileList" target="_blank" rel="noopener"><code>FileList</code></a> å¯¹è±¡ã€‚</p><h5 id="Blob-è½¬-URL"><a href="#Blob-è½¬-URL" class="headerlink" title="Blob è½¬ URL"></a>Blob è½¬ URL</h5><p>åœ¨ä¸‹è½½æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡ get è¯·æ±‚è·å¾—äº†å›¾ç‰‡çš„ blob æ ¼å¼ï¼Œä¹‹åé€šè¿‡ URL.createObjectURL è½¬æˆ objectUrlï¼Œè¿™æ ·å°±å¯ä»¥åƒæ™®é€šçš„ urlï¼Œèµ‹å€¼ç»™ img çš„ src å±æ€§æˆ–è€… a æ ‡ç­¾çš„ href å±æ€§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æºç å±‚é¢è§£è¯»Vueå“åº”å¼åŸç†</title>
      <link href="/2020/08/11/%E6%BA%90%E7%A0%81%E5%B1%82%E9%9D%A2%E8%A7%A3%E8%AF%BBVue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86/"/>
      <url>/2020/08/11/%E6%BA%90%E7%A0%81%E5%B1%82%E9%9D%A2%E8%A7%A3%E8%AF%BBVue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ Vueï¼ˆä»¥ä¸‹å‡æŒ‡çš„æ˜¯ 2.x ç‰ˆæœ¬ï¼‰ ä¸­ï¼Œæ•°æ®æ¨¡å‹ä»…ä»…æ˜¯æ™®é€šçš„ JavaScript å¯¹è±¡ï¼Œå½“ä½ ä¿®æ”¹å®ƒä»¬æ—¶ï¼Œè§†å›¾ä¼šè¿›è¡Œæ›´æ–°ï¼Œè¿™å°±æ˜¯ Vue çš„å“åº”å¼ç³»ç»Ÿï¼Œå…¶è®¾è®¡æ¨¡å¼å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ã€‚</p><a id="more"></a><h4 id="æ€è·¯æ¢³ç†"><a href="#æ€è·¯æ¢³ç†" class="headerlink" title="æ€è·¯æ¢³ç†"></a>æ€è·¯æ¢³ç†</h4><p>ä»¥ä¸‹ä¸ºé˜…è¯»æºç æ—¶ï¼Œå¯¹å“åº”å¼å®ç°åŸç†çš„ç†è§£ï¼Œä¸ºäº†æ€è·¯æ›´æ¸…æ™°ï¼Œä»…è€ƒè™‘æœ€ç®€å•çš„æƒ…å†µï¼Œå¹¶ä¸”å¯èƒ½ä¼šçœç•¥æˆ–ä¿®æ”¹éƒ¨åˆ†ä»£ç ã€‚</p><p>é¦–å…ˆï¼Œé¡ºç€ vue çš„ç”Ÿå‘½å‘¨æœŸå¼€å§‹ï¼š</p><h5 id="beforeCreate-ä¸-created"><a href="#beforeCreate-ä¸-created" class="headerlink" title="beforeCreate ä¸ created"></a>beforeCreate ä¸ created</h5><p>é¦–å…ˆ åœ¨ _init æ–¹æ³•ä¸­æ‰§è¡Œ beforeCreate ä¸ created ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Vue.prototype._init = <span class="function"><span class="keyword">function</span> (<span class="params">options?: Object</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  callHook(vm, <span class="string">'beforeCreate'</span>)</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  initState(vm)</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  callHook(vm, <span class="string">'created'</span>)</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®°ä½è¿™é‡Œæ‰§è¡Œäº†ä¸€ä¸ªæ–¹æ³•ï¼š <code>initState</code></p><p>#####initState</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initState</span> (<span class="params">vm: Component</span>) </span>&#123;</span><br><span class="line"><span class="comment">// ç•¥ï¼š...åˆå§‹åŒ– propsï¼Œmethods ç­‰</span></span><br><span class="line">  <span class="keyword">if</span> (opts.data) &#123;</span><br><span class="line">    initData(vm)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    observe(vm._data = &#123;&#125;, <span class="literal">true</span> <span class="comment">/* asRootData */</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç•¥ï¼š...åˆå§‹åŒ– computedï¼Œwatch ç­‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ initData ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initData</span> (<span class="params">vm: Component</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ç•¥ï¼š...å°† data çš„æ¯ä¸ªå±æ€§éƒ½æŒ‚åœ¨ vm ä¸Š,è¿™æ ·å¯ä»¥é€šè¿‡ this.xx ç›´æ¥è®¿é—®åˆ°</span></span><br><span class="line">  <span class="comment">// observe data</span></span><br><span class="line">  observe(data, <span class="literal">true</span> <span class="comment">/* asRootData */</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®°ä½ <code>observe</code> è¿™ä¸ªæ–¹æ³•ã€‚</p><h5 id="observe"><a href="#observe" class="headerlink" title="observe"></a>observe</h5><p><code>observe</code>  ç”¨äºåˆ›å»ºä¸€ä¸ª observer å®ä¾‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">observe</span> (<span class="params">value: any, asRootData: ?boolean</span>): <span class="title">Observer</span> | <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> ob: Observer | <span class="keyword">void</span></span><br><span class="line">  <span class="comment">// åˆ¤æ–­æ˜¯å¦å·²ç» observe è¿‡ï¼Œæ˜¯çš„è¯ç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (hasOwn(value, <span class="string">'__ob__'</span>) &amp;&amp; value.__ob__ <span class="keyword">instanceof</span> Observer) &#123;</span><br><span class="line">    <span class="comment">// observer æœ€ç»ˆä¼šæŒ‚åœ¨ value çš„ __ob__ å±æ€§ä¸Šï¼Œå› æ­¤å¯ä»¥è¿™ä¹ˆåˆ¤æ–­æ˜¯å¦  observe è¿‡ï¼Œè¯¦æƒ…çœ‹ Observer çš„ä»£ç </span></span><br><span class="line">    ob = value.__ob__</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (...) &#123;</span><br><span class="line">    <span class="comment">// å¦åˆ™æ»¡è¶³ä¸€ç³»åˆ—æ¡ä»¶çš„æƒ…å†µä¸‹å°±ä¼šé‡æ–°å®ä¾‹åŒ–ä¸€ä¸ª observer</span></span><br><span class="line">    ob = <span class="keyword">new</span> Observer(value)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ob</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ä¾‹åŒ–  observer çš„è¿‡ç¨‹ä¸­å®é™…ä¸Šä¼šå°†ä¼ å…¥å¯¹è±¡çš„æ¯ä¸ªå±æ€§é€šè¿‡ <code>defineReactive</code> æ–¹æ³•è½¬æˆå“åº”å¼ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (value: any) &#123;</span><br><span class="line">    <span class="keyword">this</span>.value = value</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æ•°æ®æ¨¡å‹çš„ dep å®ä¾‹</span></span><br><span class="line">    <span class="keyword">this</span>.dep = <span class="keyword">new</span> Dep()</span><br><span class="line">    <span class="comment">// observer æœ€ç»ˆä¼šæŒ‚åœ¨ value çš„ __ob__ å±æ€§ä¸Š</span></span><br><span class="line">    def(value, <span class="string">'__ob__'</span>, <span class="keyword">this</span>)</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(value)) &#123;</span><br><span class="line">      <span class="comment">// ç•¥ï¼š...é‡å†™ value çš„ä¸€äº›æ•°ç»„æ–¹æ³•</span></span><br><span class="line">      <span class="comment">// ç•¥ï¼š...éå†æ•°ç»„å…ƒç´ å¹¶ observe</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.walk(value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  walk (obj: <span class="built_in">Object</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(obj)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; keys.length; i++) &#123;</span><br><span class="line">       <span class="comment">// éå†ä¼ å…¥çš„æ¯ä¸ªå±æ€§ï¼Œå¹¶ç”¨ defineReactive è½¬æˆå“åº”å¼</span></span><br><span class="line">      defineReactive(obj, keys[i])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="defineReactive"><a href="#defineReactive" class="headerlink" title="defineReactive"></a>defineReactive</h5><p>ä¸Šé¢ä»£ç ä¸­æœ€æ ¸å¿ƒçš„ä¸€ä¸ªå‡½æ•°æ˜¯ <code>defineReactive</code>ï¼Œåšäº†ä»¥ä¸‹å‡ ä»¶äº‹æƒ…ï¼š</p><ol><li>åˆå§‹åŒ–ç›®æ ‡å±æ€§çš„ dep å®ä¾‹ï¼Œè¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªå‘å¸ƒè€…</li><li>å¯¹è¯¥å±æ€§çš„å­å¯¹è±¡é€’å½’è°ƒç”¨ observe</li><li>é€šè¿‡<code>Object.defineProperty</code>åŠ«æŒè¯¥å±æ€§çš„ getter ä¸ setterï¼š</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">defineReactive</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  obj: Object,</span></span></span><br><span class="line"><span class="function"><span class="params">  key: string,</span></span></span><br><span class="line"><span class="function"><span class="params">  val: any,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–ç›®æ ‡å±æ€§çš„ dep å®ä¾‹</span></span><br><span class="line">  <span class="keyword">const</span> dep = <span class="keyword">new</span> Dep()</span><br><span class="line"><span class="comment">// ç•¥ï¼š... ä¸€äº›å®¹é”™åˆ¤æ–­</span></span><br><span class="line">  <span class="comment">// ç•¥ï¼š... ä¸€äº›åˆå§‹åŒ–</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// é€’å½’ observe</span></span><br><span class="line">  <span class="keyword">let</span> childOb = !shallow &amp;&amp; observe(val)</span><br><span class="line">  <span class="comment">// åŠ«æŒ get ä¸ set</span></span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(obj, key, &#123;</span><br><span class="line">    enumerable: <span class="literal">true</span>,</span><br><span class="line">    configurable: <span class="literal">true</span>,</span><br><span class="line">    <span class="keyword">get</span>: function reactiveGetter () &#123;</span><br><span class="line">      <span class="comment">// ...ä¸€æ—¦è·å–è¯¥å±æ€§å°±ä¼šè¿›è¡Œä¾èµ–æ”¶é›†</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">set</span>: function reactiveSetter (newVal) &#123;</span><br><span class="line">      <span class="comment">// ...ä¸€æ—¦è®¾ç½®äº†æ–°å€¼å°±ä¼šæ´¾å‘æ›´æ–°</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±ç”¨åˆ°äº†è§‚å¯Ÿè€…æ¨¡å¼ï¼šå½“è¿™ä¸ªå±æ€§æ›´æ–°æ—¶ï¼Œä¼šé€šè¿‡å‘å¸ƒè€…é€šçŸ¥åˆ°è§‚å¯Ÿè€…ï¼Œè¿™äº›è§‚å¯Ÿè€…æ”¶åˆ°é€šçŸ¥åæ›´æ–°è§†å›¾ã€‚è¿™é‡Œå‘å¸ƒè€…å®é™…ä¸Šæ˜¯<code>Dep</code> å®ä¾‹ï¼Œè§‚å¯Ÿè€…å®é™…ä¸Šæ˜¯ <code>Watcher</code> å®ä¾‹ï¼Œå®ƒçš„ <code>update</code> æ–¹æ³•å¯ä»¥æ›´æ–°è§†å›¾ã€‚</p><p>æ‰€ä»¥ï¼Œä¾èµ–æ”¶é›†å®é™…ä¸Šå°±æ˜¯å°†<code>Wathcer</code> å®ä¾‹æ·»åŠ åˆ° <code>Dep</code> å®ä¾‹çš„è§‚å¯Ÿè€…åˆ—è¡¨ã€‚</p><p>reactiveGetter å’Œ reactiveSetter è¿™ä¸¤ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°æˆ‘ä»¬å…ˆæ”¾ä¸€è¾¹ï¼Œè¿™é‡Œåªéœ€è¦çŸ¥é“å¤§æ¦‚çš„ä½œç”¨å³å¯ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»ã€‚æˆ‘ä»¬ç°åœ¨æ¥çœ‹çœ‹ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘ get å‘¢ï¼Ÿç­”æ¡ˆæ˜¯åœ¨æŒ‚è½½ç»„ä»¶çš„æ—¶å€™ã€‚</p><h5 id="beforeMount-ä¸-mounted"><a href="#beforeMount-ä¸-mounted" class="headerlink" title="beforeMount ä¸ mounted"></a>beforeMount ä¸ mounted</h5><p>ç„¶åæ˜¯åœ¨ mountComponent ä¸­æ‰§è¡Œ  beforeMount ä»¥åŠ mountedï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">mountComponent</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  vm: Component,</span></span></span><br><span class="line"><span class="function"><span class="params">  el: ?Element,</span></span></span><br><span class="line"><span class="function"><span class="params">  hydrating?: boolean</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  callHook(vm, <span class="string">'beforeMount'</span>)</span><br><span class="line">  <span class="comment">// ç•¥ï¼š...è¿™é‡Œæœ‰ä¸ªéç”Ÿäº§ç¯å¢ƒçš„åˆ¤æ–­ï¼Œè¿™é‡Œä¸è€ƒè™‘ç®€åŒ–æˆå¦‚ä¸‹ï¼š</span></span><br><span class="line">  <span class="keyword">let</span> updateComponent = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      vm._update(vm._render(), hydrating)</span><br><span class="line">   &#125;</span><br><span class="line">  <span class="comment">// è¿™é‡Œå®ä¾‹åŒ– Watcherï¼šå¯ä»¥çœ‹ä½œæ˜¯æ›´æ–°è§†å›¾ç”¨çš„è§‚å¯Ÿè€…ï¼Œè¿™é‡Œçœç•¥ä¸€äº›å‚æ•°</span></span><br><span class="line">  <span class="keyword">new</span> Watcher(vm, updateComponent)</span><br><span class="line">  <span class="comment">// ...ä»…è€ƒè™‘ new Vue çš„æƒ…å†µï¼Œä»£ç ç®€åŒ–å¦‚ä¸‹</span></span><br><span class="line">  callHook(vm, <span class="string">'mounted'</span>)</span><br><span class="line">  <span class="keyword">return</span> vm</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ‚è½½ç»„ä»¶çš„æ—¶å€™å°±ä¼šå®ä¾‹åŒ–ä¸€ä¸ª <code>Watcher</code></p><h5 id="Watcher"><a href="#Watcher" class="headerlink" title="Watcher"></a>Watcher</h5><p>å½“æˆ‘ä»¬å®ä¾‹åŒ– Watcher çš„æ—¶å€™ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> uid = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Watcher</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> (</span><br><span class="line">    vm: Component,</span><br><span class="line">    expOrFn: string | Function,</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="comment">// ç•¥ï¼š...ä¸€äº›åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">this</span>.deps = []</span><br><span class="line">    <span class="keyword">this</span>.newDeps = []</span><br><span class="line">    <span class="keyword">this</span>.depIds = <span class="keyword">new</span> <span class="built_in">Set</span>()</span><br><span class="line">    <span class="keyword">this</span>.newDepIds = <span class="keyword">new</span> <span class="built_in">Set</span>()</span><br><span class="line">    <span class="comment">// ç•¥ï¼š...ä¸€äº›åˆå§‹åŒ–</span></span><br><span class="line">    <span class="comment">// ç•¥ï¼š...å¯¹ this.getter çš„ä¸€äº›åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.computed) &#123;</span><br><span class="line">      <span class="comment">// computed çš„æƒ…å†µï¼Œæœ¬æ–‡æš‚ä¸è€ƒè™‘</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// åˆå§‹åŒ–æ—¶å°±ä¼šæ‰§è¡Œ get æ–¹æ³•</span></span><br><span class="line">      <span class="keyword">this</span>.value = <span class="keyword">this</span>.get()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> () &#123;</span><br><span class="line">    <span class="comment">// pushTarget ç”¨äºå°† watcher å®ä¾‹æŒ‚åˆ° Dep çš„ target è¿™ä¸ªé™æ€å±æ€§ä¸Š</span></span><br><span class="line">    pushTarget(<span class="keyword">this</span>)</span><br><span class="line">    <span class="keyword">let</span> value</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="keyword">this</span>.vm</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// æ­¤æ—¶çš„ this.getter å®é™…ä¸Šå°±æ˜¯ updateComponent</span></span><br><span class="line">      value = <span class="keyword">this</span>.getter.call(vm, vm)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="comment">// ç•¥ï¼š...é”™è¯¯å¤„ç†</span></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="comment">// ç•¥ï¼š...é€’å½’è®¿é—® valueï¼Œè§¦å‘å®ƒæ‰€æœ‰å­é¡¹çš„ getter</span></span><br><span class="line">      <span class="keyword">this</span>.cleanupDeps()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>pushTarget</code> å°† <code>watcher</code> å®ä¾‹æŒ‚åˆ° <code>Dep</code> çš„ <code>target</code> è¿™ä¸ªé™æ€å±æ€§, ç”¨äº <code>Dep</code> å†…éƒ¨å¯ä»¥è®¿é—®åˆ°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pushTarget</span> (<span class="params">_target: ?Watcher</span>) </span>&#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">  Dep.target = _target</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ç€è°ƒç”¨ <code>this.getter</code>, è¿™é‡Œçš„ <code>this.getter</code> å®é™…ä¸Šå°±æ˜¯ <code>updateComponent</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm._update(vm._render(), hydrating)</span><br></pre></td></tr></table></figure><p><code>vm._render()</code> ä¼šç”Ÿæˆ VNodeï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šè®¿é—® vm ä¸Šçš„æ•°æ®ï¼Œè‡³æ­¤å°±ä¼šè§¦å‘æ•°æ®å¯¹è±¡çš„ getterï¼Œè¿›è¡Œä¾èµ–æ”¶é›†ã€‚</p><h5 id="æ€è·¯å°ç»“"><a href="#æ€è·¯å°ç»“" class="headerlink" title="æ€è·¯å°ç»“"></a>æ€è·¯å°ç»“</h5><p>è‡³æ­¤æˆ‘ä»¬å…ˆæ¢³ç†ä¸€ä¸‹è¿™ä¸€æ•´ä¸ªè¿‡ç¨‹ï¼Œä»¥å…é—å¿˜ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">beforeCreate =&gt; </span><br><span class="line">initState -&gt; observe -&gt; <span class="keyword">new</span> Observer</span><br><span class="line">  -&gt; defineReactiveï¼šå®ä¾‹åŒ– Depï¼ŒåŠ«æŒå¯¹è±¡å±æ€§ getter ä¸ setter</span><br><span class="line">=&gt; created</span><br><span class="line">=&gt; beforeMount</span><br><span class="line">  å®ä¾‹åŒ– Watcher -&gt; å°† watcher å®ä¾‹ç»‘å®šåˆ° Dep.targetï¼Œå¹¶è§¦å‘å¯¹è±¡å±æ€§çš„ getterï¼Œæ”¶é›†ä¾èµ–</span><br><span class="line">=&gt; mounted</span><br><span class="line">=&gt; å½“æ•°æ®æ¨¡å‹å˜æ›´æ—¶ï¼Œè§¦å‘ setterï¼Œæ›´æ–°è§†å›¾</span><br></pre></td></tr></table></figure><p>åœ¨ defineReactive ä¸­æœ‰ä¸ªå…³é”®çš„æ­¥éª¤æ˜¯å®ä¾‹åŒ– <code>Dep</code>ã€‚</p><h5 id="Dep"><a href="#Dep" class="headerlink" title="Dep"></a>Dep</h5><p>ä¸Šé¢è¯´è¿‡ Dep å®ä¾‹æ˜¯ä¸€ä¸ªå‘å¸ƒè€…ï¼Œå…¶ä»£ç å…¶å®å¾ˆç®€å•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Dep</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="keyword">this</span>.subs = []</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  addSub (sub: Watcher) &#123;</span><br><span class="line">    <span class="keyword">this</span>.subs.push(sub)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  removeSub (sub: Watcher) &#123;</span><br><span class="line">    remove(<span class="keyword">this</span>.subs, sub)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  depend () &#123;</span><br><span class="line">    <span class="keyword">if</span> (Dep.target) &#123;</span><br><span class="line">      <span class="comment">// è¿™é‡Œå°† Dep.target å³ watcher æ·»åŠ åˆ° subs é‡Œ</span></span><br><span class="line">      Dep.target.addDep(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  notify () &#123;</span><br><span class="line">    <span class="comment">// å‘å¸ƒé€šçŸ¥</span></span><br><span class="line">    <span class="keyword">const</span> subs = <span class="keyword">this</span>.subs.slice()</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = subs.length; i &lt; l; i++) &#123;</span><br><span class="line">      subs[i].update()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æœ€ç»ˆè°ƒç”¨çš„æ˜¯ <code>depend</code>æ–¹æ³•æ¥æ·»åŠ è§‚å¯Ÿè€…ï¼Œå³<code>Dep.target.addDep</code>ï¼Œæˆ‘ä»¬çŸ¥é“æ­¤æ—¶ Dep.target å®é™…ä¸Šå°±æ˜¯ watcher å®ä¾‹ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">addDep (dep: Dep) &#123;</span><br><span class="line">  <span class="keyword">const</span> id = dep.id</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">this</span>.newDepIds.has(id)) &#123;</span><br><span class="line">    <span class="comment">// å°†å‘å¸ƒè€… id æ·»åŠ åˆ° this.newDepIds</span></span><br><span class="line">    <span class="keyword">this</span>.newDepIds.add(id)</span><br><span class="line">    <span class="comment">// å°†å‘å¸ƒè€… æ·»åŠ åˆ° this.newDeps</span></span><br><span class="line">    <span class="keyword">this</span>.newDeps.push(dep)</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.depIds.has(id)) &#123;</span><br><span class="line">      <span class="comment">// å¦‚æœæ—§çš„ å‘å¸ƒè€…id åˆ—è¡¨ä¸­æ²¡æœ‰è¿™ä¸ªå‘å¸ƒè€… idï¼Œé‚£ä¹ˆå°±æ·»åŠ åˆ°å‘å¸ƒè€…çš„è§‚å¯Ÿè€…åˆ—è¡¨ä¸­</span></span><br><span class="line">      dep.addSub(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>è€Œåœ¨ watcher ä¸­ï¼Œæœ€ç»ˆè¿˜æ˜¯è°ƒç”¨äº†ä¼ å…¥çš„ dep å®ä¾‹çš„ addSub æ¥æ·»åŠ åˆ° dep çš„è§‚å¯Ÿè€…åˆ—è¡¨ä¸­ã€‚ä¹‹æ‰€ä»¥è¿™ä¹ˆè®¾è®¡ï¼Œå…¶åŸå› æ˜¯ä¸ºäº†èƒ½åœ¨ watcher ä¸­ç»´æŠ¤ä¸€ä¸ªè‡ªå·±è®¢é˜…çš„å‘å¸ƒè€…åˆ—è¡¨ã€‚</p><p>é‚£ä¹ˆ watcher ä¸­çš„å‘å¸ƒè€…åˆ—è¡¨æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿè¿˜è®°å¾— Watcher å®ä¾‹åŒ–çš„æœ€åä¼šè°ƒç”¨  <code>this.cleanupDeps()</code> å—ï¼Ÿ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cleanupDeps () &#123;</span><br><span class="line">  <span class="keyword">let</span> i = <span class="keyword">this</span>.deps.length</span><br><span class="line">  <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">    <span class="keyword">const</span> dep = <span class="keyword">this</span>.deps[i]</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.newDepIds.has(dep.id)) &#123;</span><br><span class="line">      dep.removeSub(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> tmp = <span class="keyword">this</span>.depIds</span><br><span class="line">  <span class="keyword">this</span>.depIds = <span class="keyword">this</span>.newDepIds</span><br><span class="line">  <span class="keyword">this</span>.newDepIds = tmp</span><br><span class="line">  <span class="keyword">this</span>.newDepIds.clear()</span><br><span class="line">  tmp = <span class="keyword">this</span>.deps</span><br><span class="line">  <span class="keyword">this</span>.deps = <span class="keyword">this</span>.newDeps</span><br><span class="line">  <span class="keyword">this</span>.newDeps = tmp</span><br><span class="line">  <span class="keyword">this</span>.newDeps.length = <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°å®é™…ä¸Šçš„ä½œç”¨æ˜¯ï¼š</p><ol><li><p>å¦‚æœæ— éœ€å†è§‚å¯Ÿï¼Œåˆ™ä»å‘å¸ƒè€…çš„è§‚å¯Ÿè€…åˆ—è¡¨ä¸­ç§»é™¤</p></li><li><p>å°†æœ¬æ¬¡çš„å‘å¸ƒè€… id åˆ—è¡¨è®°å½•åœ¨ this.depsIds ä¸­ï¼Œæ¸…ç©º this.newDepIds</p></li><li><p>å°†æœ¬æ¬¡çš„å‘å¸ƒè€…åˆ—è¡¨è®°å½•åœ¨ this.deps ä¸­ï¼Œæ¸…ç©º this.newDeps</p><p>é‚£ä¹ˆå…·ä½“æ˜¯å¦‚ä½•å°†å¯¹è±¡å±æ€§è½¬ä¸ºå“åº”å¼çš„å‘¢ï¼Œæˆ‘ä»¬çœ‹çœ‹å…¶å…·ä½“å®ç°ï¼š</p></li></ol><h5 id="reactiveGetter"><a href="#reactiveGetter" class="headerlink" title="reactiveGetter"></a>reactiveGetter</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reactiveGetter</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// æ­¤æ—¶çš„ Dep.target å°±æ˜¯ watcherï¼Œå…³äº Dep åé¢ä¼šè¯¦ç»†è§£é‡Š</span></span><br><span class="line">  <span class="keyword">if</span> (Dep.target) &#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œä¼šå°† watcher å®ä¾‹æ·»åŠ è¿› dep çš„ subs ä¸­ç»´æŠ¤ï¼Œå³æ”¶é›†ä¾èµ–</span></span><br><span class="line">    dep.depend()</span><br><span class="line">    <span class="keyword">if</span> (childOb) &#123;</span><br><span class="line">      <span class="comment">// å­å¯¹è±¡çš„ä¾èµ–æ”¶é›†</span></span><br><span class="line">      childOb.dep.depend()</span><br><span class="line">      <span class="comment">// ç•¥ï¼š...å¯¹æ•°ç»„çš„ä¸€äº›å¤„ç†</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è¿”å›å±æ€§å€¼</span></span><br><span class="line">  <span class="keyword">return</span> value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="reactiveSetter"><a href="#reactiveSetter" class="headerlink" title="reactiveSetter"></a>reactiveSetter</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reactiveSetter</span> (<span class="params">newVal</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// valueï¼šå±æ€§å€¼</span></span><br><span class="line">  <span class="keyword">const</span> value = ...</span><br><span class="line">  <span class="comment">// ç•¥ï¼š...ä¸€äº›åˆ¤æ–­æ˜¯å¦è§¦å‘ setter çš„æ¡ä»¶</span></span><br><span class="line">  <span class="keyword">if</span> (setter) &#123;</span><br><span class="line">    setter.call(obj, newVal)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    val = newVal</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è®¾ç½®æ–°å€¼åéœ€è¦é‡æ–° observe</span></span><br><span class="line">  childOb = !shallow &amp;&amp; observe(newVal)</span><br><span class="line">  <span class="comment">// å‘å¸ƒé€šçŸ¥</span></span><br><span class="line">  dep.notify()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>æœ¬æ–‡ç®€åŒ–äº†ä¸€äº›ç»†èŠ‚ï¼Œä½†æ˜¯ Vue çš„å“åº”å¼åŸç†å¤§è‡´å¦‚æ­¤ã€‚å½“ç†è§£äº†åŸç†ä¹‹åï¼Œå¦‚æœåé¢é—å¿˜äº†çš„è¯ï¼Œä»¥ä¸‹ä¸ºé‡è¦çš„è®°å¿†ç‚¹ï¼š</p><ol><li>observeï¼šå®ä¾‹åŒ– Observeï¼Œå‚æ•°ä¸ºæ•°æ®æ¨¡å‹ï¼Œå®ä¾‹åŒ–è¿‡ç¨‹ä¼šè°ƒç”¨éå†å¯¹è±¡å±æ€§è°ƒç”¨ defineReactive</li><li>defineReactiveï¼šå®ä¾‹åŒ– Depï¼ŒåŠ«æŒå¯¹è±¡å±æ€§çš„ getter ä¸ setterï¼Œgetter æ—¶è¿›è¡Œä¾èµ–æ”¶é›†</li><li>åœ¨æŒ‚è½½ç»„ä»¶çš„æ—¶å€™ï¼Œä¼šå®ä¾‹åŒ– Watcherï¼Œæ­¤æ—¶ä¼šè§¦å‘ getter</li><li>å½“æ›´æ–°å¯¹è±¡å±æ€§æ—¶ï¼Œä¼šè°ƒç”¨ Dep å®ä¾‹çš„ notifyï¼Œè§¦å‘ watcher çš„ update</li></ol>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>reactå¸¸è§é—®é¢˜è§£æ</title>
      <link href="/2020/08/10/react%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E6%9E%90/"/>
      <url>/2020/08/10/react%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>æ–­æ–­ç»­ç»­å¼€å§‹æ¢³ç†ä¸€äº› react çš„å¸¸è§é—®é¢˜ï¼Œå°†å°½å¯èƒ½ç»“åˆæºç æ¥è§£é‡Šã€‚å½“å‰ç‰ˆæœ¬ä¸º 16.xã€‚</p><a id="more"></a><h4 id="Qï¼šä¸ºä»€ä¹ˆ-react-ç»„ä»¶éœ€è¦-import-React-from-â€˜reactâ€™ï¼Ÿ"><a href="#Qï¼šä¸ºä»€ä¹ˆ-react-ç»„ä»¶éœ€è¦-import-React-from-â€˜reactâ€™ï¼Ÿ" class="headerlink" title="Qï¼šä¸ºä»€ä¹ˆ react ç»„ä»¶éœ€è¦ import React from â€˜reactâ€™ï¼Ÿ"></a>Qï¼šä¸ºä»€ä¹ˆ react ç»„ä»¶éœ€è¦ import React from â€˜reactâ€™ï¼Ÿ</h4><p>Aï¼šè¿™æ˜¯å› ä¸º babel åœ¨ç¼–è¯‘ jsx ä»£ç æ—¶ï¼Œæ˜¯è°ƒç”¨ React.createElement æ¥åˆ›å»ºä¸€ä¸ªç»„ä»¶ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è½¬æ¢å‰ï¼š&lt;div /&gt;</span><br><span class="line">è½¬æ¢åï¼šReact.createElement(<span class="string">"div"</span>, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure><h4 id="Qï¼šä¸ºä»€ä¹ˆ-react-ç»„ä»¶å¼€å¤´éœ€è¦å¤§å†™ï¼Ÿ"><a href="#Qï¼šä¸ºä»€ä¹ˆ-react-ç»„ä»¶å¼€å¤´éœ€è¦å¤§å†™ï¼Ÿ" class="headerlink" title="Qï¼šä¸ºä»€ä¹ˆ react ç»„ä»¶å¼€å¤´éœ€è¦å¤§å†™ï¼Ÿ"></a>Qï¼šä¸ºä»€ä¹ˆ react ç»„ä»¶å¼€å¤´éœ€è¦å¤§å†™ï¼Ÿ</h4><p>Aï¼šReact.createElement  çš„ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºç±»å‹ã€‚å¦‚æœå¼€å¤´å°å†™ï¼Œç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œæ­¤æ—¶ react ä¼šè®¤ä¸ºæ˜¯ä¸€ä¸ªåŸç”Ÿçš„ dom èŠ‚ç‚¹ã€‚è€Œå¦‚æœæ˜¯å¤§å†™ï¼Œåˆ™ç±»å‹ä¼šæ˜¯ä¸ªå˜é‡ï¼Œreact ä¼šè®¤ä¸ºè¿™æ˜¯ä¸ªè‡ªå®šä¹‰çš„ç»„ä»¶ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è½¬åŒ–å‰ï¼š&lt;Comp /&gt;</span><br><span class="line">è½¬åŒ–åï¼šReact.createElement(Comp, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure><h4 id="Qï¼šä¸ºä»€ä¹ˆè¯¸å¦‚-keyï¼Œref-ç­‰-props-ä¸ä¼šä¼ é€’ç»™ç»„ä»¶ï¼Ÿ"><a href="#Qï¼šä¸ºä»€ä¹ˆè¯¸å¦‚-keyï¼Œref-ç­‰-props-ä¸ä¼šä¼ é€’ç»™ç»„ä»¶ï¼Ÿ" class="headerlink" title="Qï¼šä¸ºä»€ä¹ˆè¯¸å¦‚ keyï¼Œref ç­‰ props ä¸ä¼šä¼ é€’ç»™ç»„ä»¶ï¼Ÿ"></a>Qï¼šä¸ºä»€ä¹ˆè¯¸å¦‚ keyï¼Œref ç­‰ props ä¸ä¼šä¼ é€’ç»™ç»„ä»¶ï¼Ÿ</h4><p>Aï¼šReact.createElement çš„ç¬¬äºŒä¸ªå‚æ•°ä¸º configï¼Œbabel è½¬åŒ–å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">è½¬åŒ–å‰ï¼š&lt;Comp props1=<span class="string">"props1"</span> props2=&#123;props2&#125; /&gt;</span><br><span class="line">è½¬åŒ–åï¼š</span><br><span class="line">React.createElement(Comp, &#123;</span><br><span class="line">  props1: <span class="string">"props1"</span>,</span><br><span class="line">  props2: props2</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>è€Œåœ¨ç”Ÿæˆ props æ—¶ä¼šå°†ä¿ç•™å±æ€§ç§»é™¤å‡ºå»çš„ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (propName <span class="keyword">in</span> config) &#123;</span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    hasOwnProperty.call(config, propName) &amp;&amp;</span><br><span class="line">    !RESERVED_PROPS.hasOwnProperty(propName)</span><br><span class="line">  ) &#123;</span><br><span class="line">    props[propName] = config[propName];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿ç•™å±æ€§å°±åŒ…æ‹¬äº† key å’Œ refï¼Œå› æ­¤ä¸ä¼šä¼ ç»™ç»„ä»¶ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> RESERVED_PROPS = &#123;</span><br><span class="line">  key: <span class="literal">true</span>,</span><br><span class="line">  ref: <span class="literal">true</span>,</span><br><span class="line">  __self: <span class="literal">true</span>,</span><br><span class="line">  __source: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="Q-props-children-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Q-props-children-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Q: props.children æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Q: props.children æ˜¯ä»€ä¹ˆï¼Ÿ</h4><p>Aï¼šprops.children æ˜¯ç»„ä»¶çš„å­èŠ‚ç‚¹åˆé›†ï¼Œbabel è½¬åŒ–å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">è½¬æ¢å‰ï¼š</span><br><span class="line">&lt;Comp&gt;</span><br><span class="line">  &lt;div&gt;<span class="number">1</span>&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;span&gt;2&lt;/</span>span&gt;</span><br><span class="line">&lt;<span class="regexp">/Comp&gt;</span></span><br><span class="line"><span class="regexp">è½¬æ¢åï¼š</span></span><br><span class="line"><span class="regexp">React.createElement(Comp, null,</span></span><br><span class="line"><span class="regexp">React.createElement("div", null, "1"), </span></span><br><span class="line"><span class="regexp">React.createElement("span", null, "2")</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure><p>React.createElement è™½ç„¶åªå£°æ˜äº†ä¸‰ä¸ªå‚æ•°ï¼Œå®é™…ä¸Šä»ç¬¬ä¸‰ä¸ªå‚æ•°å¼€å§‹å°±éƒ½æ˜¯å­èŠ‚ç‚¹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">createElement(type, config, children)</span><br></pre></td></tr></table></figure><p>åœ¨ç”Ÿæˆ props.children æ—¶ï¼Œå¦‚æœæ˜¯å•ä¸ªå­èŠ‚ç‚¹ï¼Œåˆ™ç›´æ¥èµ‹å€¼ç»™ props.childrenï¼Œå¦‚æœæœ‰å¤šä¸ªå­èŠ‚ç‚¹å°†è¿™äº›èŠ‚ç‚¹åˆæˆä¸€ä¸ªæ•°ç»„ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> childrenLength = <span class="built_in">arguments</span>.length - <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">if</span> (childrenLength === <span class="number">1</span>) &#123;</span><br><span class="line">    props.children = children;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childrenLength &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> childArray = <span class="built_in">Array</span>(childrenLength);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; childrenLength; i++) &#123;</span><br><span class="line">      childArray[i] = <span class="built_in">arguments</span>[i + <span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">Object</span>.freeze) &#123;</span><br><span class="line">        <span class="built_in">Object</span>.freeze(childArray);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    props.children = childArray;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="Q-React-children-map"><a href="#Q-React-children-map" class="headerlink" title="Q: React.children.map"></a>Q: React.children.map</h4><h4 id="Q-React-éå†å…ƒç´ çš„-key-å±æ€§"><a href="#Q-React-éå†å…ƒç´ çš„-key-å±æ€§" class="headerlink" title="Q: React éå†å…ƒç´ çš„ key å±æ€§"></a>Q: React éå†å…ƒç´ çš„ key å±æ€§</h4><h4 id="Qï¼šä»€ä¹ˆæ˜¯-Fiberï¼Ÿ"><a href="#Qï¼šä»€ä¹ˆæ˜¯-Fiberï¼Ÿ" class="headerlink" title="Qï¼šä»€ä¹ˆæ˜¯ Fiberï¼Ÿ"></a>Qï¼šä»€ä¹ˆæ˜¯ Fiberï¼Ÿ</h4><p>Aï¼šæ¯ä¸ª ReactElement éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ Fiberï¼ŒFiber ä¸Šè®°å½•äº†ç»„ä»¶çš„å„ç§çŠ¶æ€ã€‚åŒæ—¶ Fiber é€šè¿‡ childï¼Œsiblingï¼Œä»¥åŠ return æ¥è®°å½•å…¶å­ï¼Œå…„å¼Ÿä»¥åŠçˆ¶èŠ‚ç‚¹çš„ Fiberã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;parent&quot;&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;son&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;child1&quot; &#x2F;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;child2&quot; &#x2F;&gt;</span><br><span class="line">  &lt;&#x2F;div&gt;</span><br><span class="line">  &lt;div class&#x3D;&quot;son2&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆ Fiber éå†æ‰€æœ‰èŠ‚ç‚¹çš„é¡ºåºä¸ºï¼š</p><img src="https://images.gitee.com/uploads/images/2020/0826/084732_693094f2_1748283.png" alt="fiber" style="zoom:50%;" /><p>éå†çš„é¡ºåºä¸ºï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸€ç›´éå†åˆ°æœ€åä¸€ä¸ªå±‚çº§çš„å¶å­ç»“ç‚¹</span></span><br><span class="line">FiberRoot -&gt; RootFiber -&gt; App -&gt; parent -&gt; son -&gt; child</span><br><span class="line"><span class="comment">// ç„¶åæŸ¥æ‰¾å…„å¼ŸèŠ‚ç‚¹</span></span><br><span class="line">child -&gt; child2</span><br><span class="line"><span class="comment">// å¦‚æœå…„å¼ŸèŠ‚ç‚¹ä¹Ÿæ²¡æœ‰å­èŠ‚ç‚¹ï¼Œåˆ™ return ï¼Œå³è¿”å›çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">child2 -&gt; son -&gt; son2 -&gt; parent -&gt; App -&gt; RootFiber -&gt; FiberRoot</span><br></pre></td></tr></table></figure><h4 id="Qï¼šconcurrent-modeï¼Ÿ"><a href="#Qï¼šconcurrent-modeï¼Ÿ" class="headerlink" title="Qï¼šconcurrent modeï¼Ÿ"></a>Qï¼šconcurrent modeï¼Ÿ</h4><h4 id="Qï¼šReact-Fiber-Reconcilerï¼Ÿ"><a href="#Qï¼šReact-Fiber-Reconcilerï¼Ÿ" class="headerlink" title="Qï¼šReact Fiber Reconcilerï¼Ÿ"></a>Qï¼šReact Fiber Reconcilerï¼Ÿ</h4>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼-JSä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼ä¸å‘å¸ƒè®¢é˜…æ¨¡å¼</title>
      <link href="/2020/08/08/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-JS%E4%B8%AD%E7%9A%84%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E4%B8%8E%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F/"/>
      <url>/2020/08/08/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-JS%E4%B8%AD%E7%9A%84%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E4%B8%8E%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ã€Šdebounceä¸throttleã€‹ ä¸­æåˆ°äº† RxJSï¼Œ RxJS ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µ: Observableï¼ˆå¯è¢«è§‚å¯Ÿè€…ï¼‰ å’Œ Observerï¼ˆè§‚å¯Ÿè€…ï¼‰ï¼ŒRxJS çš„ Observable å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼å’Œè¿­ä»£å™¨æ¨¡å¼çš„ç»„åˆã€‚</p><p>åœ¨ javascript ä¸­ï¼Œè§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼æä¸ºç›¸ä¼¼ï¼Œå› æ­¤æœ¬æ–‡å°†æ¢è®¨è¿™ä¸¤ç§æ¨¡å¼ä»¥åŠå…¶åº”ç”¨ã€‚</p> <a id="more"></a><h4 id="è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver-patternï¼‰"><a href="#è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver-patternï¼‰" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver patternï¼‰"></a>è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver patternï¼‰</h4><blockquote><p>è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œè®©å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬æŸä¸€ä¸ªç›®æ ‡å¯¹è±¡ï¼Œå½“è¿™ä¸ªç›®æ ‡å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡ï¼Œä½¿å®ƒä»¬èƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°ã€‚ â€”â€” Graphic Design Patterns</p></blockquote><p>è§‚å¯Ÿè€…æ¨¡å¼æœ‰ä¸¤ä¸ªå¯¹è±¡ï¼šä¸€ä¸ªæ˜¯è§‚å¯Ÿè€…ï¼Œå¦ä¸€ä¸ªä¸Šé¢æåˆ°çš„ç›®æ ‡å¯¹è±¡å¯ä»¥ç§°ä¸ºæ˜¯å‘å¸ƒè€…ï¼ŒåŸºæœ¬çš„æµç¨‹ä¸ºï¼š</p><ol><li>å‘å¸ƒè€…ç»´æŠ¤ä¸€ä¸ªè§‚å¯Ÿè€…åˆ—è¡¨ï¼Œå¯ä»¥æ·»åŠ æˆ–è€…åˆ é™¤è§‚å¯Ÿè€…</li><li>å½“å‘å¸ƒè€…å‘å¸ƒé€šçŸ¥æ—¶ï¼Œéå†è§‚å¯Ÿè€…åˆ—è¡¨ï¼Œå¹¶è°ƒç”¨è§‚å¯Ÿè€…æä¾›çš„æ–¹æ³•</li></ol><p>å‘å¸ƒè€…çš„å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‘å¸ƒè€…</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Publisher</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="comment">// ç»´æŠ¤ä¸€ä¸ªè§‚å¯Ÿè€…åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">this</span>.observers = []</span><br><span class="line">    </span><br><span class="line">  &#125;    </span><br><span class="line">  <span class="comment">// æ·»åŠ è§‚å¯Ÿè€…</span></span><br><span class="line">  addObserver(observer) &#123;</span><br><span class="line">    <span class="keyword">this</span>.observers.push(observer)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ç§»é™¤è§‚å¯Ÿè€…</span></span><br><span class="line">  removeObserver(observer) &#123;</span><br><span class="line">    <span class="keyword">this</span>.observers = <span class="keyword">this</span>.observers.filter(<span class="function"><span class="params">item</span> =&gt;</span> item !== observer)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å‘å¸ƒé€šçŸ¥</span></span><br><span class="line">  notify() &#123;</span><br><span class="line">    <span class="keyword">this</span>.observers.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// æ‰§è¡Œè§‚å¯Ÿè€…æä¾›çš„æ–¹æ³•ï¼Œè¿™é‡Œå‡è®¾ä¸º update</span></span><br><span class="line">      item.update()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¢é˜…è€…åˆ™æ¯”è¾ƒç®€å•ï¼Œå®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">  &#125;</span><br><span class="line">  update() &#123;</span><br><span class="line">    <span class="comment">// æ›´æ–°çŠ¶æ€</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`observer <span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span> update`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> Observer(<span class="string">'a'</span>)</span><br><span class="line"><span class="keyword">const</span> b = <span class="keyword">new</span> Observer(<span class="string">'b'</span>)</span><br><span class="line"><span class="keyword">const</span> c = <span class="keyword">new</span> Observer(<span class="string">'c'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> publisher = <span class="keyword">new</span> Publisher()</span><br><span class="line">publisher.addObserver(a)</span><br><span class="line">publisher.addObserver(b)</span><br><span class="line">publisher.addObserver(c)</span><br><span class="line"><span class="comment">// å‘å¸ƒé€šçŸ¥</span></span><br><span class="line">publisher.notify()</span><br><span class="line"><span class="comment">// a b c</span></span><br></pre></td></tr></table></figure><p>Vue çš„å“åº”å¼åŸç†å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼çš„ä¸€ä¸ªå…¸å‹åº”ç”¨ï¼Œå…³äº Vue çš„å“åº”å¼ç”±äºç¯‡å¹…åŸå› ï¼Œå°†ä¼šå¦èµ·ä¸€ç¯‡è¯¦ç»†åˆ†æã€‚</p><h4 id="å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆPub-sub-patternï¼‰"><a href="#å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆPub-sub-patternï¼‰" class="headerlink" title="å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆPub-sub patternï¼‰"></a>å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆPub-sub patternï¼‰</h4><p>å‘å¸ƒè®¢é˜…æ¨¡å¼æ˜¯ä»è§‚å¯Ÿè€…æ¨¡å¼å‘å±•è€Œæ¥ï¼Œä¸¤è€…çš„åŒºåˆ«åœ¨äºï¼šè§‚å¯Ÿè€…æ¨¡å¼ä¸­å‘å¸ƒè€…ä¸è§‚å¯Ÿè€…æ˜¯æ¾è€¦åˆï¼Œè€Œå‘å¸ƒè®¢é˜…åˆ™åœ¨å‘å¸ƒè€…ä¸è®¢é˜…è€…ä¸­åŠ å…¥äº†äº‹ä»¶ä¸­å¿ƒå®ç°å‘å¸ƒè€…ä¸è§‚å¯Ÿè€…çš„å®Œå…¨è§£è€¦ã€‚</p><p>ç”¨å‘å¸ƒè®¢é˜…æ¨¡å¼æ¨¡æ‹Ÿäº‹ä»¶ç»‘å®šï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventCenter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">this</span>.observers = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  addListener(type, fn) &#123;</span><br><span class="line">    <span class="keyword">this</span>.observers[type] = [...(<span class="keyword">this</span>.observers[type] || []), fn]</span><br><span class="line">  &#125;</span><br><span class="line">  removeListener(type, fn) &#123;</span><br><span class="line">    <span class="keyword">let</span> listeners = <span class="keyword">this</span>.observers[type];</span><br><span class="line">    <span class="keyword">if</span> (!listeners || !listeners.length) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">this</span>.observers[type] = listeners.filter(<span class="function"><span class="params">v</span> =&gt;</span> v !== fn);</span><br><span class="line">  &#125;</span><br><span class="line">  dispatchEvent(type) &#123;</span><br><span class="line">    <span class="keyword">let</span> listeners = <span class="keyword">this</span>.observers[type];</span><br><span class="line">    <span class="keyword">if</span> (!listeners || !listeners.length) <span class="keyword">return</span>;</span><br><span class="line">    listeners.forEach(<span class="function"><span class="params">fn</span> =&gt;</span> fn());        </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> evtCenter = <span class="keyword">new</span> EventCenter()</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleClick</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'click'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è®¢é˜… click äº‹ä»¶</span></span><br><span class="line">evtCenter.addListener(<span class="string">'click'</span>, handleClick)</span><br><span class="line"><span class="comment">// å‘å¸ƒ click äº‹ä»¶</span></span><br><span class="line">evtCenter.dispatchEvent(<span class="string">'click'</span>)</span><br><span class="line"><span class="comment">// å–æ¶ˆè®¢é˜…</span></span><br><span class="line">evtCenter.removeListener(<span class="string">'click'</span>, handleClick)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä¸è§‚å¯Ÿè€…æ¨¡å¼ä¸åŒï¼Œåœ¨å‘å¸ƒè®¢é˜…æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬çš„å‘å¸ƒå’Œè®¢é˜…éƒ½æ˜¯é€šè¿‡äº‹ä»¶ä¸­å¿ƒæ¥è¿›è¡Œè°ƒåº¦çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>debounceä¸throttle</title>
      <link href="/2020/08/06/debounce%E4%B8%8Ethrottle/"/>
      <url>/2020/08/06/debounce%E4%B8%8Ethrottle/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>æµ‹è¯•åŒå­¦æäº†ä¸ª bugï¼Œåœ¨æœç´¢æ¡†ä¸­ç–¯ç‹‚è¾“å…¥æ–‡å­—ï¼Œä¸ä¸€ä¼šå„¿æ¥å£å°±æŠ¥é”™äº†ã€‚è¿™ä¸ª bug å®é™…ä¸Šå°±æ˜¯ç”±äºæ¯è¾“å…¥ä¸€ä¸ªå­—ç¬¦æ—¶ï¼Œå°±å»è¯·æ±‚æ¥å£å¼•èµ·çš„ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handleSearch = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// ...è¯·æ±‚æ¥å£</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;Input onChange=&#123;handleSearch&#125; /&gt;</span><br></pre></td></tr></table></figure><p>è§£å†³æ–¹æ³•æ˜¯é€šè¿‡ <code>debounce</code> æ¥æ§åˆ¶è¾“å…¥çš„é¢‘ç‡ã€‚</p><p>å®é™…ä¸Š <code>debounce</code> å’Œ <code>throttle</code> è¿™ä¸¤ä¸ªæ¦‚å¿µç»å¸¸æ˜¯ä¸€èµ·å‡ºç°ï¼Œåœ¨å·¥ä½œä¸­ä¹Ÿå¸¸å¸¸ä½¿ç”¨åˆ°ã€‚åœ¨æ—©å¹´æ¥è§¦å‰ç«¯çš„æ—¶å€™ï¼Œé¡¹ç›®é‡Œæœ‰ <code>lodash</code>ï¼Œå› æ­¤ç›´æ¥ä½¿ç”¨å…¶æä¾›çš„  <code>debounce</code> å’Œ <code>throttle</code> ã€‚è€Œåœ¨ä¸€äº›ç®€å•çš„é¡¹ç›®é‡Œï¼Œå¾€å¾€ä¸å¼•å…¥ <code>lodash</code>ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦è‡ªå·±å®ç°ï¼Œäºæ­¤åšä¸ªè®°å½•ã€‚</p><a id="more"></a><h4 id="debounce"><a href="#debounce" class="headerlink" title="debounce"></a>debounce</h4><p><code>debounce</code> ä¹Ÿå°±æ˜¯é˜²æŠ–ï¼Œçœ‹çœ‹ lodash ä¸­ debounce çš„å®šä¹‰ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_.debounce(func, [wait=<span class="number">0</span>], [options=&#123;&#125;])</span><br></pre></td></tr></table></figure><p>è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šè·ç¦»ä¸Šæ¬¡è°ƒç”¨åï¼Œå»¶è¿Ÿ <code>wait</code> æ¯«ç§’åè°ƒç”¨<code>func</code>ã€‚</p><p>åœ¨ä¸Šé¢çš„ bug ä¸­ï¼Œå¯¹åŸæœç´¢æ–¹æ³•è¿›è¡Œé˜²æŠ–å¤„ç†åï¼Œä»…å½“ç”¨æˆ·åœæ­¢è¾“å…¥ 300 æ¯«ç§’åï¼Œæ‰è¯·æ±‚æ¥å£è¿›è¡Œæœç´¢ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœæ­¢è¾“å…¥ 300 ms åï¼Œè¿›è¡Œæœç´¢</span></span><br><span class="line">_.debounce(handleSearch, <span class="number">300</span>)</span><br></pre></td></tr></table></figure><p>####throttle</p><p><code>throttle</code> æˆ‘ä»¬ç§°ä¹‹ä¸ºæˆªæµï¼ŒåŒæ ·çœ‹çœ‹ loads ä¸­ throttle çš„å®šä¹‰ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_.throttle(func, [wait=<span class="number">0</span>], [options=&#123;&#125;])</span><br></pre></td></tr></table></figure><p>è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æœ€å¤šæ¯ <code>wait</code> æ¯«ç§’è°ƒç”¨ä¸€æ¬¡ <code>func</code>ã€‚</p><p>å¦‚æœå¯¹æœç´¢æ–¹æ³•è¿›è¡Œæˆªæµï¼Œåˆ™æ— è®ºç”¨æˆ·è¾“å…¥å¤šå¿«ï¼Œæ¯ 1 ç§’ä»…è¯·æ±‚ä¸€æ¬¡ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœæ­¢è¾“å…¥ 300 ms åï¼Œè¿›è¡Œæœç´¢</span></span><br><span class="line">_.debounce(handleSearch, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure><h4 id="æ‰‹å†™ä¸€ä¸ª-debounce"><a href="#æ‰‹å†™ä¸€ä¸ª-debounce" class="headerlink" title="æ‰‹å†™ä¸€ä¸ª debounce"></a>æ‰‹å†™ä¸€ä¸ª debounce</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">func, wait = <span class="number">0</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> timeout</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(timeout) &#123;</span><br><span class="line">      clearTimeout(timeout)</span><br><span class="line">    &#125;</span><br><span class="line">    timeout = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> func.call(<span class="keyword">this</span>, ...args), wait)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äº func è¢«å½“ä½œæ˜¯å‚æ•°ä¼ é€’è¿›æ¥ï¼Œæ³¨æ„ä¸Šé¢çš„ func éœ€è¦ç»‘å®š thisã€‚å¹¶ä¸”åœ¨ä½¿ç”¨æ—¶å¦‚æœæœ‰ this æŒ‡å‘ï¼Œéœ€è¦æ˜¾å¼æŒ‡æ˜ thisï¼Œå¦‚ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> o = &#123;</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  b: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="keyword">this</span>.a);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> c = debounce(o.b).bind(o);</span><br></pre></td></tr></table></figure><p>å¯¹ debounce è¿›ä¸€æ­¥æ‹“å±•ï¼Œå¦‚æœéœ€è¦åœ¨è°ƒç”¨æ—¶ç«‹åˆ»æ‰§è¡Œä¸€æ¬¡ï¼Œåˆ™å¯ä»¥ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">debounce</span>(<span class="params">func, wait = <span class="number">0</span>, head</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> timeout;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> callNow = head &amp;&amp; !timeout;</span><br><span class="line">    timeout &amp;&amp; clearTimeout(timeout);</span><br><span class="line">    timeout = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(!callNow) &#123;</span><br><span class="line">        func.call(<span class="keyword">this</span>, ...args);</span><br><span class="line">      &#125;</span><br><span class="line">      timeout = <span class="literal">null</span></span><br><span class="line">    &#125;, wait);</span><br><span class="line">    <span class="keyword">if</span> (callNow) &#123;</span><br><span class="line">      func.call(<span class="keyword">this</span>, ...args)</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ‰‹å†™ä¸€ä¸ª-throttle"><a href="#æ‰‹å†™ä¸€ä¸ª-throttle" class="headerlink" title="æ‰‹å†™ä¸€ä¸ª throttle"></a>æ‰‹å†™ä¸€ä¸ª throttle</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">throttle</span>(<span class="params">func, timeFrame = <span class="number">0</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> lastTime = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">      <span class="keyword">if</span> (now - lastTime &gt;= timeFrame) &#123;</span><br><span class="line">          func.call(<span class="keyword">this</span>, ...args);</span><br><span class="line">          lastTime = now;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="whatâ€™s-more-rxjs"><a href="#whatâ€™s-more-rxjs" class="headerlink" title="whatâ€™s more: rxjs"></a>whatâ€™s more: rxjs</h4><p>æˆªæµå’Œé˜²æŠ–å¾ˆå¤šæ—¶å€™æ˜¯å‡ºç°åœ¨äº‹ä»¶ä¸­çš„ï¼Œä½¿ç”¨ rxjs åˆ™å¯ä»¥ä½¿ç”¨ debounceTime å’Œ throttleTimeï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fromEvent &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; debounceTime &#125; <span class="keyword">from</span> <span class="string">'rxjs/operators'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> inputEle = <span class="built_in">document</span>.getElementById(<span class="string">'input'</span>)</span><br><span class="line"><span class="keyword">const</span> inputs = fromEvent(inputEle, <span class="string">'input'</span>);</span><br><span class="line"><span class="keyword">const</span> result = inputs.pipe(debounceTime(<span class="number">1000</span>));</span><br><span class="line"><span class="comment">// å¦‚æœæ˜¯èŠ‚æµå¯ä½¿ç”¨ throttleTime</span></span><br><span class="line"><span class="comment">// const result = inputs.pipe(throttleTime(1000));</span></span><br><span class="line">result.subscribe(<span class="function"><span class="params">x</span> =&gt;</span> <span class="built_in">console</span>.log(x));</span><br></pre></td></tr></table></figure><h4 id="rxjs-react"><a href="#rxjs-react" class="headerlink" title="rxjs + react"></a>rxjs + react</h4><p>å¦‚æœæ˜¯ react ä¸­çš„äº‹ä»¶éœ€è¦é˜²æŠ–ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ <code>Subject</code> æ¥å®ç°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; useEffect &#125; from &quot;react&quot;;</span><br><span class="line">import &#123; Subject &#125; from &quot;rxjs&quot;;</span><br><span class="line">import &quot;rxjs&#x2F;add&#x2F;operator&#x2F;debounceTime&quot;;</span><br><span class="line"></span><br><span class="line">const value$ &#x3D; new Subject().debounceTime(300);</span><br><span class="line"></span><br><span class="line">export default function App() &#123;</span><br><span class="line">  useEffect(() &#x3D;&gt; &#123;</span><br><span class="line">    const subscription &#x3D; value$.subscribe(console.log)</span><br><span class="line">      return () &#x3D;&gt; subscription.unsubscribe()</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  const onChange &#x3D; e &#x3D;&gt; &#123;</span><br><span class="line">    value$.next(e.target.value);</span><br><span class="line">  &#125;;</span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;input onChange&#x3D;&#123;onChange&#125; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å½“æˆ‘ä»¬è¯´åˆ°æ‰“åŒ…æ—¶ï¼Œæˆ‘ä»¬åœ¨è¯´ä»€ä¹ˆ</title>
      <link href="/2020/07/31/%E5%BD%93%E6%88%91%E4%BB%AC%E8%AF%B4%E5%88%B0%E6%89%93%E5%8C%85%E6%97%B6%EF%BC%8C%E6%88%91%E4%BB%AC%E5%9C%A8%E8%AF%B4%E4%BB%80%E4%B9%88/"/>
      <url>/2020/07/31/%E5%BD%93%E6%88%91%E4%BB%AC%E8%AF%B4%E5%88%B0%E6%89%93%E5%8C%85%E6%97%B6%EF%BC%8C%E6%88%91%E4%BB%AC%E5%9C%A8%E8%AF%B4%E4%BB%80%E4%B9%88/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>ä»æ—©æœŸçš„ grunt (æˆ‘æ¥è§¦å‰ç«¯å¼€å‘çš„æ—¶å€™è¿™ä¸ªå·²ç»è¶‹äºæ²¡è½) åˆ° gulpï¼Œå†åˆ°å¦‚ä»Šçš„ webpackï¼Œrollup ï¼Œparcelï¼Œä»¥åŠ snowpackï¼Œviteï¼Œå¦‚ä»Šçš„å‰ç«¯å·²ç»è„±ç¦»äº†åˆ€è€•ç«ç§çš„æ—¶ä»£ï¼Œå„ç§æ‰“åŒ…å·¥å…·å±‚å‡ºä¸ç©·ã€‚å‰ç«¯é¡¹ç›®åŸºæœ¬ç¦»ä¸å¼€æ‰“åŒ…è¿™ä¸ªè¿‡ç¨‹ã€‚é‚£ä¹ˆå½“æˆ‘ä»¬è¯´åˆ°æ‰“åŒ…ï¼ˆbundleï¼‰æ—¶ï¼Œæˆ‘ä»¬åœ¨è¯´çš„æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>è¿™é‡Œä¸å¯¹ webpack æˆ–è€…è¿™äº›æ‰“åŒ…å·¥å…·çš„ä½¿ç”¨è¿›è¡Œå…·ä½“è¯´æ˜ï¼Œæœ¬æ–‡æƒ³æ¢ç©¶çš„æ˜¯æ‰“åŒ…çš„æœ¬è´¨ã€‚</p><a id="more"></a><h4 id="ä»æ¨¡å—åŒ–è¯´èµ·"><a href="#ä»æ¨¡å—åŒ–è¯´èµ·" class="headerlink" title="ä»æ¨¡å—åŒ–è¯´èµ·"></a>ä»æ¨¡å—åŒ–è¯´èµ·</h4><p>åœ¨æ²¡æœ‰æ¨¡å—åŒ–ä¹‹å‰ï¼Œå‰ç«¯å¼€å‘æ—¶éœ€è¦æ ¼å¤–æ³¨æ„å‘½åå†²çªä»¥åŠæ–‡ä»¶ä¹‹é—´çš„ç›¸äº’ä¾èµ–ï¼Œå‚è€ƒ <a href="https://github.com/seajs/seajs/issues/547#issue-11105836ã€‚" target="_blank" rel="noopener">https://github.com/seajs/seajs/issues/547#issue-11105836ã€‚</a></p><p>æ¨¡å—åŒ–å®é™…ä¸Šå°±æ˜¯å°†ç¨‹åºåˆ†è§£æˆç¦»æ•£çš„åŠŸèƒ½å—ï¼Œä½¿ä»£ç æ˜“äºå¤ç”¨ï¼Œç»´æŠ¤å’Œæµ‹è¯•ã€‚å¦‚ less ä¸­é€šè¿‡ @import å¼•å…¥çš„æ ·å¼ï¼ŒES6 Module / CommonJs å¼•å…¥çš„ Js ç­‰éƒ½å¯ä»¥ç§°ä¸ºæ¨¡å—ã€‚</p><p>ç„¶è€Œæµè§ˆå™¨ä¸æ”¯æŒæ¨¡å—åŒ–ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ‰“åŒ…å·¥å…·ï¼Œå°†ä»£ç ä¸­è¯¸å¦‚ require, @import, import è¿›æ¥çš„æ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæˆ–è€…å¤šä¸ªæ–‡ä»¶(å³ bundle)ã€‚</p><h4 id="æ‰“åŒ…çš„æœ¬è´¨"><a href="#æ‰“åŒ…çš„æœ¬è´¨" class="headerlink" title="æ‰“åŒ…çš„æœ¬è´¨"></a>æ‰“åŒ…çš„æœ¬è´¨</h4><p>å‚è€ƒ webpack çš„å®šä¹‰ï¼š</p><blockquote><p>æœ¬è´¨ä¸Šï¼Œ<em>webpack</em> æ˜¯ä¸€ä¸ªç°ä»£ JavaScript åº”ç”¨ç¨‹åºçš„<em>é™æ€æ¨¡å—æ‰“åŒ…å™¨(module bundler)</em>ã€‚å½“ webpack å¤„ç†åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šé€’å½’åœ°æ„å»ºä¸€ä¸ª<em>ä¾èµ–å…³ç³»å›¾(dependency graph)</em>ï¼Œå…¶ä¸­åŒ…å«åº”ç”¨ç¨‹åºéœ€è¦çš„æ¯ä¸ªæ¨¡å—ï¼Œç„¶åå°†æ‰€æœ‰è¿™äº›æ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæˆ–å¤šä¸ª <em>bundle</em>ã€‚</p></blockquote><p>è€Œè‡³äºè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¯¹ä»£ç è¿›è¡Œå‹ç¼©ï¼Œæ··æ·†ç­‰ç­‰åˆ™æ˜¯é”¦ä¸Šæ·»èŠ±çš„åŠŸèƒ½ã€‚</p><h4 id="æ‰“åŒ…çš„è¿‡ç¨‹"><a href="#æ‰“åŒ…çš„è¿‡ç¨‹" class="headerlink" title="æ‰“åŒ…çš„è¿‡ç¨‹"></a>æ‰“åŒ…çš„è¿‡ç¨‹</h4><p>è¿™é‡Œä»¥ webpack ä¸ºä¾‹ï¼š</p><ol><li>åˆå§‹åŒ–ï¼šä»é…ç½®æ–‡ä»¶å’Œ Shell è¯­å¥ä¸­è¯»å–å¹¶åˆå¹¶é…ç½®å‚æ•°</li><li>å¼€å§‹ç¼–è¯‘ï¼šæ ¹æ®ä¸Šé¢å¾—åˆ°çš„å‚æ•°åˆå§‹åŒ– Compilerï¼ŒåŠ è½½æ’ä»¶ï¼ˆPluginsï¼‰ï¼Œæ‰§è¡Œ Compiler çš„ run æ–¹æ³•å¼€å§‹ç¼–è¯‘</li><li>å…¥å£æ–‡ä»¶ï¼šé…ç½®çš„ entry</li><li>ä»å…¥å£æ–‡ä»¶å¼€å§‹ï¼Œé’ˆå¯¹ä¸åŒçš„æ¨¡å—ä½¿ç”¨å¯¹åº”çš„ Loader ç¼–è¯‘ï¼Œå†æ‰¾åˆ°è¯¥æ¨¡å—æ‰€ä¾èµ–çš„æ¨¡å—ï¼Œé€’å½’è¿™ä¸ªæ­¥éª¤</li><li>å®Œæˆç¼–è¯‘ï¼šç»è¿‡ä¸Šè¿°æ­¥éª¤åå¾—åˆ°æ¯ä¸ªæ¨¡å—ç¼–è¯‘åçš„å†…å®¹ä»¥åŠç›¸äº’ä¹‹é—´çš„ä¾èµ–å…³ç³»</li><li>è¾“å‡ºï¼šæ ¹æ®ä¾èµ–å…³ç³»ï¼Œå°†æ¨¡å—ç»„åˆæˆä¸€ä¸ªä¸ªä»£ç å—ï¼ˆChunkï¼‰ï¼Œæœ€åè¾“å‡ºæˆæ–‡ä»¶</li></ol><h4 id="å®ç°ä¸€ä¸ªç®€æ˜“çš„æ‰“åŒ…å·¥å…·"><a href="#å®ç°ä¸€ä¸ªç®€æ˜“çš„æ‰“åŒ…å·¥å…·" class="headerlink" title="å®ç°ä¸€ä¸ªç®€æ˜“çš„æ‰“åŒ…å·¥å…·"></a>å®ç°ä¸€ä¸ªç®€æ˜“çš„æ‰“åŒ…å·¥å…·</h4><p>å‚è€ƒ <a href="https://github.com/ronami" target="_blank" rel="noopener">ronami</a>/<strong><a href="https://github.com/ronami/minipack" target="_blank" rel="noopener">minipack</a></strong> å®ç°ä¸€ä¸ªæ”¯æŒ ES Module çš„ç®€æ˜“æ‰“åŒ…å·¥å…·ï¼ˆè¿™é‡Œä¸è€ƒè™‘å¾ªç¯ä¾èµ–ç­‰æƒ…å†µï¼‰ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>)</span><br><span class="line"><span class="keyword">const</span> babylon = <span class="built_in">require</span>(<span class="string">'babylon'</span>)</span><br><span class="line"><span class="keyword">const</span> traverse = <span class="built_in">require</span>(<span class="string">'babel-traverse'</span>).default</span><br><span class="line"><span class="keyword">const</span> &#123; transformFromAst &#125; = <span class="built_in">require</span>(<span class="string">'babel-core'</span>)</span><br></pre></td></tr></table></figure><p>å¼•å…¥ä¸Šè¿°ç›¸å…³ä¾èµ–ï¼š</p><ul><li>babylonï¼šç”Ÿæˆ ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰</li><li>babel-traverseï¼šæ¥åˆ†ææ–‡ä»¶çš„ä¾èµ–</li><li>transformFromAstï¼šå°† AST è½¬ä¸º ES5</li></ul><p><strong>é¦–å…ˆ</strong> å®šä¹‰ä¸€ä¸ªå‡½æ•°ç”¨äºè¯»å–æ–‡ä»¶çš„å†…å®¹å’Œä¾èµ–ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¯»å–æ–‡ä»¶å†…å®¹å’Œä¾èµ–</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createAsset</span>(<span class="params">filePath</span>) </span>&#123;</span><br><span class="line"><span class="comment">// è¯»å–æ–‡ä»¶å†…å®¹</span></span><br><span class="line">  <span class="keyword">const</span> content = fs.readFileSync(filePath, <span class="string">'utf-8'</span>)</span><br><span class="line">  <span class="comment">// ç”Ÿæˆ AST</span></span><br><span class="line">  <span class="keyword">const</span> ast = babylon.parse(content, &#123;</span><br><span class="line">    sourceType: <span class="string">'module'</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// å½“å‰æ–‡ä»¶çš„ä¾èµ–å…³ç³»</span></span><br><span class="line">  <span class="keyword">const</span> dependencies = []</span><br><span class="line">  traverse(ast, &#123;</span><br><span class="line">    <span class="comment">// å½“é‡åˆ°å¯¼å…¥çš„å£°æ˜æ—¶ï¼Œå°†å…¶å†…å®¹ push åˆ° dependencies é‡Œ</span></span><br><span class="line">    ImportDeclaration: <span class="function">(<span class="params">&#123; node &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      dependencies.push(node.source.value)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// å°† AST è½¬ä¸º ES5</span></span><br><span class="line">  <span class="keyword">const</span> &#123; code &#125; = transformFromAst(ast, <span class="literal">null</span>, &#123;</span><br><span class="line">    presets: [<span class="string">'env'</span>],</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    filePath,</span><br><span class="line">    dependencies,</span><br><span class="line">    code,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Asset æ¥å£å¦‚ä¸‹ï¼š</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> Assets &#123;</span><br><span class="line"><span class="comment">// æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">  filePath: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">// æ–‡ä»¶çš„ä¾èµ–</span></span><br><span class="line">  dependencies: <span class="built_in">string</span>[];</span><br><span class="line">  <span class="comment">// è½¬ä¸º ES5 åçš„æ–‡ä»¶å†…å®¹</span></span><br><span class="line">  code: <span class="built_in">string</span>;</span><br><span class="line">  <span class="comment">// ç›¸å¯¹è·¯å¾„</span></span><br><span class="line">  relativePath?: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰ä¸ªæ–‡ä»¶ entry.js ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// entry.js</span></span><br><span class="line"><span class="keyword">import</span> a <span class="keyword">from</span> <span class="string">'./a.js'</span></span><br><span class="line"><span class="built_in">console</span>.log(a)</span><br></pre></td></tr></table></figure><p>è¿è¡Œ <code>createAsset(&#39;./entry.js&#39;)</code> å°†ä¼šè¿”å›ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  filePath: <span class="string">'./entry.js'</span>,</span><br><span class="line">  dependencies: [ <span class="string">'./a.js'</span> ],</span><br><span class="line">  code: <span class="string">`"use strict";</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">var _a = require("./a.js");</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">var _a2 = _interopRequireDefault(_a);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function _interopRequireDefault(obj) &#123; return obj &amp;&amp; obj.__esModule ? obj : &#123; default: obj &#125;; &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">console.log(_a2.default);`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ¥ç€</strong>å®šä¹‰ä¸€ä¸ªå‡½æ•°ç”¨äºæ„å»ºä¾èµ–å…³ç³»å›¾( dependency graph )ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ„å»ºä¾èµ–å…³ç³»å›¾</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createGraph</span>(<span class="params">entry</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ä»å…¥å£æ–‡ä»¶å¼€å§‹</span></span><br><span class="line">  <span class="keyword">const</span> entryAsset = createAsset(entry);</span><br><span class="line">  <span class="comment">// åˆå§‹æ—¶ï¼Œqueue ä¸­åªæœ‰ entryAsset, ä¹‹ååˆ†æä¾èµ–å…³ç³»ï¼Œä¼šå°†æ–°çš„ Asset push åˆ° queue ä¸­ç”¨äºåˆ†æï¼Œç›´åˆ°åˆ†æå®Œå…¨éƒ¨ä¾èµ–</span></span><br><span class="line">  <span class="keyword">const</span> queue = [entryAsset]</span><br><span class="line">  <span class="comment">// éå†æ‰€æœ‰æ–‡ä»¶ä¾èµ–å…³ç³»</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> asset <span class="keyword">of</span> queue) &#123;</span><br><span class="line">    <span class="comment">// è·å¾—æ–‡ä»¶ç›®å½•</span></span><br><span class="line">    <span class="keyword">const</span> dirname = path.dirname(asset.filePath)</span><br><span class="line">    <span class="comment">// éå†å½“å‰æ–‡ä»¶ä¾èµ–å…³ç³»</span></span><br><span class="line">    asset.dependencies.forEach(<span class="function">(<span class="params">relativePath</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// è·å¾—ç»å¯¹è·¯å¾„</span></span><br><span class="line">      <span class="keyword">const</span> absolutePath = path.join(dirname, relativePath)</span><br><span class="line">      <span class="keyword">const</span> childAsset = createAsset(absolutePath)</span><br><span class="line">      childAsset.relativePath = relativePath</span><br><span class="line">      <span class="comment">// å°†å½“å‰æ–‡ä»¶æ‰€ä¾èµ–çš„æ–‡ä»¶çš„ Asset ä¹Ÿ push åˆ° queue ä¸­ç”¨äºéå†</span></span><br><span class="line">      queue.push(childAsset)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> queue</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šï¼Œæœ‰ä¸ª a.js ä»¥åŠ b.js æ–‡ä»¶, è¿è¡Œ <code>createGraph</code>ä¼šè¿”å›ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="keyword">import</span> b <span class="keyword">from</span> <span class="string">'./b.js'</span></span><br><span class="line"><span class="keyword">const</span> a = <span class="string">'1'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> a</span><br><span class="line"></span><br><span class="line"><span class="comment">// b.js</span></span><br><span class="line"><span class="keyword">const</span> b = <span class="string">'2'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> b</span><br><span class="line"></span><br><span class="line"><span class="comment">// createGraph('./entry.js')</span></span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    filePath: <span class="string">'./entry.js'</span>,</span><br><span class="line">    dependencies: [ <span class="string">'./a.js'</span> ],</span><br><span class="line">    code: <span class="string">`"use strict";</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">var _a = require("./a.js");</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">var _a2 = _interopRequireDefault(_a);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function _interopRequireDefault(obj) &#123; return obj &amp;&amp; obj.__esModule ? obj : &#123; default: obj &#125;; &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">console.log(_a2.default);`</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    filePath: <span class="string">'a.js'</span>,</span><br><span class="line">    dependencies: [ <span class="string">'./b.js'</span> ],</span><br><span class="line">    code: <span class="string">`"use strict";</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Object.defineProperty(exports, "__esModule", &#123;</span></span><br><span class="line"><span class="string">  value: true</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">var _b = require("./b.js");</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">var _b2 = _interopRequireDefault(_b);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function _interopRequireDefault(obj) &#123; return obj &amp;&amp; obj.__esModule ? obj : &#123; default: obj &#125;; &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">var a = '1';</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">exports.default = a;`</span>,</span><br><span class="line">    relativePath: <span class="string">'./a.js'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    filePath: <span class="string">'b.js'</span>,</span><br><span class="line">    dependencies: [],</span><br><span class="line">    code: <span class="string">`"use strict";</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Object.defineProperty(exports, "__esModule", &#123;</span></span><br><span class="line"><span class="string">  value: true</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string">var b = '2';</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">exports.default = b;`</span>,</span><br><span class="line">    relativePath: <span class="string">'./b.js'</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><strong>æœ€å</strong>å®ç°ä¸€ä¸ªæ‰“åŒ…å‡½æ•°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bundle</span>(<span class="params">entry</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> graph = createGraph(entry)</span><br><span class="line">  <span class="keyword">let</span> modules = <span class="string">''</span></span><br><span class="line">  <span class="comment">// æ„å»ºå‡½æ•°å‚æ•°</span></span><br><span class="line">  graph.forEach(<span class="function">(<span class="params">mod</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> filePath = mod.relativePath || entry</span><br><span class="line">    <span class="comment">// æ‹¼è£…æˆ modules</span></span><br><span class="line">    modules += <span class="string">`'<span class="subst">$&#123;filePath&#125;</span>': (</span></span><br><span class="line"><span class="string">      function (module, exports, require) &#123; <span class="subst">$&#123;mod.code&#125;</span> &#125;</span></span><br><span class="line"><span class="string">    ),`</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// æœ€ç»ˆç»“æœ</span></span><br><span class="line">  <span class="keyword">const</span> result = <span class="string">`</span></span><br><span class="line"><span class="string">    (function(modules) &#123;</span></span><br><span class="line"><span class="string">// ast è½¬ es5 çš„ä»£ç æ˜¯ commonjs é£æ ¼ï¼Œè€Œæµè§ˆå™¨ä¸æ”¯æŒ commonjsï¼Œå› æ­¤è‡ªå®šä¹‰ requireï¼Œä»¥æ–‡ä»¶åä½œä¸º id</span></span><br><span class="line"><span class="string">      function require(id) &#123;</span></span><br><span class="line"><span class="string">        const module = &#123; exports : &#123;&#125; &#125;</span></span><br><span class="line"><span class="string">        modules[id](module, module.exports, require)</span></span><br><span class="line"><span class="string">        return module.exports</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">// å¼•å…¥å…¥å£æ–‡ä»¶ä»£ç </span></span><br><span class="line"><span class="string">      require('<span class="subst">$&#123;entry&#125;</span>')</span></span><br><span class="line"><span class="string">    &#125;)(&#123;<span class="subst">$&#123;modules&#125;</span>&#125;)</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">  <span class="comment">// å½“ç”Ÿæˆçš„å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ä¸­</span></span><br><span class="line">  fs.writeFileSync(<span class="string">'./bundle.js'</span>, result)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆè¾“å‡ºä¸€ä¸ª IIFEï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">;(<span class="function"><span class="keyword">function</span> (<span class="params">modules</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">require</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">module</span> = &#123; <span class="attr">exports</span>: &#123;&#125; &#125;</span><br><span class="line">    modules[id](<span class="built_in">module</span>, <span class="built_in">module</span>.exports, <span class="built_in">require</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">module</span>.exports</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">'./entry.js'</span>)</span><br><span class="line">&#125;)(&#123;</span><br><span class="line">  <span class="string">'./entry.js'</span>: <span class="function"><span class="keyword">function</span> (<span class="params">module, exports, require</span>) </span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> _a = <span class="built_in">require</span>(<span class="string">'./a.js'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> _a2 = _interopRequireDefault(_a)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_interopRequireDefault</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> obj &amp;&amp; obj.__esModule ? obj : &#123; <span class="attr">default</span>: obj &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(_a2.default)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">'./a.js'</span>: <span class="function"><span class="keyword">function</span> (<span class="params">module, exports, require</span>) </span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(exports, <span class="string">'__esModule'</span>, &#123;</span><br><span class="line">      value: <span class="literal">true</span>,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> _b = <span class="built_in">require</span>(<span class="string">'./b.js'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> _b2 = _interopRequireDefault(_b)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_interopRequireDefault</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> obj &amp;&amp; obj.__esModule ? obj : &#123; <span class="attr">default</span>: obj &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> a = <span class="string">'1'</span></span><br><span class="line"></span><br><span class="line">    exports.default = a</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">'./b.js'</span>: <span class="function"><span class="keyword">function</span> (<span class="params">module, exports, require</span>) </span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(exports, <span class="string">'__esModule'</span>, &#123;</span><br><span class="line">      value: <span class="literal">true</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">var</span> b = <span class="string">'2'</span></span><br><span class="line"></span><br><span class="line">    exports.default = b</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‰ç«¯å·¥ç¨‹åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼-JSä¸­çš„å•ä¾‹æ¨¡å¼</title>
      <link href="/2020/07/28/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-JS%E4%B8%AD%E7%9A%84%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
      <url>/2020/07/28/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-JS%E4%B8%AD%E7%9A%84%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>æ­¤å‰é¡¹ç›®æœ‰ä¸ª im  æ¨¡å—ï¼Œéœ€è¦ç”¨åˆ° websocketã€‚ä½¿ç”¨ websocket éœ€è¦å»ºç«‹è¿æ¥ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> initWs = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">'wss://xxx.com'</span>);</span><br><span class="line">  ws.onopen(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'opened'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">  ws.onmessage(<span class="function">(<span class="params">evt</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Received evt'</span>, evt.data)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">//....</span></span><br><span class="line">  <span class="keyword">return</span> ws</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è‚¯å®šä¸å¸Œæœ›åœ¨æ¯ä¸ªç”¨åˆ° ws çš„åœ°æ–¹éƒ½é‡å¤åˆå§‹åŒ–ï¼Œå³æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ª WebSocket çš„å®ä¾‹ã€‚</p><a id="more"></a><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wsA = <span class="keyword">new</span> SingleWs()</span><br><span class="line"><span class="keyword">const</span> wsB = <span class="keyword">new</span> SingleWs()</span><br><span class="line"><span class="comment">// æœ‰æ²¡æœ‰åŠæ³•ä½¿å¾—:</span></span><br><span class="line">wsA <span class="keyword">instanceof</span> WebSocket &amp;&amp; wsB <span class="keyword">instanceof</span> WebSocket &amp;&amp; wsA === wsB</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆè¦å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ï¼Ÿå®é™…ä¸Šå°±å¯ä»¥ç”¨åˆ°å•ä¾‹æ¨¡å¼ã€‚ä¸‹é¢åˆ—ä¸¾å‡ ä¸ªå®ç°çš„æ–¹æ³•ï¼š</p><h4 id="ä½¿ç”¨å…¨å±€å˜é‡"><a href="#ä½¿ç”¨å…¨å±€å˜é‡" class="headerlink" title="ä½¿ç”¨å…¨å±€å˜é‡"></a>ä½¿ç”¨å…¨å±€å˜é‡</h4><p>è¿™ä¸ªå¯èƒ½æ˜¯æœ€å®¹æ˜“æƒ³åˆ°çš„ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.ws = <span class="built_in">window</span>.ws || initWs()</span><br></pre></td></tr></table></figure><p>å°† ws æŒ‚åœ¨ window å¯¹è±¡ä¸Šï¼Œä½¿ç”¨æ—¶ä¹Ÿç”¨ window.wsï¼Œæ˜¾ç„¶è¿™ä¸ªè§£å†³æ–¹æ¡ˆæœ‰ä¸ªé—®é¢˜æ˜¯éœ€è¦å°å¿ƒ window.ws è¢«è¦†ç›–ã€‚</p><h4 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h4><p>é—­åŒ…å¯ä»¥ä¿æŒå±€éƒ¨å˜é‡ä¿æŒåœ¨å†…å­˜ä¸­ä¸è¢«é”€æ¯ï¼Œé€šè¿‡è¿™ä¸ªç‰¹æ€§å¯ä»¥å°±å¯ä»¥é¿å…æ±¡æŸ“å…¨å±€å˜é‡ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> SingleWs = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">let</span> ws = <span class="literal">null</span>;</span><br><span class="line"> <span class="comment">// const initWs = ....</span></span><br><span class="line"> <span class="keyword">return</span> &#123;</span><br><span class="line">   getWs() &#123;</span><br><span class="line">     <span class="keyword">if</span>(!ws) &#123;</span><br><span class="line">       ws = initWs()</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> ws</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> wsA = SingleWs.getWs()</span><br><span class="line"><span class="keyword">const</span> wsB = SingleWs.getWs()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(wsA <span class="keyword">instanceof</span> WebSocket &amp;&amp; wsB <span class="keyword">instanceof</span> WebSocket &amp;&amp; wsA === wsB)</span><br></pre></td></tr></table></figure><p>ç„¶è€Œä¸Šé¢çš„å†™æ³•ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œå¦‚ getWs å¯ä»¥è¢«æ”¹å†™ã€‚</p><p>å†™æ³•è¿˜å¯ä»¥è¿›ä¸€æ­¥æ”¹å†™ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> SingleWs = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">let</span> ws = <span class="literal">null</span>;</span><br><span class="line"> <span class="comment">// const initWs = .... </span></span><br><span class="line"> <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(!ws) &#123;</span><br><span class="line">      ws = initWs()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ws</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™é‡Œçš„ new å¯ä»¥ä¸å†™</span></span><br><span class="line"><span class="keyword">const</span> wsA = <span class="keyword">new</span> SingleWs()</span><br><span class="line"><span class="keyword">const</span> wsB = <span class="keyword">new</span> SingleWs()</span><br><span class="line"></span><br><span class="line">wsA <span class="keyword">instanceof</span> WebSocket &amp;&amp; wsB <span class="keyword">instanceof</span> WebSocket &amp;&amp; wsA === wsB</span><br></pre></td></tr></table></figure><h4 id="æ¨¡å—åŒ–"><a href="#æ¨¡å—åŒ–" class="headerlink" title="æ¨¡å—åŒ–"></a>æ¨¡å—åŒ–</h4><p>é€šè¿‡æ¨¡å—åŒ–ä¹Ÿèƒ½å®ç°ä¸Šè¿°çš„æ•ˆæœï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ws.js</span></span><br><span class="line"><span class="keyword">let</span> ws = <span class="literal">null</span></span><br><span class="line"><span class="comment">// const initWs = ....</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SingleWs</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (ws) &#123;</span><br><span class="line">    <span class="keyword">return</span> ws</span><br><span class="line">  &#125;</span><br><span class="line">  ws = initWs()</span><br><span class="line">  <span class="keyword">return</span> ws</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> SingleWs</span><br></pre></td></tr></table></figure><h4 id="é€šè¿‡-class-çš„é™æ€å±æ€§æ¥å®ç°"><a href="#é€šè¿‡-class-çš„é™æ€å±æ€§æ¥å®ç°" class="headerlink" title="é€šè¿‡ class çš„é™æ€å±æ€§æ¥å®ç°"></a>é€šè¿‡ class çš„é™æ€å±æ€§æ¥å®ç°</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingleWs</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> (!SingleWs.instance) &#123;</span><br><span class="line">      SingleWs.instance = <span class="keyword">this</span>.initWs()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> SingleWs.instance</span><br><span class="line">  &#125;</span><br><span class="line">  initWs() &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> wsA = <span class="keyword">new</span> SingleWs()</span><br><span class="line"><span class="keyword">const</span> wsB = <span class="keyword">new</span> SingleWs()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(wsA <span class="keyword">instanceof</span> WebSocket &amp;&amp; wsB <span class="keyword">instanceof</span> WebSocket &amp;&amp; wsA === wsB)</span><br></pre></td></tr></table></figure><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>JS ä¸­çš„å•ä¾‹æ¨¡å¼ï¼š</p><ol><li>å®ä¾‹åŒ–æ—¶ï¼Œåˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨å®ä¾‹ã€‚</li><li>å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆå§‹åŒ–ï¼Œå¹¶å°†ç”Ÿæˆçš„å®ä¾‹å­˜å‚¨èµ·æ¥ã€‚</li><li>å­˜å‚¨çš„æ–¹æ³•å¯ä»¥æ˜¯å…¨å±€å˜é‡ï¼Œé—­åŒ…ï¼Œæ¨¡å—ä»¥åŠç±»çš„é™æ€å±æ€§ã€‚</li><li>å¦‚æœå·²ç»å­˜åœ¨å®ä¾‹ï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å›è¯¥å®ä¾‹ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€è¯‘ã€‘ReactHooks-å¹¶éé»‘é­”æ³•ï¼Œæœ¬è´¨æ˜¯æ•°ç»„</title>
      <link href="/2020/07/26/%E3%80%90%E8%AF%91%E3%80%91ReactHooks-%E5%B9%B6%E9%9D%9E%E9%BB%91%E9%AD%94%E6%B3%95%EF%BC%8C%E6%9C%AC%E8%B4%A8%E6%98%AF%E6%95%B0%E7%BB%84/"/>
      <url>/2020/07/26/%E3%80%90%E8%AF%91%E3%80%91ReactHooks-%E5%B9%B6%E9%9D%9E%E9%BB%91%E9%AD%94%E6%B3%95%EF%BC%8C%E6%9C%AC%E8%B4%A8%E6%98%AF%E6%95%B0%E7%BB%84/</url>
      
        <content type="html"><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>æœ¬æ–‡ç¿»è¯‘è‡ª <a href="https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e" target="_blank" rel="noopener">React hooks: not magic, just arrays</a>ï¼Œè¯¥æ–‡ç« å¾ˆå¥½çš„é˜é‡Šäº† react hooks åŸç†ï¼Œæˆ‘å°†ä¿æŒåŸæ–‡çš„æ„æ€è¿›è¡Œç¿»è¯‘ï¼Œå¦‚æœ‰è‡ªå·±æ„Ÿè§‰ä¸æ¸…æ¥šçš„åœ°æ–¹å°†ä¼šåœ¨æ‹¬å·ä¸­æ³¨æ˜ã€‚ä»¥ä¸‹ä¸ºç¿»è¯‘å†…å®¹ã€‚</p><p>æˆ‘æ˜¯ hooks api çš„å¿ å®ç²‰ä¸ã€‚ç„¶è€Œ hooks åœ¨ä½¿ç”¨æ—¶å´æœ‰ä¸€äº›<a href="https://reactjs.org/docs/hooks-rules.html" target="_blank" rel="noopener">å¥‡æ€ªçš„çº¦æŸ</a>ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ç»™å°è¯•å»ç†è§£è¿™äº›è§„åˆ™ç”±æ¥çš„äººæä¾›ä¸€ä¸ªäº†æ¨¡å‹ï¼Œç”¨äºæ€è€ƒå¦‚ä½•å»ä½¿ç”¨è¿™äº›æ–° apiã€‚</p><a id="more"></a><h4 id="hooks-çš„è§„åˆ™"><a href="#hooks-çš„è§„åˆ™" class="headerlink" title="hooks çš„è§„åˆ™"></a>hooks çš„è§„åˆ™</h4><p>åœ¨ <a href="https://reactjs.org/docs/hooks-rules.html" target="_blank" rel="noopener">hooks proposal documentation</a> çš„æçº²ä¸­ï¼ŒReact æ ¸å¿ƒå›¢é˜Ÿè§„å®šäº†ä¸¤æ¡å¼€å‘è€…åœ¨ä½¿ç”¨ hooks æ—¶éœ€è¦éµå®ˆçš„ä¸»è¦è§„åˆ™ï¼š</p><ul><li>ä¸è¦åœ¨å¾ªç¯ï¼Œæ¡ä»¶æˆ–è€…æ˜¯åµŒå¥—å‡½æ•°ä¸­ä½¿ç”¨ hooks</li><li>åªèƒ½åœ¨ React Functions ä¸­æ‰èƒ½ä½¿ç”¨ hooks</li></ul><p>åè€…æˆ‘è®¤ä¸ºæ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚è¦å°†è¡Œä¸ºé™„åŠ åˆ°å‡½æ•°å¼ç»„ä»¶ä¸Šï¼Œä½ éœ€è¦èƒ½å¤Ÿä»¥æŸç§æ–¹å¼å°†è¯¥è¡Œä¸ºä¸ç»„ä»¶å…³è”èµ·æ¥ã€‚ï¼ˆåŸæ–‡ä¸ºï¼š To attach behaviour to a functional component you need to be able to associate that behaviour with the component somehow. ä¸å¤ªç†è§£ä½œè€…æƒ³è¡¨è¾¾çš„æ„æ€ï¼‰</p><p>å‰è€…æˆ‘è®¤ä¸ºä¼šæ¯”è¾ƒè®©äººå›°æƒ‘ï¼Œå› ä¸ºåƒè¿™æ ·ä½¿ç”¨ api å¯èƒ½çœ‹èµ·æ¥ä¸å¤ªè‡ªç„¶ã€‚è€Œè¿™æ­£æ˜¯æˆ‘ä»Šå¤©æƒ³è¦æ¢è®¨çš„å†…å®¹ã€‚</p><h4 id="hooks-çš„çŠ¶æ€ç®¡ç†éƒ½æ˜¯åŸºäºæ•°ç»„"><a href="#hooks-çš„çŠ¶æ€ç®¡ç†éƒ½æ˜¯åŸºäºæ•°ç»„" class="headerlink" title="hooks çš„çŠ¶æ€ç®¡ç†éƒ½æ˜¯åŸºäºæ•°ç»„"></a>hooks çš„çŠ¶æ€ç®¡ç†éƒ½æ˜¯åŸºäºæ•°ç»„</h4><p>ä¸ºäº†æ›´æ¸…æ™°åœ°ç†è§£å¿ƒæ™ºæ¨¡å‹ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„ hooks apiã€‚</p><p><strong>æ³¨æ„è¿™åªæ˜¯ API çš„ä¸€ç§å¯èƒ½çš„å®ç°æ–¹å¼åŠçŒœæƒ³ï¼Œç”¨äºè®©ä½ ç†è§£ï¼Œè€Œé API çœŸæ­£çš„å†…éƒ¨å®ç°æ–¹å¼</strong></p><h4 id="æˆ‘ä»¬å¦‚ä½•å®ç°-useState"><a href="#æˆ‘ä»¬å¦‚ä½•å®ç°-useState" class="headerlink" title="æˆ‘ä»¬å¦‚ä½•å®ç° useState?"></a>æˆ‘ä»¬å¦‚ä½•å®ç° <code>useState</code>?</h4><p>è®©æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªå®ä¾‹æ¥æ¼”ç¤ºå¦‚ä½•å®ç°ä¸€ä¸ª state hookã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç»„ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function RenderFunctionComponent() &#123;</span><br><span class="line">  const [firstName, setFirstName] &#x3D; useState(&quot;Rudi&quot;);</span><br><span class="line">  const [lastName, setLastName] &#x3D; useState(&quot;Yardley&quot;);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;Button onClick&#x3D;&#123;() &#x3D;&gt; setFirstName(&quot;Fred&quot;)&#125;&gt;Fred&lt;&#x2F;Button&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª Hooks api èƒŒåçš„æ€æƒ³æ˜¯ï¼Œä½ å¯ä»¥ç”¨ hook å‡½æ•°è¿”å›çš„æ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ ä½œä¸º setter æ–¹æ³•ï¼Œè¿™ä¸ª setter æ–¹æ³•å¯ä»¥æ§åˆ¶è¢« hook ç®¡ç†çš„çŠ¶æ€ã€‚</p><h4 id="é‚£ä¹ˆ-React-æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸ªçš„å‘¢ï¼Ÿ"><a href="#é‚£ä¹ˆ-React-æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸ªçš„å‘¢ï¼Ÿ" class="headerlink" title="é‚£ä¹ˆ React æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸ªçš„å‘¢ï¼Ÿ"></a>é‚£ä¹ˆ React æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸ªçš„å‘¢ï¼Ÿ</h4><p>è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªåœ¨ React å†…éƒ¨æ˜¯å¦‚ä½•è¿ä½œçš„ã€‚ä»¥ä¸‹å†…å®¹å°†åœ¨ç‰¹å®šç»„ä»¶çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚è¿™å°±æ˜¯è¯´æ•°æ®å­˜å‚¨åœ¨è¦æ¸²æŸ“çš„ç»„ä»¶çš„ä¸Šä¸€å±‚ã€‚è¿™ä¸ª state ä¸ä¸å…¶ä»–ç»„ä»¶å…±äº«ï¼Œä½†æ˜¯ç»´æŠ¤åœ¨ä¸€ä¸ªå¯ä»¥ç”¨äºè¯¥ç»„ä»¶åç»­æ¸²æŸ“çš„ä½œç”¨åŸŸå†…ã€‚ï¼ˆåŸæ–‡ï¼šThe following would work within the execution context for rendering a particular component. That means that the data stored here lives one level outside of the component being rendered. This state is not shared with other components but it is maintained in a scope that is accessible to subsequent rendering of the specific componentï¼‰</p><ol><li><p>åˆå§‹åŒ–</p><p>åˆ›å»ºä¸¤ä¸ªç©ºæ•°ç»„ï¼š<code>setter</code> å’Œ <code>state</code></p><p>å°†æŒ‡é’ˆè®¾ç½®ä¸º 0</p><p><img src="https://miro.medium.com/max/1280/1*LAZDuAEm7nbcx0vWVKJJ2w.png" alt="Image for post"></p></li><li><p>é¦–æ¬¡æ¸²æŸ“</p><p>é¦–æ¬¡è¿è¡Œè¯¥ç»„ä»¶ã€‚</p><p>æ¯æ¬¡è°ƒç”¨ <code>useState</code> ï¼Œå¦‚æœæ˜¯é¦–æ¬¡è¿è¡Œï¼Œåˆ™ push ä¸€ä¸ª setter æ–¹æ³•ï¼ˆç»‘å®šåˆ°æŒ‡é’ˆçš„ä½ç½®ï¼‰åˆ° setters æ•°ç»„ä¸­ï¼Œå¹¶ä¸” push ä¸€äº› state åˆ° state æ•°ç»„ä¸­ã€‚</p><p><img src="https://miro.medium.com/max/1260/1*8TpWnrL-Jqh7PymLWKXbWg.png" alt="Image for post"></p></li><li><p>åç»­æ¸²æŸ“</p><p>æ¯æ¬¡åç»­æ¸²æŸ“ï¼ŒæŒ‡é’ˆå°†è¢«é‡ç½®ï¼Œç„¶åä»å„ä¸ªæ•°ç»„ä¸­è¯»å–å¯¹åº”çš„å€¼ã€‚</p><p><img src="https://miro.medium.com/max/1254/1*qtwvPWj-K3PkLQ6SzE2u8w.png" alt="Image for post"></p></li><li><p>äº‹ä»¶å¤„ç†</p><p>æ¯ä¸€ä¸ª setter éƒ½ä¿å­˜ä¸€ä¸ªå¯¹åº”çš„æŒ‡é’ˆä½ç½®çš„å¼•ç”¨ï¼Œå› æ­¤è§¦å‘ä»»æ„ä¸€ä¸ª <code>setter</code> éƒ½å¯ä»¥ä¿®æ”¹ state æ•°ç»„ä¸­å¯¹åº”æŒ‡é’ˆä½ç½®çš„ stateã€‚</p><p><img src="https://miro.medium.com/max/1260/1*3L8YJnn5eV5ev1FuN6rKSQ.png" alt="Image for post"></p></li></ol><h4 id="ç®€å•çš„å®ç°-And-the-naive-implementation"><a href="#ç®€å•çš„å®ç°-And-the-naive-implementation" class="headerlink" title="ç®€å•çš„å®ç°(And the naive implementation)"></a>ç®€å•çš„å®ç°(And the naive implementation)</h4><p>ä¸‹é¢æ˜¯ç®€å•çš„ä»£ç æ¼”ç¤ºï¼š</p><p><strong>æ³¨æ„ï¼šè¿™ä¸ä»£è¡¨ hooks çš„å®é™…å®ç°ï¼Œä½†æ˜¯åº”è¯¥èƒ½ç»™ä½ ä¸€ä¸ªç†è§£ hooks å·¥ä½œåŸç†çš„æ€è·¯ã€‚è¿™å°±æ˜¯æˆ‘ä¸ºä»€ä¹ˆä½¿ç”¨å—çº§å˜é‡çš„åŸå› ï¼ˆåŸæ–‡ï¼š That is why we are using module level vars etcï¼‰</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">let state &#x3D; [];</span><br><span class="line">let setters &#x3D; [];</span><br><span class="line">let firstRun &#x3D; true;</span><br><span class="line">let cursor &#x3D; 0;</span><br><span class="line"></span><br><span class="line">function createSetter(cursor) &#123;</span><br><span class="line">  return function setterWithCursor(newVal) &#123;</span><br><span class="line">    state[cursor] &#x3D; newVal;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; This is the pseudocode for the useState helper</span><br><span class="line">export function useState(initVal) &#123;</span><br><span class="line">  if (firstRun) &#123;</span><br><span class="line">    state.push(initVal);</span><br><span class="line">    setters.push(createSetter(cursor));</span><br><span class="line">    firstRun &#x3D; false;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const setter &#x3D; setters[cursor];</span><br><span class="line">  const value &#x3D; state[cursor];</span><br><span class="line"></span><br><span class="line">  cursor++;</span><br><span class="line">  return [value, setter];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Our component code that uses hooks</span><br><span class="line">function RenderFunctionComponent() &#123;</span><br><span class="line">  const [firstName, setFirstName] &#x3D; useState(&quot;Rudi&quot;); &#x2F;&#x2F; cursor: 0</span><br><span class="line">  const [lastName, setLastName] &#x3D; useState(&quot;Yardley&quot;); &#x2F;&#x2F; cursor: 1</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;Button onClick&#x3D;&#123;() &#x3D;&gt; setFirstName(&quot;Richard&quot;)&#125;&gt;Richard&lt;&#x2F;Button&gt;</span><br><span class="line">      &lt;Button onClick&#x3D;&#123;() &#x3D;&gt; setFirstName(&quot;Fred&quot;)&#125;&gt;Fred&lt;&#x2F;Button&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; This is sort of simulating Reacts rendering cycle</span><br><span class="line">function MyComponent() &#123;</span><br><span class="line">  cursor &#x3D; 0; &#x2F;&#x2F; resetting the cursor</span><br><span class="line">  return &lt;RenderFunctionComponent &#x2F;&gt;; &#x2F;&#x2F; render</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">console.log(state); &#x2F;&#x2F; Pre-render: []</span><br><span class="line">MyComponent();</span><br><span class="line">console.log(state); &#x2F;&#x2F; First-render: [&#39;Rudi&#39;, &#39;Yardley&#39;]</span><br><span class="line">MyComponent();</span><br><span class="line">console.log(state); &#x2F;&#x2F; Subsequent-render: [&#39;Rudi&#39;, &#39;Yardley&#39;]</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; click the &#39;Fred&#39; button</span><br><span class="line"></span><br><span class="line">console.log(state); &#x2F;&#x2F; After-click: [&#39;Fred&#39;, &#39;Yardley&#39;]</span><br></pre></td></tr></table></figure><h4 id="ä¸ºä»€ä¹ˆé¡ºåºå¾ˆé‡è¦ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆé¡ºåºå¾ˆé‡è¦ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆé¡ºåºå¾ˆé‡è¦ï¼Ÿ"></a>ä¸ºä»€ä¹ˆé¡ºåºå¾ˆé‡è¦ï¼Ÿ</h4><p>ç°åœ¨å¦‚æœåœ¨ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸé‡Œï¼Œæˆ‘ä»¬åŸºäºå¤–éƒ¨çš„å› ç´ æˆ–è€…ç»„ä»¶çŠ¶æ€æ”¹å˜äº† hooks çš„é¡ºåºï¼Œå°†ä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼Ÿ</p><p>è®©æˆ‘ä»¬è¯•è¯•çœ‹ react ä¸å»ºè®®æˆ‘ä»¬åšçš„äº‹æƒ…ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">let firstRender &#x3D; true;</span><br><span class="line"></span><br><span class="line">function RenderFunctionComponent() &#123;</span><br><span class="line">  let initName;</span><br><span class="line"></span><br><span class="line">  if(firstRender)&#123;</span><br><span class="line">    [initName] &#x3D; useState(&quot;Rudi&quot;);</span><br><span class="line">    firstRender &#x3D; false;</span><br><span class="line">  &#125;</span><br><span class="line">  const [firstName, setFirstName] &#x3D; useState(initName);</span><br><span class="line">  const [lastName, setLastName] &#x3D; useState(&quot;Yardley&quot;);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;Button onClick&#x3D;&#123;() &#x3D;&gt; setFirstName(&quot;Fred&quot;)&#125;&gt;Fred&lt;&#x2F;Button&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨ä¸€ä¸ªæ¡ä»¶è¯­å¥ä¸­ä½¿ç”¨äº† <code>useState</code>ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹é€ æˆäº†ä»€ä¹ˆæ ·çš„ç ´åï¼š</p><h4 id="åç»„ä»¶çš„ç¬¬ä¸€æ¬¡æ¸²æŸ“"><a href="#åç»„ä»¶çš„ç¬¬ä¸€æ¬¡æ¸²æŸ“" class="headerlink" title="åç»„ä»¶çš„ç¬¬ä¸€æ¬¡æ¸²æŸ“"></a>åç»„ä»¶çš„ç¬¬ä¸€æ¬¡æ¸²æŸ“</h4><p><img src="https://miro.medium.com/max/1270/1*C4IA_Y7v6eoptZTBspRszQ.png" alt="Image for post"></p><p>åœ¨è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬çš„å®ä¾‹å˜é‡ <code>firstName</code> å’Œ <code>lastName</code> æŒ‡å‘çš„æ­£ç¡®çš„æ•°æ®ï¼Œä½†æ˜¯æˆ‘ä»¬çœ‹çœ‹ç¬¬äºŒæ¬¡æ¸²æŸ“å‘ç”Ÿäº†ä»€ä¹ˆï¼š</p><h4 id="åç»„ä»¶çš„ç¬¬äºŒæ¬¡æ¸²æŸ“"><a href="#åç»„ä»¶çš„ç¬¬äºŒæ¬¡æ¸²æŸ“" class="headerlink" title="åç»„ä»¶çš„ç¬¬äºŒæ¬¡æ¸²æŸ“"></a>åç»„ä»¶çš„ç¬¬äºŒæ¬¡æ¸²æŸ“</h4><p><img src="https://miro.medium.com/max/1274/1*aK7jIm6oOeHJqgWnNXt8Ig.png" alt="Image for post"></p><p>ç°åœ¨æˆ‘ä»¬çš„ state å­˜å‚¨å‡ºç°å¼‚å¸¸ï¼Œ <code>firstName</code> å’Œ <code>lastName</code> éƒ½æŒ‡å‘ â€œRudiâ€ã€‚ä¸Šè¿°æ˜æ˜¾é”™è¯¯çš„æ“ä½œç»™äº†æˆ‘ä»¬ä¸€ä¸ªæ€è·¯ï¼šä¸ºä»€ä¹ˆ hooks è¦å¦‚æ­¤è§„å®šã€‚</p><blockquote><p>The React team are stipulating the usage rules because not following them will lead to inconsistent data</p></blockquote><h4 id="æƒ³æƒ³-hooks-æ“ä½œä¸€ç³»åˆ—çš„æ•°ç»„ï¼Œé‚£ä¹ˆä½ å°±ä¸ä¼šæ‰“ç ´è§„åˆ™äº†ï¼ˆThink-about-hooks-manipulating-a-set-of-arrays-and-you-wont-break-the-rulesï¼‰"><a href="#æƒ³æƒ³-hooks-æ“ä½œä¸€ç³»åˆ—çš„æ•°ç»„ï¼Œé‚£ä¹ˆä½ å°±ä¸ä¼šæ‰“ç ´è§„åˆ™äº†ï¼ˆThink-about-hooks-manipulating-a-set-of-arrays-and-you-wont-break-the-rulesï¼‰" class="headerlink" title="æƒ³æƒ³ hooks æ“ä½œä¸€ç³»åˆ—çš„æ•°ç»„ï¼Œé‚£ä¹ˆä½ å°±ä¸ä¼šæ‰“ç ´è§„åˆ™äº†ï¼ˆThink about hooks manipulating a set of arrays and you wont break the rulesï¼‰"></a>æƒ³æƒ³ hooks æ“ä½œä¸€ç³»åˆ—çš„æ•°ç»„ï¼Œé‚£ä¹ˆä½ å°±ä¸ä¼šæ‰“ç ´è§„åˆ™äº†ï¼ˆThink about hooks manipulating a set of arrays and you wont break the rulesï¼‰</h4><p>ç°åœ¨åº”è¯¥èƒ½å¾ˆæ¸…æ™°ç†è§£ä¸ºä»€ä¹ˆä¸èƒ½åœ¨æ¡ä»¶æˆ–è€…å¾ªç¯è¯­å¥ä¸­ä½¿ç”¨ <code>use</code> hook äº†ï¼šå› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†æŒ‡é’ˆæŒ‡å‘äº†æ•°ç»„ï¼Œå¦‚æœåœ¨ render çš„æ—¶å€™æ”¹å˜äº†é¡ºåºï¼Œé‚£ä¹ˆæŒ‡é’ˆå°±ä¸èƒ½å¯¹åº”æ­£ç¡®çš„æ•°æ®ï¼Œæ‰€ä»¥è°ƒç”¨ use ä¹Ÿä¸ä¼šæŒ‡å‘æ­£ç¡®çš„æ•°æ®å’Œ setterã€‚</p><p>å› æ­¤ï¼Œè¯€çªå°±æ˜¯å°† hooks æƒ³åƒæˆç”¨æ’å®šçš„æŒ‡é’ˆæ¥ç®¡ç†ä¸€ç³»åˆ—æ•°ç»„ã€‚å¦‚æœèƒ½åšåˆ°è¿™ä¸ªï¼Œé‚£ä¹ˆä¸€åˆ‡å°±èƒ½æŒ‰é¢„æœŸè¿›è¡Œã€‚</p><h4 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h4><p>å¸Œæœ›æˆ‘å·²ç»å°±å¦‚ä½•æ€è€ƒ hooks api çš„å·¥ä½œåŸç†æŒ‡å‡ºäº†ä¸€ä¸ªæ¸…æ™°çš„å¿ƒæ™ºæ¨¡å‹ã€‚ï¼ˆåé¢å°±å·ä¸ªæ‡’ä¸ç¿»è¯‘äº†ï¼ŒåŸºæœ¬æ˜¯ä¸Šè¿°è§‚ç‚¹çš„é‡å¤å¼ºè°ƒã€‚ï¼‰</p><p>Hopefully I have laid out a clearer mental model for how to think about what is going on under the hood with the new hooks API. Remember the true value here is being able to group concerns together so being careful about order and using the hooks API will have a high payoff.</p><p>Hooks is an effective plugin API for React Components. There is a reason why people are excited about this and if you think about this kind of model where state exists as a set of arrays then you should not find yourselves breaking the rules around their usage.</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‰ç«¯å…¥å‘flutter</title>
      <link href="/2020/07/24/%E5%89%8D%E7%AB%AF%E5%85%A5%E5%9D%91flutter/"/>
      <url>/2020/07/24/%E5%89%8D%E7%AB%AF%E5%85%A5%E5%9D%91flutter/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>è¸©è¿‡ RN çš„å‘ä¹‹åè¶Šå‘æƒ³å°è¯•å­¦ä¹ ä¸‹ flutter çš„å¼€å‘ï¼Œæœ¬æ–‡ç”¨äºè®°å½•ä¸‹å¼€å‘è¿‡ç¨‹ä¸­çš„é—®é¢˜ä¸æ€è€ƒï¼Œæœ¬æ¥æ˜¯å†™åœ¨ notion é‡Œçš„ï¼Œæœ€è¿‘ notion æ— æ³•æ‰“å¼€ï¼Œæ•…è®°å½•äºæ­¤ã€‚</p><a id="more"></a><h4 id="Flutterä¸ºä»€ä¹ˆé€‰æ‹©äº†-Dartè€Œä¸æ˜¯-JavaScript"><a href="#Flutterä¸ºä»€ä¹ˆé€‰æ‹©äº†-Dartè€Œä¸æ˜¯-JavaScript" class="headerlink" title="Flutterä¸ºä»€ä¹ˆé€‰æ‹©äº† Dartè€Œä¸æ˜¯ JavaScript"></a>Flutterä¸ºä»€ä¹ˆé€‰æ‹©äº† Dartè€Œä¸æ˜¯ JavaScript</h4><p>ä»¥ä¸‹å†…å®¹å¼•ç”¨è‡ª <a href="https://book.flutterchina.club/chapter1/flutter_intro.html" target="_blank" rel="noopener">flutter å¼€å‘å®æˆ˜</a>ã€‚</p><p>é¦–å…ˆè¦äº†è§£ä¸¤ä¸ªæ¦‚å¿µï¼šJITå’ŒAOTã€‚<br>ç›®å‰ï¼Œç¨‹åºä¸»è¦æœ‰ä¸¤ç§è¿è¡Œæ–¹å¼ï¼šé™æ€ç¼–è¯‘ä¸åŠ¨æ€è§£é‡Šã€‚é™æ€ç¼–è¯‘çš„ç¨‹åºåœ¨æ‰§è¡Œå‰å…¨éƒ¨è¢«ç¿»è¯‘ä¸ºæœºå™¨ç ï¼Œé€šå¸¸å°†è¿™ç§ç±»å‹ç§°ä¸º<strong>AOT</strong> ï¼ˆAhead of timeï¼‰å³ â€œæå‰ç¼–è¯‘â€ï¼›è€Œè§£é‡Šæ‰§è¡Œçš„åˆ™æ˜¯ä¸€å¥ä¸€å¥è¾¹ç¿»è¯‘è¾¹è¿è¡Œï¼Œé€šå¸¸å°†è¿™ç§ç±»å‹ç§°ä¸º<strong>JIT</strong>ï¼ˆJust-in-timeï¼‰å³â€œå³æ—¶ç¼–è¯‘â€ã€‚AOTç¨‹åºçš„å…¸å‹ä»£è¡¨æ˜¯ç”¨C/C++å¼€å‘çš„åº”ç”¨ï¼Œå®ƒä»¬å¿…é¡»åœ¨æ‰§è¡Œå‰ç¼–è¯‘æˆæœºå™¨ç ï¼Œè€ŒJITçš„ä»£è¡¨åˆ™éå¸¸å¤šï¼Œå¦‚JavaScriptã€pythonç­‰ï¼Œäº‹å®ä¸Šï¼Œæ‰€æœ‰è„šæœ¬è¯­è¨€éƒ½æ”¯æŒJITæ¨¡å¼ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯JITå’ŒAOTæŒ‡çš„æ˜¯ç¨‹åºè¿è¡Œæ–¹å¼ï¼Œå’Œç¼–ç¨‹è¯­è¨€å¹¶éå¼ºå…³è”çš„ï¼Œæœ‰äº›è¯­è¨€æ—¢å¯ä»¥ä»¥JITæ–¹å¼è¿è¡Œä¹Ÿå¯ä»¥ä»¥AOTæ–¹å¼è¿è¡Œï¼Œå¦‚Javaã€Pythonï¼Œå®ƒä»¬å¯ä»¥åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶ç¼–è¯‘æˆä¸­é—´å­—èŠ‚ç ã€ç„¶ååœ¨ä¹‹åæ‰§è¡Œæ—¶å¯ä»¥ç›´æ¥æ‰§è¡Œå­—èŠ‚ç ï¼Œä¹Ÿè®¸æœ‰äººä¼šè¯´ï¼Œä¸­é—´å­—èŠ‚ç å¹¶éæœºå™¨ç ï¼Œåœ¨ç¨‹åºæ‰§è¡Œæ—¶ä»ç„¶éœ€è¦åŠ¨æ€å°†å­—èŠ‚ç è½¬ä¸ºæœºå™¨ç ï¼Œæ˜¯çš„ï¼Œè¿™æ²¡æœ‰é”™ï¼Œä¸è¿‡é€šå¸¸æˆ‘ä»¬åŒºåˆ†æ˜¯å¦ä¸ºAOTçš„æ ‡å‡†å°±æ˜¯çœ‹ä»£ç åœ¨æ‰§è¡Œä¹‹å‰æ˜¯å¦éœ€è¦ç¼–è¯‘ï¼Œåªè¦éœ€è¦ç¼–è¯‘ï¼Œæ— è®ºå…¶ç¼–è¯‘äº§ç‰©æ˜¯å­—èŠ‚ç è¿˜æ˜¯æœºå™¨ç ï¼Œéƒ½å±äºAOTã€‚åœ¨æ­¤ï¼Œè¯»è€…ä¸å¿…çº ç»“äºæ¦‚å¿µï¼Œæ¦‚å¿µå°±æ˜¯ä¸ºäº†ä¼ è¾¾ç²¾ç¥è€Œå‘æ˜çš„ï¼Œåªè¦è¯»è€…èƒ½å¤Ÿç†è§£å…¶åŸç†å³å¯ï¼Œå¾—å…¶ç¥å¿˜å…¶å½¢ã€‚<br>JavaScriptä¸ºè„šæœ¬è¯­è¨€ï¼Œæ‰§è¡Œæ—¶éœ€è¦JIT(Just In Time)ï¼Œæ‰§è¡Œæ•ˆç‡å’ŒAOT(Ahead Of Time)ä»£ç ä»æœ‰å·®è·ã€‚<br>Dartåœ¨ JITï¼ˆå³æ—¶ç¼–è¯‘ï¼‰æ¨¡å¼ä¸‹ï¼Œé€Ÿåº¦ä¸ JavaScriptåŸºæœ¬æŒå¹³ã€‚<br>ä½†æ˜¯ Dartæ”¯æŒ AOTï¼Œå½“ä»¥ AOTæ¨¡å¼è¿è¡Œæ—¶ï¼ŒJavaScriptä¾¿è¿œè¿œè¿½ä¸ä¸Šäº†ã€‚</p><h4 id="ç½‘é¡µå¼€å‘"><a href="#ç½‘é¡µå¼€å‘" class="headerlink" title="ç½‘é¡µå¼€å‘"></a>ç½‘é¡µå¼€å‘</h4><p>ç°åœ¨ flutter å·²ç»æ”¯æŒ web äº†ï¼Œåˆ‡æ¢åˆ° beta ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// åˆ‡æ¢ channel</span><br><span class="line">flutter channel beta</span><br><span class="line">// æ›´æ–° sdk</span><br><span class="line">flutter upgrade</span><br><span class="line">// å®‰è£…ä¾èµ–</span><br><span class="line">flutter packages get</span><br><span class="line">// å¯åŠ¨å¼€å‘æ¨¡å¼</span><br><span class="line">flutter run -d chrome</span><br></pre></td></tr></table></figure><h4 id="é…ç½®ç¯å¢ƒ"><a href="#é…ç½®ç¯å¢ƒ" class="headerlink" title="é…ç½®ç¯å¢ƒ"></a>é…ç½®ç¯å¢ƒ</h4><p>è¿‡ç¨‹ä¸æï¼Œæ–‡æ¡£è®²çš„æ¯”è¾ƒæ¸…æ™°äº†ï¼Œæ³¨æ„é…ç½®å›½å†…çš„æºå³å¯ã€‚</p><h4 id="é¡¹ç›®ç»“æ„ä¸å‘½åè§„èŒƒ"><a href="#é¡¹ç›®ç»“æ„ä¸å‘½åè§„èŒƒ" class="headerlink" title="é¡¹ç›®ç»“æ„ä¸å‘½åè§„èŒƒ"></a>é¡¹ç›®ç»“æ„ä¸å‘½åè§„èŒƒ</h4><p>dart çš„æ–‡ä»¶åæ˜¯ç”¨ä¸‹åˆ’çº¿è¿æ¥çš„ï¼Œæºæ–‡ä»¶åœ¨ lib ç›®å½•ä¸‹ï¼Œmain.dart ä¸ºå…¥å£æ–‡ä»¶, ä» main å‡½æ•°å¼€å§‹æ‰§è¡Œï¼Œä¸‹åˆ’çº¿å¼€å¤´çš„å˜é‡ä¸ºç§æœ‰å˜é‡</p><h4 id="æ¨¡å—åŒ–"><a href="#æ¨¡å—åŒ–" class="headerlink" title="æ¨¡å—åŒ–"></a>æ¨¡å—åŒ–</h4><p>dart é‡Œå¦‚ä½•å¯¼å…¥æœ¬åœ°æ–‡ä»¶çš„å‘¢ï¼Ÿå’Œå¼•ç”¨ç¬¬ä¸‰æ–¹çš„åº“çš„ç”¨æ³•ä¸€æ ·ï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:&#123;é¡¹ç›®å&#125;/&#123;æ–‡ä»¶å&#125;'</span>;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­æˆå‘˜å˜é‡è‡ªåŠ¨å¯¼å‡ºï¼Œé‚£ä¹ˆå¦‚ä½•é˜²æ­¢å‘½åå†²çªï¼Ÿ:</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:&#123;é¡¹ç›®å&#125;/&#123;æ–‡ä»¶å&#125;'</span> <span class="keyword">as</span> MyModule;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ as æ¥æŒ‡å®šåŒ…åï¼Œæ­¤æ—¶è¦ä½¿ç”¨å†…éƒ¨æˆå‘˜å°±éœ€è¦ MyModule.xxxã€‚</p><p>ä¹Ÿå¯ä»¥å±è”½æŸäº›å˜é‡å¯¼å‡ºï¼š</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'package:&#123;é¡¹ç›®å&#125;/&#123;æ–‡ä»¶å&#125;'</span> <span class="keyword">hide</span> MyVar;</span><br></pre></td></tr></table></figure><h4 id="Material-ç»„ä»¶åº“"><a href="#Material-ç»„ä»¶åº“" class="headerlink" title="Material ç»„ä»¶åº“"></a>Material ç»„ä»¶åº“</h4><p><a href="https://flutterchina.club/widgets/material/" target="_blank" rel="noopener">https://flutterchina.club/widgets/material/</a></p><h4 id="ğŸ’€-Divider-åœ¨-web-éœ€è¦ä¼ -thickness"><a href="#ğŸ’€-Divider-åœ¨-web-éœ€è¦ä¼ -thickness" class="headerlink" title="ğŸ’€ Divider åœ¨ web éœ€è¦ä¼  thickness"></a>ğŸ’€ Divider åœ¨ web éœ€è¦ä¼  thickness</h4><p>å¦åˆ™ä¸æ¸²æŸ“ï¼Œ issue å¦‚ä¸‹ï¼š <a href="https://github.com/flutter/flutter/issues/46339" target="_blank" rel="noopener">https://github.com/flutter/flutter/issues/46339</a></p><h4 id="ğŸ’€-BottomNavigationBar"><a href="#ğŸ’€-BottomNavigationBar" class="headerlink" title="ğŸ’€ BottomNavigationBar"></a>ğŸ’€ BottomNavigationBar</h4><p>å¦‚æœè¶…è¿‡ 3 ä¸ª itemsï¼ŒèƒŒæ™¯ä¼šå˜ç™½ï¼ŒåŸå› æ˜¯è¶…è¿‡ 3 ä¸ª BottomNavigationBar çš„ type ä¼šå˜æˆ BottomNavigationBarType.shifting ç±»å‹ï¼Œè¯¦æƒ…è§ï¼š <a href="https://github.com/flutter/flutter/issues/13642#issuecomment-371875044" target="_blank" rel="noopener">https://github.com/flutter/flutter/issues/13642#issuecomment-371875044</a></p><p>è§£å†³çš„åŠæ³•æ˜¯è®¾ç½® type å±æ€§ä¸º fixedã€‚</p><h4 id="è¿›ç¨‹é”æ­»"><a href="#è¿›ç¨‹é”æ­»" class="headerlink" title="è¿›ç¨‹é”æ­»"></a>è¿›ç¨‹é”æ­»</h4><p>é‡åˆ°æ§åˆ¶å°æç¤ºï¼ŒWaiting for another flutter command to release the startup lockâ€¦ å¯ä»¥ç®€å•ç²—æš´æ€è¿›ç¨‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">killall -9 dart</span><br></pre></td></tr></table></figure><h4 id="è¿è¡Œæ‰€æœ‰çš„-flutter-å‘½ä»¤éƒ½è¢«æŒ‚èµ·æ—¶"><a href="#è¿è¡Œæ‰€æœ‰çš„-flutter-å‘½ä»¤éƒ½è¢«æŒ‚èµ·æ—¶" class="headerlink" title="è¿è¡Œæ‰€æœ‰çš„ flutter å‘½ä»¤éƒ½è¢«æŒ‚èµ·æ—¶"></a>è¿è¡Œæ‰€æœ‰çš„ flutter å‘½ä»¤éƒ½è¢«æŒ‚èµ·æ—¶</h4><p>åˆ é™¤ <code>flutter/bin/cache</code>ï¼Œç„¶åé‡æ–°è¿è¡Œ <code>flutter doctor -v</code></p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> flutter </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‰ç«¯å¸¸è§çš„å®‰å…¨é—®é¢˜æ±‡æ€»</title>
      <link href="/2020/07/23/%E5%89%8D%E7%AB%AF%E5%B8%B8%E8%A7%81%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/"/>
      <url>/2020/07/23/%E5%89%8D%E7%AB%AF%E5%B8%B8%E8%A7%81%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>æœ€è¿‘å®‰å…¨éƒ¨é—¨çš„å°ä¼™ä¼´æäº†ä¸€ä¸ªå‰ç«¯å®‰å…¨çš„æ¼æ´ï¼Œæƒ³åˆ°å‰ç«¯å¼€å‘è¿‡ç¨‹ä¸­æœ‰æ—¶å€™å¾€å¾€è¿½æ±‚å¼€å‘æ•ˆç‡ï¼Œå¿½ç•¥æ‰ä¸€äº›å®‰å…¨é—®é¢˜ï¼Œä»¥ä¸‹ç®€å•æ€»ç»“ä¸€äº›è‡ªå·±é‡åˆ°è¿‡çš„ä»¥åŠä¸€äº›å¸¸è§çš„æ”»å‡»æ‰‹æ®µï¼Œä»¥è‡ªæŸ¥è‡ªçœã€‚</p><a id="more"></a><h4 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h4><p>å›åˆ°å®‰å…¨éƒ¨é—¨æå‡ºçš„æ¼æ´ï¼Œåœºæ™¯è¿˜åŸå¦‚ä¸‹ï¼š<br>è¿™æ˜¯ä¸€ä¸ªè€é¡¹ç›®ï¼Œå±•ç¤ºæ–‡ç« ç”¨ï¼Œé¡µé¢è·¯ç”±ä¸º <a href="http://xxx/article/:id?these-are-queriesï¼Œnode" target="_blank" rel="noopener">http://xxx/article/:id?these-are-queriesï¼Œnode</a> å±‚æ”¶åˆ°è¿™ä¸ª url åï¼Œè¿”å›è¿”å›è¯¥æ–‡ç«  htmlï¼Œå†…å®¹åˆ™åŒ…æ‹¬äº†ã€æ¨èæ–‡ç« ã€‘ï¼Œ è€Œæ¨èæ–‡ç« çš„é“¾æ¥åˆ™æ˜¯æ ¹æ® url çš„å€¼æ¥çš„ï¼Œä»…å˜åŒ– idã€‚æ­¤æ—¶å¦‚æœåœ¨ url ä¸Šçš„ query ä¸Šæ„é€ ä¸€æ®µæ¶æ„è„šæœ¬ï¼Œç„¶åå¼•å¯¼ç”¨æˆ·æ‰“å¼€ï¼Œé‚£ä¹ˆç”¨æˆ·æ‰“å¼€é¡µé¢åå°±ä¼šè¿è¡Œè¯¥æ¶æ„è„šæœ¬ã€‚<br>ä¸Šè¿°æ­£æ˜¯ä¸€ä¸ªå…¸å‹çš„ XSS æ”»å‡»ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p><blockquote><p>XSSæ˜¯è·¨ç«™è„šæœ¬æ”»å‡»(Cross Site Scripting)ï¼Œä¸ºä¸å’Œå±‚å æ ·å¼è¡¨(Cascading Style Sheets, CSS)çš„ç¼©å†™æ··æ·†ï¼Œæ•…å°†è·¨ç«™è„šæœ¬æ”»å‡»ç¼©å†™ä¸ºXSSã€‚æ¶æ„æ”»å‡»è€…å¾€Webé¡µé¢é‡Œæ’å…¥æ¶æ„Scriptä»£ç ï¼Œå½“ç”¨æˆ·æµè§ˆè¯¥é¡µä¹‹æ—¶ï¼ŒåµŒå…¥å…¶ä¸­Webé‡Œé¢çš„Scriptä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ¶æ„æ”»å‡»ç”¨æˆ·çš„ç›®çš„ã€‚</p></blockquote><p>XSS çš„æœ¬è´¨æ˜¯ä¿¡ä»»äº†æŸäº›ä¸å®‰å…¨çš„è¾“å…¥ï¼Œå¯¼è‡´æ¶æ„ä»£ç æ··å…¥æ­£å¸¸ä»£ç ï¼Œè¿›è€Œå‘ç”Ÿçš„æ”»å‡»è¡Œä¸ºã€‚å¸¸è§çš„ä¸å®‰å…¨è¾“å…¥æœ‰ï¼š</p><ol><li>ä¸Šé¢æåˆ°çš„ url å‚æ•°ï¼Œè¿™ç§éœ€è¦è¯±å¯¼ç”¨æˆ·å–ç‚¹å‡»</li><li>ç”¨æˆ·è¾“å…¥çš„å†…å®¹ï¼Œæ¯”å¦‚ç”¨æˆ·å‘è¡¨è¯„è®º</li><li>ç¬¬ä¸‰æ–¹çš„é“¾æ¥ç­‰</li></ol><p>é˜²èŒƒçš„æ–¹æ³•é€šå¸¸æ˜¯ï¼šå¯¹ç”¨æˆ·è¾“å…¥å†…å®¹å’ŒæœåŠ¡ç«¯è¿”å›å†…å®¹è¿›è¡Œè¿‡æ»¤å’Œè½¬è¯‘ã€‚</p><h4 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h4><p>CSRF æ”»å‡»å¸¸è§çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>ç”¨æˆ·ç™»å½•ä½ çš„ç½‘ç«™ï¼Œäº§ç”Ÿç™»å½•å‡­è¯ï¼Œå¦‚ cookie</li><li>ç”¨æˆ·è¢«<strong>è¯±å¯¼</strong>ç™»å½•åˆ°æ¶æ„ç½‘ç«™</li><li>æ¶æ„ç½‘ç«™æºå¸¦åˆšåˆšåœ¨æµè§ˆå™¨äº§ç”Ÿçš„å‡­è¯å‘ä½ çš„æœåŠ¡å™¨å‘é€ä¸€ä¸ªæ¶æ„è¯·æ±‚</li><li>ä½ çš„æœåŠ¡å™¨æ— æ³•è¯†åˆ«æ˜¯å¦æ¶æ„è¯·æ±‚ï¼Œè¯·æ±‚å®Œæˆï¼Œç”¨æˆ·å—å®³ã€‚</li></ol><p>ä¸ä¸Šé¢æåˆ°çš„ XSS æ”»å‡»æœ‰ä¸ªæ˜æ˜¾çš„åŒºåˆ«åœ¨äºï¼šCSRF æ”»å‡»å‘ç”Ÿåœ¨æ¶æ„ç½‘ç«™ï¼Œè€Œä¸æ˜¯è¢«æ”»å‡»çš„ç½‘ç«™ã€‚è€Œè¿™ä¹Ÿä½¿å¾—æ”»å‡»è€…å¹¶ä¸èƒ½è·å–åˆ°å—å®³è€…çš„ç™»å½•å‡­è¯ï¼Œä»…ä»…åªèƒ½ä½¿ç”¨ã€‚<br>é˜²èŒƒçš„æ–¹æ³•é€šå¸¸æ˜¯ï¼š</p><ol><li>è¯·æ±‚ url æ·»åŠ  token æˆ–è€…æ˜¯åœ¨ http è¯·æ±‚å¤´è‡ªå®šä¹‰å±æ€§è¿›è¡ŒéªŒè¯</li><li>åŒæºæ£€æµ‹ï¼Œé€šè¿‡è§£æ è¯·æ±‚å¤´ä¸­çš„ referer åˆ¤æ–­è¯·æ±‚æ¥æº</li><li>Samesiteï¼ŒGoogle èµ·è‰äº†ä¸€ä»½è‰æ¡ˆæ¥æ”¹è¿› HTTP åè®®ï¼Œä¸º Set-Cookie å“åº”å¤´æ–°å¢ Samesite å±æ€§ï¼Œç”¨äºæ ‡æ˜ Cookie æ˜¯å¦èƒ½ä½œç”¨äºå…¶ä»–ç½‘ç«™ï¼Œç›®å‰å…¼å®¹æ€§è¿˜ä¸æ˜¯å¾ˆå¥½ã€‚</li></ol><h4 id="Iframe"><a href="#Iframe" class="headerlink" title="Iframe"></a>Iframe</h4><p>å½“æˆ‘ä»¬ä½¿ç”¨ iframe åŠ è½½ç¬¬ä¸‰æ–¹ç½‘ç«™æ—¶ï¼Œç¬¬ä¸‰æ–¹ç½‘ç«™å¯ä»¥å¯¹æˆ‘ä»¬çš„ç½‘ç«™æ‰§è¡Œæ¶æ„æ“ä½œï¼Œå¦‚æ“ä½œDOMï¼ŒåŠ è½½ js ç­‰ã€‚<br>é˜²èŒƒçš„æ–¹æ³•æ˜¯é€šè¿‡è®¾ç½® sandbox å±æ€§æ§åˆ¶ iframe çš„æ“ä½œæƒé™ã€‚</p><h4 id="opener"><a href="#opener" class="headerlink" title="opener"></a>opener</h4><p>æˆ‘ä»¬åœ¨é€šå¸¸é€šè¿‡ä»¥ä¸‹å†™æ³•åœ¨ æ–° tab ä¸‹æ‰“å¼€é“¾æ¥ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> &lt;a target=<span class="string">'_blank'</span> href=<span class="string">'new-site.com'</span>&gt;</span><br><span class="line"><span class="number">2.</span> <span class="built_in">window</span>.open(<span class="string">'new-site.com'</span>)</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä¸¤ç§å†™æ³•çš„é—®é¢˜åœ¨äºï¼Œ <code>new-site.com</code> æ˜¯å¯ä»¥é€šè¿‡ <code>window.opener</code> æ¥æ‹¿åˆ°æºé¡µé¢çš„ <code>window</code> å¯¹è±¡ï¼Œè¿›è€Œè¿›è¡Œæ¶æ„æ“ä½œã€‚<br>é˜²èŒƒçš„æ–¹æ³•é€šå¸¸æ˜¯ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> &lt;a target=<span class="string">"_blank"</span> href=<span class="string">"new-site.com"</span> rel=<span class="string">"noopener noreferrer nofollow"</span>&gt;aæ ‡ç­¾è·³è½¬url&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">2. function openurl(url) &#123;</span></span><br><span class="line"><span class="regexp">    var newTab = window.open();</span></span><br><span class="line"><span class="regexp">    newTab.opener = null;</span></span><br><span class="line"><span class="regexp">    newTab.location = url;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h5 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h5><ul><li><p><a href="https://tech.meituan.com/2018/09/27/fe-security.html" target="_blank" rel="noopener">å‰ç«¯å®‰å…¨ç³»åˆ—ï¼ˆä¸€ï¼‰ï¼šå¦‚ä½•é˜²æ­¢XSSæ”»å‡»ï¼Ÿ</a></p></li><li><p><a href="https://tech.meituan.com/2018/10/11/fe-security-csrf.html" target="_blank" rel="noopener">å‰ç«¯å®‰å…¨ç³»åˆ—ï¼ˆäºŒï¼‰ï¼šå¦‚ä½•é˜²æ­¢CSRFæ”»å‡»ï¼Ÿ</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RN é¿å‘æŒ‡åŒ—</title>
      <link href="/2020/07/21/RN%20%E9%81%BF%E5%9D%91%E6%8C%87%E5%8C%97/"/>
      <url>/2020/07/21/RN%20%E9%81%BF%E5%9D%91%E6%8C%87%E5%8C%97/</url>
      
        <content type="html"><![CDATA[<p>è®°å½•å¹³æ—¶å¼€å‘ rn æ—¶é‡åˆ°çš„é—®é¢˜ï¼Œç‰¹æŒ‡ 0.59 ç‰ˆæœ¬ï¼Œä¸åŒç‰ˆæœ¬å¯èƒ½æƒ…å†µä¸åŒï¼Œä»…ä¾›å‚è€ƒã€‚</p><a id="more"></a><h5 id="ä¸€åƒç´ é—®é¢˜"><a href="#ä¸€åƒç´ é—®é¢˜" class="headerlink" title="ä¸€åƒç´ é—®é¢˜"></a>ä¸€åƒç´ é—®é¢˜</h5><p>rn è§£å†³ä¸€åƒç´ å¾ˆç®€å•ï¼Œåªéœ€è¦  <code>StyleSheet.hairlineWidth</code> å³å¯è§£å†³ã€‚</p><h5 id="TextInput-ç»„ä»¶"><a href="#TextInput-ç»„ä»¶" class="headerlink" title="TextInput  ç»„ä»¶"></a>TextInput  ç»„ä»¶</h5><p>è‡ªå¸¦å†…è¾¹è·ï¼Œå¤šè¡Œæ–‡å­—æ—¶æ–‡å­—å±…ä¸­å±•ç¤ºï¼Œæƒ³è¦æ¶ˆé™¤éœ€è¦è®¾ç½®æ ·å¼å¦‚ä¸‹ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// æ–‡å­—å‘ä¸Šå¯¹é½</span><br><span class="line">textAlignVertical: 'top'</span><br><span class="line">// æ¶ˆé™¤å†…è¾¹è·</span><br><span class="line"><span class="selector-tag">padding</span>: 0</span><br></pre></td></tr></table></figure><p>Placeholder åœ¨ ios å’Œ android ä¸‹é»˜è®¤é¢œè‰²è¡¨ç°ä¸ä¸€è‡´ï¼Œå¯ä»¥é€šè¿‡ <code>placeholderTextColor</code>  å±æ€§è¿›è¡Œè®¾ç½®ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">placeholderTextColor=<span class="string">"#CCCCCC"</span></span><br></pre></td></tr></table></figure><h5 id="é˜´å½±"><a href="#é˜´å½±" class="headerlink" title="é˜´å½±"></a>é˜´å½±</h5><p>å› ä¸ºè®¾è®¡ç†å¿µçš„é—®é¢˜ï¼Œandroid ä¸‹å‡ ä¹æ— æ³•å®ç°å’Œ ios ä¸€è‡´çš„é˜´å½±æ•ˆæœã€‚è€Œ flutter åŸºäº skia å¼•æ“æ¸²æŸ“ï¼Œåº”è¯¥ä¼šæœ‰æ¯”è¾ƒå¥½çš„è¡¨ç°ï¼Ÿæœ‰ç©ºå°è¯•ä¸‹ã€‚ ğŸ¤”</p><h5 id="border-è™šçº¿"><a href="#border-è™šçº¿" class="headerlink" title="border è™šçº¿"></a>border è™šçº¿</h5><p>border è™šçº¿ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜, android ä¸Šå®æµ‹æ— æ•ˆï¼Œè¯¦æƒ…çœ‹ <a href="https://github.com/facebook/react-native/issues/17251" target="_blank" rel="noopener">issue</a>ã€‚è§£å†³æ–¹æ¡ˆæ˜¯å¾ªç¯ä¸€ä¸ª pattern ç„¶å overhidden æ‰ï¼Œåˆå¤šäº†ä¸€ä¸ªè®©æˆ‘æƒ³å°è¯• flutter çš„ç†ç”± ğŸ˜‚</p><h5 id="å¤šè¡Œæ–‡å­—"><a href="#å¤šè¡Œæ–‡å­—" class="headerlink" title="å¤šè¡Œæ–‡å­—"></a>å¤šè¡Œæ–‡å­—</h5><p>å¤šè¡Œæ–‡å­—åœ¨ android æœºå‹ä¸‹æœ‰å¯èƒ½ä¼šå‡ºç°é«˜åº¦ä¸å¤Ÿå¯¼è‡´æ–‡å­—è¢«æˆªæ‰çš„é—®é¢˜ï¼Œè§£å†³æ–¹æ³•ï¼šè®¾ç½®  <code>lineHeight</code></p><h5 id="å®ç°ä¸åŒå­—å·çš„æ–‡å­—åº•éƒ¨å¯¹é½"><a href="#å®ç°ä¸åŒå­—å·çš„æ–‡å­—åº•éƒ¨å¯¹é½" class="headerlink" title="å®ç°ä¸åŒå­—å·çš„æ–‡å­—åº•éƒ¨å¯¹é½"></a>å®ç°ä¸åŒå­—å·çš„æ–‡å­—åº•éƒ¨å¯¹é½</h5><p>ä¾‹å¦‚ Â¥500 æƒ³è¦ Â¥ å­—å·å°ä¸€ç‚¹ï¼Œè€Œ 500 å­—å·å¤§ä¸€ç‚¹ï¼Œä½†æ˜¯éœ€è¦åº•éƒ¨å¯¹é½ï¼Œåˆ™å¯ä»¥ç”¨ Text åŒ…è£¹èµ·æ¥ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Text&gt;</span><br><span class="line">  &lt;Text style&#x3D;&#123;&#123; fontSize: 12 &#125;&#125;&gt;Â¥&lt;&#x2F;Text&gt;</span><br><span class="line">  &lt;Text style&#x3D;&#123;&#123; fontSize: 20 &#125;&#125;&gt;500&lt;&#x2F;Text&gt;</span><br><span class="line">&lt;&#x2F;Text&gt;</span><br></pre></td></tr></table></figure><h5 id="Text-ç»„ä»¶æ ·å¼ç»§æ‰¿"><a href="#Text-ç»„ä»¶æ ·å¼ç»§æ‰¿" class="headerlink" title="Text ç»„ä»¶æ ·å¼ç»§æ‰¿"></a>Text ç»„ä»¶æ ·å¼ç»§æ‰¿</h5><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œcss å¦‚æœæƒ³è®¾ç½®é»˜è®¤çš„å…¨å±€æ ·å¼ç›¸å½“ç®€å•ï¼Œæ¯”å¦‚å­—ä½“é¢œè‰²é»˜è®¤ä¸º â€˜#323232â€™ , åªè¦åœ¨ body ä¸Šè®¾ç½®ä¸€ä¸‹ <code>color: #323232</code> å³å¯ ï¼Œç„¶è€Œå¯¹äº RN æ¥è¯´åˆ™æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š</p><ol><li><p>å°†åŸç”Ÿ Text æ›¿æ¢æˆè‡ªå®šä¹‰ Text ç»„ä»¶ï¼ˆå®˜æ–¹æ¨èï¼‰</p><blockquote><p>The recommended way to use consistent fonts and sizes across your application is to create a component <code>MyAppText</code> that includes them and use this component across your app</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import React from &#39;react&#39;;</span><br><span class="line">import &#123; TextProps, StyleSheet, Text &#125; from &#39;react-native&#39;;</span><br><span class="line"></span><br><span class="line">const styles &#x3D; StyleSheet.create(&#123;</span><br><span class="line">  defaultStyle: &#123;</span><br><span class="line">    color: &#39;#323232&#39;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export default function CustomText(props: TextProps &amp; &#123; children?: any &#125;) &#123;</span><br><span class="line">  const &#123; style, ...restProps &#125; &#x3D; props;</span><br><span class="line">  return (</span><br><span class="line">    &lt;Text style&#x3D;&#123;[styles.defaultStyle, style]&#125; &#123;...restProps&#125;&gt;</span><br><span class="line">      &#123;props.children&#125;</span><br><span class="line">    &lt;&#x2F;Text&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å‚è€ƒ <a href="https://github.com/Ajackster" target="_blank" rel="noopener">Ajackster</a>/<strong><a href="https://github.com/Ajackster/react-native-global-props" target="_blank" rel="noopener">react-native-global-props</a></strong> çš„å®ç°ï¼Œåœ¨é¡¹ç›®å…¥å£ä½ç½®ï¼Œä¿®æ”¹ç»„ä»¶çš„ render æ–¹æ³•ã€‚</p></li></ol><p>æ–¹æ¡ˆäºŒè™½ç„¶æ–¹ä¾¿ï¼Œä½†ä¸æ˜¯å®˜æ–¹è§£æ³•ï¼Œä¸‡ä¸€æœ‰å‘å°± GG äº†ã€‚è€Œæ–¹æ¡ˆä¸€å¦‚æœæ˜¯å·²æœ‰é¡¹ç›®ï¼Œåˆ™éœ€è¦æ‰¹é‡ä¿®æ”¹ä»£ç ã€‚<br>è¿™é‡Œé¡ºä¾¿æä¸€ä¸‹åœ¨ vscode é‡Œæ‰¹é‡æ›¿æ¢çš„æ–¹æ³•ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// å°†æ­£åˆ™ï¼Œå¤§å°å†™ï¼Œå…¨åŒ¹é… ä¸‰ä¸ªæŒ‰é’®ç‚¹äº®</span><br><span class="line">find: Text(,|\s)(.*react-nativ<span class="string">e';)</span></span><br><span class="line"><span class="string">replace: $2\nimport Text from '</span>Your/<span class="type">Text</span><span class="string">';</span></span><br></pre></td></tr></table></figure><p>ä¸€å¼€å§‹æˆ‘æ˜¯è¿™ä¹ˆå†™çš„ï¼Œåªè€ƒè™‘åˆ°äº†å•è¡Œï¼Œç»“æœä¸‹é¢è¿™ç§æƒ…å†µæ²¡æœ‰æ›¿æ¢æ‰ï¼š</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import &#123;</span><br><span class="line"><span class="built_in">  StyleSheet,</span></span><br><span class="line"><span class="built_in">  ViewStyle,</span></span><br><span class="line"><span class="built_in">  View,</span></span><br><span class="line"><span class="built_in">  Text,</span></span><br><span class="line"><span class="built_in">  Image,</span></span><br><span class="line"><span class="built_in">  TouchableOpacity,</span></span><br><span class="line">&#125; from 'react-native'<span class="comment">;</span></span><br></pre></td></tr></table></figure><p>åé¢æ¢æˆ <code>\sText[,|\s]\n?([\s\S]*&#39;react-native&#39;;)</code> åœ¨æµè§ˆå™¨é‡Œå¯ä»¥åŒ¹é…ä¸Šï¼Œä½†æ˜¯ vscode æ— æ³•åŒ¹é… ğŸ¤”ã€‚ æœ€åç®€å•å†™ä¸ªè„šæœ¬è¡¥å…¨ä¸Šé¢çš„æ¼ç½‘ä¹‹é±¼:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> glob = <span class="built_in">require</span>(<span class="string">'glob'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> replace = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    glob(<span class="string">'src/**/*.tsx'</span>, &#123;&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">er, files</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> reg = <span class="regexp">/\sText[,|\s]\n?([\s\S]*'react-native';)/</span>;</span><br><span class="line">      files.forEach(<span class="keyword">async</span> (file) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> content = <span class="keyword">await</span> util.promisify(fs.readFile)(file, <span class="string">'utf8'</span>);</span><br><span class="line">        <span class="keyword">const</span> newContent = content.replace(reg, (m, p1) =&gt; &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="string">` <span class="subst">$&#123;p1.trim()&#125;</span></span></span><br><span class="line"><span class="string">import Text from '@/components/Text';`</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">await</span> util.promisify(fs.writeFile)(file, newContent, <span class="string">'utf8'</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">replace();</span><br></pre></td></tr></table></figure><p>ğŸ¤” ä¸Šé¢ CustomText çš„å†™æ³•æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå³åµŒå¥— Text çš„æ ·å¼å¦‚æœæ˜¯è‡ªå®šä¹‰ç»„ä»¶ä¸­é»˜è®¤çš„æ ·å¼ï¼Œå°†ä¸ä¼šè¢«ç»§æ‰¿:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;Text style&#x3D;&#123;&#123; color: &#39;red&#39; &#125;&#125;&gt;</span><br><span class="line">  &lt;Text&gt;red&lt;&#x2F;Text&gt;</span><br><span class="line">  &lt;Text&gt;red&lt;&#x2F;Text&gt;</span><br><span class="line">&lt;&#x2F;Text&gt;</span><br><span class="line"></span><br><span class="line">&lt;CustomText style&#x3D;&#123;&#123; color: &#39;red&#39; &#125;&#125;&gt;</span><br><span class="line">  &lt;CustomText&gt;not red&lt;&#x2F;Text&gt;</span><br><span class="line">  &lt;CustomText&gt;not red&lt;&#x2F;Text&gt;</span><br><span class="line">&lt;&#x2F;CustomText&gt;</span><br></pre></td></tr></table></figure><p>æ”¹è‰¯ç‰ˆï¼š </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Children, isValidElement, cloneElement &#125; from &#39;react&#39;;</span><br><span class="line">import &#123; TextProps, StyleSheet, Text &#125; from &#39;react-native&#39;;</span><br><span class="line"></span><br><span class="line">const styles &#x3D; StyleSheet.create(&#123;</span><br><span class="line">  defaultStyle: &#123;</span><br><span class="line">    color: &#39;#323232&#39;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">export default function CustomText(</span><br><span class="line">  props: TextProps &amp; &#123; children?: any; useDefaultStyle?: boolean &#125;,</span><br><span class="line">) &#123;</span><br><span class="line">  const &#123; style, useDefaultStyle &#x3D; true, ...restProps &#125; &#x3D; props;</span><br><span class="line">  const newStyle &#x3D; useDefaultStyle ? [styles.defaultStyle, style] : style;</span><br><span class="line"></span><br><span class="line">  const childrenWithProps &#x3D; Children.map(props.children, (child) &#x3D;&gt; &#123; </span><br><span class="line">   if (isValidElement(child)) &#123;</span><br><span class="line">     &#x2F;&#x2F; å¦‚æœå­å…ƒç´ æ˜¯ä¸ªç»„ä»¶ï¼Œåˆ™å­ç»„ä»¶ä¸ä½¿ç”¨é»˜è®¤ style</span><br><span class="line">      return cloneElement(child as React.ReactElement&lt;any&gt;, &#123;</span><br><span class="line">        useDefaultStyle: false,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    return child;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;Text style&#x3D;&#123;newStyle&#125; &#123;...restProps&#125;&gt;</span><br><span class="line">      &#123;childrenWithProps&#125;</span><br><span class="line">    &lt;&#x2F;Text&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><a href="https://github.com/ptomasroos/react-native-scrollable-tab-view" target="_blank" rel="noopener">react-native-scrollable-tab-view</a></p><p><a href="https://github.com/ptomasroos/react-native-scrollable-tab-view" target="_blank" rel="noopener">react-native-scrollable-tab-view</a> ç»„ä»¶ä½œä¸º ScrollView çš„å­ç»„ä»¶æ—¶ä¸å¯ç”¨ï¼Œä¼šå‡ºç° tab é€‰ä¸­ä¸ä¸€è‡´ï¼Œtab content æ— æ³•æ’‘å¼€çš„ç°è±¡ï¼Œè¯¦æƒ…çœ‹ï¼š<a href="https://github.com/ptomasroos/react-native-scrollable-tab-view/issues/982" target="_blank" rel="noopener">https://github.com/ptomasroos/react-native-scrollable-tab-view/issues/982</a></p></li><li><p>è®¾ç½®ç¯å¢ƒå˜é‡<br>é€šå¸¸æˆ‘ä»¬çš„ web é¡¹ç›®å¯ä»¥åœ¨ npm script é‡Œé€šè¿‡è®¾ç½® NODE_ENV æ¥è®¾ç½®ä¸åŒçš„ç¯å¢ƒå˜é‡ã€‚æ¯”å¦‚ <code>NODE_ENV=develope node index.js</code>, ä¹‹åå¯ä»¥åœ¨ä»£ç ä¸­é€šè¿‡ <code>process.env.NODE_ENV</code> æ¥åˆ¤æ–­å…·ä½“æ˜¯å“ªä¸ªç¯å¢ƒã€‚rn é¡¹ç›®è¦è¾¾åˆ°åŒæ ·çš„ç›®çš„ï¼Œåˆ™éœ€è¦é¢å¤–å®‰è£… babel æ’ä»¶ <a href="https://www.npmjs.com/package/babel-plugin-transform-inline-environment-variables" target="_blank" rel="noopener">babel-plugin-transform-inline-environment-variables</a>ï¼ˆæˆ–è€…å¯ä»¥é€šè¿‡ <a href="https://github.com/luggit/react-native-config" target="_blank" rel="noopener">react-native-config</a>ï¼Œä¸è¿‡è¿™ä¸ªæ–¹æ³•æ²¡æœ‰å»éªŒè¯ï¼Œå› ä¸ºä½äº 6.x ç‰ˆæœ¬çš„éœ€è¦å®¢æˆ·ç«¯ linkï¼‰</p></li></ul><h5 id="ScrollView-ä¸-Keyboard"><a href="#ScrollView-ä¸-Keyboard" class="headerlink" title="ScrollView ä¸ Keyboard"></a>ScrollView ä¸ Keyboard</h5><p>åœºæ™¯ï¼š å½“ ScrollView / FlatList / SectionList ä¸­åŒ…å«è¾“å…¥æ¡†æ—¶ï¼Œç‚¹å‡»è¾“å…¥æ¡†å”¤èµ·é”®ç›˜ã€‚å¦‚æœæ­¤æ—¶è¾“å…¥æ¡†å³ä¾§æœ‰æ¸…é™¤è¾“å…¥çš„æŒ‰é’®ï¼Œç‚¹å‡»æ—¶é¦–å…ˆä¼šå°†é”®ç›˜æ”¶èµ·ï¼Œä¹‹åå†æ¬¡ç‚¹å‡»æ‰ä¼šæ‰§è¡Œ onPressã€‚</p><p>æ–¹æ¡ˆï¼šå°† <code>keyboardShouldPersistTaps</code> å±æ€§è®¾ç½®ä¸º <code>always</code>ï¼Œç‚¹å‡»æ¸…é™¤è¾“å…¥çš„æŒ‰é’®ï¼Œé”®ç›˜ä¸ä¼šè‡ªåŠ¨æ”¶èµ·ã€‚</p><h5 id="iOS-Text"><a href="#iOS-Text" class="headerlink" title="iOS Text"></a>iOS Text</h5><p>ios çš„ Text ç»„ä»¶ <code>borderRadius</code> | <code>textAlignVertical</code> å±æ€§æ— æ•ˆï¼Œåªèƒ½å¤–å±‚å†åŒ…ä¸ª View</p><h5 id="Border"><a href="#Border" class="headerlink" title="Border"></a>Border</h5><p>RN çš„ç›’æ¨¡å‹æ˜¯ border-box, å³ å®½é«˜åŒ…æ‹¬äº† padding å’Œ borderã€‚</p><p>åœ¨å¼€å‘ä¸­å‘ç°å¦‚æœå®¹å™¨å…·æœ‰ backgroundColor ä¸ borderRadius åï¼Œè®¾ç½®ä¸€ä¸ªä¸åŒé¢œè‰²çš„ border, è¯¥å®¹å™¨å¤–å›´ä¼šæœ‰ä¸€å±‚æµ…æµ…çš„ backgroundColor æè¾¹ï¼ˆç›®å‰ä»… ios æœ‰è¿™ç§æƒ…å†µï¼‰è§£å†³æ–¹æ¡ˆï¼šåœ¨å®¹å™¨å¤–å±‚å†åŒ…ä¸€ä¸ª Viewï¼Œè®¾ç½® border æ ·å¼</p><h5 id="FlatList-çš„-onViewableItemsChanged"><a href="#FlatList-çš„-onViewableItemsChanged" class="headerlink" title="FlatList çš„ onViewableItemsChanged"></a>FlatList çš„ onViewableItemsChanged</h5><p>onViewableItemsChanged çš„æ–¹æ³•åœ¨ FlatList çš„ç”Ÿå‘½å‘¨æœŸä¸­ä¸å¯ä»¥æ”¹å˜ï¼Œå¦åˆ™æŠ¥é”™ï¼š</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invariant Violation: Changing onViewableItemsChanged <span class="keyword">on</span> <span class="keyword">the</span> fly <span class="keyword">is</span> <span class="keyword">not</span> supported</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ç±»ç»„ä»¶ï¼Œå¯ä»¥åœ¨ constructor ä¸­å®šä¹‰è¯¥æ–¹æ³•ï¼Œå¦‚æœæ˜¯å‡½æ•°ç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡ useRef åŒ…è£¹è¯¥æ–¹æ³•ã€‚</p><h5 id="ç­‰å®½å­—ä½“"><a href="#ç­‰å®½å­—ä½“" class="headerlink" title="ç­‰å®½å­—ä½“"></a>ç­‰å®½å­—ä½“</h5><p>å¦‚æœå­—ä½“ä¸æ˜¯ç­‰å®½çš„è¯ï¼Œå€’è®¡æ—¶ç»„ä»¶ä¼šäº§ç”Ÿå®½åº¦æŠ–åŠ¨ã€‚ios å’Œ å®‰å“å¹³å°çš„å­—ä½“å¹¶ä¸é€šç”¨ï¼Œå‚è€ƒ <a href="https://github.com/react-native-training/react-native-fontsã€‚æƒ³è¦è®¾ç½®ç­‰å®½å­—ä½“å¯ä»¥è®¾ç½®" target="_blank" rel="noopener">https://github.com/react-native-training/react-native-fontsã€‚æƒ³è¦è®¾ç½®ç­‰å®½å­—ä½“å¯ä»¥è®¾ç½®</a> Text å¦‚ä¸‹æ ·å¼å±æ€§ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">fontVariant:</span> [<span class="string">'tabular-nums'</span>] <span class="comment">// ä»… IOS</span></span><br><span class="line"><span class="string">fontFamily:</span> Platform.OS === <span class="string">'android'</span> ? 'monospace' : undefined <span class="comment">// å¦‚æœæ˜¯å®‰å“åˆ™è®¾ç½®å­—ä½“ä¸º monospace</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„å¦‚æœ fontFamily æŒ‡å®šçš„å­—ä½“ä¸å­˜åœ¨ï¼Œåˆ™é¡µé¢å°†æŠ¥é”™</p><h5 id="è½®æ’­å›¾"><a href="#è½®æ’­å›¾" class="headerlink" title="è½®æ’­å›¾"></a>è½®æ’­å›¾</h5><p>è½®æ’­å›¾ä¸€å¼€å§‹ç”¨çš„æ˜¯ç¤¾åŒºé‡Œ star æ•°æ¯”è¾ƒé«˜çš„ <a href="https://github.com/leecade/react-native-swiper/issues/932ï¼Œ" target="_blank" rel="noopener">https://github.com/leecade/react-native-swiper/issues/932ï¼Œ</a></p><p>â˜ ï¸ ä½†æ˜¯è¿™ä¸ªç»„ä»¶å­˜åœ¨ä¸€ä¸ªå‘ï¼šå¦‚æœ loop ä¸º trueï¼Œrerender çš„æ—¶å€™ï¼Œä¼šå…ˆå±•ç¤ºæœ€åä¸€é¡¹ï¼Œå†é—ªå›åˆ°ç¬¬ä¸€é¡¹ã€‚è¿™ä¸ª bug å­˜åœ¨å¥½å‡ å¹´äº†ï¼Œæäº†å¾ˆå¤š issueï¼Œéƒ½æ²¡æœ‰è§£å†³æ‰ï¼Œä¾‹å¦‚ <a href="https://github.com/leecade/react-native-swiper/issues/932" target="_blank" rel="noopener">https://github.com/leecade/react-native-swiper/issues/932</a> </p><p>ç”±äºé¡¹ç›®æ¯”è¾ƒç´§å¼ ï¼Œåˆæ²¡æœ‰æ—¶é—´è‡ªå·±å»å®ç°ä¸€ä¸ªï¼Œåé¢å‘ç° <a href="https://github.com/f111fei/react-native-banner-carousel" target="_blank" rel="noopener">https://github.com/f111fei/react-native-banner-carousel</a> è¿™ä¸ªä»“åº“ä¸å­˜åœ¨è¯¥é—®é¢˜ã€‚åç»­è¿˜æ˜¯éœ€è¦è‡ªå·±å»ç ”ç©¶ä¸€ä¸‹ rn çš„è½®æ’­å›¾å®ç°æ–¹æ¡ˆã€‚</p><h5 id="stickyHeaderIndices"><a href="#stickyHeaderIndices" class="headerlink" title="stickyHeaderIndices"></a>stickyHeaderIndices</h5><p>ScrollView æä¾› stickyHeaderIndices å¯ä»¥æŒ‡å®šæ»šåŠ¨æ—¶å¸é¡¶çš„ç»„ä»¶ç´¢å¼•</p><p>â˜ ï¸ è¿™ä¸ªå±æ€§å¦‚æœæ˜¯åŠ¨æ€çš„ä¼šå¯¼è‡´ ScrollView æ— æ³•æ­£å¸¸æ¸²æŸ“ï¼Œè§ // <a href="https://github.com/facebook/react-native/issues/25157" target="_blank" rel="noopener">https://github.com/facebook/react-native/issues/25157</a> ï¼Œè§£å†³çš„æ–¹æ³•æ˜¯å°† removeClippedSubviews è®¾ç½®æˆ false </p><h5 id="å…³é—­å¼¹çª—ä¸è·³è½¬æ–°é¡µé¢"><a href="#å…³é—­å¼¹çª—ä¸è·³è½¬æ–°é¡µé¢" class="headerlink" title="å…³é—­å¼¹çª—ä¸è·³è½¬æ–°é¡µé¢"></a>å…³é—­å¼¹çª—ä¸è·³è½¬æ–°é¡µé¢</h5><p>åœ¨æˆ‘ä»¬çš„ ios å®¢æˆ·ç«¯å‘ç°ä¸€ä¸ªé—®é¢˜ï¼šç‚¹å‡»ä¸€ä¸ª Modal ä¸­çš„å†…å®¹åï¼Œå…³é—­è¯¥ modal å¹¶æ‰“å¼€ä¸€ä¸ªæ–°çš„ webviewï¼Œæ­¤æ—¶æœ‰å¾ˆå¤§æ¦‚ç‡æ— æ³•æ‰“å¼€æ–° webviewã€‚</p><p>çŒœæµ‹æ˜¯ç”±äºå…³é—­ modal çš„åŠ¨ç”»å½±å“åˆ°æ‰“å¼€æ–° webviewï¼ˆä¸æ¸…æ¥šæ˜¯å¦ ios åŸç”Ÿå°±æ˜¯å¦‚æ­¤ï¼‰</p><p>è§£å†³æ–¹æ¡ˆå°±æ˜¯å»¶è¿Ÿ 300ms åå†æ‰“å¼€æ–° webview</p><p>æœªå®Œå¾…ç»­ï½</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ReactNative </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°å½•ä¸€æ¬¡æ­å»º react é¡¹ç›®é‡åˆ°çš„å‘</title>
      <link href="/2020/07/20/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E6%90%AD%E5%BB%BA%20react%20%E9%A1%B9%E7%9B%AE%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/"/>
      <url>/2020/07/20/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E6%90%AD%E5%BB%BA%20react%20%E9%A1%B9%E7%9B%AE%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/</url>
      
        <content type="html"><![CDATA[<h5 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h5><p>ç”µå•†é¡¹ç›®éœ€è¦æ­å»ºä¸€ä¸ª h5 é¡¹ç›®ã€‚è¿™é‡Œç®€å•è®°å½•ä¸€ä¸‹æ­å»ºè¿‡ç¨‹é‡åˆ°çš„å‘ï¼Œä½œä¸ºæ€»ç»“ã€‚</p><a id="more"></a><p>ui æ¡†æ¶ï¼šä¸ºäº†ç»Ÿä¸€ ui æ¡†æ¶ï¼Œå› æ­¤é€‰æ‹©ä½¿ç”¨ antd-mobileã€‚<br>æ‰“åŒ…ï¼šparceljs åœ¨æ­¤å‰çš„é¡¹ç›®ä¸­å·²ç»ä½¿ç”¨è¿‡å¾ˆå¤šæ¬¡äº†ï¼Œæ‰“åŒ…é€Ÿåº¦è¾ƒ cra å¿«ï¼Œä¸”é…ç½®ç®€å•ï¼Œå› æ­¤æ‹Ÿç”¨ parcelã€‚<br>tsï¼šå¤šäººé¡¹ç›®è¿˜æ˜¯ä¸Š tsï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ã€‚<br>å¾ˆå¿«å°±æ­å»ºå¥½ demoï¼Œæ¥ç€å°±å¼€å§‹é‡åˆ°ä¸€äº›é—®é¢˜ã€‚</p><h5 id="antd-mobile-æŒ‰éœ€åŠ è½½"><a href="#antd-mobile-æŒ‰éœ€åŠ è½½" class="headerlink" title="antd-mobile æŒ‰éœ€åŠ è½½"></a>antd-mobile æŒ‰éœ€åŠ è½½</h5><p>antd-mobile æŒ‰éœ€åŠ è½½æ¨èä½¿ç”¨ <a href="https://github.com/ant-design/babel-plugin-import" target="_blank" rel="noopener">babel-plugin-import</a></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .babelrc or babel-loader option</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"plugins"</span>: [</span><br><span class="line">    [<span class="string">"import"</span>, &#123; <span class="attr">"libraryName"</span>: <span class="string">"antd-mobile"</span>, <span class="attr">"style"</span>: <span class="string">"css"</span> &#125;] <span class="comment">// `style: true` ä¼šåŠ è½½ less æ–‡ä»¶</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤å‰ parcel å®é™…ä¸Šå†…ç½®æ”¯æŒäº† tsï¼Œç›´æ¥è½¬æˆ es5 äº†ï¼Œå› æ­¤æ­¤å‰æ²¡æœ‰é¢å¤–å†é…ç½® babelã€‚<br>ğŸ¤” babel-plugin-import åªæ”¯æŒ es6 module å†™æ³•çš„ä»£ç ï¼Œçœ‹æ¥éœ€è¦å…ˆæŠŠ ts è½¬æˆ es6 ç„¶ååœ¨é€šè¿‡ babel è½¬æˆ es5ï¼Œ æ²¡é—®é¢˜ï¼Œå®‰æ’ï½ äºæ˜¯ï¼š</p><ol><li><p>æ–°å¢ .babelrc</p></li><li><p>ä¿®æ”¹ tsconfig çš„ module ä¸º <code>es6</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="attr">"module"</span>: <span class="string">"ES6"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¡¹ç›®å¯åŠ¨ï¼Œæ²¡é—®é¢˜ã€‚ä½†æ˜¯ vscode å¼€å§‹æŠ¥é”™ï¼š</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import React from &#39;react&#39;</span><br><span class="line">&#x2F;&#x2F; Module &#39;&quot;&#x2F;node_modules&#x2F;@types&#x2F;react&#x2F;index&quot;&#39; can only be default-imported using the &#39;allowSyntheticDefaultImports&#39; flag</span><br></pre></td></tr></table></figure><p>æ ¹æœ¬åŸå› æ˜¯ç”±äº react å¯¼å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="built_in">require</span>(<span class="string">'react.development.js'</span>)</span><br></pre></td></tr></table></figure><p>è€Œé</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports.default = <span class="built_in">require</span>(<span class="string">'react.development.js'</span>)</span><br></pre></td></tr></table></figure><p>Babel ä¼šåœ¨ commonjs æ ¼å¼æ·»åŠ  default å¯¼å‡ºï¼Œé‚£æˆ‘ä»¬è¦åšçš„å°±æ˜¯è®© ts ä¸è¦æç¤ºè¿™ç§ç±»å‹çš„æŠ¥é”™ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="attr">"allowSyntheticDefaultImports"</span>: <span class="literal">true</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ğŸ¤” ä¸è¿‡ä¸ºä»€ä¹ˆä¸€å¼€å§‹ parcel ä¸ä¼šæŠ¥é”™å‘¢ï¼Ÿ</p><p>æ¥ä¸‹æ¥è·¯ç”±åŠ¨æ€å¼•å…¥ç»„ä»¶å¼€å§‹æŠ¥é”™ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Suspense, lazy &#125; from &#39;react&#39;</span><br><span class="line"></span><br><span class="line">const List &#x3D; lazy(() &#x3D;&gt; import(&#39;.&#x2F;modules&#x2F;List&#39;))</span><br><span class="line">&#x2F;&#x2F; Dynamic imports are only supported when the &#39;--module&#39; flag is set to &#39;es2020&#39;, &#39;esnext&#39;, &#39;commonjs&#39;, &#39;amd&#39;, &#39;system&#39;, or &#39;umd&#39;.</span><br></pre></td></tr></table></figure><p>çœ‹æ¥ <code>es6</code> æ˜¯ä¸æ”¯æŒ import() è¯­æ³•, é‚£å¥½åŠï¼Œå°† module æ”¹æˆ <code>esnext</code>ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="attr">"module"</span>: <span class="string">"ESNext"</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å¼•å…¥ anti-mobile ç»„ä»¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; List &#125; <span class="keyword">from</span> <span class="string">'antd-mobile'</span></span><br><span class="line"><span class="comment">// Cannot find module 'antd-mobile' or its corresponding type declarations.</span></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æç¤ºæ‰¾ä¸åˆ°å¯¹åº”çš„æ¨¡å—å£°æ˜ï¼Œ æ­¤æ—¶æˆ‘çš„å†…å¿ƒæ˜¯å´©æºƒçš„ï¼Œçœ‹èµ·æ¥åº”è¯¥æ˜¯æ¨¡å—è§£æè·¯å¾„ä¸å¯¹ï¼Œå› æ­¤åœ¨ tsconfig ä¸­æ˜¾å¼é…ç½® <code>moduleResolution</code>:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="attr">"moduleResolution"</span>: <span class="string">"Node"</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸å†æŠ¥é”™äº†ï¼Œçœ‹çœ‹ ts æ–‡æ¡£çš„è§£é‡Šå§ï¼Œts å…±æœ‰ä¸¤ç§å¯ç”¨çš„æ¨¡å—è§£æç­–ç•¥ï¼š<a href="https://www.tslang.cn/docs/handbook/module-resolution.html#node" target="_blank" rel="noopener">Node</a>å’Œ<a href="https://www.tslang.cn/docs/handbook/module-resolution.html#classic" target="_blank" rel="noopener">Classic</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span> === <span class="string">"AMD"</span> or <span class="string">"System"</span> or <span class="string">"ES6"</span> ? <span class="string">"Classic"</span> : <span class="string">"Node"</span></span><br></pre></td></tr></table></figure><p>ğŸ¤” æŒ‰ç†è¯´ module ä¸º esnext çš„è¯å²‚ä¸æ˜¯åº”è¯¥æŒ‰ node ç­–ç•¥è§£æï¼Ÿä½†æ˜¯ç›®å‰çœ‹æ¥ä¼¼ä¹ä¸æ˜¯è¿™æ ·çš„ï¼Ÿ</p><h5 id="é…ç½®-antd-mobile-ä¸»é¢˜"><a href="#é…ç½®-antd-mobile-ä¸»é¢˜" class="headerlink" title="é…ç½® antd-mobile ä¸»é¢˜"></a>é…ç½® antd-mobile ä¸»é¢˜</h5><p>æ¥ä¸‹æ¥éœ€è¦é…ç½®ä¸»é¢˜ï¼Œanti-mobile æ¨èä½¿ç”¨ <a href="http://lesscss.org/usage/#using-less-in-the-browser-modify-variables" target="_blank" rel="noopener">modifyVars</a> æ¥é…ç½®ä¸»é¢˜ã€‚<br>å°† .babelrc æ”¹æˆåšä¸€ä¸‹è°ƒæ•´ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">"plugins"</span>: [</span><br><span class="line">        [<span class="string">"import"</span>, &#123;<span class="string">"libraryName"</span>: <span class="string">"antd-mobile"</span>, <span class="string">"style"</span>: <span class="literal">true</span>&#125;],</span><br><span class="line">        ...</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§ webpack çš„ç»éªŒï¼Œæ­¤æ—¶éœ€è¦å¼€å¯ <code>javascriptEnabled: true</code>é—®é¢˜æ¥äº† parcel å†…ç½®æ”¯æŒ less ï¼Œé‚£æˆ‘ä»¬è¦åœ¨å“ªé‡Œå»é…ç½® less å‘¢ï¼Ÿæ ¹æ® <a href="https://github.com/parcel-bundler/parcel/issues/907" target="_blank" rel="noopener">issue</a> æåˆ°å¯ä»¥ç”¨ .lessrc æ–‡ä»¶æ¥é…ç½®ï¼Œä½†æ˜¯æˆ‘ç»è¿‡å°è¯•å‘ç°å…¶å®æ˜¯æ— æ•ˆçš„ã€‚ã€‚<br>è‡³æ­¤åŸºæœ¬æ”¾å¼ƒ parcelã€‚parcel åœ¨å¿«é€Ÿæ­å»ºå®éªŒæ€§é¡¹ç›®æ—¶ç¡®å®æœ‰ä¸€å®šçš„ä¼˜åŠ¿ï¼Œä¸è¿‡ç”Ÿæ€ç¡®å®ä¸å¦‚ webpackï¼Œç”±æ­¤è½¬å‘ä½¿ç”¨ create-react-app</p><h5 id="create-react-app"><a href="#create-react-app" class="headerlink" title="create-react-app"></a>create-react-app</h5><p>ä½¿ç”¨ cra å¾ˆå¿«ä¹Ÿå»ºå¥½ demoï¼Œè§£å†³å¦‚ä½•è®© cra åˆ›å»ºçš„é¡¹ç›®æ”¯æŒ less ï¼Œè¿™ä¸ªç®€å•ï¼š<br>é€šè¿‡ <code>customize-cra</code> æä¾›çš„ <code>addLessLoader</code> æ–¹æ³•å³å¯ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº† <code>fixBabelImports</code> å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ·»åŠ  babel-plugin-import é…ç½®ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; override, fixBabelImports, addLessLoader &#125; = <span class="built_in">require</span>(<span class="string">'customize-cra'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = override(</span><br><span class="line">  fixBabelImports(<span class="string">'import'</span>, &#123;</span><br><span class="line">    libraryName: <span class="string">'antd-mobile'</span>,</span><br><span class="line">    style: <span class="literal">true</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">  addLessLoader(&#123;</span><br><span class="line">    lessOptions: &#123;</span><br><span class="line">      javascriptEnabled: <span class="literal">true</span>,</span><br><span class="line">      modifyVars: &#123;</span><br><span class="line">        <span class="string">'@brand-primary'</span>: <span class="string">'#ff74b9'</span>,</span><br><span class="line">        <span class="string">'brand-primary-tap'</span>: <span class="string">'#ff9cca'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h5 id="åˆ«å"><a href="#åˆ«å" class="headerlink" title="åˆ«å"></a>åˆ«å</h5><p>æ¥ç€æ˜¯é…ç½®è·¯å¾„åˆ«åé‡åˆ°çš„é—®é¢˜ï¼Œé€šè¿‡ <code>customize-cra</code> æä¾›çš„ <code>addWebpackAlias</code> å¯ä»¥é…ç½®åˆ«åï¼Œä½†æ˜¯ typescript ä¸€ç›´æ— æ³•è§£æå¯¹åº”åˆ«åï¼Œé‚£ä¹ˆåº”è¯¥åªéœ€è¦é…ç½®å¥½ ts çš„ paths å°±è¡Œäº†å§ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="attr">"baseUrl"</span>: <span class="string">"."</span>,</span><br><span class="line">    <span class="attr">"paths"</span>: &#123;</span><br><span class="line">      <span class="attr">"@/*"</span>: [<span class="string">"./src/*"</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>vscode ä¸å†æŠ¥é”™äº†,æ¥ä¸‹æ¥å°±æ˜¯è§è¯å¥‡è¿¹çš„æ—¶åˆ»äº†<code>npm run start</code>ï¼š<br>æ§åˆ¶å°æ˜¾ç¤º <code>- compilerOptions.paths must not be set (aliased imports are not supported)</code> å¹¶ä¸” cra ä¼šè‡ªåŠ¨æŠŠ tscongfig ä¸­çš„ paths ç§»é™¤æ‰ ğŸ˜‚<br>æ ¹æ® <a href="https://github.com/timarney/react-app-rewired/issues/375" target="_blank" rel="noopener">issue</a>ï¼Œä½¿ç”¨å°† baseUrl å’Œ paths çš„é…ç½®ç§»åŠ¨åˆ°å•ç‹¬çš„æ–‡ä»¶åï¼Œåœ¨ tsconfig é‡Œé€šè¿‡ extends çš„æ–¹å¼ç»§æ‰¿ï¼Œè™½ç„¶æ§åˆ¶å°ä¾ç„¶æç¤ºé”™è¯¯ï¼Œä½†æ˜¯åˆ«åå¯ä»¥ç”Ÿæ•ˆã€‚</p><h5 id="mini-css-extract-plugin"><a href="#mini-css-extract-plugin" class="headerlink" title="mini-css-extract-plugin"></a>mini-css-extract-plugin</h5><p>åœ¨ build æ—¶ï¼Œmini-css-extract-plugin æç¤º Conflicting orderï¼Œ é”™è¯¯ä½ç½®åœ¨ antd-mobile çš„æ ·å¼æ–‡ä»¶ã€‚æ ¹æ® <a href="https://github.com/ant-design/ant-design/issues/14895" target="_blank" rel="noopener">issue</a> ä»¥åŠ <a href="https://github.com/webpack-contrib/mini-css-extract-plugin/issues/250" target="_blank" rel="noopener"> issue </a>çœ‹æ¥è¿™ä¸ªé—®é¢˜ä¸»è¦æ˜¯ç”±äºæ‡’åŠ è½½åŠ ä¸Š antd ç»„ä»¶å¯¼å…¥é¡ºåºä¸ä¸€è‡´å¯¼è‡´çš„ï¼Œç›®å‰çœ‹æ¥æ— éœ€è§£å†³ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é‡å­¦ Generatorã€Šä¸€ã€‹</title>
      <link href="/2020/07/15/%E9%87%8D%E5%AD%A6%20Generator%E3%80%8A%E4%B8%80%E3%80%8B/"/>
      <url>/2020/07/15/%E9%87%8D%E5%AD%A6%20Generator%E3%80%8A%E4%B8%80%E3%80%8B/</url>
      
        <content type="html"><![CDATA[<h5 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h5><p>åœ¨å®é™…å·¥ä½œçš„ä¸šåŠ¡å¼€å‘ä¸­ï¼Œä½¿ç”¨åˆ° Generator æ¯”è¾ƒå°‘ã€‚è¿‘æœŸæœ‰ä¸ªé¡¹ç›®çŠ¶æ€ç®¡ç†ä½¿ç”¨çš„æ˜¯ redux-sagaï¼Œè€Œ redux-saga åˆæ˜¯åŸºäº Generatorï¼Œå€Ÿæ­¤æœºä¼šé‡æ–°å­¦äº†ä¸‹ Generatorã€‚</p><p>æœ¬æ–‡ä¸»è¦æ˜¯è®°å½• generator çš„è¦ç‚¹ï¼Œä»¥é˜²å°†æ¥é—å¿˜ã€‚</p><a id="more"></a><h5 id="è°ƒç”¨-generator-å°†ä¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨"><a href="#è°ƒç”¨-generator-å°†ä¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨" class="headerlink" title="è°ƒç”¨ generator å°†ä¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨"></a>è°ƒç”¨ generator å°†ä¼šè¿”å›ä¸€ä¸ªè¿­ä»£å™¨</h5><p>æ‰€è°“ generator å®é™…ä¸Šå°±æ˜¯å¸¦æœ‰ * çš„å‡½æ•°ï¼Œè°ƒç”¨åä¸ä¼šæ‰§è¡Œ generator å†…éƒ¨ä»£ç ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ª iterator</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> generatorFunction = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'generator'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> iterator = generatorFunction()</span><br><span class="line"><span class="built_in">console</span>.log(iterator[<span class="built_in">Symbol</span>.iterator])</span><br><span class="line"></span><br><span class="line"><span class="comment">// function [Symbol.iterator]()</span></span><br></pre></td></tr></table></figure><h5 id="æ‰§è¡Œ-generator"><a href="#æ‰§è¡Œ-generator" class="headerlink" title="æ‰§è¡Œ generator"></a>æ‰§è¡Œ generator</h5><p>æ¯æ¬¡è°ƒç”¨è¿”å›çš„è¿­ä»£å™¨çš„ next æ–¹æ³•å¯ä»¥æ‰§è¡Œ generator ä¸­çš„ä»£ç ï¼Œç›´åˆ°æ‰§è¡Œå®Œé‡åˆ°çš„ç¬¬ä¸€ä¸ª yield æˆ–è€… return åå¹¶äº¤å‡ºæ‰§è¡Œæƒ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> generatorFunction = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'1'</span>)</span><br><span class="line">  <span class="keyword">yield</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'2'</span>)</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> iterator = generatorFunction()</span><br><span class="line">iterator.next()</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line">iterator.next()</span><br><span class="line"><span class="comment">// 2</span></span><br></pre></td></tr></table></figure><h5 id="return-ä¸-yield-çš„å¼‚åŒ"><a href="#return-ä¸-yield-çš„å¼‚åŒ" class="headerlink" title="return ä¸ yield çš„å¼‚åŒ"></a>return ä¸ yield çš„å¼‚åŒ</h5><p>æ‰§è¡Œ iterator.next è¿”å›çš„æ˜¯ä¸€ä¸ªåŒ…æ‹¬ value å’Œ done ä¸¤ä¸ªå±æ€§çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡çš„ value å°±æ˜¯ <code>yield</code> æˆ– <code>return</code> åé¢è¡¨è¾¾å¼çš„å€¼ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> generatorFunction = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> iterator = generatorFunction()</span><br><span class="line"><span class="keyword">var</span> a = iterator.next()</span><br><span class="line"><span class="built_in">console</span>.log(a)</span><br><span class="line"><span class="comment">// &#123; value: 1, done: false &#125;</span></span><br><span class="line"><span class="keyword">var</span> b = iterator.next()</span><br><span class="line"><span class="built_in">console</span>.log(b)</span><br><span class="line"><span class="comment">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure><p>yield ä¸ return ç±»ä¼¼ï¼Œä½† yield æ˜¯æš‚åœçš„æ„æ€ï¼Œè€Œ return åˆ™ä»£è¡¨ç»“æŸ, return ä¹‹åçš„ä»£ç å°†ä¸ä¼šè¢«æ‰§è¡Œåˆ°ã€‚</p><p>done ä¸º true è¡¨ç¤ºéå†ç»“æŸï¼Œä½†æ˜¯æ­¤æ—¶ä¾ç„¶å¯ä»¥å¯ä»¥ç»§ç»­è°ƒç”¨ iterator.next()ï¼Œåªä¸è¿‡è¿”å›å€¼å°†æ˜¯ { value: undefined, done: true }ã€‚</p><p><code>for...of</code>å¾ªç¯å¯ä»¥è‡ªåŠ¨éå† Generator å‡½æ•°è¿è¡Œæ—¶ç”Ÿæˆçš„<code>Iterator</code>å¯¹è±¡ï¼Œç›´åˆ° done å˜ä¸º trueã€‚</p><p>âš ï¸ done ä¸º true çš„è¿è¡Œç»“æœä¼šè¢«æŠ›å¼ƒæ‰ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> generatorFunction = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> iterator = generatorFunction();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> index <span class="keyword">of</span> iterator) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(index);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 3</span></span><br></pre></td></tr></table></figure><h5 id="next-çš„å‚æ•°"><a href="#next-çš„å‚æ•°" class="headerlink" title="next çš„å‚æ•°"></a>next çš„å‚æ•°</h5><p>next çš„å‚æ•°å¯ä»¥æœ€ä¸º yield è¯­å¥çš„è¿”å›å€¼:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> generatorFunction = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="keyword">yield</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'a'</span>, a)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> iterator = generatorFunction()</span><br><span class="line">iterator.next()</span><br><span class="line">iterator.next(<span class="number">1</span>)</span><br><span class="line"><span class="comment">// a 1</span></span><br></pre></td></tr></table></figure><h5 id="yield"><a href="#yield" class="headerlink" title="yield *"></a>yield *</h5><p>é€šè¿‡ yield * å¯ä»¥è¿›å…¥åˆ°å¦ä¸€ä¸ª generator ä¸­ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> foo = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">'foo'</span>;</span><br><span class="line">    <span class="keyword">yield</span> * bar();</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> bar = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">'bar'</span>;</span><br><span class="line">    <span class="keyword">yield</span> * baz();</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> baz = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">'baz'</span>;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> index <span class="keyword">of</span> foo()) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(index);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// foo</span></span><br><span class="line"><span class="comment">// bar</span></span><br><span class="line"><span class="comment">// baz</span></span><br></pre></td></tr></table></figure><h5 id="å‘-generaotr-å†…éƒ¨æŠ›å¼‚å¸¸"><a href="#å‘-generaotr-å†…éƒ¨æŠ›å¼‚å¸¸" class="headerlink" title="å‘ generaotr å†…éƒ¨æŠ›å¼‚å¸¸"></a>å‘ generaotr å†…éƒ¨æŠ›å¼‚å¸¸</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> generatorFunction = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">yield</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e != <span class="string">'a'</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> e;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'Generator caught'</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> iterator = generatorFunction();</span><br><span class="line">iterator.next();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    iterator.throw(<span class="string">'a'</span>);</span><br><span class="line">    iterator.throw(<span class="string">'b'</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Uncaught'</span>, e);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Generator caught a</span></span><br><span class="line"><span class="comment">// Uncaught b</span></span><br></pre></td></tr></table></figure><p>èµ„æ–™ä¸»è¦å‚è€ƒè‡ª  <a href="https://github.com/gajus/gajus.com-blog/blob/master/posts/the-definitive-guide-to-the-javascript-generators/index.md" target="_blank" rel="noopener">generator æƒå¨æŒ‡å—</a></p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
