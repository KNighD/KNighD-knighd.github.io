<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>JavaScript-OOP.md</title>
      <link href="/2021/02/19/JavaScript-OOP/"/>
      <url>/2021/02/19/JavaScript-OOP/</url>
      
        <content type="html"><![CDATA[<p>åœ¨å¹³æ—¶çš„ CodeReview ä¸­è¦å¦‚ä½•å»åˆ†è¾¨ä»£ç çš„å¥½åå‘¢ï¼Ÿæœ€è¿‘çœ‹åˆ° <a href="https://github.com/ryanmcdermott/clean-code-javascript">https://github.com/ryanmcdermott/clean-code-javascript</a> è¿™ä¸ªä»“åº“çš„æ€»ç»“ï¼Œæ„Ÿè§‰è›®æœ‰å‚è€ƒä»·å€¼çš„ã€‚ç‰¹åˆ«æ˜¯å…³äºç±»è¿™ä¸€ç« ï¼Œæ¶‰åŠå¾ˆå¤šè®¾è®¡æ¨¡å¼çš„æ€æƒ³ã€‚åˆšå¥½ç›¸å…³çš„ä¸­æ–‡ä»“åº“ä¼¼ä¹ç¼ºå¤±äº†ç±»è¿™ç« èŠ‚çš„ç¿»è¯‘ï¼Œä»¥ä¸‹ä¸ºç±»ä»¥åŠ SOLID è¿™ä¸ªç« èŠ‚çš„ç¿»è¯‘å¹¶æ·»åŠ ä¸ªäººç†è§£ã€‚</p><a id="more"></a><h2 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h2><h3 id="æœ€å¥½ä½¿ç”¨-ES2015-ES6-classes-è€Œé-ES5-çš„å‡½æ•°"><a href="#æœ€å¥½ä½¿ç”¨-ES2015-ES6-classes-è€Œé-ES5-çš„å‡½æ•°" class="headerlink" title="æœ€å¥½ä½¿ç”¨  ES2015/ES6 classes è€Œé ES5 çš„å‡½æ•°"></a>æœ€å¥½ä½¿ç”¨  ES2015/ES6 classes è€Œé ES5 çš„å‡½æ•°</h3><p>ä¼ ç»Ÿçš„ ES5 ç±»çš„ç»§æ‰¿ï¼Œæ„é€ ï¼Œä»¥åŠå†…éƒ¨æ–¹æ³•å¯è¯»æ€§éå¸¸å·®ï¼Œåœ¨éœ€è¦ç»§æ‰¿ï¼ˆå½“ç„¶ä½ ä¹Ÿå¯ä»¥æ— éœ€ç»§æ‰¿ï¼‰çš„åœºæ™¯ä¸‹ï¼Œæ¨èä½¿ç”¨  ES2015/ES6 classesã€‚å¦‚æœä½ éœ€è¦ä¸€ä¸ªå¤§å‹ä¸”æåº¦å¤æ‚çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ function æ›¿ä»£ classã€‚</p><p><strong>Bad</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const Animal &#x3D; function(age) &#123;  if (!(this instanceof Animal)) &#123;    throw new Error(&quot;Instantiate Animal with &#96;new&#96;&quot;);  &#125;  this.age &#x3D; age;&#125;;Animal.prototype.move &#x3D; function move() &#123;&#125;;const Mammal &#x3D; function(age, furColor) &#123;  if (!(this instanceof Mammal)) &#123;    throw new Error(&quot;Instantiate Mammal with &#96;new&#96;&quot;);  &#125;&#x2F;&#x2F; è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–å½“å‰å­ç±»çš„ this çš„ age å±æ€§  Animal.call(this, age);  &#x2F;&#x2F; åˆå§‹åŒ–å­ç±»çš„ this çš„ furColor å±æ€§  this.furColor &#x3D; furColor;&#125;;&#x2F;&#x2F; å°†å­ç±»çš„ prototype ä¿®æ”¹ä¸ºçˆ¶ç±»çš„ prototypeMammal.prototype &#x3D; Object.create(Animal.prototype);&#x2F;&#x2F; ä¿®æ”¹å­ç±»çš„ prototype.constructor çš„æŒ‡å‘Mammal.prototype.constructor &#x3D; Mammal;&#x2F;&#x2F; ç»™å­ç±»çš„ prototype æ·»åŠ é¢å¤–çš„å‡½æ•°Mammal.prototype.liveBirth &#x3D; function liveBirth() &#123;&#125;;const Human &#x3D; function(age, furColor, languageSpoken) &#123;  if (!(this instanceof Human)) &#123;    throw new Error(&quot;Instantiate Human with &#96;new&#96;&quot;);  &#125;  Mammal.call(this, age, furColor);  this.languageSpoken &#x3D; languageSpoken;&#125;;Human.prototype &#x3D; Object.create(Mammal.prototype);Human.prototype.constructor &#x3D; Human;Human.prototype.speak &#x3D; function speak() &#123;&#125;;</code></pre><p>ä¸Šè¿°çš„ç»§æ‰¿å®é™…ä¸Šå°±æ˜¯æœ€å¸¸è§çš„ç»„åˆå¯„ç”Ÿå¼ç»§æ‰¿ï¼š</p><ol><li>åœ¨å­ç±»ä¸­è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ç”¨äºç»§æ‰¿å±æ€§</li><li>è®¾ç½®å­ç±»è‡ªå·±çš„å±æ€§</li><li>å°†å­ç±»çš„ prototype ä¿®æ”¹ä¸ºçˆ¶ç±»çš„ prototype ç”¨äºç»§æ‰¿çˆ¶ç±»çš„æ–¹æ³•</li><li>ä¿®æ”¹ å­ç±»çš„ prototype.constructor çš„æŒ‡å‘ä¸ºå­ç±»</li><li>æ·»åŠ å­ç±»è‡ªå·±çš„æ–¹æ³• </li></ol><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªè¿‡ç¨‹æä¸ºç¹çã€‚</p><p><strong>Good</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class Animal &#123;  constructor(age) &#123;    this.age &#x3D; age;  &#125;  move() &#123;    &#x2F;* ... *&#x2F;  &#125;&#125;class Mammal extends Animal &#123;  constructor(age, furColor) &#123;    &#x2F;&#x2F; æ‰§è¡Œçˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œç»§æ‰¿çˆ¶ç±»å±æ€§å€¼ä»¥åŠæ–¹æ³•    super(age);    this.furColor &#x3D; furColor;  &#125;  liveBirth() &#123;    &#x2F;* ... *&#x2F;  &#125;&#125;class Human extends Mammal &#123;  constructor(age, furColor, languageSpoken) &#123;    super(age, furColor);    this.languageSpoken &#x3D; languageSpoken;  &#125;  speak() &#123;    &#x2F;* ... *&#x2F;  &#125;&#125;</code></pre><p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨ class åˆ™ç®€å•çš„å¤šï¼Œåªéœ€è¦ extends å…³é”®å­—ï¼Œå¹¶ä¸”åœ¨å­ç±»ä¸­çš„ constructor çš„ super æ¥å®ç°ç»§æ‰¿ã€‚</p><p>è¿™é‡Œæœ‰ä¸ªæ³¨æ„ç‚¹æ˜¯ï¼šå­ç±»å¦‚æœå†™äº† constructorï¼Œ è€Œä¸å†™ super æˆ–æ˜¯åœ¨è°ƒç”¨ this åå†è°ƒç”¨ superï¼Œåˆ™ä¼šæŠ¥é”™ï¼Œè¿™æ˜¯å› ä¸º constructor ä¸å†™åˆ™é»˜è®¤ä¸ºçˆ¶ç±»çš„ constructorï¼Œå¦‚æœå†™äº† constructorï¼Œä½†æ˜¯æ²¡æœ‰è°ƒç”¨ superï¼Œåˆ™æ— æ³•ç”Ÿæˆ thisï¼Œè¿™ç‚¹ä¸ ES5 ä¹Ÿæ˜¯æœ‰åŒºåˆ«çš„ã€‚å³ ES5 å­ç±»ç»§æ‰¿å‰å°±æœ‰ this äº†ï¼Œè€Œ ES6 çš„ class å­ç±»åˆ™æ˜¯ super ä¹‹åæ‰æœ‰çš„ thisã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ReactNative æ–‡å­—æŠ˜å </title>
      <link href="/2021/01/22/ReactNative-%E6%96%87%E5%AD%97%E6%8A%98%E5%8F%A0/"/>
      <url>/2021/01/22/ReactNative-%E6%96%87%E5%AD%97%E6%8A%98%E5%8F%A0/</url>
      
        <content type="html"><![CDATA[<p> h5 çš„å•è¡Œ/å¤šè¡Œæ–‡å­—æº¢å‡ºæˆªæ–­å®ç°å¦‚ä¸‹</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">&#x2F;&#x2F; å•è¡Œdiv &#123;  white-space: nowrap;  overflow: hidden;  text-overflow: ellipsis;&#125;&#x2F;&#x2F; å¤šè¡Œdiv &#123;  display: -webkit-box;  overflow: hidden;  -webkit-line-clamp: 2;  -webkit-box-orient: vertical;  text-overflow: ellipsis;&#125;</code></pre><p>åœ¨ h5 ä¸­ï¼Œå¤šè¡Œæ–‡å­—æˆªæ–­çš„å…¼å®¹æ€§å¹¶ä¸å¥½ï¼Œè€Œåœ¨ RN ä¸­ï¼Œå®ç°æ–‡å­—æˆªæ–­åˆ™ç®€å•çš„å¤šï¼Œåªéœ€è¦ç»™ Text ç»„ä»¶æ·»åŠ  <code>numberOfLines</code> å±æ€§å³å¯ã€‚</p><p>ä½†æ˜¯é€šå¸¸æˆ‘ä»¬è¿˜ä¼šé‡åˆ°å¦‚ä¸‹éœ€æ±‚ï¼š</p><p>æ–‡å­—åœ¨ä¸è¶…å‡º N è¡Œæ—¶ï¼Œå…¨éƒ¨å±•ç¤ºï¼Œè¶…å‡º N è¡Œæ—¶æˆªæ–­ï¼Œå¹¶æ˜¾ç¤º é˜…è¯»æ›´å¤š æŒ‰é’®ï¼Œç”¨äºç‚¹å‡»å±•å¼€ï¼Œå±•å¼€å é˜…è¯»æ›´å¤š æŒ‰é’®æ˜¾ç¤ºä¸º æ”¶èµ·ï¼Œç‚¹å‡»åæŠ˜å æ–‡å­—ã€‚</p><a id="more"></a><p>å¦‚æœæˆ‘ä»¬èƒ½å¾—çŸ¥æ–‡å­—åˆå§‹æ—¶æ˜¯å¦å¤„äºæŠ˜å çŠ¶æ€ï¼Œé‚£ä¹ˆå°±å¾ˆå¥½åŠäº†ï¼Œé€šè¿‡ä¿®æ”¹ <code>numberOfLines</code>  çš„å€¼ 0 / Nï¼Œæ¥å˜æ›´ å±•å¼€ä¸æŠ˜å  çŠ¶æ€ã€‚</p><p>ä½†æ˜¯å¾ˆå¯æƒœï¼ŒRN å¹¶æ²¡æœ‰æä¾› api æ¥å‘ŠçŸ¥æ–‡å­—æ˜¯å¦å¤„äºæŠ˜å çŠ¶æ€ï¼Œå› æ­¤åªèƒ½å¦å¯»ä»–æ³•ã€‚</p><h5 id="å°è¯•ä¸€"><a href="#å°è¯•ä¸€" class="headerlink" title="å°è¯•ä¸€"></a>å°è¯•ä¸€</h5><p>å‚è€ƒ github ä¸Šçš„ <a href="https://github.com/facebook/react-native/issues/2496">issue</a> å¯ä»¥çœ‹åˆ°è¿™ä¸ªé—®é¢˜ç”±æ¥å·²ä¹…ï¼Œæœ‰ä¸ªè§£æ³•æ˜¯åœ¨ onLayout æ—¶è·å– Text çš„é«˜åº¦, å¯¹æ¯”ç†è®ºæŠ˜å å€¼( N * lineHeight)ï¼Œå¦‚æœæ¯”ç†è®ºæŠ˜å å€¼å¤§ï¼Œåˆ™è¯´æ˜æ–‡å­—å¤„äºæŠ˜å çŠ¶æ€ã€‚</p><p>ä¸Šé¢è¿™ä¸ªæ–¹æ¡ˆæˆ‘å°è¯•äº†ä¸‹ï¼Œåœ¨ ios ä¸Šè¡¨ç°è‰¯å¥½ï¼Œä½†æ˜¯åœ¨ å®‰å“ æœºå™¨ä¸Šï¼ŒonLayout æ—¶è·å–åˆ°çš„ Text é«˜åº¦å´æ˜¯æŠ˜å åçš„é«˜åº¦ï¼Œè¿™æ„å‘³ç€ä¸Šè¿°æ–¹æ³•å°†å¤±æ•ˆã€‚</p><h5 id="å°è¯•äºŒ"><a href="#å°è¯•äºŒ" class="headerlink" title="å°è¯•äºŒ"></a>å°è¯•äºŒ</h5><p>æ¥ç€æˆ‘åˆæ³¨æ„åˆ°ä¸€ä¸ª api <code>onTextLayout</code>ã€‚<code>onTextLayout</code> åœ¨ Text layout çš„æ—¶å€™ä¼šè¢«è°ƒç”¨ï¼Œå¯ä»¥è·å–åˆ° linesï¼Œè¿™æ˜¯ä¸ªå¯¹è±¡æ•°ç»„ï¼ŒåŒ…å«äº†æ¯è¡Œæ–‡å­—çš„å®½é«˜ç­‰ä¿¡æ¯ã€‚æˆ‘æ‰“ç®—å°è¯•ä¸€ä¸‹è¿™ä¸ª api å…·ä½“çš„è¡¨ç°å¦‚ä½•ã€‚å¥‡æ€ªçš„æ˜¯<code>onTextLayout</code> è™½ç„¶å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯ TS çš„ç”³æ˜æ–‡ä»¶ä¸­ Text ç»„ä»¶å´æ²¡æœ‰è¿™ä¸ªå±æ€§ã€‚å†åˆ™åœ¨å®‰å“æœºä¸Š <code>onTextLayout</code>  è¿”å›çš„ lines ä¸ºæœªæŠ˜å æ—¶çš„è¡Œæ•°ï¼Œè€Œåœ¨ ios ä¸Šåˆ™ä¸ºæŠ˜å åçš„è¡Œæ•°ï¼ˆæœ€åä¸€è¡Œå°†åŒ…æ‹¬æŠ˜å åæœªèƒ½æ”¾ä¸‹çš„æ–‡å­—ï¼‰ã€‚çœ‹æ¥ä»…é€šè¿‡ <code>onTextLayout</code>  ä¹Ÿæ˜¯æ— æ³•åˆ¤æ–­åˆ°æ˜¯å¦æ–‡å­—å¤„äºæŠ˜å çŠ¶æ€ã€‚</p><h5 id="å°è¯•ä¸‰"><a href="#å°è¯•ä¸‰" class="headerlink" title="å°è¯•ä¸‰"></a>å°è¯•ä¸‰</h5><p>ä¸è¿‡ä¸Šè¿°çš„å°è¯•å¯å‘äº†æˆ‘ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥å¾—çŸ¥æ–‡å­—åœ¨å…¨éƒ¨å±•å¼€æ—¶çš„è¡Œæ•°ï¼Œå¦‚æœè¶…è¿‡ N ï¼Œåˆ™å°† <code>numberOfLines</code>  è®¾ç½®ä¸º Nï¼Œå¦åˆ™ä¸º 0ï¼Œæ­¤æ—¶çš„åˆå§‹åŒ–çŠ¶æ€å¿…å®šæ˜¯æŠ˜å çš„ã€‚é‚£ä¹ˆé—®é¢˜æ˜¯å¦‚ä½•å¾—çŸ¥æ–‡å­—åœ¨å…¨éƒ¨å±•å¼€æ—¶çš„è¡Œæ•°ï¼Ÿå¦‚æœå°†æ–‡å­— <code>numberOfLines</code>  åˆå§‹å€¼è®¾ç½®ä¸º 0ï¼Œè¡¨ç°å°†ä¼šæ˜¯ä¸€å¼€å§‹å…¨éƒ¨å±•å¼€ï¼Œä¹‹åå†æ”¶èµ·ï¼Œæ˜¾ç„¶ä¸ç¬¦åˆéœ€æ±‚ã€‚é‚£ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ªä¸ä¼šè¢«çœ‹åˆ°çš„åœ°æ–¹æš—æˆ³æˆ³åœ°æ¸²æŸ“ <code>numberOfLines</code>  ä¸º 0 çš„ Textã€‚è¿™é‡Œæˆ‘æ˜¯æ„å»ºäº†ä¸€ä¸ª height ä¸º 0 çš„ ScrollViewï¼Œåœ¨è¿™ä¸ª ScrollView ä¸­æ¸²æŸ“ <code>numberOfLines</code>  ä¸º 0 çš„ Textï¼Œå¹¶ä¸”é€šè¿‡è¯¥ Text çš„ onTextLayout å¯ä»¥è·å–åˆ°æ–‡å­—çš„è¡Œæ•°ï¼Œå¹¶ä¸”ä¸ N è¿›è¡Œå¯¹æ¯”ï¼Œå°±å¯ä»¥çŸ¥é“æ–‡å­—æ˜¯å¦å¯æŠ˜å ã€‚</p><p>æœ€ç»ˆä»£ç å®ç°å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">&#x2F;* è¯¥ç»„ä»¶çš„ä¸»è¦ç”¨é€”æ˜¯æµ‹é‡å…·æœ‰ numberOfLines å±æ€§çš„ Text æ˜¯å¦ä¼šè¢«è£å‰ªï¼Œä»¥ç”¨äºè‡ªå®šä¹‰å±•å¼€æ›´å¤šæŒ‰é’® åŸç†æ˜¯åœ¨ä¸€ä¸ªé«˜åº¦ä¸º 0 çš„ ScrollView ä¸­è¿›è¡Œæ¸²æŸ“ï¼Œè·å–åˆ°æ¸²æŸ“åçš„è¡Œæ•°*&#x2F;import React, &#123; Children, isValidElement, cloneElement &#125; from &#39;react&#39;;import &#123; View, ViewStyle, ScrollView &#125; from &#39;react-native&#39;;interface IProps &#123;&#x2F;&#x2F; æœ€å¤šè¡Œæ•°ï¼Œè¶…å‡ºæŠ˜å   limitLineNumber: number;  children: React.ReactElement;  onReady: (truncated: boolean) &#x3D;&gt; void;  style: ViewStyle;&#125;const ReadMore &#x3D; (&#123; children, limitLineNumber, onReady, style &#125;: IProps) &#x3D;&gt; &#123;  &#x2F;* å¤åˆ¶å‡ºä¸€ä¸ªä¸å¸¦æœ‰ numberOfLines çš„ children *&#x2F;  const childrenTemp &#x3D; Children.map(children, (child) &#x3D;&gt; &#123;    if (isValidElement(child)) &#123;      return cloneElement(child as React.ReactElement&lt;any&gt;, &#123;        numberOfLines: 0,        onTextLayout: (e: any) &#x3D;&gt; &#123;          &#x2F;&#x2F; onTextLayoutäº‹ä»¶ï¼šios ä¸ å®‰å“ åœ¨æ–‡å­—æŠ˜å æƒ…å†µæ—¶ä¼šç•¥å¾®ä¸åŒï¼Œä½“ç°åœ¨ lines å±æ€§ä¸Š          &#x2F;&#x2F; ios æ˜¯è¿”å›æŠ˜å åçš„ï¼Œè€Œå®‰å“åˆ™è¿”å›çš„æ˜¯æŠ˜å ä¹‹å‰çš„          &#x2F;&#x2F; onTextLayout åœ¨ 0.59 çš„æ–‡æ¡£ä¸Šå¹¶æœªä½“ç°ï¼Œä¸” ts ç±»å‹ä¹Ÿæ²¡æœ‰ï¼Œä½†å®é™…ä¸Šæ˜¯å¯ä»¥ä½¿ç”¨çš„          onReady(e.nativeEvent.lines?.length &gt; limitLineNumber);        &#125;,      &#125;);    &#125;    return child;  &#125;);  return (    &lt;View style&#x3D;&#123;style&#125;&gt;      &lt;ScrollView style&#x3D;&#123;&#123; height: 0 &#125;&#125;&gt;&#123;childrenTemp&#125;&lt;&#x2F;ScrollView&gt;      &#123;children&#125;    &lt;&#x2F;View&gt;  );&#125;;export default ReadMore;</code></pre><p>ä½¿ç”¨æ—¶:</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const Demo &#x3D; () &#x3D;&gt; &#123;  const onReadMoreReady &#x3D; (truncated: boolean) &#x3D;&gt; &#123;      &#x2F;&#x2F; æ ¹æ®æ˜¯å¦å¯æŠ˜å ï¼Œåˆ¤æ–­å±•ç¤ºæŒ‰é’®çš„æ–‡å­—ç­‰çŠ¶æ€  &#125;;    return &lt;ReadMore onReady&#x3D;&#123;onReadMoreReady&#125; limitLineNumber&#x3D;&#123;2&#125; &gt;    &lt;Text&gt;      any content you need...    &lt;&#x2F;Text&gt;  &lt;&#x2F;ReadMore&gt;&#125;</code></pre><p>âš ï¸ ä»¥ä¸Šå…¨éƒ¨åŸºäº RN 0.59 ç‰ˆæœ¬</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ReactNative </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°å½•ä¸€æ¬¡è¸©å‘ï¼šwebpä¸ios</title>
      <link href="/2020/12/31/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E8%B8%A9%E5%9D%91%EF%BC%9Awebp%E4%B8%8Eios/"/>
      <url>/2020/12/31/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E8%B8%A9%E5%9D%91%EF%BC%9Awebp%E4%B8%8Eios/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘æœ‰åŒäº‹é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œæœ‰ä¸ªé¡µé¢çš„å›¾ç‰‡ï¼ˆ<a href="http://www.xxx.jpgï¼‰åœ¨å®‰å“å’Œ">www.xxx.jpgï¼‰åœ¨å®‰å“å’Œ</a> pc éƒ½èƒ½æ­£å¸¸æ˜¾ç¤ºï¼Œä½†æ˜¯ç”¨ ios å°±å±•ç¤ºä¸äº†ã€‚é€šå¸¸å‡ºç°åœ¨è¿™ç§æƒ…å†µæ˜¯å› ä¸º WKWebview ä¸æ”¯æŒ webp çš„å›¾ç‰‡å¯¼è‡´çš„ã€‚é€šè¿‡ <a href="https://caniuse.com/?search=webpï¼Œå¯ä»¥çœ‹åˆ°">https://caniuse.com/?search=webpï¼Œå¯ä»¥çœ‹åˆ°</a> safari åœ¨ 14.0 ä¹‹åæ‰æ”¯æŒ webpã€‚</p><a id="more"></a><p>è™½ç„¶è¿™ä¸ªåœºæ™¯é‡Œçš„å›¾ç‰‡åç¼€åæ˜¯ jpgï¼Œä½†æ–‡ä»¶çš„åç¼€åå¹¶ä¸èƒ½å‡†ç¡®åæ˜ æ–‡ä»¶çš„å®é™…æ ¼å¼ã€‚å› æ­¤åœ¨ pc ç«¯æ‰“å¼€é“¾æ¥åï¼ŒæŸ¥çœ‹ <code>Content-Type</code> çœ‹åˆ°å±æ€§ä¸º <code>image/webp</code>, å› æ­¤å¯ä»¥ç¡®å®šè¿™ä¸ªå›¾ç‰‡æ–‡ä»¶å®é™…ä¸Šæ˜¯ webpã€‚</p><p>è¿™ä¸ªå›¾ç‰‡æ˜¯åœ¨åå°ç³»ç»Ÿä¸Šä¼ çš„ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½æ˜¯æ“ä½œäººå‘˜ä»ç½‘ç»œä¸‹è½½äº†ä¸€å¼  webp çš„å›¾ç‰‡ï¼Œä¹‹åä¿®æ”¹åç¼€åå¹¶ä¸Šä¼ ã€‚</p><p>ä¸Šä¼ ç»„ä»¶æ˜¯é€šè¿‡ antdesign æä¾›çš„<code>Upload</code>ï¼ˆè¯¥ç»„ä»¶æœ¬è´¨ä¸Šä¹Ÿæ˜¯å°è£…äº† input ç»„ä»¶ï¼‰ã€‚ åœ¨ <code>beforeUpload</code> å¯ä»¥è·å–åˆ°ä¸Šä¼ çš„ fileï¼Œ ä¸Šä¼ å‰é€šè¿‡ <code>file.type</code> æ ¡éªŒè¿‡æ–‡ä»¶çš„ MIME type å¿…é¡»æ˜¯ <code>image/jpeg</code>ã€‚</p><p>å¥‡æ€ªçš„è¿™é‡Œ webp æ–‡ä»¶ï¼Œå¦‚æœåç¼€åæ”¹æˆ jpg, åˆ™ file.type æ˜¾ç¤ºçš„æ˜¯ <code>image/jpeg</code> è€Œé <code>image/webp</code>, å³ file.type è·å–åˆ°ç±»å‹ä¼šæ”¶åˆ°åç¼€åçš„å½±å“ï¼Œå¹¶ä¸æ˜¯å‡†ç¡®çš„æ–‡ä»¶ç±»å‹ã€‚</p><p>æ ¹æ® MDN çš„æè¿°</p><blockquote><p> Based on the current implementation, browsers wonâ€™t actually read the bytestream of a file to determine its media type. It is assumed based on the file extension; a PNG image file renamed to .txt would give â€œ<em>text/plain</em>â€œ and not â€œ<em>image/png</em>â€œ. Moreover, <code>file.type</code> is generally reliable only for common file types like images, HTML documents, audio and video. Uncommon file extensions would return an empty string. Client configuration (for instance, the Windows Registry) may result in unexpected values even for common types. <strong>Developers are advised not to rely on this property as a sole validation scheme.</strong></p></blockquote><p>ç¡®å®æµè§ˆå™¨ä¼šä¾æ®åç¼€åæ¥åˆ¤æ–­ File.type è€ŒéçœŸæ­£å»è¯»å–æ–‡ä»¶æµå†…å®¹ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•åˆ¤æ–­æ–‡ä»¶çš„ç±»å‹æ˜¯å¦ä¸ºæˆ‘ä»¬éœ€è¦çš„ç±»å‹å‘¢ï¼Ÿæœ‰åŒäº‹ç»™äº†æ®µä»£ç :</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">var reader &#x3D; new FileReader();reader.onload &#x3D; function() &#123;  const isJPG &#x3D; z &#x3D;&gt; [255,216,255].every((v, k) &#x3D;&gt; z.charCodeAt(k)&#x3D;&#x3D;&#x3D;v);  const isWEBP &#x3D; z &#x3D;&gt; [87,69,66,80].every((v, k) &#x3D;&gt; z.charCodeAt(k+8)&#x3D;&#x3D;&#x3D;v);  const isPNG &#x3D; z &#x3D;&gt; [137,80,78,71,13,10,26,10].every((v, k) &#x3D;&gt; z.charCodeAt(k) &#x3D;&#x3D;&#x3D; v);  const isGIF &#x3D; z &#x3D;&gt; [71,73,70].every((v, k) &#x3D;&gt; z.charCodeAt(k) &#x3D;&#x3D;&#x3D; v);  var res &#x3D; reader.result;  console.log(isJPG(res));  console.log(isWEBP(res));  console.log(isPNG(res));  console.log(isGIF(res));&#125;;reader.readAsBinaryString($0.files[0]);</code></pre>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»™ RN æ·»åŠ  mobx</title>
      <link href="/2020/12/14/%E7%BB%99-RN-%E6%B7%BB%E5%8A%A0-mobx/"/>
      <url>/2020/12/14/%E7%BB%99-RN-%E6%B7%BB%E5%8A%A0-mobx/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>é¡¹ç›®ç»„ä¸­ RN ä¹‹å‰ä½¿ç”¨çš„çŠ¶æ€ç®¡ç†æ˜¯å°ä¼™ä¼´è‡ªè¡Œå°è£… reduxï¼Œ redux-saga çš„ä¸€ä¸ªç»„ä»¶åº“ï¼Œç„¶è€Œç”±äºæ–‡æ¡£ä¸å…¨ï¼Œä½¿ç”¨èµ·æ¥ä¸æ–¹ä¾¿ç­‰åŸå› ï¼Œç»è¿‡è®¨è®ºï¼Œå†³å®šæ›¿æ¢æˆ mobxã€‚ä¸»è¦å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š <a href="https://mobx.js.org/react-integration.html#react-integrationã€‚æœ¬æ–‡è®°å½•æˆ‘å°†">https://mobx.js.org/react-integration.html#react-integrationã€‚æœ¬æ–‡è®°å½•æˆ‘å°†</a> mobx åŠ å…¥ RN çš„è¿‡ç¨‹ä»¥åŠä½¿ç”¨ mobx çš„ä¸€äº›æ³¨æ„äº‹é¡¹ï¼ˆå®é™…ä¸Šä¸æ™®é€šçš„ React é¡¹ç›®å·®ä¸å¤šï¼‰</p><a id="more"></a><h4 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h4><ol><li><p>åœ¨ src ç›®å½•ä¸‹æ–°å¢ä¸€ä¸ª stores æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾ mobx ç›¸å…³çš„ä»£ç </p></li><li><p>ç¼–å†™ observable stateï¼Œè¿™é‡Œæˆ‘å†™äº†ä¸€ä¸ª Counter.ts å¹¶ä¸”æ–°å»º stores.ts ç®¡ç†æ‰€æœ‰çš„çŠ¶æ€ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">&#x2F;&#x2F; Counter.tsimport &#123; makeAutoObservable &#125; from &#39;mobx&#39;;class Counter &#123;  count &#x3D; 0;  constructor() &#123;    makeAutoObservable(this);  &#125;  &#x2F;&#x2F; æ³¨æ„è¦ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼Œå¦åˆ™éœ€è¦ç”¨ action.bound æ¥ç»‘å®š thisï¼Œå¦åˆ™æŒ‡å‘ React ç»„ä»¶  increase &#x3D; () &#x3D;&gt; &#123;    this.count +&#x3D; 1;  &#125;;  decrease &#x3D; () &#x3D;&gt; &#123;    this.count -&#x3D; 1;  &#125;;&#125;export default Counter;&#x2F;&#x2F; stores.tsimport Counter from &#39;.&#x2F;Counter&#39;;export default &#123;  counter: new Counter(),&#125;;</code></pre></li><li><p>æ ¹æ® mobx æ–‡æ¡£ï¼Œç»„ä»¶è¦ä½¿ç”¨å¤–éƒ¨çŠ¶æ€æœ‰ä¸‰ç§å†™æ³•ï¼š</p><ol><li>é€šè¿‡ props å°† çŠ¶æ€ä¼ é€’åˆ°ç»„ä»¶</li><li>ç›´æ¥é€šè¿‡ import è¿›æ¥</li><li>é€šè¿‡ React context å¼•å…¥åˆ°ç»„ä»¶</li></ol><p>ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œè€ƒè™‘ 2ï¼Œ3 ä¸­å†™æ³•ï¼Œæ–‡æ¡£ä¸­æ¨èä½¿ç”¨ contextï¼Œé‚£ä¹ˆå°±è¿™é‡Œå°è¯•ä½¿ç”¨ contextã€‚</p></li><li><p>ç¼–å†™ withStores.ts å‡½æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œä¸»è¦çš„ä½œç”¨æ˜¯ç»™æ ¹å…ƒç´ ç”¨ Provider åŒ…è£¹èµ·æ¥ï¼Œå¹¶ä¸”æ ¹å…ƒç´ é€šå¸¸ä¹Ÿæ˜¯éœ€è¦ observe çš„ï¼Œå› æ­¤è¿™é‡Œä¹Ÿé¡ºä¾¿å°†å…¶è½¬æˆå¯è§‚æµ‹çš„ç»„ä»¶ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">&#x2F;&#x2F; withStores.tsimport React, &#123; createContext &#125; from &#39;react&#39;;import &#123; observer &#125; from &#39;mobx-react-lite&#39;;import stores from &#39;.&#x2F;stores&#39;;&#x2F;&#x2F; åˆå§‹åŒ– Contextexport const StoresContext &#x3D; createContext&lt;typeof stores&gt;(stores);const withStores &#x3D; &lt;P extends object&gt;(  WrappedComponent: React.FunctionComponent&lt;P&gt;,) &#x3D;&gt; (props: P) &#x3D;&gt; &#123;  &#x2F;&#x2F; è½¬æˆå¯è§‚æµ‹çš„ç»„ä»¶  const ObserverWrappedComponent &#x3D; observer(WrappedComponent);  return (    &lt;StoresContext.Provider value&#x3D;&#123;stores&#125;&gt;      &lt;ObserverWrappedComponent &#123;...props&#125; &#x2F;&gt;    &lt;&#x2F;StoresContext.Provider&gt;  );&#125;;export default withStores;</code></pre></li><li><p>æ¥ä¸‹æ¥çš„ä½¿ç”¨å°±ç®€å•äº†ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import React, &#123; useEffect, useContext &#125; from &#39;react&#39;;import &#123; TouchableOpacity, View, Text &#125; from &#39;react-native&#39;;import &#123; withStores, StoresContext &#125; from &#39;@&#x2F;stores&#39;;import Child from &#39;.&#x2F;Child&#39;;const MobxDemo &#x3D; () &#x3D;&gt; &#123;  const &#123; counter &#125; &#x3D; useContext(StoresContext);  return (    &lt;View&gt;      &lt;Text&gt;count: &#123;counter.count&#125;&lt;&#x2F;Text&gt;      &lt;TouchableOpacity onPress&#x3D;&#123;counter.increase&#125;&gt;        &lt;Text&gt;increase: +&lt;&#x2F;Text&gt;      &lt;&#x2F;TouchableOpacity&gt;      &lt;TouchableOpacity onPress&#x3D;&#123;counter.decrease&#125;&gt;        &lt;Text&gt;decrease: -&lt;&#x2F;Text&gt;      &lt;&#x2F;TouchableOpacity&gt;      &lt;Child &#x2F;&gt;    &lt;&#x2F;View&gt;  );&#125;;export default withStores(MobxDemo);&#x2F;&#x2F; Child.tsximport React, &#123; useContext &#125; from &#39;react&#39;;import &#123; observer &#125; from &#39;mobx-react-lite&#39;;import &#123; Text &#125; from &#39;react-native&#39;;import &#123; StoresContext &#125; from &#39;@&#x2F;stores&#39;;export const Child &#x3D; () &#x3D;&gt; &#123;  const &#123; counter &#125; &#x3D; useContext(StoresContext);  return &lt;Text&gt;child: &#123;counter.count&#125;&lt;&#x2F;Text&gt;;&#125;;export default observer(Child);</code></pre></li></ol>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>svg ä¸å­—ä½“</title>
      <link href="/2020/12/10/svg-%E4%B8%8E%E5%AD%97%E4%BD%93/"/>
      <url>/2020/12/10/svg-%E4%B8%8E%E5%AD%97%E4%BD%93/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>ç»§ä¸Šä¸€ç¯‡ ã€Šsvg å›¾ç‰‡çš„ä¸Šä¼ ä¸ä¸‹è½½ã€‹åï¼Œäº§å“è¦æ±‚ä¸‹è½½çš„ svg éœ€è¦ä½¿ç”¨ â€œOCR-B 10 BTâ€ è¿™ä¸ªå­—ä½“ã€‚ä¸‹é¢è®°å½•ä¸‹é‡åˆ°çš„å‘ã€‚</p><a id="more"></a><h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><p><code>jsbarcode</code> è¿™ä¸ªåº“æä¾›äº†ä¸€ä¸ª <code>font</code> é…ç½®é¡¹ã€‚ä¾‹å¦‚è¿™é‡Œé…ç½® </p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">JsBarcode(svg, barcode, &#123;  font: &#39;Arial&#39;&#125;);</code></pre><p>è¿™ä¸ªé…ç½®çš„ä½œç”¨æ˜¯åœ¨ svg çš„ text èŠ‚ç‚¹çš„ style å±æ€§ä¸Šæ·»åŠ <code>font:Arial</code></p><p>é‚£ä¹ˆé—®é¢˜å¦‚æœæ˜¯ OCR-B 10 BTï¼Œæˆ‘ä»¬ç›´æ¥é…ç½®æˆ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">JsBarcode(svg, barcode, &#123;  font: &#39;OCR-B 10 BT&#39;&#125;);</code></pre><p>é‚£ä¹ˆç»“æœä¼šå˜æˆ:</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&lt;text style&#x3D;&quot;font: OCR-B 10 BT&quot;&gt;xxx&lt;&#x2F;text&gt;</code></pre><p>è¿™å°†ä¼šå¯¼è‡´æ— æ³•è¯†åˆ«å‡º font çš„å±æ€§ï¼Œè€Œ jsbarcode å¹¶æ²¡æœ‰å•ç‹¬æä¾› font-family é…ç½®ã€‚æ­£ç¡®çš„å†™æ³•å¯ä»¥å¦‚ä¸‹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">JsBarcode(svg, barcode, &#123;  font: &#96;&quot;OCR-B 10 BT&quot;&#96;&#125;);</code></pre><p>åˆ°äº†è¿™ä¸€æ­¥å¹¶æ²¡æœ‰å®Œå…¨è§£å†³é—®é¢˜ï¼Œå¯¹äºç³»ç»Ÿæœ‰å®‰è£…è¿‡ OCR-B 10 BT å­—ä½“çš„ç”¨æˆ·æ˜¯å¯ä»¥æ­£å¸¸å±•ç¤ºä¸‹è½½çš„ svgï¼Œç„¶è€Œå¯¹äºæ²¡æœ‰å®‰è£…è¿‡è¿™ä¸ªå­—ä½“çš„åˆ™ä¼šå±•ç¤ºé»˜è®¤å­—ä½“ã€‚è¿™é‡Œåˆ†æˆä¸¤ç§åœºæ™¯ï¼š1. åœ¨æˆ‘ä»¬çš„ç½‘ç«™ä¸Šå±•ç¤º 2. ä¸‹è½½åçš„ svg å±•ç¤º</p><p>å¯¹äºç¬¬ä¸€ä¸ªåœºæ™¯ï¼Œåœ¨ web é€šè¿‡ font-face å¼•å…¥å­—ä½“æ–‡ä»¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">@font-face &#123;    font-family: &#39;OCR-B 10 BT&#39;;    src: url(&#39;fonts&#x2F;webfont.eot&#39;);    src:url(&#39;fonts&#x2F;webfont.woff&#39;) format(&#39;woff&#39;),       url(&#39;fonts&#x2F;webfont.woff2&#39;) format(&#39;woff2&#39;),        url(&#39;fonts&#x2F;webfont.ttf&#39;) format(&#39;truetype&#39;);    font-weight: normal;    font-style: normal;&#125;</code></pre><p>ç„¶è€Œåœ¨ç¬¬äºŒä¸ªåœºæ™¯åˆ™éœ€è¦å°†å­—ä½“æ–‡ä»¶æ”¾åˆ° svg é‡Œé¢ï¼Œæ³¨æ„è¿™ä¸ªä¼šå¯¼è‡´ svg ä½“ç§¯å¢å¤§ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨ svg ä¸­å®šä¹‰ styleï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const defs &#x3D; document.createElementNS(&#39;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&#39;, &#39;defs&#39;);const style &#x3D; document.createElementNS(&#39;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&#39;, &#39;style&#39;);style.type &#x3D; &#39;text&#x2F;css&#39;;&#x2F;&#x2F; myFontStyle æ˜¯æˆ‘ä»¬å®šä¹‰çš„æ ·å¼ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€æ®µå®šä¹‰ font-face çš„å­—ç¬¦ä¸²style.innerHTML &#x3D; myFontStyle;defs.appendChild(style);svgElement.appendChild(defs);</code></pre><p>å¯ä»¥é€šè¿‡ <a href="https://www.fontsquirrel.com/tools/webfont-generator">https://www.fontsquirrel.com/tools/webfont-generator</a> è¿™é‡Œé€‰æ‹© EXPERT æ¨¡å¼ï¼Œåœ¨ css çš„å‹¾é€‰æ é€‰ä¸­ Base64 ç¼–ç ï¼Œç”Ÿæˆçš„ zip åŒ…ä¸­çš„ css æ–‡ä»¶å†…å®¹å°±åŒ…å«æˆ‘ä»¬ç¼–ç æˆ base64 åçš„æ ·å¼ã€‚å°† myFontStyle æ›¿æ¢æˆ æ–‡ä»¶å†…å®¹å³å¯ã€‚</p><p>è‡³æ­¤ç»™ svg å®šä¹‰å­—ä½“çš„éœ€æ±‚å°±ç®—æ˜¯å®Œæˆäº†ï¼Œä¸è¿‡çœŸçš„ä¸æ¨èå°†å­—ä½“å¡è¿› svg ä¸­ï¼Œå¦åˆ™æ–‡ä»¶ä½“ç§¯å°†ä¼šé£™å‡ â˜ ï¸</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HTML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å›é¡¾é¡¹ç›®ä¸­å®è·µçš„ graphql</title>
      <link href="/2020/11/16/%E5%9B%9E%E9%A1%BE%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%AE%9E%E8%B7%B5%E7%9A%84-graphql/"/>
      <url>/2020/11/16/%E5%9B%9E%E9%A1%BE%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%AE%9E%E8%B7%B5%E7%9A%84-graphql/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>æ—©äº›æ—¶å€™åœ¨å…¬å¸å†…éƒ¨çš„åšè¿‡ä¸€ä¸ªå†…éƒ¨é¡¹ç›® <code>api-docs</code>ï¼Œè¯¥é¡¹ç›®æ˜¯æä¾›ä¸€ä¸ª Api ç®¡ç†æ–‡æ¡£å¹³å°ï¼Œç±»ä¼¼äº YApi ã€‚é¡¹ç›®æ˜¯åŠè·¯æ¥è¿‡æ¥çš„ï¼Œå‰ç«¯ä½¿ç”¨ <code>vue</code>ï¼ŒæœåŠ¡ç«¯ä½¿ç”¨ <code>eggjs</code> æä¾›ç¬¦åˆ restful è§„èŒƒçš„æ¥å£ï¼Œæ•°æ®åº“åˆ™é€‰æ‹©çš„æ˜¯ <code>mongodb</code>ã€‚</p><p>åœ¨ä¸æ–­çš„è¿­ä»£ä¸­ï¼Œé‡åˆ°ä»¥ä¸‹ä¸€äº›é—®é¢˜</p><ol><li>é¦–é¡µå’Œæµ‹è¯•æ¨¡å—éƒ½å±•ç¤ºäº† api åˆ—è¡¨ï¼Œä½†æ˜¯é¦–é¡µä¸æµ‹è¯•æ¨¡å—æ‰€å±•ç¤ºçš„å­—æ®µå­˜åœ¨ä¸€äº›å¼‚åŒç‚¹ï¼ŒåŸºäºæ­¤ï¼Œæœ‰ä¸¤ç§åšæ³•ï¼š<ol><li>æä¾›ä¸¤ä¸ªä¸åŒçš„æ¥å£</li><li>æä¾›åŒä¸€ä¸ªæ¥å£ï¼Œæ ¹æ®è¯·æ±‚å‚æ•°åˆ¤æ–­éœ€è¦ä¸‹å‘çš„å­—æ®µ</li></ol></li><li>éœ€è¦å¯¹å¤–å¼€æ”¾æŸ¥è¯¢æ¥å£ï¼Œä¸åŒéƒ¨é—¨éœ€æ±‚çš„å­—æ®µä¿¡æ¯ä¸åŒ</li><li>ç”±äºæ˜¯å†…éƒ¨ä½¿ç”¨ï¼Œæ¥å£ ( éœ€æ±‚ ) æ”¹åŠ¨æ¯”è¾ƒé¢‘ç¹ï¼Œä»…ä»…æ˜¯ä¿®æ”¹å‰ç«¯å±•ç¤ºçš„æ•°æ®å´éœ€è¦é¢‘ç¹ä¿®æ”¹æœåŠ¡ç«¯æ¥å£ï¼Œå½“ç„¶å¯ä»¥å°†é¡µé¢éœ€è¦çš„å­—æ®µå…¨éƒ¨ä¸‹å‘ï¼Œä¸è¿‡è¿™ä¹ˆåšæœ‰ç‚¹æµªè´¹å¸¦å®½ã€‚</li></ol><p>å› æ­¤æˆ‘å¼•å…¥äº† <code>graphql</code> æ¥è§£å†³ä¸Šè¿°çš„é—®é¢˜ã€‚åŸºæœ¬æƒ³æ³•æ˜¯å‰ç«¯è‡ªè¡Œæ„å»ºéœ€è¦çš„å­—æ®µï¼ŒæœåŠ¡ç«¯æ— éœ€å˜æ›´ã€‚</p><p>æœ¬æ–‡å°è¯•å»è¿˜åŸå¼•å…¥çš„è¿‡ç¨‹æ˜¯é˜²æ­¢é—å¿˜( å®é™…ä¸Šæ—¶é—´éš”å¾—æ¯”è¾ƒä¹…äº†ï¼Œä¸€äº›ç»†èŠ‚ç¡®å®å·²ç»æ¨¡ç³Šäº† )ã€‚ç”±äºå½“æ—¶ä¹Ÿæ˜¯æ‘¸çŸ³å¤´è¿‡æ²³ï¼Œå¯èƒ½ä¼šæœ‰ä¸€äº›ä¸æ˜¯æœ€ä½³å®è·µçš„åœ°æ–¹ï¼Œè¿˜æœ›æŒ‡æ•™ã€‚</p><a id="more"></a><p>æ–‡ä¸­æ¶‰åŠåˆ°çš„åº“ç‰ˆæœ¬ï¼š</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; æœåŠ¡ç«¯dataloader: 1.4.0egg: 2.0.0egg-graphql: 2.3.0graphql-type-json: 0.2.1&#x2F;&#x2F; å‰ç«¯graphqlï¼š14.5.8apollo-boostï¼š0.1.23</code></pre><h4 id="å‰ç«¯å¤„ç†"><a href="#å‰ç«¯å¤„ç†" class="headerlink" title="å‰ç«¯å¤„ç†"></a>å‰ç«¯å¤„ç†</h4><p>å‰ç«¯æˆ‘æ˜¯ä½¿ç”¨äº† apollo æ¥å‘é€è¯·æ±‚çš„ï¼Œå¼•å…¥ apollo</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">import Vue from &quot;vue&quot;;import VueApollo from &quot;vue-apollo&quot;;import ApolloClient from &quot;apollo-boost&quot;;import API from &quot;@&#x2F;config&#x2F;api&quot;;const apolloClient &#x3D; new ApolloClient(&#123;  uri: &#39;&#x2F;graphql&#39;&#125;);const apolloProvider &#x3D; new VueApollo(&#123;  defaultClient: apolloClient&#125;);Vue.use(VueApollo);export default apolloProvider;</code></pre><p>æ„é€ ä¸€ä¸ªæŸ¥è¯¢ api åˆ—è¡¨çš„è¯­å¥</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">import gql from &quot;graphql-tag&quot;;const apiListQuery &#x3D; gql&#96;    query($pageInfo: PageInfo)&#123;      apis(pageInfo: $pageInfo)&#123;        nodes&#123;          _id          name        &#125;        total      &#125;    &#125;  &#96;</code></pre><p>è¿˜å¯ä»¥é€šè¿‡å¼€å‘è€…å·¥å…· graphiql å¿«é€Ÿæ„é€ æ­£ç¡®çš„æŸ¥è¯¢è¯­å¥ï¼Œè¿™ä¸ªåé¢ä¼šç»“åˆ eggjs ä»‹ç»ã€‚</p><p>å‘é€è¯·æ±‚</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">function getList &#x3D; async () &#x3D;&gt; &#123;  const pageInfo &#x3D; &#123;    pageSize: 20,    currentPage: 1&#125;;  await apolloProvider.defaultClient.query(&#123;    query: apiListQuery,    variables: &#123;      pageInfo    &#125;  &#125;);&#125;</code></pre><p>æˆ–è€…ç®€å•é€šè¿‡ axios å‘é€</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">axios(&#123;  url: &#39;http:&#x2F;&#x2F;xxxxx&#x2F;graphql&#39;,  method: &#39;POST&#39;,  data: &#123;    query: &#96;            query ($filter: Api_Filter, $pageInfo: PageInfo) &#123;              apis(filter: $filter, pageInfo: $pageInfo) &#123;                  nodes &#123;                      _id                      name                  &#125;                  total              &#125;          &#125;&#96;,    variables: &#123;      pageInfo: &#123;        pageSize: 20,        currentPage: 1,      &#125;    &#125;,  &#125;,&#125;);</code></pre><h4 id="æœåŠ¡ç«¯å¤„ç†"><a href="#æœåŠ¡ç«¯å¤„ç†" class="headerlink" title="æœåŠ¡ç«¯å¤„ç†"></a>æœåŠ¡ç«¯å¤„ç†</h4><p>ä»…æ”¹é€ æ—§æ¥å£ä¸­æœ‰ä¸Šè¿°éœ€æ±‚çš„ get è¯·æ±‚ï¼Œå¯¹äºå…¶ä»–æ²¡æœ‰å¿…è¦å…¨éƒ¨è½¬ä¸º graphql çš„æ¥å£ä¸åšå˜æ›´ã€‚</p><p>egg å¯¹ graphql åšäº†ä¸€å®šçš„æ”¯æŒ: <a href="https://github.com/eggjs/egg-graphqlï¼Œå…¶ä¸­çš„é…ç½®å¯ä»¥å‚è€ƒæ–‡æ¡£ã€‚">https://github.com/eggjs/egg-graphqlï¼Œå…¶ä¸­çš„é…ç½®å¯ä»¥å‚è€ƒæ–‡æ¡£ã€‚</a></p><pre class="line-numbers language-js" data-language="js"><code class="language-js">&#x2F;&#x2F; congfig.jsgraphql: &#123;  router: &#39;&#x2F;graphql&#39;,  &#x2F;&#x2F; æ˜¯å¦åŠ è½½åˆ° app ä¸Šï¼Œé»˜è®¤å¼€å¯  app: true,  &#x2F;&#x2F; æ˜¯å¦åŠ è½½åˆ° agent ä¸Šï¼Œé»˜è®¤å…³é—­  agent: false,  &#x2F;&#x2F; æ˜¯å¦åŠ è½½å¼€å‘è€…å·¥å…· graphiql, é»˜è®¤å¼€å¯ã€‚è·¯ç”±åŒ router å­—æ®µã€‚ä½¿ç”¨æµè§ˆå™¨æ‰“å¼€è¯¥å¯è§ã€‚  graphiql: true&#125;&#x2F;&#x2F; pluginexports.graphql &#x3D; &#123;  enable: true,  package: &#39;egg-graphql&#39;&#125;</code></pre><p>ç›®å½•ç»“æ„ï¼š</p><pre class="line-numbers language-none"><code class="language-none">.â”œâ”€â”€ appâ”‚   â”œâ”€â”€ graphqlâ”‚   â”‚   â”œâ”€â”€ projectâ”‚   â”‚   â”‚   â””â”€â”€ schema.graphqlâ”‚   â”‚   â”œâ”€â”€ api  &#x2F;&#x2F; api æ¨¡å‹â”‚   â”‚   â”‚   â”œâ”€â”€ connector.js  â”‚   â”‚   â”‚   â”œâ”€â”€ resolver.jsâ”‚   â”‚   â”‚   â””â”€â”€ schema.graphqlâ”‚   â”œâ”€â”€ modelâ”‚   â”‚   â””â”€â”€ api.jsâ”‚   â”œâ”€â”€ publicâ”‚   â””â”€â”€ router.js</code></pre><p>åœ¨ app ä¸‹æ–°å¢ä¸€ä¸ª graphql æ–‡ä»¶å¤¹ã€‚</p><p>ä¸‹é¢å†æ–°å»ºä¸€ä¸ª api æ–‡ä»¶å¤¹ï¼Œæ ¹æ® GraphQL çš„è§„èŒƒï¼Œå°† GraphQL ç›¸å…³é€»è¾‘åˆ†æˆ Schema, Resolvers, Models, å’Œ Connectorsã€‚</p><p> schema.graphql ä¸­æè¿°æ•°æ®æ¨¡å‹ï¼Œæœ‰ç‚¹åƒ typescript ä¸­çš„ interfaceã€‚</p><p>graphql çš„æ•°æ®æ¨¡å‹å…¥å£åœ¨ project/schema.graphql</p><pre class="line-numbers language-none"><code class="language-none">type Apis &#123;  nodes: [Api],  total: Int&#125;type Query &#123;  apis(filter: Api_Filter, pageInfo: PageInfo): Apis&#125;</code></pre><p>api / schema.graphql çš„å†…å®¹å¦‚ä¸‹</p><pre class="line-numbers language-none"><code class="language-none">type Api_Options &#123;&#x2F;&#x2F; ã€‚ã€‚ã€‚&#125;type Api &#123;  _id: String  name: String  options: Api_Options&#125;</code></pre><p>å£°æ˜çš„ type å¯ä»¥è¢«åˆ«çš„ type å¼•ç”¨ã€‚</p><p>resolver æ˜¯å¯¹æ¥åˆ°ç”¨æˆ·æŸ¥è¯¢</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">module.exports &#x3D; &#123;  Query: &#123;    apis (root, params, ctx) &#123;      return ctx.connector.api.find(params)    &#125;,  &#125;,&#125;</code></pre><p>ä¸Šé¢æˆ‘ä»¬çœ‹åˆ° ctx æœ‰ä¸ª connector å±æ€§ï¼Œå®é™…ä¸Šå¯¹åº”çš„å°±æ˜¯æˆ‘ä»¬çš„ connector æ–‡ä»¶ï¼Œconnector ä¸»è¦è´Ÿè´£å–æ•°é€»è¾‘ï¼Œç±»ä¼¼äº controller çš„èŒèƒ½ã€‚</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">class ApiConnector &#123;  constructor (ctx) &#123;    this.ctx &#x3D; ctx  &#125;  async find (params) &#123;    &#x2F;&#x2F; è·å–åˆ°å‚æ•°    const &#123; pageInfo &#125; &#x3D; params    const &#123; currentPage, pageSize &#125; &#x3D; pageInfo    const apis &#x3D; await this.ctx.model.Api.find()      .sort(&#123;        createTime: -1      &#125;)      .skip((Number(currentPage) - 1) * Number(pageSize))      .limit(Number(pageSize))      .exec()    const total &#x3D; await this.ctx.model.Api.find()      .count()      .exec()    return &#123;      nodes: apis,      total    &#125;  &#125;&#125;module.exports &#x3D; ApiConnector</code></pre><p>è‡³æ­¤å®Œæˆäº†ä¸€ä¸ªç®€å•çš„å‘ graphql è¯·æ±‚ï¼Œåˆ°æœåŠ¡ç«¯å¤„ç†çš„å¹¶è¿”å›çš„è¿‡ç¨‹ã€‚</p><h4 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h4><p>DataLoaderï¼šgraphql æ”¯æŒåµŒå¥—æŸ¥è¯¢ï¼Œæœ‰æ—¶å€™ä¼šå‡ºç°ä¸¥é‡çš„N+1æŸ¥è¯¢æ€§èƒ½é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œfacebook æå‡º dataloader è¿™ä¸ªæ–¹æ¡ˆã€‚</p><ol><li>å…·ä½“å¯ä»¥çœ‹ <a href="https://zhuanlan.zhihu.com/p/30604868">https://zhuanlan.zhihu.com/p/30604868</a> çš„è¯´æ˜ã€‚</li><li>dataloader è¦æ±‚è¿”å›çš„ç»“æœå’Œä¼ å…¥çš„ key ä¸€è‡´ï¼Œè€Œ mongo find ä¸ $in æ˜¯ä¸ä¿è¯é¡ºåºçš„ï¼Œè¯·æ³¨æ„è¦è½¬æˆæ­£ç¡®çš„é¡ºåºã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GraphQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VSCode merge-diffs æ’ä»¶å¼€å‘</title>
      <link href="/2020/10/30/%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/"/>
      <url>/2020/10/30/%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>å½“å‰çš„é¡¹ç›®ç”±äºä¸æ˜¯ä¸¥æ ¼æŒ‰ç…§æ•æ·å¼€å‘è¿›è¡Œçš„ï¼Œç»å¸¸æœ‰åŠŸèƒ½åˆ†æ”¯éœ€è¦åˆ†åˆ«ä¸Šåˆ° æµ‹è¯•ï¼Œé¢„å‘ä»¥åŠå¼€å‘ç¯å¢ƒã€‚è¿™ä¸ªå°±å¯¼è‡´äº†åŠŸèƒ½åˆ†æ”¯æ¯”è¾ƒå¤šï¼Œä¸”å¼€å‘è¦åœ¨ä¸´ä¸Šçº¿å‰æ•´ç†éœ€ä¸Šçº¿çš„åˆ†æ”¯ï¼Œåœ¨ä¸Šåˆ°æ­£å¼ç¯å¢ƒä¹‹å‰éœ€è¦åˆå¹¶åˆ°ä¸€ä¸ªä¸´æ—¶åˆ†æ”¯ï¼Œä¹‹åå†ç»Ÿä¸€ä¸Šåˆ° master åˆ†æ”¯ã€‚å› æ­¤ç»å¸¸ä¼šé—æ¼æ‰ä¸€äº›åˆ†æ”¯ã€‚ç”¨ git log å¯ä»¥å¯¹æ¯”å‡ºä¸¤ä¸ªåˆ†æ”¯åˆå¹¶åˆ†æ”¯çš„åŒºåˆ«ï¼Œä»è€ŒçŸ¥é“æœ‰å“ªäº›åˆ†æ”¯åˆå¹¶åˆ°æµ‹è¯•åˆ†æ”¯ï¼Œä½†æ˜¯å¹¶æ²¡åˆå¹¶åˆ° masterã€‚ é‚£ä¹ˆè¿™äº›åˆ†æ”¯å°±æœ‰å¯èƒ½æ˜¯éœ€è¦ä¸Šçº¿åˆ° master çš„ã€‚æˆ‘ä¸ªäººæ¯”è¾ƒä¹ æƒ¯ä½¿ç”¨å‘½ä»¤è¡Œ + vscode æ¥ä½¿ç”¨ gitï¼Œä½†æ˜¯å‘½ä»¤è¡Œä¸å¤ªç›´è§‚ï¼Œä¸”äº¤äº’æ¯”è¾ƒéº»çƒ¦ï¼Œå› æ­¤æ‰“ç®—å†™ä¸ª VSCode æ’ä»¶ã€‚</p><a id="more"></a><p>å…³äºä¸ªäººé¡¹ç›®ï¼ˆæ’é™¤å•çº¯ä¸ºäº†æŠ˜è…¾æŠ€æœ¯çš„ç›®çš„ï¼‰æˆ‘æœ‰ä¸€ä¸ªç»éªŒæ˜¯è¿½æ±‚çš„ä¸åº”è¯¥æ˜¯æŠ€æœ¯æ–¹æ¡ˆå®Œç¾ï¼Œè€Œæ˜¯èƒ½å°½å¿«ä½œå‡ºéœ€è¦çš„åŠŸèƒ½ï¼ˆå¦åˆ™æå¯èƒ½ä¸­é€”æ”¾å¼ƒï¼‰ï¼Œä¹‹åå†ä¸æ–­è¿­ä»£ç›´è‡³è‡ªå·±æ»¡æ„ï¼Œå› æ­¤è¿™ä¸ªè¿‡ç¨‹ä¸­å¯èƒ½ä¼šæœ‰ä¸€äº›ä¸å¤Ÿåå…¨åç¾çš„åœ°æ–¹ï¼Œè¿˜æœ›è§è°…ã€‚</p><p>ä»£ç åœ°å€ï¼š<a href="https://github.com/KNighD/merge-diffs">https://github.com/KNighD/merge-diffs</a></p><h4 id="æŠ€æœ¯æ ˆ"><a href="#æŠ€æœ¯æ ˆ" class="headerlink" title="æŠ€æœ¯æ ˆ"></a>æŠ€æœ¯æ ˆ</h4><p>è¿™é‡Œæˆ‘é€‰æ‹©ä½¿ç”¨ Typescript æ¥å®ç°æ’ä»¶ï¼Œè¦è¯´åŸå› ï¼Œä¸»è¦æ˜¯å¯ä»¥æç¤ºå‚æ•°ç±»å‹å§ï¼Œæ¯•ç«Ÿä¸å¤ªç†Ÿæ‚‰æ–‡æ¡£ã€‚</p><p>ç”±äºå­˜åœ¨è¾“å…¥æ—¶é—´ä¹‹ç±»çš„äº¤äº’ï¼Œå› æ­¤è¿˜æ˜¯éœ€è¦ä½¿ç”¨åˆ° webview çš„ï¼Œhtml éƒ¨åˆ†è€ƒè™‘ä½¿ç”¨ vue3 æ¥å®ç°ï¼ˆè™½ç„¶react å†™èµ·æ¥æ›´ç†Ÿæ‚‰ï¼Œä½†æ˜¯æƒ³æŠ˜è…¾ä¸€ä¸‹ï¼‰</p><p>æ€»ä½“çš„æƒ³æ³•æ˜¯åœ¨é¡µé¢è¾“å…¥æŸ¥è¯¢æ¡ä»¶ï¼Œç„¶ååœ¨ä¸ node ç«¯è¿›è¡Œé€šä¿¡ï¼Œæ‰§è¡Œå‘½ä»¤æŸ¥è¯¢å‡ºç»“æœå¤„ç†å®Œæˆåå›ä¼ ç»™é¡µé¢å¹¶åšå±•ç¤ºã€‚ç•Œé¢ UI çš„è¯å°±å‚è€ƒ Git Historyã€‚</p><h4 id="åˆå§‹åŒ–é¡¹ç›®"><a href="#åˆå§‹åŒ–é¡¹ç›®" class="headerlink" title="åˆå§‹åŒ–é¡¹ç›®"></a>åˆå§‹åŒ–é¡¹ç›®</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">&#x2F;&#x2F; å®‰è£…è„šæ‰‹æ¶npm install -g yo generator-code&#x2F;&#x2F; ç”Ÿæˆæ¨¡æ¿ä»£ç yo code</code></pre><p>é¢˜å¤–è¯ï¼šgithub ä¸Šçš„ä¸»åˆ†æ”¯å·²ç»æ”¹å« main äº†ã€‚ã€‚</p><h4 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h4><p>åˆå§‹ä»£ç æ¨¡æ¿å…¥å£æ˜¯ <code>src/extension.ts</code>ï¼ŒåŠŸèƒ½å°±æ˜¯åœ¨å‘½ä»¤é¢æ¿è¾“å…¥ <code>Hello World</code>ï¼Œå°†ä¼šå¼¹å‡ºä¸€å¥æç¤ºã€‚</p><p>ç”¨ vscode æ‰“å¼€ç”Ÿæˆçš„é¡¹ç›®ï¼ŒæŒ‰ F5 å°†ä¼šå¼¹å‡ºä¸€ä¸ªæ–°çª—å£ï¼Œåœ¨æ–°çª—å£çš„å‘½ä»¤é¢æ¿è¾“å…¥ <code>Hello World</code>ï¼Œå¦‚æœå¼¹å‡ºä¸€å¥æç¤ºï¼Œå°±è¡¨æ˜é¡¹ç›®åˆå§‹åŒ–æˆåŠŸäº†ã€‚</p><h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; package.json&#123;  &quot;activationEvents&quot;: [  &#x2F;&#x2F; å½“å‘½ä»¤è¿è¡Œæ—¶å¯åŠ¨      &quot;onCommand:merge-logs.showMergeLogs&quot;    ],    &quot;contributes&quot;: &#123;      &quot;commands&quot;: [      &#x2F;&#x2F; å®šä¹‰å‘½ä»¤        &#123;          &quot;command&quot;: &quot;merge-logs.showMergeLogs&quot;,          &#x2F;&#x2F; å‘½ä»¤é¢æ¿ä¸Šå±•ç¤ºçš„          &quot;title&quot;: &quot;MergeLogs: show&quot;        &#125;      ]    &#125;&#125;</code></pre><h4 id="æ‰“å¼€ä¸€ä¸ª-webview"><a href="#æ‰“å¼€ä¸€ä¸ª-webview" class="headerlink" title="æ‰“å¼€ä¸€ä¸ª webview"></a>æ‰“å¼€ä¸€ä¸ª webview</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">let show &#x3D; vscode.commands.registerCommand(&#39;merge-logs.showMergeLogs&#39;, () &#x3D;&gt; &#123;    const panel &#x3D; vscode.window.createWebviewPanel(      &#39;testWebview&#39;,      &#x2F;&#x2F; title      &#39;MergeLogs&#39;,      &#x2F;&#x2F; æ˜¾ç¤ºåœ¨ç¼–è¾‘å™¨çš„å“ªä¸ªéƒ¨ä½      vscode.ViewColumn.One,      &#123;        &#x2F;&#x2F; å¯ç”¨JSï¼Œé»˜è®¤ç¦ç”¨        enableScripts: true,        &#x2F;&#x2F; webviewè¢«éšè—æ—¶ä¿æŒçŠ¶æ€ï¼Œé¿å…è¢«é‡ç½®        retainContextWhenHidden: true,      &#125;    )    panel.webview.html &#x3D; &#96;&lt;html&gt;&lt;body&gt;test merge logs&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;&#96;  &#125;)  context.subscriptions.push(show)</code></pre><p>WebView åŠ è½½çš„èµ„æºè·¯å¾„å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•è·å–</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">const getRelativeResource &#x3D; (webview: Webview, relativePath: string) &#x3D;&gt; &#123;  return webview.asWebviewUri(Uri.file(path.join(context.extensionPath, relativePath)));&#125;;panel.webview.html &#x3D; &#96;&lt;html&gt;&lt;head&gt;&lt;script src&#x3D;&#39;$&#123;getRelativeResource(panel.webview, &#39;.&#x2F;test.js&#39;)&#125;&#39;&gt;&lt;&#x2F;script&gt;&lt;&#x2F;head&gt;&lt;body&gt;test merge logs&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;&#96;;&#125;);</code></pre><p>è°ƒè¯•çš„æ—¶å€™éœ€è¦åœ¨å¼€å‘çª—å£æ‰“å¼€å‘½ä»¤é¢æ¿ï¼Œè¾“å…¥ <code>Open Webview Developer Tools</code> </p><h4 id="å¼€å‘-web-é¡µé¢"><a href="#å¼€å‘-web-é¡µé¢" class="headerlink" title="å¼€å‘ web é¡µé¢"></a>å¼€å‘ web é¡µé¢</h4><p>æˆ‘å°† web é¡µé¢æ”¾åœ¨ /client ç›®å½•ä¸‹</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">npm init vite-app client cd clientnpm i</code></pre><p>é¡¹ç›®æ˜¯åŸºäº Typescript çš„ï¼Œè€Œ client æ˜¯ vueï¼Œæ­¤æ—¶æ ¹ç›®å½•çš„ eslint ä¼šæŠ¥é”™ï¼Œæˆ‘ä»¬å…ˆå°† client ç›®å½•ä¸‹çš„æ–‡ä»¶å¿½ç•¥æ‰,å°†æ¥åœ¨ client ä¸­å•ç‹¬æ·»åŠ  eslintã€‚</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; .eslint.json&quot;ignorePatterns&quot;: [&quot;&#x2F;client&quot;]</code></pre><p>é¡¹ç›®æ‰“åŒ…åèµ„æºæ–‡ä»¶ä¼šå¸¦ä¸Š hash å€¼ï¼ŒæŒ‰ç…§ webpack çš„ç»éªŒï¼Œåº”è¯¥å¯ä»¥é‡‡å–ä¸¤ç§å¤„ç†æ–¹å¼ï¼š</p><ol><li>ä¿®æ”¹æ‰“åŒ…é…ç½®å°† public path æ›¿æ¢æˆ getRelativeResource åè·å–åˆ°çš„åœ°å€, åŠ¨æ€è¯»å–æ‰“åŒ…åçš„ html</li><li>webview å†™æ­» html æ¨¡æ¿ï¼Œä¿®æ”¹æ‰“åŒ…é…ç½®ï¼Œè®©æ‰“åŒ…åçš„èµ„æºä¸å¸¦ hash,è§ <a href="https://github.com/vitejs/vite/issues/378">https://github.com/vitejs/vite/issues/378</a></li></ol><p>è¿™é‡Œé‡‡ç”¨ç¬¬äºŒç§æ–¹æ¡ˆï¼Œåœ¨ client ä¸‹æ·»åŠ  <code>vite.config.js</code> </p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; vite.config.jsexport default &#123;  rollupOutputOptions: &#123;    entryFileNames: &#96;[name].js&#96;,    chunkFileNames: &#96;[name].js&#96;,    assetFileNames: &#96;[name].[ext]&#96;,  &#125;,&#125;</code></pre><p>ğŸ¤”ä¸è¿‡è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè°ƒè¯•èµ·æ¥éå¸¸éº»çƒ¦ï¼Œæ¯æ¬¡ä¿®æ”¹å®Œéƒ½éœ€è¦ build ä¸€ä¸‹</p><h4 id="å®ç°ç®€å•é€šä¿¡"><a href="#å®ç°ç®€å•é€šä¿¡" class="headerlink" title="å®ç°ç®€å•é€šä¿¡"></a>å®ç°ç®€å•é€šä¿¡</h4><p>åœ¨é¡µé¢ä¸Šæ·»åŠ ä¸€ä¸ªç®€å•çš„æŒ‰é’®ï¼Œç‚¹å‡»è¿™ä¸ªæŒ‰é’®åï¼Œå°†ä¼šå‘ä¸€ä¸ª getLogs çš„å‘½ä»¤ç»™æ’ä»¶ç«¯ï¼Œæ’ä»¶ç«¯æ¥æ”¶ä¹‹åï¼Œæ‰§è¡Œ <code>git log</code>,å¹¶è¿”å›ç»“æœã€‚</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&#x2F;&#x2F; App.vue&lt;template&gt;  &lt;button @click&#x3D;&quot;sendMessage&quot;&gt;sendMessage&lt;&#x2F;button&gt;&lt;&#x2F;template&gt;&lt;script&gt;export default &#123;  data() &#123;    return &#123;      vscode: null,    &#125;  &#125;,  mounted() &#123;    &#x2F;&#x2F; åˆå§‹åŒ– vscode å¯¹è±¡    this.vscode &#x3D; acquireVsCodeApi()    &#x2F;&#x2F; ç›‘å¬æ¥è‡ª vscode æ’ä»¶çš„ä¿¡æ¯    window.addEventListener(&#39;message&#39;, (event) &#x3D;&gt; &#123;      const message &#x3D; event.data      console.log(message)    &#125;)  &#125;,  methods: &#123;    sendMessage() &#123;      &#x2F;&#x2F; å‘é€æ¶ˆæ¯ç»™æ’ä»¶      this.vscode.postMessage(&#39;getLogs&#39;)    &#125;,  &#125;,&#125;&lt;&#x2F;script&gt;</code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; æ’ä»¶ç«¯æ¥æ”¶åˆ°æ¶ˆæ¯panel.webview.onDidReceiveMessage(  async (message) &#x3D;&gt; &#123;    if (message &#x3D;&#x3D;&#x3D; &#39;getLogs&#39;) &#123;      try &#123;        const logs &#x3D; await getLogs();        panel.webview.postMessage(logs);      &#125; catch (error) &#123;        panel.webview.postMessage(error);      &#125;    &#125;  &#125;,  undefined,  context.subscriptions);&#125;</code></pre><p>ä½¿ç”¨ <code>child_process</code> å¹¶æ‰§è¡Œ node å‘½ä»¤ï¼Œå¹¶å°è£…æˆ Promiseï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const getLogs &#x3D; () &#x3D;&gt; &#123;  return new Promise((resolve, reject) &#x3D;&gt; &#123;    cp.exec(      &#96;git log&#96;,      (err: Error, stdout: string, stderr: string) &#x3D;&gt; &#123;        if (stderr || err) &#123;          return reject(stderr || err);        &#125;        return resolve(stdout);      &#125;    );  &#125;);&#125;;</code></pre><p>âš ï¸ ç”±äº exec ä¼šè¡ç”Ÿå­ shellï¼Œå› æ­¤åœ¨æ¯æ¬¡æ‰§è¡Œ shell å‘½ä»¤æ—¶è¦ç¡®è®¤å½“å‰çš„è·¯å¾„æ˜¯å¦æ­£ç¡®ã€‚</p><p>è‡³æ­¤ä¸€ä¸ªå¤§ä½“çš„æ¡†æ¶å°±å®Œæˆäº†ã€‚</p><p>åç»­çš„å¼€å‘ä¸»è¦æ˜¯ç”¨ <code>git branch --merged</code> æŸ¥è¯¢åˆ†æ”¯åˆå¹¶æƒ…å†µï¼Œç„¶ååˆ†åˆ«å¯¹æ¯”ä¸¤ä¸ªåˆ†æ”¯çš„åˆå¹¶åˆ†æ”¯çš„å¼‚åŒï¼Œå¹¶å±•ç¤ºåˆ°é¡µé¢ä¸Šï¼Œè¿™é‡Œä¸è¿›è¡Œèµ˜è¿°ã€‚</p><h4 id="æ·»åŠ -UI-ç»„ä»¶åº“"><a href="#æ·»åŠ -UI-ç»„ä»¶åº“" class="headerlink" title="æ·»åŠ  UI ç»„ä»¶åº“"></a>æ·»åŠ  UI ç»„ä»¶åº“</h4><p>ç»„ä»¶åº“è¿™é‡Œçœ‹åˆ° ant-desin-vue æ”¯æŒ vue3 äº†ï¼Œæ‰“ç®—è¯•è¯•ã€‚ç‰ˆæœ¬éœ€è¦ 2.0.0-beta.5 åŠä»¥ä¸Šã€‚</p><p>æŒ‰éœ€å¼•å…¥ï¼ŒåŸå…ˆæ˜¯æ˜¯ç”¨ babel-plugin-import æ¥å¤„ç†çš„ï¼Œä¸è¿‡è¿˜æ²¡ç ”ç©¶å¦‚ä½•åœ¨ vite ä¸­æ·»åŠ ï¼Œå°±æ‰“ç®—ä½¿ç”¨ <code>import Button from &#39;ant-design-vue/lib/button&#39;;</code> è¿™æ ·çš„å†™æ³•ï¼Œç„¶è€Œè¿è¡Œçš„æ—¶å€™ï¼Œvite ä¼šæç¤º:</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">[vite] Avoid deep import &quot;ant-design-vue&#x2F;lib&#x2F;button&quot; (imported by &#x2F;src&#x2F;main.js)because &quot;ant-design-vue&quot; has been pre-optimized by vite into a single file.Prefer importing directly from the module entry:import &#123; ... &#125; from &quot;ant-design-vue&quot; If the dependency requires deep import to function properly, add the deep path to optimizeDeps.include in vite.config.js.</code></pre><p>æ„æ€æ˜¯ vite å·²ç»åšäº†æŒ‰éœ€å¼•å…¥çš„ä¼˜åŒ–äº†ï¼Œé‚£ä¹ˆåº”è¯¥ç›´æ¥å¯¼å…¥å°±å¥½äº†ã€‚</p><h4 id="vue3-çš„-eslint-é…ç½®"><a href="#vue3-çš„-eslint-é…ç½®" class="headerlink" title="vue3 çš„ eslint é…ç½®"></a>vue3 çš„ eslint é…ç½®</h4><p>å¡«ä¹‹å‰çš„å‘ï¼Œé¡ºä¾¿è¡¥ä¸Š prettier é…ç½®ï¼Œæœ€ç»ˆæ ¹ç›®å½•çš„ eslint é…ç½®å¦‚ä¸‹</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">&#123;  &quot;root&quot;: true,  &quot;parser&quot;: &quot;vue-eslint-parser&quot;,  &quot;parserOptions&quot;: &#123;    &quot;parser&quot;: &quot;@typescript-eslint&#x2F;parser&quot;,    &quot;ecmaVersion&quot;: 6,    &quot;sourceType&quot;: &quot;module&quot;  &#125;,  &quot;extends&quot;: [&quot;plugin:vue&#x2F;vue3-recommended&quot;],  &quot;plugins&quot;: [&quot;@typescript-eslint&quot;, &quot;prettier&quot;],  &quot;rules&quot;: &#123;    &quot;@typescript-eslint&#x2F;naming-convention&quot;: &quot;warn&quot;,    &quot;curly&quot;: &quot;warn&quot;,    &quot;eqeqeq&quot;: &quot;warn&quot;,    &quot;no-throw-literal&quot;: &quot;warn&quot;,    &quot;semi&quot;: &quot;off&quot;,    &quot;vue&#x2F;singleline-html-element-content-newline&quot;: &quot;off&quot;  &#125;&#125;</code></pre><h4 id="vite-åˆ«å"><a href="#vite-åˆ«å" class="headerlink" title="vite åˆ«å"></a>vite åˆ«å</h4><p>ç›®å‰ä¼¼ä¹æ²¡æœ‰æ”¯æŒå¤šç›®å½• vue é¡¹ç›®çš„ vscode æ’ä»¶ï¼Œè§ <a href="https://github.com/vuejs/vetur/issues/424ã€‚æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯">https://github.com/vuejs/vetur/issues/424ã€‚æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯</a> veturï¼Œä¸ºäº†é¿å…æŠ¥é”™ï¼Œåœ¨ vite ä¸­é…ç½® aliasã€‚ï¼ˆåæ§½ä¸€ä¸‹ï¼šæ€»è§‰å¾— vscode / ts å¯¹ react çš„æ”¯æŒè¿˜æ˜¯æ¯” vue è¦å¥½ä¸Šä¸å°‘çš„ï¼‰</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">alias: &#123;  &#x2F;&#x2F; import useInit from &#39;&#x2F;@&#x2F;composables&#x2F;useInit&#39;  &#39;&#x2F;@&#x2F;&#39;: path.resolve(__dirname, &#39;.&#x2F;src&#x2F;&#39;),&#125;</code></pre><h4 id="å‘å¸ƒ"><a href="#å‘å¸ƒ" class="headerlink" title="å‘å¸ƒ"></a>å‘å¸ƒ</h4><p>ç”±äºè¾“å‡ºå®‰è£…åŒ…æ—¶æ— éœ€ç”¨åˆ° client çš„æºç ï¼Œå› æ­¤å¯ä»¥åœ¨ .vscodeignore ä¸­åŠ å…¥ clientï¼ŒåŒæ—¶ä¿®æ”¹ vite çš„è¾“å‡ºç›®å½•ï¼Œä»¥åŠæ’ä»¶ä¸­å¼•ç”¨ client èµ„æºçš„ç›®å½•ã€‚</p><p>å¦‚æœæ­¤å‰æ²¡æœ‰å‘å¸ƒè¿‡ï¼Œå¯ä»¥å‚è€ƒ <a href="https://code.visualstudio.com/api/working-with-extensions/publishing-extension#publishing-extensionsã€‚">https://code.visualstudio.com/api/working-with-extensions/publishing-extension#publishing-extensionsã€‚</a></p><p>éœ€è¦åœ¨ package.json ä¸­æ·»åŠ  <code>publisher name</code> å’Œ <code>repository</code>ï¼Œè¿è¡Œ <code>vsce package</code> å¯ä»¥æ‰“å‡ºä¸€ä¸ª .vsix çš„æ‹“å±•åŒ…ç”¨äºå®‰è£…ã€‚</p><p>å¦‚æœæ­¤å‰æœ‰å‘å¸ƒè¿‡æ’ä»¶ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½ä¸ªäººè®¿é—®ä»¤ç‰Œå·²ç»å¤±æ•ˆäº†ï¼Œéœ€è¦åˆ° <a href="https://aka.ms/SignupAzureDevOps">https://aka.ms/SignupAzureDevOps</a> ä¸Šé‡æ–°åˆ›å»ºæ–°çš„ä¸ªäººè®¿é—®ä»¤ç‰Œã€‚</p><p>åˆ›å»ºä¸ªäººè®¿é—®ä»¤ç‰Œè¦æ³¨æ„<code>Organization</code>è¦é€‰æ‹©<code>all accessible organizations</code>ï¼Œ<code>Scopes</code>è¦é€‰æ‹©<code>Full access</code>ï¼Œå¦åˆ™å‘å¸ƒä¼šå¤±è´¥ã€‚</p><p>ä¹‹åæ·»åŠ ä¸€ä¸‹ icon ï¼Œå†è¡¥å…¨ä¸€ä¸‹ README å°±å¯ä»¥å‘å¸ƒäº†</p><pre class="line-numbers language-none"><code class="language-none">vsce publish</code></pre><h4 id="æ„Ÿæƒ³"><a href="#æ„Ÿæƒ³" class="headerlink" title="æ„Ÿæƒ³"></a>æ„Ÿæƒ³</h4><p>ä»¥ä¸‹ä¸ºä¸ªäººè§‚ç‚¹ï¼šæ€»ä½“ä¸Šæ„Ÿè§‰ Vue3 çš„ç»„åˆå¼ api å’Œ react çš„ hooks æƒ³åšçš„éƒ½æ˜¯åŒä¸€ä»¶äº‹ï¼šå°†åŸå…ˆè·Ÿç”Ÿå‘½å‘¨æœŸç»‘å®šåœ¨ä¸€èµ·çš„é€»è¾‘æŠ½ç¦»å‡ºæ¥ï¼Œä½¿å¾—ä»£ç çš„å…³æ³¨ç‚¹æ›´ä¸ºæ¸…æ™°ï¼ŒåŒæ—¶ä¹Ÿæ›´æ˜“äºå¤ç”¨ï¼Œä½œä¸º hoc / mixins çš„ä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆã€‚</p><p>ä¸åŒç‚¹æ˜¯ react æ˜¯è¶Šæ¥è¶Šåå‘å‡½æ•°å¼ï¼Œæ¯”å¦‚ useEffect å®Œå…¨è„±ç¦»äº†ç”Ÿå‘½å‘¨æœŸçš„æ¦‚å¿µï¼Œå£°æ˜å¼ç¼–ç¨‹ã€‚è€Œ vue ä¾ç„¶æ˜¯å‘½ä»¤å¼ï¼Œæä¾›äº†onMounted ä¹‹ç±»çš„ apiã€‚</p><p>è‡³äº vite è¿˜æ²¡ä»”ç»†å»ç ”ç©¶ï¼Œä¸è¿‡é…ç½®ç¡®å®æ˜¯å°‘äº†å¾ˆå¤šï¼Œæ›´å®¹æ˜“ä¸Šæ‰‹çš„æ ·å­ï¼Œä¼¼ä¹æ˜¯åŸºäº rollup ï¼Ÿè¿˜æœ‰å¾…è¸©å‘ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> VSCodeæ’ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RNç€‘å¸ƒæµ</title>
      <link href="/2020/10/20/RN%E7%80%91%E5%B8%83%E6%B5%81/"/>
      <url>/2020/10/20/RN%E7%80%91%E5%B8%83%E6%B5%81/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>ç”µå•†ä»¥åŠå›¾ç‰‡ç½‘ç«™ç»å¸¸å¯ä»¥çœ‹åˆ°ç€‘å¸ƒæµçš„åˆ—è¡¨ï¼Œå³å¤šåˆ—ç­‰å®½çš„åˆ—è¡¨ï¼Œä½†æ˜¯æ¯ä¸€åˆ—ä¸­çš„å…ƒç´ é«˜åº¦ä¸ä¸€å®šä¸€è‡´ã€‚è¿™åœ¨ web æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„è®¾è®¡ä¸”æœ‰å¾ˆå¤šç»„ä»¶å¯ä¾›ä½¿ç”¨ï¼Œè€Œåœ¨ ReactNative ä¸­ï¼Œå°‘æœ‰æˆç†Ÿçš„ç€‘å¸ƒæµç»„ä»¶ï¼Œå¤§å¤šæ•°ç»„ä»¶è¦ä¹ˆæ˜¯å¤šå¹´å‰ç»´æŠ¤çš„ï¼Œè¦ä¹ˆ star æ•°è¾ƒå°‘ï¼Œæˆ–è€…å¹²è„†æœ‰ä¸€äº›ä¸ç»´æŠ¤äº†ï¼Œæ€»ä¹‹å°±æ˜¯ç”¨ç€ä¸æ”¾å¿ƒã€‚å› æ­¤åœ¨äº§å“åŒå­¦çš„è¦æ±‚ä¸‹ï¼Œå®ç°äº†ä¸€ä¸ª RN ç€‘å¸ƒæµç»„ä»¶ã€‚è¿™é‡Œåªè®°å½•æ€è·¯ï¼Œå…·ä½“ä»£ç åé¢æ·»åŠ äº†è¾ƒå¤šä¸šåŠ¡ç›¸å…³çš„ï¼Œå°±ä¸è´´äº†ã€‚</p><a id="more"></a><h4 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h4><ol><li><p>æ”¯æŒä¸Šæ‹‰åŠ è½½ï¼Œä¸‹æ‹‰åˆ·æ–°</p></li><li><p>æ”¯æŒå¤šåˆ—å¯å®šåˆ¶</p></li><li><p>æ€§èƒ½å°½é‡å¥½</p></li><li><p>è‡ªå®šä¹‰å…ƒç´ </p></li></ol><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><ol><li><p>æ•´ä¸ªç€‘å¸ƒæµé€šè¿‡ FlatList æ¥å®ç°ï¼Œé€šè¿‡è®¾ç½® columnsNum ä¸ renderItemï¼Œå°†æ¯ä¸€åˆ—åˆåˆ†åˆ«æ¸²æŸ“æˆä¸€ä¸ª FlatListã€‚å†…å±‚å¹¶åˆ—çš„ FlatList å°†ä¼šæ’‘å¼€ä¸”ä¸ä¼šäº§ç”Ÿå¤šä½™çš„æ»šåŠ¨æ¡ï¼Œæ»šåŠ¨æ—¶æ˜¯å¤–å±‚çš„ FlatListã€‚</p></li><li><p>æ¥æ”¶ data æ—¶ï¼Œåˆ¤æ–­æ¯ä¸€é¡¹åº”è¯¥å±äºå“ªä¸€åˆ—ï¼Œ å¦‚æœé¡¹çš„é«˜åº¦ä¸èƒ½æå‰è·å¾—ï¼Œé‚£ä¹ˆè¦åœ¨é¡¹çš„ onLayout æ—¶è·å–é«˜åº¦ï¼Œä¹‹ååˆ¤æ–­ä¸‹ä¸€é¡¹å±äºå“ªä¸€åˆ—</p></li><li><p>ä¸‹æ‹‰é‡‡ç”¨ RN æä¾›çš„ RefreshControl å°±å¯ä»¥å®Œæˆï¼Œè€Œä¸Šæ‹‰çš„äº‹ä»¶ï¼Œå•åˆ—è¡¨å¯ä»¥é€šè¿‡ onReachEnd è§¦å‘ï¼Œè€Œå¯¹äºæˆ‘ä»¬è¿™ç§å®ç°æ–¹å¼åˆ™åªèƒ½é€šè¿‡ onScroll è‡ªè¡Œåˆ¤æ–­æ˜¯å¦åˆ°è¾¾åº•éƒ¨</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; ç”±äº onEndReached åœ¨æ¸²æŸ“ data é¡¹æ—¶ä¼šå¤šæ¬¡è§¦å‘ï¼Œä¸” props åŠ state æœªå˜åŒ–æ—¶ä¸ä¼šè§¦å‘ï¼Œå› æ­¤è‡ªè¡Œå®ç°const handleScroll &#x3D; (event: NativeSyntheticEvent&lt;NativeScrollEvent&gt;) &#x3D;&gt; &#123;  const &#123;    nativeEvent: &#123;      contentOffset: &#123; y: scrollTop &#125;,      contentSize: &#123; height: scrollHeight &#125;,      layoutMeasurement: &#123; height &#125;,    &#125;,  &#125; &#x3D; event;  if (scrollHeight - height - scrollTop &lt;&#x3D; onEndReachedThreshold) &#123;    if (onEndReached) &#123;      onEndReached(event);    &#125;  &#125;  if (props.onScroll) &#123;    props.onScroll(event);  &#125;&#125;;</code></pre></li></ol><p>è¿™æ ·ä¸€ä¸ªç®€å•çš„ ç€‘å¸ƒæµå°±å®Œæˆäº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ReactNative </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>react-native é€šè®¯å½•å­—æ¯åˆ—è¡¨</title>
      <link href="/2020/09/22/react-native-%E9%80%9A%E8%AE%AF%E5%BD%95%E5%AD%97%E6%AF%8D%E5%88%97%E8%A1%A8/"/>
      <url>/2020/09/22/react-native-%E9%80%9A%E8%AE%AF%E5%BD%95%E5%AD%97%E6%AF%8D%E5%88%97%E8%A1%A8/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>éœ€æ±‚ï¼šå®ç°ä¸€ä¸ªé€‰æ‹©å¿«é€’çš„é¡µé¢ï¼Œæ“ä½œç±»ä¼¼äºé€šè®¯å½•ï¼Œè®¾è®¡å›¾å¦‚ä¸‹</p><img src="https://i.loli.net/2020/10/20/OwH5A3bRgSuiBKt.png" alt="image.png" style="zoom: 50%"><p>ä¸ŠåŠéƒ¨åˆ†çš„æœç´¢äº¤äº’åŠå®ç°è¿™é‡Œå°±ä¸èµ˜è¿°ï¼Œé‡ç‚¹æ¢è®¨å­—æ¯åˆ—è¡¨çš„å®ç°ã€‚</p><a id="more"></a><p>éœ€è¦å®ç°çš„ç‚¹ï¼š</p><ol><li>ä¸»åˆ—è¡¨åˆ†ç»„ï¼Œå¤´éƒ¨ä¸å¸é¡¶</li><li>å­—æ¯åˆ—è¡¨å¯ä»¥æ»‘åŠ¨æˆ–ç‚¹å‡»ï¼Œå˜æ›´å½“å‰é€‰ä¸­çš„å­—æ¯ï¼Œä¸”ä¸»åˆ—è¡¨è·Ÿéšæ»‘åŠ¨å®šä½</li><li>ä¸»åˆ—è¡¨æ»šåŠ¨æ—¶ï¼Œå­—æ¯åˆ—è¡¨å½“å‰é€‰ä¸­çš„å­—æ¯å¯¹åº”å˜åŒ–</li></ol><p>æœç´¢äº†ç›®å‰å·²æœ‰çš„å¼€æºç»„ä»¶ï¼Œè¦ä¹ˆæœ€åä¸€æ¬¡æ›´æ–°çš„æ—¶é—´ä¹Ÿæ¯”è¾ƒä¹…è¿œï¼Œè¦ä¹ˆä¸é€‚ç”¨äºæˆ‘ä»¬çš„åœºæ™¯ï¼Œè¦ä¹ˆ star æ•°é‡ä¸å¤š ğŸ˜‚ã€‚å› æ­¤æ‰“ç®—é‡æ–°é€ ä¸ªè½®å­ï¼Œå³ä½¿å°†æ¥æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä¹Ÿèƒ½è‡ªè¡Œç»´æŠ¤ã€‚</p><h4 id="AlphabetList"><a href="#AlphabetList" class="headerlink" title="AlphabetList"></a>AlphabetList</h4><p>å°†æˆ‘ä»¬çš„ç»„ä»¶å‘½åä¸º AlphabetListï¼Œå®ƒå°†æ¥æ”¶ä¸€ä¸ª dataSource ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">&lt;AlphabetList dataSource&#x3D;&#123;dataSource&#125; &#x2F;&gt;</code></pre><p>dataSource çš„ç»“æ„å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">interface IListItem &#123;  name: string;  value: string | number;&#125;interface ISectionItem &#123;sectionKey: string;data: &#123;name: string;value: string&#125;[]&#125;interface DataSource: SectionItem[]</code></pre><p>ä¾‹å¦‚ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">[  &#123;    sectionKey: &#39;å¸¸&#39;,    data: [      &#123;        name: &#39;é¡ºä¸°ç‰©æµ&#39;,        value: &#39;1&#39;,      &#125;,      &#123;        name: &#39;äº¬ä¸œå¿«é€’&#39;,        value: &#39;2&#39;,      &#125;,    ],  &#125;,  &#123;    sectionKey: &#39;A&#39;,    data: [      &#123;        name: &#39;å®‰èƒ½ç‰©æµ&#39;,        value: &#39;3&#39;,      &#125;,      &#123;        name: &#39;æ¾³å¤§åˆ©äºšé‚®æ”¿&#39;,        value: &#39;4&#39;,      &#125;,    ],  &#125;]</code></pre><p>AlphabetList çš„ç»“æ„å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">&lt;View&gt;  &#123;&#x2F;* ä¸»åˆ—è¡¨ *&#x2F;&#125;  &lt;MainList &#x2F;&gt;  &#123;&#x2F;* å³ä¾§å­—æ¯åˆ—è¡¨ *&#x2F;&#125;  &lt;SideBar &#x2F;&gt;&lt;&#x2F;View&gt;</code></pre><h4 id="MainList"><a href="#MainList" class="headerlink" title="MainList"></a>MainList</h4><p>ä¸»åˆ—è¡¨åˆ†ç»„ Mainï¼Œé‚£ä¹ˆä½¿ç”¨ SectionList æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ç”¨ FlatList æ¥å®ç°ï¼‰</p><p>å½“æ»šåŠ¨ MainList æ—¶ï¼Œé€šè¿‡ <code>onListViewableItemsChanged</code> çš„å›è°ƒå¯ä»¥å¾—åˆ°å½“å‰çª—å£å¯è§†çš„åˆ†ç»„ï¼Œä»è€Œæ”¹å˜å½“å‰é€‰ä¸­çš„å­—æ¯</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const MainList &#x3D; (&#123;    dataSource,    onMainListViewableItemsChanged,  &#125;) &#x3D;&gt; &#123;  return (    &lt;SectionList      renderItem&#x3D;&#123;(&#123; item &#125;) &#x3D;&gt; (&lt;ListItem item&#x3D;&#123;item&#125; &#x2F;&gt;)&#125;      renderSectionHeader&#x3D;&#123;(&#123; section &#125;) &#x3D;&gt; &lt;SectionHeader section&#x3D;&#123;section&#125; &#x2F;&gt;&#125;      keyExtractor&#x3D;&#123;(item) &#x3D;&gt; &#96;$&#123;item.value&#125;&#96;&#125;      sections&#x3D;&#123;dataSource&#125;      stickySectionHeadersEnabled&#x3D;&#123;false&#125;      onViewableItemsChanged&#x3D;&#123;onMainListViewableItemsChanged&#125;    &#x2F;&gt;  );&#125;;export default MainList;</code></pre><p>åœ¨ AlphabetList ä¸­ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const AlphabetList &#x3D; (&#123; dataSource &#125;: IProps) &#x3D;&gt; &#123;  &#x2F;&#x2F; å³ä¾§å­—æ¯è¡¨åˆ—è¡¨  const letterlist &#x3D; dataSource.map((item) &#x3D;&gt; &#123;    return item.sectionKey;  &#125;);  const [currentSectionKey, setCurrentSectionKey] &#x3D; useState(letterlist);  const onMainListViewableItemsChanged &#x3D; (info: &#123;    viewableItems: ViewToken[];  &#125;) &#x3D;&gt; &#123;    &#x2F;&#x2F; å°†é€‰ä¸­çš„å­—æ¯è®¾ç½®ä¸ºå½“å‰ç¬¬ä¸€ä¸ªå¯è§ section çš„ sectionKey    setCurrentSectionKey(info.viewableItems[0].section.sectionKey);  &#125;;  return (    &lt;View style&#x3D;&#123;styles.container&#125;&gt;      &#123;&#x2F;* ä¸»åˆ—è¡¨ start *&#x2F;&#125;      &lt;MainList        dataSource&#x3D;&#123;dataSource&#125;        onMainListTouchStart&#x3D;&#123;() &#x3D;&gt; setCurrentResponder(&#39;mainList&#39;)&#125;        onMainListViewableItemsChanged&#x3D;&#123;onMainListViewableItemsChanged&#125;      &#x2F;&gt;      &#123;&#x2F;* ä¸»åˆ—è¡¨ end *&#x2F;&#125;      &#123;&#x2F;* å³ä¾§å­—æ¯åˆ—è¡¨ start *&#x2F;&#125;      &lt;SideBar &#x2F;&gt;      &#123;&#x2F;* å³ä¾§å­—æ¯åˆ—è¡¨ end *&#x2F;&#125;    &lt;&#x2F;View&gt;  );&#125;;export default AlphabetList;</code></pre><h4 id="SideBar"><a href="#SideBar" class="headerlink" title="SideBar"></a>SideBar</h4><p>ä¾§è¾¹æ çš„å®ç°æ¯”èµ·æ¥åˆ™è¦å¤æ‚ä¸€äº›ï¼Œè¿™é‡Œä½¿ç”¨ä¸€ä¸ªç»å¯¹å®šä½çš„ FlatListï¼Œå®é™…ä¸Šç®€å•ä½¿ç”¨ View å»å®ç°ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const SideBar &#x3D; (&#123;  letterlist,  &#x2F;&#x2F; å›è°ƒ  handleSideBarItemRespond,  currentSectionKey&#125;: IProps) &#x3D;&gt; &#123;  return (    &lt;FlatList      style&#x3D;&#123;styles.wrap&#125;      scrollEnabled&#x3D;&#123;false&#125;      data&#x3D;&#123;letterlist&#125;      renderItem&#x3D;&#123;(&#123; item, index &#125;) &#x3D;&gt; (        &lt;Item          item&#x3D;&#123;item&#125;          handleSideBarItemRespond&#x3D;&#123;handleSideBarItemRespond&#125;          letterlist&#x3D;&#123;letterlist&#125;        &#x2F;&gt;      )&#125;      keyExtractor&#x3D;&#123;item &#x3D;&gt; item&#125;    &#x2F;&gt;  );&#125;;</code></pre><p>ä¸€å¼€å§‹æˆ‘çš„æƒ³æ³•æ˜¯é€šè¿‡ç›‘å¬ Item çš„ onPress | onPressIn ï¼Œä»ä¸€é¡¹æ»‘åŠ¨åˆ°å¦ä¸€é¡¹çš„æ—¶å€™ï¼Œä¾æ¬¡è§¦å‘äº‹ä»¶ï¼Œå®éªŒåå‘ç°ï¼Œåœ¨é‡Šæ”¾æ‰‹åŠ¿ä¹‹å‰ï¼Œä»…ä¼šæœ‰ä¸€ä¸ªå“åº”çš„å…ƒç´ ã€‚</p><p>è¿™é‡Œå°±å¾—æä¸€ä¸‹ RN çš„æ‰‹åŠ¿ç³»ç»Ÿäº†ã€‚</p><h5 id="Responder"><a href="#Responder" class="headerlink" title="Responder"></a>Responder</h5><p>åœ¨ React Native ä¸­ï¼Œå“åº”æ‰‹åŠ¿çš„åŸºæœ¬å•ä½æ˜¯<code>responder</code>ï¼Œå¹¶ä¸”ä»…æœ‰ä¸€ä¸ª <code>responder</code> æ‹¥æœ‰æ§åˆ¶æƒã€‚åœ¨ View ä¸Šæœ‰è¿™äº›å±æ€§ï¼š</p><ol><li>onStartShouldSetResponderï¼šç‚¹å‡»æ—¶æ˜¯å¦å˜æˆä¸€ä¸ª responder</li><li>onMoveShouldSetResponderï¼šæ»‘åŠ¨æ—¶æ˜¯å¦å˜æˆä¸€ä¸ª responder</li><li>onResponderGrantï¼š ç‚¹å‡»æ—¶çš„å›è°ƒ</li><li>onResponderMoveï¼šç§»åŠ¨æ—¶çš„å›è°ƒ</li><li>onResponderTerminationRequestï¼šå½“åˆ«çš„å…ƒç´ å¸Œæœ›æˆä¸º responder æ—¶ï¼Œæ˜¯å¦è¦é‡Šæ”¾å½“å‰çš„ responderï¼Ÿ</li><li>onResponderReleaseï¼šå½“ reponder é‡Šæ”¾æ—¶çš„å›è°ƒ</li><li>ç­‰ç­‰</li></ol><p>é€šè¿‡ä¸Šè¿°è¿™äº› API æˆ‘ä»¬å°±èƒ½å¾ˆå®¹æ˜“çš„å®ç°ä¸€äº›æ‰‹åŠ¿ã€‚åˆæ¬¡ä¹‹å¤–ï¼ŒRN è¿˜æä¾›äº†æ›´é«˜çº§çš„æŠ½è±¡ PanResponderï¼Œå®ƒå¯ä»¥ç»™æˆ‘ä»¬æä¾›æ›´å¤šæ‰‹åŠ¿ä¿¡æ¯ï¼Œè¿™é‡Œä¸å±•å¼€è§£é‡Šã€‚</p><p>ä¸è¿‡å½“æˆ‘å°è¯•åœ¨æ¯ä¸ª Item ä¸Šè®¾ç½®æ‰‹åŠ¿å“åº”ï¼Œå¹¶ä¸”è®¾ç½®  onResponderTerminationRequest ä¸º <code>() =&gt; true</code>ï¼Œæ‰‹åŠ¿ä¾ç„¶æ²¡æœ‰åœ¨åˆ‡æ¢ Item æ—¶é‡Šæ”¾åŸ responderã€‚</p><p>å› æ­¤åªèƒ½é€šè¿‡è®¡ç®—é«˜åº¦æ¥è·å–æ»‘åŠ¨æ—¶å½“å‰çš„å­—æ¯</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; evt.nativeEvent.pageY: è§¦æ‘¸äº‹ä»¶çš„ pageY&#x2F;&#x2F; sideBarTop: SideBar çš„ pageY&#x2F;&#x2F; letterHeightï¼šæ¯ä¸ªå­—æ¯çš„é«˜åº¦const index &#x3D; Math.floor((evt.nativeEvent.pageY - sideBarTop) &#x2F; letterHeight);</code></pre><p>è¦è·å–å…ƒç´ è·ç¦»å±å¹•çš„é«˜åº¦ï¼Œå¯ä»¥åœ¨ onLayout çš„æ—¶å€™ï¼Œè°ƒç”¨ measure æ¥è·å–ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const SideBar &#x3D; (&#123;  letterlist,  handleSideBarItemRespond,  currentSectionKey,  letterHeight,&#125;: IProps) &#x3D;&gt; &#123;  const [sideBarTop, setSideBarTop] &#x3D; useState(0);  const sideBarRef &#x3D; useRef&lt;View&gt;(null);  const measure &#x3D; () &#x3D;&gt; &#123;    if (sideBarRef.current) &#123;      sideBarRef.current.measure((x, y, width, height, pageX, pageY) &#x3D;&gt; &#123;        setSideBarTop(pageY);      &#125;);    &#125;  &#125;;  return (    &lt;View onLayout&#x3D;&#123;measure&#125; ref&#x3D;&#123;sideBarRef&#125;&gt;      &lt;FlatList&lt;string&gt;        &#x2F;&#x2F; ...      &#x2F;&gt;    &lt;&#x2F;View&gt;  );&#125;;</code></pre><p>ç„¶åå°±æ˜¯ Item çš„å®ç°ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const Item &#x3D; (&#123;  item,  handleSideBarItemRespond,  isCurrentSectionKey,  letterlist,  letterHeight,  sideBarTop,&#125;: &#123;  item: string;  isFirst: boolean;  handleSideBarItemRespond: (item: string) &#x3D;&gt; void;  letterlist: string[];  letterHeight: number;  sideBarTop?: number;&#125;) &#x3D;&gt; &#123;  const panResponder &#x3D; PanResponder.create(&#123;    onStartShouldSetPanResponderCapture: () &#x3D;&gt; true,    onStartShouldSetPanResponder: () &#x3D;&gt; true,    &#x2F;&#x2F; å°è¯•é€šè¿‡ onResponderTerminationRequest æ¥ç»ˆæ­¢æ‰‹åŠ¿ï¼Œå‘ç°ä¸ç”Ÿæ•ˆï¼Œåªèƒ½é€šè¿‡è®¡ç®—åç§»é‡æ¥è·å–å½“å‰é€‰ä¸­    onPanResponderTerminationRequest: () &#x3D;&gt; true,    onPanResponderGrant: () &#x3D;&gt; &#123;      handleSideBarItemRespond(item);    &#125;,    onPanResponderMove: (evt, gs) &#x3D;&gt; &#123;      if (!sideBarTop) &#123;        return;      &#125;      const index &#x3D; Math.floor(        (evt.nativeEvent.pageY - sideBarTop) &#x2F; letterHeight,      );      if (index &gt;&#x3D; 0 &amp;&amp; index &lt; letterlist.length) &#123;        &#x2F;&#x2F; è§¦å‘ä¾§è¾¹å­—æ¯é€‰ä¸­çš„å›è°ƒ        handleSideBarItemRespond(letterlist[index]);      &#125;    &#125;,  &#125;);  return (    &lt;View &#123;...panResponder.panHandlers&#125;&gt;      &lt;Text&gt;        &#123;item&#125;      &lt;&#x2F;Text&gt;    &lt;&#x2F;View&gt;  );&#125;;</code></pre><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œä¾§è¾¹æ çš„é€»è¾‘å·²ç»å®Œæˆã€‚ç°åœ¨å¤„ç†ä¾§è¾¹æ äº‹ä»¶çš„å›è°ƒé€»è¾‘, ä¸»è¦é€šè¿‡ scrollToLocation æ¥å®ç°åˆ—è¡¨æ»šåŠ¨åˆ°å¯¹åº”çš„ä½ç½®</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const AlphabetList &#x3D; (&#123; dataSource, companyList, onCompanySelect &#125;: IProps) &#x3D;&gt; &#123;  &#x2F;&#x2F; ...  const mainListRef &#x3D; useRef&lt;SectionList&lt;IListItem&gt;&gt;(null);  const handleSideBarItemRespond &#x3D; (item: string) &#x3D;&gt; &#123;    if (!mainListRef.current) &#123;      return;    &#125;  &#x2F;&#x2F; è®°å½•å½“å‰é€‰ä¸­çš„å­—æ¯    setCurrentSectionKey(item);    mainListRef.current.scrollToLocation(&#123;      sectionIndex: dataSource.findIndex((data) &#x3D;&gt; data.sectionKey &#x3D;&#x3D;&#x3D; item),      itemIndex: 0,      animated: false,    &#125;);  &#125;;  return (    &lt;View style&#x3D;&#123;styles.container&#125;&gt;      &#123;&#x2F;* ä¸»åˆ—è¡¨ start *&#x2F;&#125;      &lt;MainList        &#x2F;&#x2F; ...        ref&#x3D;&#123;mainListRef&#125;      &#x2F;&gt;      &#x2F;&#x2F; ...    &lt;&#x2F;View&gt;  );&#125;;</code></pre><p>è¿™é‡Œéœ€è¦é€šè¿‡ React.forwardRef è·å–åˆ° MainList çš„ ref</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const MainList: React.ForwardRefRenderFunction&lt;  SectionList&lt;IListItem&gt;,  IProps&gt; &#x3D; (  &#123;    dataSource,    &#x2F;&#x2F; ...  &#125;,  ref,) &#x3D;&gt; &#123; &#x2F;&#x2F; ...  return (    &lt;SectionList      &#x2F;&#x2F; ...      ref&#x3D;&#123;ref&#125;    &#x2F;&gt;  );&#125;;export default React.forwardRef(MainList)</code></pre><p>åˆ°è¿™ä¸€æ­¥ï¼Œå·²ç»åŸºæœ¬å®Œæˆäº†ä¸€ä¸ªé€šè®¯å½•å­—æ¯åˆ—è¡¨ã€‚</p><h4 id="å…¶ä»–ç»†èŠ‚"><a href="#å…¶ä»–ç»†èŠ‚" class="headerlink" title="å…¶ä»–ç»†èŠ‚"></a>å…¶ä»–ç»†èŠ‚</h4><p>åœ¨å®Œæˆä¸Šè¿°åŠŸèƒ½åï¼Œç”±äºç‚¹å‡»ä¾§è¾¹æ ä¼šæ»šåŠ¨ä¸»åˆ—è¡¨ï¼Œæ­¤æ—¶ä¹Ÿä¼šè§¦å‘ MainList çš„ onViewableItemsChangedï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªæ ‡è¯†æ¥åŒºåˆ†æ˜¯ä»€ä¹ˆåŠ¨ä½œè§¦å‘çš„ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const AlphabetList &#x3D; (&#123; dataSource, companyList, onCompanySelect &#125;: IProps) &#x3D;&gt; &#123;  &#x2F;&#x2F; æ ‡è¯†ä½ï¼šç”¨äºåŒºåˆ†å½“å‰çš„æ“ä½œæ˜¯ç”±ä»€ä¹ˆè§¦å‘çš„  const [currentResponder, setCurrentResponder] &#x3D; useState(&#39;&#39;);  const mainListRef &#x3D; useRef&lt;SectionList&lt;IListItem&gt;&gt;(null);  &#x2F;&#x2F; å³ä¾§å­—æ¯è¡¨åˆ—è¡¨  const letterlist &#x3D; dataSource.map((item) &#x3D;&gt; &#123;    return item.sectionKey;  &#125;);  const [currentSectionKey, setCurrentSectionKey] &#x3D; useState(letterlist[0]);  const handleSideBarItemRespond &#x3D; (item: string) &#x3D;&gt; &#123;    if (!mainListRef.current) &#123;      return;    &#125;    setCurrentResponder(&#39;sideBar&#39;);  &#x2F;&#x2F; ...  &#125;;  const onMainListViewableItemsChanged &#x3D; (info: &#123;    viewableItems: ViewToken[];  &#125;) &#x3D;&gt; &#123;    if (      &#x2F;&#x2F; ä¾§è¾¹æ è§¦å‘çš„æ»šåŠ¨åˆ™ä¸è§¦å‘      currentResponder &#x3D;&#x3D;&#x3D; &#39;sideBar&#39; ||      !info.viewableItems[0].section.sectionKey    ) &#123;      return;    &#125;    setCurrentSectionKey(info.viewableItems[0].section.sectionKey);  &#125;;  return (    &lt;View style&#x3D;&#123;styles.container&#125;&gt;      &#123;&#x2F;* ä¸»åˆ—è¡¨ start *&#x2F;&#125;      &lt;MainList       &#x2F;&#x2F; ...        onMainListTouchStart&#x3D;&#123;() &#x3D;&gt; setCurrentResponder(&#39;mainList&#39;)&#125;        &#x2F;&#x2F; ...      &#x2F;&gt;      &#123;&#x2F;* ä¸»åˆ—è¡¨ end *&#x2F;&#125;      &#x2F;&#x2F; ...    &lt;&#x2F;View&gt;  );&#125;;</code></pre><h4 id="è¸©å‘"><a href="#è¸©å‘" class="headerlink" title="è¸©å‘"></a>è¸©å‘</h4><p>åŠŸèƒ½æ˜¯åŸºæœ¬ä¸Šå®Œæˆäº†ï¼Œç„¶è€Œç”±äºè¿™é‡Œçš„æ•°æ®é‡æ¯”è¾ƒå¤šï¼Œå¤§æ¦‚æœ‰ 600 æ¡æ•°æ®ï¼Œä¸”ç”±äº SectionList ä¹Ÿæ˜¯åŸºäº VirtualListï¼Œå› æ­¤å¯¼è‡´äº†ä»¥ä¸‹é•¿åˆ—è¡¨å›ºæœ‰çš„å‡ ä¸ªé—®é¢˜ï¼š</p><ol><li>å¿«é€Ÿæ»šåŠ¨ MainListï¼Œå½“ SectionList æ¥ä¸åŠæ¸²æŸ“æ—¶ï¼Œä¼šå¯¼è‡´å±å¹•ç©ºç™½</li><li>å½“ä½¿ç”¨ scrollToLocation æ—¶ï¼Œå¦‚æœå®šä½åˆ°æ¥ä¸åŠæ¸²æŸ“çš„åŒºåŸŸï¼Œå°†ä¼šæŠ¥é”™ï¼Œæç¤ºéœ€è¦è®¾ç½® getItemLayout å±æ€§ï¼Œè¿™ä¸ªå±æ€§æ˜¯ç”¨äºè®¡ç®—ä¸»åˆ—è¡¨æ¯ä¸€é¡¹é«˜åº¦ä»¥åŠåç§»é‡çš„</li></ol><p>åœ¨å°è¯•äº†ä¸€äº›ä¼˜åŒ–çš„æ‰‹æ®µåï¼Œå¦‚ React.memo, initialNumToRenderï¼ŒgetItemLayout ç­‰å±æ€§ä¾ç„¶æ— æ³•æœ‰æ•ˆè§£å†³ä¸Šè¿°é—®é¢˜ã€‚ã€‚</p><p>RN çš„ list çœŸçš„æ˜¯è®©äººä¸€è¨€éš¾å°½ã€‚ã€‚ä¸çŸ¥é“æ˜¯å¦åŸç”Ÿç»„ä»¶æˆ–è€… flutter å¯¹é•¿åˆ—è¡¨çš„æ”¯æŒä¼šæ›´å¥½ä¸€ç‚¹å‘¢ ğŸ˜‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ReactNative </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title> TypeScript çš„ enum ç±»å‹æ”¶çª„é—®é¢˜</title>
      <link href="/2020/09/21/TypeScript-%E7%9A%84-enum-%E7%B1%BB%E5%9E%8B%E6%94%B6%E7%AA%84%E9%97%AE%E9%A2%98/"/>
      <url>/2020/09/21/TypeScript-%E7%9A%84-enum-%E7%B1%BB%E5%9E%8B%E6%94%B6%E7%AA%84%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>åœ¨é¡¹ç›®ä¸­çœ‹åˆ°ä¸€æ®µå°ä¼™ä¼´å†™çš„ä»£ç ï¼Œç®€åŒ–åå¤§æ¦‚å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">enum A &#123;  &quot;ONE&quot; &#x3D; 1,  &quot;TWO&quot; &#x3D; 2&#125;const a &#x3D; Math.random() &gt; 0.5 ? A.ONE : A.TWOconst b &#x3D; Math.random() &gt; 0.5 ? a : 0if(b &#x3D;&#x3D;&#x3D; 1 || b &#x3D;&#x3D;&#x3D; 2) &#123;&#125;</code></pre><p>æ­¤æ—¶ï¼Œb === 2 å¤„ ts ä¼šæç¤º:</p><pre class="line-numbers language-none"><code class="language-none">This condition will always return &#39;false&#39; since the types &#39;0&#39; and &#39;2&#39; have no overlap.ts(2367)</code></pre><p>ä¸ºä½• TypeScript ä¼šæç¤º 0 ä¸ 2 æ²¡æœ‰é‡åˆçš„åœ°æ–¹å‘¢ï¼Ÿ</p><a id="more"></a><h4 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><p>é¼ æ ‡æ‚¬æµ®åœ¨ b === 1 æ—¶ï¼Œæç¤º b çš„ç±»å‹ä¸º A ï½œ 0 çš„è”åˆç±»å‹ï¼Œè€Œåˆ°äº† b === 2 æ—¶ï¼Œå´å˜æˆäº† <code>b: 0</code>ã€‚é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ TypeScript åœ¨åˆ¤æ–­ b !== 1 æ—¶ï¼Œå°±åˆ¤å®š b ä¸å¯èƒ½ä¸ºç±»å‹ Aï¼Œæ­¤æ—¶å°†ç±»å‹æ”¶çª„ä¸º 0ã€‚è€Œ 0 ä¸å¯èƒ½ assgin ç»™ 2ï¼Œå› æ­¤æŠ¥é”™ã€‚ä¸Šç½‘æœç´¢ä¼¼ä¹ä¹Ÿæ²¡æœ‰å¾—åˆ°ä¸ºä½•æ—¶è¿™ç§æ”¶çª„ç­–ç•¥çš„åŸå› ï¼Œä»…æœ‰ä¸€ä¸ªå¯èƒ½æœ‰å…³è”çš„ <a href="https://github.com/Microsoft/TypeScript/issues/9998">https://github.com/Microsoft/TypeScript/issues/9998</a> , ç„¶è€Œè‡³ä»Šè¿˜æ˜¯ open çš„ã€‚</p><h4 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h4><p>é‚£æˆ‘ä»¬è¦æ€ä¹ˆè§£å†³è¿™ä¸ªæŠ¥é”™å‘¢ï¼Ÿå®é™…ä¸Šæˆ‘ä»¬å°†åˆ¤æ–­çš„å³å€¼æ”¹æˆ enum å³å¯ï¼Œä¸”é€»è¾‘æ›´æ¸…æ™°ï¼Œç»´æŠ¤æ›´ç®€å•ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">if(b &#x3D;&#x3D;&#x3D; A.ONE || b &#x3D;&#x3D;&#x3D; A.TWO) &#123;&#x2F;&#x2F; no error&#125;</code></pre><p>æˆ–è€…ä¸‹é¢è¿™ç§ä¹Ÿå¯ä»¥ï¼ˆä¸æ˜¯å¾ˆæ¨èï¼Œæ²¡æœ‰å‘æŒ¥å‡º enum åº”æœ‰çš„ä½œç”¨ï¼‰</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">if(b as A &#x3D;&#x3D;&#x3D; 1 || b &#x3D;&#x3D;&#x3D; 0) &#123;&#x2F;&#x2F; no error&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°å½•ä¸€æ¬¡bugæ’æŸ¥</title>
      <link href="/2020/09/16/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1bug%E6%8E%92%E6%9F%A5/"/>
      <url>/2020/09/16/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1bug%E6%8E%92%E6%9F%A5/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>æµ‹è¯•åŒå­¦æäº†ä¸€ä¸ªæµ‹è¯•ç¯å¢ƒè¡¨æ ¼æ— æ³•åˆ‡æ¢æ¯é¡µæ¡æ•°çš„ bugã€‚</p><h4 id="æ’æŸ¥è¿‡ç¨‹"><a href="#æ’æŸ¥è¿‡ç¨‹" class="headerlink" title="æ’æŸ¥è¿‡ç¨‹"></a>æ’æŸ¥è¿‡ç¨‹</h4><p>åœ¨æµ‹è¯•ç¯å¢ƒæ“ä½œåå‘ç°ï¼Œç¡®å®å­˜åœ¨è¯¥é—®é¢˜ï¼Œä½†æ˜¯åˆ‡æ¢åˆ°å¯¹åº”æµ‹è¯•åˆ†æ”¯ï¼Œæœ¬åœ°è¿è¡Œï¼Œæœªèƒ½é‡ç°ã€‚</p><a id="more"></a><p>åœ¨æµ‹è¯•ç¯å¢ƒçš„æ“ä½œå‘ç°å®é™…ä¸Šåˆ‡æ¢æ¯é¡µæ¡æ•°çš„å›è°ƒ onShowSizeChange ç¡®å®ä¼šè§¦å‘ï¼Œä½†æ˜¯æ­¤ååˆå˜å›åŸæ¯é¡µæ¡æ•°ã€‚</p><p>å¯¹äºæµ‹è¯•ç¯å¢ƒä¸æœ¬åœ°å¼€å‘çš„è¡¨ç°ä¸ä¸€è‡´ï¼Œåœ¨æ’é™¤äº†å„ç§å¯èƒ½æ€§ä¹‹åï¼ŒçŒœæµ‹æ˜¯ä¾èµ–ç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡´çš„ã€‚</p><p>ç‰ˆæœ¬ä¸ä¸€è‡´å‡ºç°é—®é¢˜æ­¤å‰å·²ç»å‡ºç°è¿‡ä¸€æ¬¡ï¼šæˆ‘æœ¬åœ°çš„æœ‰æ®µä»£ç æç¤ºäº†ä¸€ä¸ª eslint çš„ no-throw-literalï¼Œä½†æ˜¯åˆ«çš„åŒäº‹éƒ½æ²¡æœ‰æŠ¥é”™ï¼Œ eslintrc çš„é…ç½®æ˜¯ä¸€æ ·çš„ã€‚æœ€ç»ˆå‘ç°æ˜¯æˆ‘çš„ umi ç‰ˆæœ¬æ¯”è¾ƒé«˜ï¼Œå…¶ä¸­ä¾èµ–çš„ @typescript-eslint/eslint-plugin åœ¨ 2.13.0 æ–°å¢äº† no-throw-literal è¿™ä¸ªé…ç½®ï¼Œè€Œåˆ«çš„å°ä¼™ä¼´ä»¬çš„ç‰ˆæœ¬ä½äºæ­¤ï¼Œæ•…ä¸ä¼šæŠ¥é”™ã€‚</p><p>å› æ­¤æ‰§è¡Œå‘½ä»¤ <code>npm ci</code> ï¼Œè¯¥å‘½ä»¤ä¼šæŒ‰ç…§ packge-lock.json ä¸­è®°å½•çš„ç‰ˆæœ¬è¿›è¡Œå®‰è£…,ä¸‹é¢æ˜¯è¿™ä¸ªå‘½ä»¤çš„è¯´æ˜</p><blockquote><p>This command is similar to <code>npm-install</code>, except itâ€™s meant to be used in automated environments such as test platforms, continuous integration, and deployment â€“ or any situation where you want to make sure youâ€™re doing a clean install of your dependencies. It can be significantly faster than a regular npm install by skipping certain user-oriented features. It is also more strict than a regular install, which can help catch errors or inconsistencies caused by the incrementally-installed local environments of most npm users.</p></blockquote><p>é‡æ–°å®‰è£…ä¾èµ–ä¹‹åæœç„¶æœ¬åœ°å¯ä»¥é‡ç°è¯¥é—®é¢˜ã€‚</p><p>æ­¤åç»è¿‡ debug å‘ç°ï¼Œåˆ‡æ¢ pageSize ä¼šå…ˆåè§¦å‘ onShowSizeChange å’Œè¡¨æ ¼çš„ onChangeï¼Œè¡¨æ ¼çš„ onChange é‡æ–°å°† pageSize è®¾ç½®å›å»ã€‚</p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>æœ€ç»ˆå¦‚ä½•è§£å†³ä¸Šè¿° bug å°±ä¸èµ˜è¿°äº†ã€‚</p><p>ä¸»è¦æƒ³æ€»ç»“çš„æ˜¯ï¼šé‡åˆ° bugï¼Œå¦‚æœå‡ºç°ä»£ç å’Œè¿è¡Œç¯å¢ƒä¹‹ç±»çš„å„ç§æ¡ä»¶éƒ½ä¸€è‡´ï¼Œä½†æ˜¯è¡¨ç°å°±æ˜¯ä¸ä¸€è‡´çš„æƒ…å†µï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½æ˜¯ä¾èµ–åŒ…çš„ç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡´çš„ ğŸ‘»</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®€æ˜“ redux</title>
      <link href="/2020/09/14/%E7%AE%80%E6%98%93-redux/"/>
      <url>/2020/09/14/%E7%AE%80%E6%98%93-redux/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>Redux å¸¸å¸¸é…åˆ react-redux ä½œä¸ºçŠ¶æ€ç®¡ç†åº”ç”¨åœ¨ React çš„é¡¹ç›®ä¸­ï¼Œå¹¶ä¸”åŸºäº redux å‘å±•å‡ºäº† dva ä¹‹ç±»çš„è¯¸å¤šçŠ¶æ€ç®¡ç†å·¥å…·ã€‚</p><p>è¯´æ¥æƒ­æ„§ï¼Œè™½ç„¶åœ¨é¡¹ç›®ä¸­å¸¸å¸¸ä½¿ç”¨åˆ°ï¼Œä½†æ˜¯å¹¶æœªé˜…è¯»è¿‡ redux çš„æºç ï¼Œäº†è§£å…¶åŸç†ã€‚æœ¬æ–‡ä½œä¸ºå­¦ä¹ ç¬”è®°ï¼Œå¹¶æ ¹æ® redux çš„æ¯”è¾ƒæ ¸å¿ƒçš„ createStore è¿™éƒ¨åˆ†ä»£ç å®ç°ä¸€ä¸ªç®€æ˜“ç‰ˆæœ¬çš„ reduxï¼Œä»¥ä¾¿å°†æ¥å›é¡¾ã€‚</p><a id="more"></a><h4 id="redux-demo"><a href="#redux-demo" class="headerlink" title="redux demo"></a>redux demo</h4><p>redux æä¾›äº†ä½¿ç”¨ demo å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">import &#123; createStore &#125; from &#39;redux&#39;&#x2F;** * è¿™æ˜¯ä¸ª reducerï¼Œçº¯å‡½æ•°ï¼Œç”¨äºæè¿°çŠ¶æ€æ˜¯å¦‚ä½•è½¬å˜çš„ * reducer æ¥æ”¶ state å’Œ action ä½œä¸ºå‚æ•° *&#x2F;function counter(state &#x3D; 0, action) &#123;  switch (action.type) &#123;    case &#39;INCREMENT&#39;:      return state + 1    case &#39;DECREMENT&#39;:      return state - 1    default:      return state  &#125;&#125;&#x2F;&#x2F; createStoreï¼šæ¥æ”¶ reducer ä½œä¸ºå‚æ•°ï¼Œä»¥æ­¤æ„å»ºä¸€ä¸ª storelet store &#x3D; createStore(counter)&#x2F;&#x2F; è®¢é˜… store, æ¯æ¬¡ dispatch çš„æ—¶å€™ï¼Œéƒ½å°†è§¦å‘å›è°ƒstore.subscribe(() &#x3D;&gt; console.log(store.getState()))&#x2F;&#x2F; dispath ä¸€ä¸ª actionstore.dispatch(&#123; type: &#39;INCREMENT&#39; &#125;)</code></pre><h4 id="ç®€åŒ–çš„æ•°æ®æµ"><a href="#ç®€åŒ–çš„æ•°æ®æµ" class="headerlink" title="ç®€åŒ–çš„æ•°æ®æµ"></a>ç®€åŒ–çš„æ•°æ®æµ</h4><img src="https://i.loli.net/2020/11/09/UscH6njLXxCVDvu.png" alt="fiber" style="zoom:50%;" /><p>ä»¥ä¸Šçš„æ•°æ®æµç®€åŒ–äº† combineReducers ç­‰è¿‡ç¨‹</p><h4 id="ç®€æ˜“-redux"><a href="#ç®€æ˜“-redux" class="headerlink" title="ç®€æ˜“ redux"></a>ç®€æ˜“ redux</h4><p>å¯ä»¥çœ‹å‡º redux å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œç®€æ˜“ç‰ˆå®ç°å¦‚ä¸‹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const createStore &#x3D; (reducer) &#x3D;&gt; &#123;  let state  &#x2F;&#x2F; è®¢é˜…çš„å›è°ƒ  let listeners &#x3D; []  &#x2F;&#x2F; è·å– state  const getState &#x3D; () &#x3D;&gt; &#123;    return state  &#125;  const dispatch &#x3D; (action) &#x3D;&gt; &#123;    &#x2F;&#x2F; æ›´æ–° state    state &#x3D; reducer(state, action)    &#x2F;&#x2F; ä¸€æ—¦ dispatch å°±æ‰§è¡Œæ‰€æœ‰è®¢é˜…çš„å›è°ƒ    listeners.forEach((listener) &#x3D;&gt; listener())  &#125;  const subscribe &#x3D; (listener) &#x3D;&gt; &#123;    &#x2F;&#x2F; æ”¶é›†å›è°ƒ    listeners.push(listener)    return () &#x3D;&gt; &#123;      &#x2F;&#x2F; å–æ¶ˆè®¢é˜…      listeners &#x3D; listeners.filter((l) &#x3D;&gt; l !&#x3D;&#x3D; listener)    &#125;  &#125;  return &#123;    getState,    dispatch,    subscribe,  &#125;&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‘Šåˆ«é­”æ³•æ•°å­—</title>
      <link href="/2020/09/12/%E5%91%8A%E5%88%AB%E9%AD%94%E6%B3%95%E6%95%B0%E5%AD%97/"/>
      <url>/2020/09/12/%E5%91%8A%E5%88%AB%E9%AD%94%E6%B3%95%E6%95%B0%E5%AD%97/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ä»¥å¾€çš„å¼€å‘ä¸­å¾€å¾€ä¼šå‡ºç°ç±»ä¼¼ä»¥ä¸‹çš„ä»£ç </p> <pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">if(status &#x3D;&#x3D;&#x3D; 1) &#123;   &#x2F;&#x2F; do something&#125; else if(status &#x3D;&#x3D;&#x3D; 2) &#123;   &#x2F;&#x2F; do something&#125; else if (status &#x3D;&#x3D;&#x3D; 3) &#123;  &#x2F;&#x2F; ...&#125;</code></pre><p>ä¸Šé¢ä»£ç ä¸­çš„ <code>1</code>ï¼Œ<code>2</code>ï¼Œ<code>3</code>å°±æ˜¯æ‰€è°“çš„é­”æ³•æ•°å­—ï¼Œå³æ²¡æœ‰æ³¨é‡Šçš„æƒ…å†µä¸‹æˆ‘ä»¬å¾ˆéš¾çŸ¥é“ 1ï¼Œ2ï¼Œ3 ä»£è¡¨çš„åˆ°åº•æ˜¯ä»€ä¹ˆ statusã€‚</p><a id="more"></a><h4 id="å¸¸é‡å¯¹è±¡"><a href="#å¸¸é‡å¯¹è±¡" class="headerlink" title="å¸¸é‡å¯¹è±¡"></a>å¸¸é‡å¯¹è±¡</h4><p>åœ¨ javascript ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›æ•°å­—ç»´æŠ¤åœ¨ä¸€ä¸ªå¸¸é‡å¯¹è±¡ä¸­</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const STATUS &#x3D; &#123;  ERROR: 1,  NORMAL: 2,  SUCCESS: 3&#125;</code></pre><p>ä½¿ç”¨æ—¶å°±å¯ä»¥ä½¿ç”¨ STATUS.ERROR æ¥æ›¿æ¢æ‰ 1ã€‚</p><p>è¿™æ ·å¯ä»¥å¾ˆæ¸…æ™°å°±åˆ†æ¸…æ¥š 1ï¼Œ2ï¼Œ3 è¿™äº›æ•°å€¼å¯¹åº”çš„æ˜¯ä»€ä¹ˆå«ä¹‰ã€‚åŒæ—¶å¦‚æœå°†æ¥ ERROR ä¸å†æ˜¯ 1ï¼Œæˆ‘ä»¬ä¹Ÿåªéœ€è¦ç»´æŠ¤ STATUS å³å¯ã€‚</p><h4 id="Enums"><a href="#Enums" class="headerlink" title="Enums"></a>Enums</h4><h4 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h4><p>è€Œåœ¨ TypeScript ä¸­ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥ä½¿ç”¨æšä¸¾ç±»å‹æ¥ç»´æŠ¤è¿™äº›æ•°å€¼ã€‚</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">enum STATUS &#123;  ERROR &#x3D; 1,  NORMAL,  SUCCESS&#125;</code></pre><p>ä½¿ç”¨æ—¶åŒæ ·æ˜¯ STATUS.ERROR æ›¿æ¢æ‰ 1 å³å¯ã€‚</p><p>å…³äº enums çš„ä½¿ç”¨<a href="https://www.tslang.cn/docs/handbook/enums.html">æ–‡æ¡£</a>é‡Œæè¿°çš„å·²ç»å¾ˆæ¸…æ¥šï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p><h4 id="åå‘æ˜ å°„"><a href="#åå‘æ˜ å°„" class="headerlink" title="åå‘æ˜ å°„"></a>åå‘æ˜ å°„</h4><p>å€¼å¾—ä¸€æçš„æ˜¯ enums æä¾›äº†å¸¸é‡å¯¹è±¡ä¸å…·å¤‡çš„åå‘æ˜ å°„ï¼ˆvalue<code>-&gt;</code>name ï¼‰ã€‚</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">const STATUS &#x3D; &#123;  ERROR: 1,  NORMAL: 2,  SUCCESS: 3&#125;&#x2F;&#x2F; è¾“å‡ºï¼š&quot;ERROR&quot;STATUS[1]</code></pre><p>è¿™æ˜¯å› ä¸º ts å°†ä¸Šè¿°çš„ enums ç¼–è¯‘æˆä»¥ä¸‹ä»£ç </p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">var STATUS;(function (STATUS) &#123;  STATUS[STATUS[&quot;ERROR&quot;] &#x3D; 1] &#x3D; &quot;ERROR&quot;;  STATUS[STATUS[&quot;NORMAL&quot;] &#x3D; 2] &#x3D; &quot;NORMAL&quot;;  STATUS[STATUS[&quot;SUCCESS&quot;] &#x3D; 3] &#x3D; &quot;SUCCESS&quot;;&#125;)(STATUS || (STATUS &#x3D; &#123;&#125;));</code></pre><p>âš ï¸ ä½†å¦‚æœæ˜¯å­—ç¬¦ä¸²æšä¸¾æˆå‘˜åˆ™ä¸ä¼šç”Ÿæˆåå‘æ˜ å°„ã€‚</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">enum STATUS &#123;  ERROR &#x3D; &quot;1&quot;,  NORMAL &#x3D; &quot;2&quot;,  SUCCESS &#x3D; &quot;3&quot;&#125;&#x2F;&#x2F; ç¼–è¯‘åvar STATUS;(function (STATUS) &#123;  STATUS[&quot;ERROR2&quot;] &#x3D; &quot;1&quot;;  STATUS[&quot;NORMAL&quot;] &#x3D; &quot;2&quot;;  sSTATUS[&quot;SUCCESS&quot;] &#x3D; &quot;3&quot;;&#125;)(STATUS || (STATUS &#x3D; &#123;&#125;));</code></pre><p>å¹¶ä¸”å¯¹äºé‡å¤å®šä¹‰çš„æšä¸¾ç±»å‹ï¼Œå°†ä¼šåˆå¹¶æˆå‘˜ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">enum STATUS &#123;  ERROR &#x3D; 1,&#125;enum STATUS &#123;  NORMAL &#x3D; 2,&#125;&#x2F;&#x2F; ç­‰æ•ˆäºenum STATUS &#123;  ERROR &#x3D; 1,  NORMAL &#x3D; 2,&#125;</code></pre><h4 id="const-æšä¸¾"><a href="#const-æšä¸¾" class="headerlink" title="const æšä¸¾"></a>const æšä¸¾</h4><p>å…³äºæšä¸¾ï¼Œè¿˜æœ‰ä¸€ç§ä¸æ˜¯å¸¸è§çš„å†™æ³•</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">const enum STATUS &#123;  ERROR &#x3D; 1,&#125;</code></pre><p>å³å£°æ˜å‰æœ‰ä¸ªå…³é”®å­— constã€‚</p><p>ä¸å¸¸è§„æšä¸¾ä¸åŒçš„åœ°æ–¹åœ¨äº</p><ol><li>const æšä¸¾ä¸ä¼šç¼–è¯‘å‡ºé¢å¤–çš„ä»£ç </li></ol><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">const enum STATUS &#123;  ERROR &#x3D; 1,&#125;console.log(STATUS.ERROR)&#x2F;&#x2F; æœ€ç»ˆçš„ç¼–è¯‘å‡ºçš„ä»£ç ä¸åŒ…å« STATUSconsole.log(1 &#x2F;* ERROR *&#x2F;);</code></pre><ol start="2"><li>ä¹Ÿæ­£å› ä¸ºç¼–è¯‘é˜¶æ®µå°±ä¼šç¡®å®šä¸‹æšä¸¾çš„æˆå‘˜ï¼Œconst æšä¸¾ä¸å¯ä»¥åŒ…å«è®¡ç®—æˆå‘˜</li></ol><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">const geterror &#x3D; () &#x3D;&gt; 3const enum STATUS &#123;  &#x2F;&#x2F; In &#39;const&#39; enum declarations member initializer must be constant expression.  ERROR &#x3D; geterror()&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>React æ³›å‹ç»„ä»¶</title>
      <link href="/2020/09/08/React%20%E6%B3%9B%E5%9E%8B%E7%BB%84%E4%BB%B6/"/>
      <url>/2020/09/08/React%20%E6%B3%9B%E5%9E%8B%E7%BB%84%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>åœºæ™¯ï¼šå°è£…ä¸€ä¸ª antd çš„ Radio ç»„ä»¶æ—¶ï¼Œéœ€è¦ä»çˆ¶ç»„ä»¶è·å–åˆ° value çš„ç±»å‹ã€‚å…¶ props æ¥å£å®šä¹‰å¦‚ä¸‹</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">interface CustomRadioProps&lt;ValueType&gt; &#123;  options: Option&lt;ValueType&gt;[];  value: ValueType;  onChange: (value: ValueType) &#x3D;&gt; void;&#125;</code></pre><p>ä½¿ç”¨æ—¶è¿™é‡Œå‡è®¾ä¼ è¿›å»çš„æ˜¯ä¸ª number ç±»å‹</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">&lt;CustomRadio&lt;number&gt;  onChange&#x3D;&#123;handleTypeChange&#125;  options&#x3D;&#123;[    &#123;      label: &#39;1&#39;,      value: 1,    &#125;,    &#123;      label: &#39;1&#39;,      value: 2,    &#125;,  ]&#125;  value&#x3D;&#123;1&#125;&#x2F;&gt;</code></pre><p>é‚£ä¹ˆè¿™ä¸ª CustomRadioProps ç§°ä¸ºæ³›å‹ç»„ä»¶ã€‚</p><p>é‚£ä¹ˆå¦‚ä½•å®šä¹‰ä¸€ä¸ªæ³›å‹ç»„ä»¶ï¼Ÿ</p><a id="more"></a><h4 id="ç±»ç»„ä»¶"><a href="#ç±»ç»„ä»¶" class="headerlink" title="ç±»ç»„ä»¶"></a>ç±»ç»„ä»¶</h4><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">class CustomRadio&lt;T&gt; extends React.Component&lt;Props&lt;T&gt;&gt; &#123; &#x2F;&#x2F; ...&#125;</code></pre><h4 id="å‡½æ•°ç»„ä»¶"><a href="#å‡½æ•°ç»„ä»¶" class="headerlink" title="å‡½æ•°ç»„ä»¶"></a>å‡½æ•°ç»„ä»¶</h4><p>å¯¹äºç”¨ function å£°æ˜çš„å‡½æ•°å¼ç»„ä»¶å®é™…ä¸Šäºæ³›å‹å‡½æ•°æ˜¯ä¸€æ ·çš„å†™æ³•ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">function CustomRadio&lt;T&gt;(props: IProps&lt;T&gt;) &#123;&#x2F;&#x2F; ...&#125;</code></pre><p>ç„¶è€Œå¯¹äºç”¨ç®­å¤´å‡½æ•°ä¸å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const CustomRadio: React.FunctionComponent&lt;IProps&lt;T&gt;&gt; &#x3D; props &#x3D;&gt; &#123; &#x2F;*...*&#x2F; &#125; </code></pre><p>ç®­å¤´å‡½æ•°ç»„ä»¶æ­£ç¡®çš„å†™æ³•ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">const IconRadioGroup &#x3D; &lt;T extends any&gt;(props: IProps&lt;T&gt;) &#x3D;&gt; &#123;&#x2F;&#x2F; ...&#125;</code></pre><p>è¿™é‡Œ T å¿…é¡»è¦ä½¿ç”¨ extends, ç”¨ <code>T extends any</code> æ¥è¡¨æ˜æ¥æ”¶ä»»æ„ç±»å‹ï¼Œå¦‚æœåªèƒ½ number æˆ–è€… stringç±»å‹ï¼Œåˆ™æ”¹æˆ  <code>T extends numberï½œstring</code> å³å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jsè·å–åç¼€å</title>
      <link href="/2020/09/02/js%E8%8E%B7%E5%8F%96%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E5%90%8D/"/>
      <url>/2020/09/02/js%E8%8E%B7%E5%8F%96%E6%96%87%E4%BB%B6%E5%90%8E%E7%BC%80%E5%90%8D/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>Code Review çš„æ—¶å€™çœ‹åˆ°å°ä¼™ä¼´æäº¤äº†ä¸€æ®µç”¨äºæå–æ–‡ä»¶æ‹“å±•åçš„ä»£ç ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; æˆªå–å›¾ç‰‡åç¼€ä¿¡æ¯&#x2F;&#x2F; example: &#39;www.baidu.com&#x2F;somepic.jpg?h&#x2F;w&#x2F;&#39;&#x2F;&#x2F; return: &#39;.jpg&#39;const getExtension &#x3D; (url &#x3D; &#39;&#39;) &#x3D;&gt; &#123;  const end &#x3D; url.indexOf(&#39;?&#39;) || undefined;  const start &#x3D; url.lastIndexOf(&#39;.&#39;, end);  return url.substring(start, end);&#125;;</code></pre><p>è¿™ç§å†™æ³•å›ºç„¶æ²¡é”™ï¼Œé‚£ä¹ˆæ˜¯å¦æœ‰åˆ«çš„å†™æ³•å˜?</p><a id="more"></a><h4 id="æ–¹æ¡ˆä¸€"><a href="#æ–¹æ¡ˆä¸€" class="headerlink" title="æ–¹æ¡ˆä¸€"></a>æ–¹æ¡ˆä¸€</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const getExtension &#x3D; (url &#x3D; &#39;&#39;) &#x3D;&gt; &#123;  const extensionName &#x3D; url.split(&#39;.&#39;).pop()  return extensionName ? &#96;.$&#123;extensionName&#125;&#96; : &#39;&#39;&#125;</code></pre><h4 id="æ–¹æ¡ˆäºŒ"><a href="#æ–¹æ¡ˆäºŒ" class="headerlink" title="æ–¹æ¡ˆäºŒ"></a>æ–¹æ¡ˆäºŒ</h4><p>æ­£åˆ™è¡¨è¾¾å¼</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const getExtension &#x3D; (url &#x3D; &#39;&#39;) &#x3D;&gt; &#123;  const matches &#x3D; url.match(&#x2F;.*(\.[^?]+)&#x2F;)  return matches ? matches[1] : &#39;&#39;&#125;</code></pre><p>å¯èƒ½æœ‰äº›åŒå­¦å¯¹æ­£åˆ™ä¸å¤ªç†Ÿæ‚‰ï¼Œä»¥ä¸‹å¯¹è¿™ä¸ªæ­£åˆ™åšä¸€ä¸‹è§£é‡Šï¼š</p><ol><li><code>.*</code>ï¼š . è¡¨ç¤ºéæ¢è¡Œç¬¦å·ï¼Œ * ç”¨äºæ¶ˆè€—å°½å¯èƒ½å¤šçš„å­—ç¬¦</li><li><code>()</code> æ‹¬å·è¡¨ç¤ºæ•è·ç»„ï¼Œè¿™é‡Œ <code>()</code> ä¸­çš„è¡¨è¾¾å¼å°±æ˜¯ç”¨äºæ•è·åç¼€åã€‚</li><li><code>\.</code> è¡¨ç¤º . çš„è½¬ä¹‰</li><li><code>[^\?+]</code>: ^ è¡¨ç¤ºéï¼Œ + è¡¨ç¤ºä¸€ä¸ªæˆ–è€…å¤šä¸ªã€‚å› æ­¤ <code>[^?+]</code> å³è¡¨ç¤ºé ï¼Ÿçš„å¤šä¸ªå­—ç¬¦</li></ol><h4 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h4><p>å¦‚æœæ˜¯åœ¨ node çš„ç¯å¢ƒï¼Œæœ¬åœ°çš„æ–‡ä»¶åå¯ä»¥é€šè¿‡ path æ¨¡å—æä¾›çš„ extname è·å–ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const &#123; extname &#125; &#x3D; require(&#39;path&#39;)console.log(extname(&#39;some-pic.jpg&#39;))&#x2F;&#x2F; .jpg</code></pre><p>é‚£å¦‚æœæ˜¯è¿œç¨‹åœ°å€å‘¢ï¼Ÿå¯ä»¥é€šè¿‡ url æ¨¡å—å¾—åˆ° pathname ä¹‹åå†ç”¨ extname æ¥è·å–ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const &#123; extname &#125; &#x3D; require(&#39;path&#39;)const &#123; parse &#125; &#x3D; require(&#39;url&#39;);const getExtension &#x3D; (url &#x3D; &#39;&#39;) &#x3D;&gt; extname(parse(url).pathname)</code></pre>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TypeScriptä¸­çš„constæ–­è¨€</title>
      <link href="/2020/08/26/TypeScript%E4%B8%AD%E7%9A%84const%E6%96%AD%E8%A8%80/"/>
      <url>/2020/08/26/TypeScript%E4%B8%AD%E7%9A%84const%E6%96%AD%E8%A8%80/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>æœ€è¿‘åœ¨ä½¿ç”¨ ant design çš„ Table ç»„ä»¶ï¼Œé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå®šä¹‰ Table çš„ columns å±æ€§å¦‚ä¸‹ï¼š</p><a id="more"></a><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">const columns: ColumnProps&lt;MyRecord&gt;[] &#x3D; [&#123;  title: &#39;ID&#39;,  dataIndex: &#39;id&#39;,  align: &#39;center&#39;,&#125;]</code></pre><p>æ­¤æ—¶ TS æç¤ºï¼š</p><pre class="line-numbers language-none"><code class="language-none">Types of property &#39;align&#39; are incompatible.        Type &#39;string&#39; is not assignable to type &#39;&quot;right&quot; | &quot;left&quot; | &quot;center&quot; | undefined&#39;.  TS2322</code></pre><h4 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h4><p>ç»è¿‡æŸ¥çœ‹ä»£ç å‘ç°ï¼Œ ColumnProps çš„ align å±æ€§çš„å®é™…ç»§æ‰¿è‡ª ColumnSharedTypeï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">interface ColumnSharedType&lt;RecordType&gt; &#123;    &#x2F;&#x2F; ...    align?: AlignType;&#125;export declare type AlignType &#x3D; &#39;left&#39; | &#39;center&#39; | &#39;right&#39;;</code></pre><p>ä¹Ÿå°±æ˜¯ column ä¸­çš„ align çš„ç±»å‹ä¸º stringï¼Œè€Œ string æ— æ³• cast åˆ° AlignTypeã€‚å³ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">type AlignType &#x3D; &#39;left&#39; | &#39;center&#39; | &#39;right&#39;;let align: AlignType | undefinedlet myAlign &#x3D; &quot;center&quot;&#x2F;&#x2F; Type &#39;string&#39; is not assignable to type &#39;&quot;left&quot; | &quot;right&quot; | &quot;center&quot; | undefined&#39;.ts(2322)align &#x3D; myAlign</code></pre><h4 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h4><p>TypeScript 3.4 ç‰ˆæœ¬ä»¥ä¸Šæä¾›äº† const æ–­è¨€ï¼Œå¯ä»¥é€šè¿‡ as const æ¥æ¶ˆé™¤ä»¥ä¸ŠæŠ¥é”™ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">const columns: ColumnProps&lt;MyRecord&gt;[] &#x3D; [&#123;  title: &#39;ID&#39;,  dataIndex: &#39;id&#39;,  align: &#39;center&#39; as const,&#125;]</code></pre><h4 id="const-assertions"><a href="#const-assertions" class="headerlink" title="const assertions"></a>const assertions</h4><p>ä»¥ä¸‹å†…å®¹ç¿»è¯‘è‡ª <a href="https://devblogs.microsoft.com/typescript/announcing-typescript-3-4-rc/">https://devblogs.microsoft.com/typescript/announcing-typescript-3-4-rc/</a> ä¸­çš„ <code>const</code> assertionsã€‚(ç¿»è¯‘ä¸åŠ¨çš„åœ°æ–¹ä¼šè´´ä¸ŠåŸæ–‡)</p><p>å½“å£°æ˜ä¸€ä¸ªå¯å˜çš„å˜é‡æˆ–è€…å±æ€§æ—¶ï¼ŒTypeScript ç»å¸¸æ‹“å®½å€¼ä»¥ç¡®ä¿æˆ‘ä»¬å¯ä»¥åœ¨ä¸å†™æ˜ç¡®åˆ‡çš„ç±»å‹çš„æƒ…å†µä¸‹è¿›è¡Œèµ‹å€¼ã€‚</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">let x &#x3D; &quot;hello&quot;;&#x2F;&#x2F; æˆ‘ä»¬å¯ä»¥ç»™ x èµ‹å€¼x &#x3D; &quot;world&quot;;</code></pre><p>ä¸¥æ ¼æ¥è¯´ï¼Œæ¯ä¸€ä¸ªå­—é¢é‡éƒ½æœ‰å…¶å­—é¢ç±»å‹ã€‚ä¸Šé¢çš„ x åœ¨ç±»å‹æ¨æ–­æ—¶ï¼Œç”± <code>&quot;hello&quot;</code> ç±»å‹è½¬ä¸ºæ›´ä¸º widen çš„ <code>string</code> ç±»å‹ã€‚</p><p>ç›¸å¯¹è€Œè¨€ï¼Œå¦‚æœ x åŸå§‹å­—é¢é‡ç±»å‹ä¸º â€œhelloâ€ï¼Œ é‚£ä¹ˆæˆ‘ä»¬å°±æ— æ³•å°† x èµ‹å€¼ä¸º â€œworldâ€:</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">let x: &quot;hello&quot; &#x3D; &quot;hello&quot;;&#x2F;&#x2F; error!x &#x3D; &quot;world&quot;;</code></pre><p>ä¸Šé¢çš„æƒ…å†µçœ‹èµ·æ¥æ¯”è¾ƒæç«¯ï¼Œä½†æ˜¯åœ¨ä¸€äº›æƒ…å†µä¸‹æ¯”è¾ƒæœ‰ç”¨çš„ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬ç»å¸¸åˆ›å»ºä¸€ä¸ªè”åˆå±æ€§çš„å¯¹è±¡ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">type Shape &#x3D;    | &#123; kind: &quot;circle&quot;, radius: number &#125;    | &#123; kind: &quot;square&quot;, sideLength: number &#125;function getShapes(): readonly Shape[] &#123;    let result &#x3D; [        &#123; kind: &quot;circle&quot;, radius: 100, &#125;,        &#123; kind: &quot;square&quot;, sideLength: 50, &#125;,    ];        &#x2F;&#x2F; Some terrible error message because TypeScript inferred    &#x2F;&#x2F; &#39;kind&#39; to have the type &#39;string&#39; instead of    &#x2F;&#x2F; either &#39;&quot;circle&quot;&#39; or &#39;&quot;square&quot;&#39;.    return result;&#125;</code></pre><p>å¯ä¿®æ”¹æ€§æ˜¯ TypeScript æ–­å®šä»€ä¹ˆæ—¶å€™ widen ç±»å‹çš„é‡è¦å› ç´ ï¼Œè€Œéåˆ†ææ‰€æœ‰ä»£ç ã€‚ï¼ˆMutability is one of the best heuristics of intent which TypeScript can use to determine when to widen (rather than analyzing our entire program).ï¼‰</p><p>æ­£å¦‚ä¸Šè¿°ä¾‹å­ï¼Œä¸å¹¸çš„æ˜¯ï¼ŒJavaScript ä¸­çš„å±æ€§é»˜è®¤å¯ä¿®æ”¹ã€‚è¿™æ„å‘³ç€ç»å¸¸ä¼šæœ‰ä¸å¿…è¦çš„ widen ç±»å‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç‰¹å®šçš„åœ°æ–¹å¯¹ç±»å‹è¿›è¡Œç¡®åˆ‡çš„å£°æ˜ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">function getShapes(): readonly Shape[] &#123;  &#x2F;&#x2F; This explicit annotation gives a hint  &#x2F;&#x2F; to avoid widening in the first place.  let result: readonly Shape[] &#x3D; [  &#123; kind: &quot;circle&quot;, radius: 100, &#125;,  &#123; kind: &quot;square&quot;, sideLength: 50, &#125;,  ];  return result;&#125;</code></pre><p>ä¸Šè¿°çš„æ–¹æ³•å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯å½“æ•°æ®ç»“æ„è¶Šæ¥è¶Šå¤æ‚çš„æ—¶å€™ï¼Œè¿™ç§æ–¹å¼å°†ä¼šæ˜¾çš„ç¬¨é‡ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒTypeScript 3.4 ä¸ºå­—é¢å€¼å¼•å…¥äº† const æ–­è¨€ã€‚å®ƒçš„è¯­æ³•æ˜¯ä¸€ç§ç±»å‹æ–­è¨€ï¼Œä¾‹å¦‚ <code>123 as const</code>ã€‚å½“æˆ‘ä»¬è¿™ä¹ˆä½¿ç”¨çš„æ—¶å€™ï¼Œæ„å‘³ç€ï¼š</p><ol><li>å­—é¢é‡ç±»å‹ä¸ä¼šè¢« widenï¼Œå¦‚ä¸ä¼šä» â€œhelloâ€ å˜æˆ string</li><li>å¯¹è±¡å­—é¢é‡çš„å±æ€§å€¼ä¸ºåªè¯»</li><li>æ•°ç»„å­—é¢é‡å˜æˆåªè¯»å…ƒç»„</li></ol><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">&#x2F;&#x2F; Type &#39;10&#39;let x &#x3D; 10 as const;&#x2F;&#x2F; Type &#39;readonly [10, 20]&#39;let y &#x3D; [10, 20] as const;&#x2F;&#x2F; Type &#39;&#123; readonly text: &quot;hello&quot; &#125;&#39;let z &#x3D; &#123; text: &quot;hello&quot; &#125; as const;</code></pre><p>åœ¨ tsx æ–‡ä»¶ä»¥å¤–ï¼Œè¿˜å¯ä»¥è¿™ä¹ˆä½¿ç”¨ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">&#x2F;&#x2F; Type &#39;10&#39;let x &#x3D; &lt;const&gt;10;&#x2F;&#x2F; Type &#39;readonly [10, 20]&#39;let y &#x3D; &lt;const&gt;[10, 20];&#x2F;&#x2F; Type &#39;&#123; readonly text: &quot;hello&quot; &#125;&#39;let z &#x3D; &lt;const&gt;&#123; text: &quot;hello&quot; &#125;;</code></pre><p>This feature often means that types that would otherwise be used just to hint immutability to the compiler can often be omitted.</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">&#x2F;&#x2F; Works with no types referenced or declared.&#x2F;&#x2F; We only needed a single const assertion.function getShapes() &#123;    let result &#x3D; [        &#123; kind: &quot;circle&quot;, radius: 100, &#125;,        &#123; kind: &quot;square&quot;, sideLength: 50, &#125;,    ] as const;        return result;&#125;for (const shape of getShapes()) &#123;    &#x2F;&#x2F; Narrows perfectly!    if (shape.kind &#x3D;&#x3D;&#x3D; &quot;circle&quot;) &#123;        console.log(&quot;Circle radius&quot;, shape.radius);    &#125;    else &#123;        console.log(&quot;Square side length&quot;, shape.sideLength);    &#125;&#125;</code></pre><p>æ³¨æ„ä¸Šé¢æ— éœ€ç±»å‹å£°æ˜ï¼Œconst æ–­è¨€å…è®¸ ts ä½¿ç”¨æœ€ç²¾ç¡®çš„è¡¨è¾¾å¼ç±»å‹ã€‚</p><h5 id="è­¦å‘Š"><a href="#è­¦å‘Š" class="headerlink" title="è­¦å‘Š"></a>è­¦å‘Š</h5><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œconst æ–­è¨€åªèƒ½ä½¿ç”¨åœ¨ç®€å•çš„å­—é¢è¡¨è¾¾å¼ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">&#x2F;&#x2F; Error!&#x2F;&#x2F;   A &#39;const&#39; assertion can only be applied to a string, number, boolean, array, or object literal.let a &#x3D; (Math.random() &lt; 0.5 ? 0 : 1) as const;&#x2F;&#x2F; Works!let b &#x3D; Math.random() &lt; 0.5 ?    0 as const :    1 as const;</code></pre><p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œconst ä¸ä¼šå°†è¡¨è¾¾å¼è½¬å˜ä¸ºå®Œå…¨ä¸å¯å˜ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">et arr &#x3D; [1, 2, 3, 4];let foo &#x3D; &#123;    name: &quot;foo&quot;,    contents: arr,&#125;;foo.name &#x3D; &quot;bar&quot;;   &#x2F;&#x2F; error!foo.contents &#x3D; [];  &#x2F;&#x2F; error!foo.contents.push(5); &#x2F;&#x2F; ...works!</code></pre>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸å˜çš„æ‰¿è¯º Promise</title>
      <link href="/2020/08/25/%E4%B8%8D%E5%8F%98%E7%9A%84%E6%89%BF%E8%AF%BA%20Promise/"/>
      <url>/2020/08/25/%E4%B8%8D%E5%8F%98%E7%9A%84%E6%89%BF%E8%AF%BA%20Promise/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>Promise æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥è§£å†³å‰ç«¯çš„å›è°ƒåœ°ç‹±ã€‚ä»¥ä¸‹æ ¹æ® <a href="https://es6.ruanyifeng.com/?search=promise&x=0&y=0#docs/promise">ES6 å…¥é—¨</a> ç®€å•è¿‡ä¸€ä¸‹ Promise çš„åŸºç¡€åŠä¸ªäººçš„ä¸€äº›è§è§£è¡¥å……ï¼ŒåŒæ—¶å°è¯•å®ç°ä¸€ä¸ªç¬¦åˆ PromiseA+ è§„èŒƒçš„ Promiseã€‚</p> <a id="more"></a><h4 id="Promise-åŸºç¡€"><a href="#Promise-åŸºç¡€" class="headerlink" title="Promise åŸºç¡€"></a>Promise åŸºç¡€</h4><h5 id="Promise-çš„çŠ¶æ€"><a href="#Promise-çš„çŠ¶æ€" class="headerlink" title="Promise çš„çŠ¶æ€"></a>Promise çš„çŠ¶æ€</h5><p>Promise åªæœ‰ä¸‰ç§çŠ¶æ€ï¼š<code>pending</code>ï¼ˆè¿›è¡Œä¸­ï¼‰ï¼Œ<code>fulfilled</code>ï¼ˆå·²æˆåŠŸï¼‰å’Œ <code>rejected</code>ï¼ˆå·²å¤±è´¥ï¼‰ã€‚</p><p>Promise çš„çŠ¶æ€æ”¹å˜åªæœ‰ä¸¤ç§æƒ…å†µï¼š</p><p><code>pending</code> åˆ° <code>fulfilled</code> ä»¥åŠ <code>pending</code> åˆ° <code>rejected</code>ã€‚å½“çŠ¶æ€å˜æˆ  <code>fulfilled</code> æˆ– <code>rejected</code>æ—¶ï¼Œæˆ‘ä»¬å°±ç§°è¿™ä¸ª Promise  <code>resolved</code>ã€‚</p><p>âš ï¸ æˆ‘ä»¬é€šå¸¸è¯´çš„ resolved ä»…æŒ‡ä»£ <code>fulfilled</code>ï¼Œä¸åŒ…æ‹¬ <code>rejected</code>ã€‚</p><h5 id="æ„é€ ä¸€ä¸ª-Promise"><a href="#æ„é€ ä¸€ä¸ª-Promise" class="headerlink" title="æ„é€ ä¸€ä¸ª Promise"></a>æ„é€ ä¸€ä¸ª Promise</h5><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const promise &#x3D; new Promise(function(resolve, reject) &#123;  &#x2F;&#x2F; ... some code  if (&#x2F;* å¼‚æ­¥æ“ä½œæˆåŠŸ *&#x2F;)&#123;    resolve(value);  &#125; else &#123;    reject(error);  &#125;&#125;);</code></pre><h5 id="promise-then"><a href="#promise-then" class="headerlink" title="promise.then"></a>promise.then</h5><p>Promise çš„å®ä¾‹æ‹¥æœ‰ then æ–¹æ³•ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">promise.then(function(value) &#123;  &#x2F;&#x2F; success&#125;, function(error) &#123;  &#x2F;&#x2F; failure&#125;);</code></pre><p>âš ï¸  Promise æ–°å»ºåç«‹å³æ‰§è¡Œï¼Œè€Œ then æ–¹æ³•åˆ™å±äºå¾®ä»»åŠ¡çš„å›è°ƒï¼Œæ‰§è¡Œæ—¶æœºä¸ºå®ä»»åŠ¡æ‰§è¡Œä¹‹åï¼Œå…·ä½“çš„äº‹ä»¶å¾ªç¯æœºåˆ¶åé¢å¼€æ–°å‘æ€»ç»“ã€‚</p><h5 id="resolve"><a href="#resolve" class="headerlink" title="resolve"></a>resolve</h5><p>æ„é€  Promise æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•° resolve å‡½æ•°æ‰€æ¥æ”¶çš„å‚æ•°ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæ™®é€šçš„å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª promiseã€‚å¦‚æœæ¥æ”¶çš„æ˜¯ä¸€ä¸ª promise å®ä¾‹ï¼Œé‚£ä¹ˆ promise çš„çŠ¶æ€å–å†³äº resolve æ¥æ”¶çš„ promise çš„çŠ¶æ€ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const p1 &#x3D; new Promise(function (resolve, reject) &#123;  setTimeout(() &#x3D;&gt; reject(new Error(&#39;fail&#39;)), 3000)&#125;)const p2 &#x3D; new Promise(function (resolve, reject) &#123;  setTimeout(() &#x3D;&gt; resolve(p1), 1000)&#125;)p2  .then(result &#x3D;&gt; console.log(result))  .catch(error &#x3D;&gt; console.log(error))&#x2F;&#x2F; 3s åè¾“å‡ºï¼šError: fail</code></pre><p>è¿™æ—¶<code>p1</code>çš„çŠ¶æ€å°±ä¼šä¼ é€’ç»™<code>p2</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>p1</code>çš„çŠ¶æ€å†³å®šäº†<code>p2</code>çš„çŠ¶æ€ã€‚å¦‚æœ<code>p1</code>çš„çŠ¶æ€æ˜¯<code>pending</code>ï¼Œé‚£ä¹ˆ<code>p2</code>çš„å›è°ƒå‡½æ•°å°±ä¼šç­‰å¾…<code>p1</code>çš„çŠ¶æ€æ”¹å˜ï¼›å¦‚æœ<code>p1</code>çš„çŠ¶æ€å·²ç»æ˜¯<code>resolved</code>æˆ–è€…<code>rejected</code>ï¼Œé‚£ä¹ˆ<code>p2</code>çš„å›è°ƒå‡½æ•°å°†ä¼šç«‹åˆ»æ‰§è¡Œã€‚</p><h5 id="resolve-ä¸-return"><a href="#resolve-ä¸-return" class="headerlink" title="resolve ä¸ return"></a>resolve ä¸ return</h5><p>è°ƒç”¨<code>resolve</code>æˆ–<code>reject</code>å¹¶ä¸ä¼šç»ˆç»“ Promise çš„å‚æ•°å‡½æ•°çš„æ‰§è¡Œï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">new Promise((resolve, reject) &#x3D;&gt; &#123;  resolve(1);  console.log(2);&#125;).then(r &#x3D;&gt; &#123;  console.log(r);&#125;);&#x2F;&#x2F; 2&#x2F;&#x2F; 1</code></pre><p>ä¸€èˆ¬æ¥è¯´ï¼Œè°ƒç”¨<code>resolve</code>æˆ–<code>reject</code>ä»¥åï¼ŒPromise çš„ä½¿å‘½å°±å®Œæˆäº†ï¼Œåç»§æ“ä½œåº”è¯¥æ”¾åˆ°<code>then</code>æ–¹æ³•é‡Œé¢ï¼Œè€Œä¸åº”è¯¥ç›´æ¥å†™åœ¨<code>resolve</code>æˆ–<code>reject</code>çš„åé¢ã€‚æ‰€ä»¥ï¼Œæœ€å¥½åœ¨å®ƒä»¬å‰é¢åŠ ä¸Š<code>return</code>:</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">new Promise((resolve, reject) &#x3D;&gt; &#123;  return resolve(1);  &#x2F;&#x2F; åé¢çš„è¯­å¥ä¸ä¼šæ‰§è¡Œ  console.log(2);&#125;)</code></pre><h5 id="catch"><a href="#catch" class="headerlink" title=".catch"></a>.catch</h5><ol><li><p><code>Promise.prototype.catch()</code>æ–¹æ³•æ˜¯<code>.then(null | undefined, rejection)</code>ï¼Œç”¨äºæŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶çš„å›è°ƒå‡½æ•°ã€‚</p></li><li><p>Promise å¯¹è±¡çš„é”™è¯¯å…·æœ‰â€œå†’æ³¡â€æ€§è´¨ï¼Œä¼šä¸€ç›´å‘åä¼ é€’ï¼Œç›´åˆ°è¢«æ•è·ä¸ºæ­¢ï¼Œå³é”™è¯¯æ€»æ˜¯ä¼šè¢«ä¸‹ä¸€ä¸ª<code>catch</code>è¯­å¥æ•è·ã€‚</p></li><li><p><code>catch()</code>æ–¹æ³•è¿”å›çš„è¿˜æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå› æ­¤åé¢è¿˜å¯ä»¥æ¥ç€è°ƒç”¨<code>then()</code>ä¸ <code>catch()</code> æ–¹æ³•ã€‚</p></li><li><p>promise å†…éƒ¨çš„é”™è¯¯ä¸ä¼šæŠ›åˆ°å¤–å±‚ï¼Œå› æ­¤ <code>try/catch</code> æ— æ³•æ•è·ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">try &#123;   const p2 &#x3D; new Promise((resolve, reject) &#x3D;&gt; &#123;        throw &#39;err&#39;    &#125;)    console.log(&#39;out&#39;)&#125; catch(e) &#123;    console.log(&#39;catch you&#39;, e)&#125;&#x2F;&#x2F; out&#x2F;&#x2F; æœªæ•è·çš„å¼‚å¸¸ï¼šUncaught (in promise) err</code></pre><p>å› æ­¤æœ€å¥½ promise åéƒ½ç”¨ catch æ¥æ•è·ã€‚</p></li></ol><h5 id="finally"><a href="#finally" class="headerlink" title=".finally()"></a>.finally()</h5><ul><li>ES2018 å¼•å…¥ï¼Œå³ä¸ç®¡ Promise å¯¹è±¡æœ€åçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œã€‚</li><li><code>finally</code>æ–¹æ³•çš„å›è°ƒå‡½æ•°ä¸æ¥å—ä»»ä½•å‚æ•°</li></ul><h4 id="æ‰‹å†™ä¸€ä¸ªç®€æ˜“çš„-Promise"><a href="#æ‰‹å†™ä¸€ä¸ªç®€æ˜“çš„-Promise" class="headerlink" title="æ‰‹å†™ä¸€ä¸ªç®€æ˜“çš„ Promise"></a>æ‰‹å†™ä¸€ä¸ªç®€æ˜“çš„ Promise</h4><p>æ‰‹å†™ä¸€ä¸ªç¬¦åˆ PromiseA+ è§„èŒƒçš„ Promise å¹¶ä¸ç®€å•ï¼Œå¯ä»¥å…ˆç®€å•æ ¹æ®ä¸Šè¿° promise çš„åŸºæœ¬åŠŸèƒ½å®ç°ä¸€ä¸ª<strong>ç®€æ˜“ç‰ˆæœ¬</strong>ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const PENDING &#x3D; &#39;pending&#39;const RESOLVED &#x3D; &#39;resolved&#39;const REJECTED &#x3D; &#39;rejected&#39;class MyPromise &#123;  constructor(fn) &#123;    this.state &#x3D; PENDING    &#x2F;&#x2F; æ”¶é›† .then ä¸­çš„ resolve çš„å›è°ƒå‡½æ•°    this.resolveCallbacks &#x3D; []    &#x2F;&#x2F; æ”¶é›† .then ä¸­çš„ reject çš„å›è°ƒå‡½æ•°    this.rejectCallbacks &#x3D; []    &#x2F;&#x2F; resolve(result)    this.result &#x3D; null    &#x2F;&#x2F; reject(reason)    this.reason &#x3D; null    &#x2F;&#x2F; ç”±äº fn æœ‰å¯èƒ½å¼‚å¸¸ï¼Œéœ€è¦æ•è·    try &#123;      &#x2F;&#x2F; Promise ä¸€å®ä¾‹åŒ–å°±æ‰§è¡Œä¼ å…¥çš„ fn      &#x2F;&#x2F; æ³¨æ„æ­¤å¤„å°†å‡½æ•°å½“ä½œå‚æ•°ä¼ å…¥ï¼Œéœ€è¦ bind ç»‘å®šä¸Šä¸‹æ–‡      &#x2F;&#x2F; æˆ–è€… resolve &#x2F; reject ç”¨ç®­å¤´å‡½æ•°å®ç°      fn(this.resolve.bind(this), this.reject.bind(this))    &#125; catch (error) &#123;      this.reject(error)    &#125;  &#125;  resolve(result) &#123;    if (this.state &#x3D;&#x3D;&#x3D; PENDING) &#123;      &#x2F;&#x2F; ä¿®æ”¹çŠ¶æ€      this.state &#x3D; RESOLVED      this.result &#x3D; result      &#x2F;&#x2F; æ‰§è¡Œ then ä¸­çš„ resolve å›è°ƒå‡½æ•°      this.resolveCallbacks.forEach((cb) &#x3D;&gt; cb(result))    &#125;  &#125;  reject(reason) &#123;    if (this.state &#x3D;&#x3D;&#x3D; PENDING) &#123;      &#x2F;&#x2F; ä¿®æ”¹çŠ¶æ€      this.state &#x3D; REJECTED      this.reason &#x3D; reason      &#x2F;&#x2F; æ‰§è¡Œ then ä¸­çš„ reject å›è°ƒå‡½æ•°      this.rejectCallbacks.forEach((cb) &#x3D;&gt; cb(reason))    &#125;  &#125;  then(onFulfilled, onRejected) &#123;    &#x2F;&#x2F; è°ƒç”¨ .then æ—¶å¦‚æœè¿˜åœ¨ pending åˆ™å°†å›è°ƒå…ˆå­˜èµ·æ¥ï¼Œç­‰å¾… resolve åæ‰§è¡Œ    if (this.state &#x3D;&#x3D;&#x3D; PENDING) &#123;      &#x2F;&#x2F; æ”¶é›†å›è°ƒ      this.resolveCallbacks.push(onFulfilled)      this.rejectCallbacks.push(onRejected)    &#125;    &#x2F;&#x2F; å¦‚æœè°ƒç”¨ .then æ—¶å·²ç» resolve &#x2F; reject, é‚£ä¹ˆç›´æ¥æ‰§è¡Œå¯¹åº”çš„å›è°ƒ    if (this.state &#x3D;&#x3D;&#x3D; RESOLVED) &#123;      onFulfilled(this.result)    &#125;    if (this.state &#x3D;&#x3D;&#x3D; REJECTED) &#123;      onRejected(this.reason)    &#125;  &#125;&#125;</code></pre><p>æµ‹è¯•ä»£ç ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const myPromise &#x3D; new MyPromise((resolve, reject) &#x3D;&gt; &#123;  setTimeout(() &#x3D;&gt; &#123;    resolve(&#39;resolved&#39;)  &#125;, 3000)&#125;)myPromise.then(  (result) &#x3D;&gt; &#123;    console.log(result)  &#125;,  (reason) &#x3D;&gt; &#123;    console.log(reason)  &#125;)</code></pre><p>Promise çš„è®¾è®¡æ€è·¯å®é™…ä¸Šå°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ï¼šæ”¶é›†å›è°ƒå‡½æ•°ï¼Œè§¦å‘é€šçŸ¥ï¼Œä¾æ¬¡æ‰§è¡Œå›è°ƒã€‚</p><p>ä¸Šè¿°ç‰ˆæœ¬è¿˜æœªèƒ½è¾¾åˆ° Promise / A+ çš„è§„èŒƒï¼Œæ¯”å¦‚ é“¾å¼è°ƒç”¨ ç­‰ã€‚</p><h4 id="ç¬¦åˆ-Promise-A-çš„-Promise"><a href="#ç¬¦åˆ-Promise-A-çš„-Promise" class="headerlink" title="ç¬¦åˆ Promise / A+ çš„ Promise"></a>ç¬¦åˆ Promise / A+ çš„ Promise</h4><p>å‚è€ƒ <a href="https://promisesaplus.com/">Promise / A+</a> ï¼Œä»¥ä¸‹è¿˜éœ€è¦è¡¥å……ä¸‹é¢å‡ ç‚¹ï¼š</p><ol><li>then æ–¹æ³•çš„å‚æ•°å¯é€‰</li><li><code>onFulfilled</code> å’Œ <code>onRejected</code>æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ <code>setTimeout</code> æˆ– <code>setImmediate</code> ä¹‹ç±»çš„â€œå®ä»»åŠ¡â€æœºåˆ¶ï¼Œæˆ–è€…ä½¿ç”¨è¯¸å¦‚ <code>MutationObserver</code> æˆ– <code>process.nextTick</code> ä¹‹ç±»çš„â€œå¾®ä»»åŠ¡â€æœºåˆ¶æ¥å®ç°ã€‚</li><li>é“¾å¼è°ƒç”¨ ä¸ promise è§£å†³æ­¥éª¤</li></ol><h5 id="å€¼ç©¿é€"><a href="#å€¼ç©¿é€" class="headerlink" title="å€¼ç©¿é€"></a>å€¼ç©¿é€</h5><p>é’ˆå¯¹ then çš„å‚æ•°å¯é€‰è¿™ä¸€ç‚¹ï¼Œå¦‚æœ <code>onFulfilled</code>  å’Œ <code>onRejectd</code> ä¸æ˜¯å‡½æ•°ï¼Œåˆ™ä¼šè¢«å¿½ç•¥ï¼Œå¹¶ä¸”å°†å€¼ä¼ é€’ç»™ä¸‹ä¸€ä¸ª thenã€‚å³æ‰€è°“çš„å€¼ç©¿é€ï¼Œå¯¹ <code>then</code> è¿›è¡Œæ”¹é€ :</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">then(onFulfilled, onRejected) &#123;  &#x2F;&#x2F; å¦‚æœä¸æ˜¯å‡½æ•°ï¼Œä¼ é€’ result    onFulfilled &#x3D;      typeof onFulfilled &#x3D;&#x3D;&#x3D; &#39;function&#39; ? onFulfilled : (result) &#x3D;&gt; result  &#x2F;&#x2F; å¦‚æœä¸æ˜¯å‡½æ•°ï¼ŒæŠ›å‡º reason    onRejected &#x3D;      typeof onRejected &#x3D;&#x3D;&#x3D; &#39;function&#39;        ? onRejected        : (reason) &#x3D;&gt; &#123;            throw reason          &#125;  &#x2F;&#x2F; ... if (this.state &#x3D;&#x3D;&#x3D; PENDING) ... &#125;</code></pre><p>å½“ç„¶å½“å‰çš„ç®€æ˜“ç‰ˆ promise è¿˜ä¸æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œå€¼ç©¿é€ä¹Ÿå°±æ— ä»è°ˆèµ·ã€‚</p><h5 id="å¼‚æ­¥æ‰§è¡Œ"><a href="#å¼‚æ­¥æ‰§è¡Œ" class="headerlink" title="å¼‚æ­¥æ‰§è¡Œ"></a>å¼‚æ­¥æ‰§è¡Œ</h5><p>åœ¨å®ç°é“¾å¼è°ƒç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬å®Œå–„ä»£ç ï¼Œä½¿å¾—<code>onFulfilled</code> å’Œ <code>onRejected</code>æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚</p><p>å½“å‰æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">var myPromise &#x3D; new MyPromise((resolve, reject) &#x3D;&gt; &#123;  resolve(1)&#125;)myPromise.then(  (val) &#x3D;&gt; &#123;    console.log(val)  &#125;,  (val) &#x3D;&gt; &#123;    console.log(val)  &#125;)console.log(2)</code></pre><p>ç°è¾“å‡º 1 å†è¾“å‡º 2ï¼Œæ˜¾ç„¶ä¸æ˜¯å¼‚æ­¥çš„ã€‚æ ¹æ® Promise/ A+ çš„è§„èŒƒï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ setTimeout æ¥æ”¹é€  resolve å’Œ reject ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; ...resolve(result) &#123;  &#x2F;&#x2F; é€šè¿‡ setTimeout æ¨¡æ‹Ÿå¼‚æ­¥  setTimeout(() &#x3D;&gt; &#123;    if (this.state &#x3D;&#x3D;&#x3D; PENDING) &#123;      &#x2F;&#x2F; ...    &#125;  &#125;)&#125;reject(reason) &#123;    &#x2F;&#x2F; é€šè¿‡ setTimeout æ¨¡æ‹Ÿå¼‚æ­¥  setTimeout(() &#x3D;&gt; &#123;    if (this.state &#x3D;&#x3D;&#x3D; PENDING) &#123;       &#x2F;&#x2F; ...    &#125;  &#125;)&#125;&#x2F;&#x2F; ...</code></pre><p>è‡³æ­¤ï¼Œè¾“å‡ºé¡ºåºå°†æ˜¯ 2, 1ã€‚ ç¬¦åˆé¢„æœŸ</p><h5 id="é“¾å¼è°ƒç”¨"><a href="#é“¾å¼è°ƒç”¨" class="headerlink" title="é“¾å¼è°ƒç”¨"></a>é“¾å¼è°ƒç”¨</h5><p>ç°åœ¨æ¥å®ç°é“¾å¼è°ƒç”¨ï¼š</p><ol><li><code>then</code> éœ€è¦è¿”å›ä¸€ä¸ª Promise</li><li><code>then</code> æ‹¿åˆ°ä¸Šä¸€æ¬¡ then çš„è¿”å›å€¼</li><li>å¦‚æœ then è¿”å›çš„æ˜¯ä¸€ä¸ª Promise åˆ™éœ€è¦ç­‰å¾…è¯¥ promise çŠ¶æ€å‘ç”Ÿå˜åŒ–åå†æ‰§è¡Œä¸‹ä¸€ä¸ª then</li></ol><p>promise2: æˆ‘ä»¬å°† then è¿”å›çš„ promise å‘½åä¸º promise2, å³ <code>promise2 = promise1.then(onFulfilled, onRejected);</code></p><p>x: å°† onFulfilled æˆ–è€… onRejected çš„è¿”å›å€¼å‘½åä¸º xï¼Œè¿™ä¸ª x å¯ä»¥æ˜¯ä¸€ä¸ª thenableã€‚</p><p>resolutionProcedure: promise è§£å†³æ­¥éª¤ã€‚å¦‚æœ <code>x</code> å…·æœ‰ thenable ç‰¹æ€§ï¼Œæˆ‘ä»¬å°±å‡è®¾ <code>x</code> çš„è¡Œä¸ºè‡³å°‘æœ‰ç‚¹åƒ promiseï¼Œå®ƒå°†è¯•å›¾ä½¿ promise æ¥æ”¶ <code>x</code> çš„çŠ¶æ€ã€‚å¦åˆ™ï¼Œå®ƒä½¿ç”¨å€¼ <code>x</code> æ‰§è¡Œ <code>promise</code>ã€‚ä¹‹æ‰€ä»¥æ˜¯ thenable æ˜¯ä¸ºäº†å¯ä»¥å…¼å®¹åˆ«çš„ promiseï¼ˆä¾‹å¦‚ fetchï¼‰ã€‚å®é™…ä¸Šè¿™ä¸ªæ–¹æ³•åœ¨ Promise / A+ ä¸­æœ‰å¾ˆå¤šæƒ…å†µåˆ†å‰ï¼Œæˆ‘ä»¬å…ˆç®€åŒ–æˆä»¥ä¸‹ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; åˆ†ç±»è®¨è®ºè¿”å›å€¼,å¦‚æœæ˜¯Promise,é‚£ä¹ˆç­‰å¾…PromiseçŠ¶æ€å˜æ›´, å¦åˆ™ç›´æ¥resolvex instanceof MyPromise ? x.then(resolve, reject) : resolve(x)</code></pre><p>ç°åœ¨çš„ Promise å®Œæ•´ä»£ç å¦‚ä¸‹ï¼Œ<strong>æ¥è¿‘å®Œå…¨ä½“ç‰ˆæœ¬</strong>ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const PENDING &#x3D; &#39;pending&#39;const RESOLVED &#x3D; &#39;resolved&#39;const REJECTED &#x3D; &#39;rejected&#39;class MyPromise &#123;  constructor(fn) &#123;    this.state &#x3D; PENDING    &#x2F;&#x2F; æ”¶é›† .then ä¸­çš„ resolve çš„å›è°ƒå‡½æ•°    this.resolveCallbacks &#x3D; []    &#x2F;&#x2F; æ”¶é›† .then ä¸­çš„ reject çš„å›è°ƒå‡½æ•°    this.rejectCallbacks &#x3D; []    &#x2F;&#x2F; resolve(result)    this.result &#x3D; null    &#x2F;&#x2F; reject(reason)    this.reason &#x3D; null    &#x2F;&#x2F; ç”±äº fn æœ‰å¯èƒ½å¼‚å¸¸ï¼Œéœ€è¦æ•è·    try &#123;      &#x2F;&#x2F; Promise ä¸€å®ä¾‹åŒ–å°±æ‰§è¡Œä¼ å…¥çš„ fn      &#x2F;&#x2F; æ³¨æ„æ­¤å¤„å°†å‡½æ•°å½“ä½œå‚æ•°ä¼ å…¥ï¼Œéœ€è¦ bind ç»‘å®šä¸Šä¸‹æ–‡      &#x2F;&#x2F; æˆ–è€… resolve &#x2F; reject ç”¨ç®­å¤´å‡½æ•°å®ç°      fn(this.resolve.bind(this), this.reject.bind(this))    &#125; catch (error) &#123;      this.reject(error)    &#125;  &#125;  resolve(result) &#123;    setTimeout(() &#x3D;&gt; &#123;      if (this.state &#x3D;&#x3D;&#x3D; PENDING) &#123;        &#x2F;&#x2F; ä¿®æ”¹çŠ¶æ€        this.state &#x3D; RESOLVED        this.result &#x3D; result        &#x2F;&#x2F; æ‰§è¡Œ then ä¸­çš„ resolve å›è°ƒå‡½æ•°        this.resolveCallbacks.forEach((cb) &#x3D;&gt; cb(result))      &#125;    &#125;)  &#125;  reject(reason) &#123;    setTimeout(() &#x3D;&gt; &#123;      if (this.state &#x3D;&#x3D;&#x3D; PENDING) &#123;        &#x2F;&#x2F; ä¿®æ”¹çŠ¶æ€        this.state &#x3D; REJECTED        this.reason &#x3D; reason        &#x2F;&#x2F; æ‰§è¡Œ then ä¸­çš„ reject å›è°ƒå‡½æ•°        this.rejectCallbacks.forEach((cb) &#x3D;&gt; cb(reason))      &#125;    &#125;)  &#125;  then(onFulfilled, onRejected) &#123;    &#x2F;&#x2F; å¦‚æœä¸æ˜¯å‡½æ•°ï¼Œä¼ é€’ result    onFulfilled &#x3D;      typeof onFulfilled &#x3D;&#x3D;&#x3D; &#39;function&#39; ? onFulfilled : (result) &#x3D;&gt; result    &#x2F;&#x2F; å¦‚æœä¸æ˜¯å‡½æ•°ï¼ŒæŠ›å‡º reason    onRejected &#x3D;      typeof onRejected &#x3D;&#x3D;&#x3D; &#39;function&#39;        ? onRejected        : (reason) &#x3D;&gt; &#123;            throw reason          &#125;    &#x2F;&#x2F; è°ƒç”¨ .then æ—¶å¦‚æœè¿˜åœ¨ pending åˆ™å°†å›è°ƒå…ˆå­˜èµ·æ¥ï¼Œç­‰å¾… resolve åæ‰§è¡Œ    if (this.state &#x3D;&#x3D;&#x3D; PENDING) &#123;      const promise2 &#x3D; new MyPromise((resolve, reject) &#x3D;&gt; &#123;        const resolvedCallBack &#x3D; () &#x3D;&gt; &#123;          try &#123;            const x &#x3D; onFulfilled(this.result)            &#x2F;&#x2F; ç®€åŒ–é€»è¾‘çš„ resolutionProcedure            x instanceof MyPromise ? x.then(resolve, reject) : resolve(x)            &#x2F;&#x2F; resolutionProcedure(promise2, x, resolve, reject)          &#125; catch (error) &#123;            reject(error)          &#125;        &#125;        const rejectCallBack &#x3D; () &#x3D;&gt; &#123;          try &#123;            const x &#x3D; onRejected(this.result)            &#x2F;&#x2F; ç®€åŒ–é€»è¾‘çš„ resolutionProcedure            x instanceof MyPromise ? x.then(resolve, reject) : resolve(x)            &#x2F;&#x2F; resolutionProcedure(promise2, x, resolve, reject)          &#125; catch (error) &#123;            reject(error)          &#125;        &#125;        &#x2F;&#x2F; æ”¶é›†å›è°ƒ        this.resolveCallbacks.push(resolvedCallBack)        this.rejectCallbacks.push(onRejected)      &#125;)      return promise2    &#125;    &#x2F;&#x2F; å¦‚æœè°ƒç”¨ .then æ—¶å·²ç» resolve &#x2F; reject, é‚£ä¹ˆç›´æ¥æ‰§è¡Œå¯¹åº”çš„å›è°ƒ    if (this.state &#x3D;&#x3D;&#x3D; RESOLVED) &#123;      onFulfilled(this.result)    &#125;    if (this.state &#x3D;&#x3D;&#x3D; REJECTED) &#123;      onRejected(this.reason)    &#125;  &#125;&#125;</code></pre><h5 id="resolutionProcedure"><a href="#resolutionProcedure" class="headerlink" title="resolutionProcedure"></a>resolutionProcedure</h5><p>æœ€åæ ¹æ® Promise / A+ çš„è§„èŒƒæ¥å®Œå–„ resolutionProcedureï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ç³»åˆ—çš„åˆ¤æ–­ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const resolutionProcedure &#x3D; (promise2, x, resolve, reject) &#x3D;&gt; &#123;  if (promise2 &#x3D;&#x3D;&#x3D; x) &#123;    return reject(new TypeError(&#39;Error&#39;))  &#125;  if (x instanceof MyPromise) &#123;    x.then(function(value) &#123;        resolutionProcedure(promise2, value, resolve, reject)    &#125;, reject)&#125;  let called &#x3D; false  if (x !&#x3D;&#x3D; null &amp;&amp; (typeof x &#x3D;&#x3D;&#x3D; &#39;object&#39; || typeof x &#x3D;&#x3D;&#x3D; &#39;function&#39;)) &#123;    try &#123;      let then &#x3D; x.then      if (typeof then &#x3D;&#x3D;&#x3D; &#39;function&#39;) &#123;        then.call(          x,          y &#x3D;&gt; &#123;            if (called) return            called &#x3D; true            resolutionProcedure(promise2, y, resolve, reject)          &#125;,          e &#x3D;&gt; &#123;            if (called) return            called &#x3D; true            reject(e)          &#125;        )      &#125; else &#123;        resolve(x)      &#125;    &#125; catch (e) &#123;      if (called) return      called &#x3D; true      reject(e)    &#125;  &#125; else &#123;    resolve(x)  &#125;&#125;</code></pre><h4 id="ç¬¦åˆ-Promise-A-çš„-Promise-1"><a href="#ç¬¦åˆ-Promise-A-çš„-Promise-1" class="headerlink" title="ç¬¦åˆ Promise / A+ çš„ Promise"></a>ç¬¦åˆ Promise / A+ çš„ Promise</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const PENDING &#x3D; &#39;pending&#39;const RESOLVED &#x3D; &#39;resolved&#39;const REJECTED &#x3D; &#39;rejected&#39;const resolutionProcedure &#x3D; (promise2, x, resolve, reject) &#x3D;&gt; &#123;  if (promise2 &#x3D;&#x3D;&#x3D; x) &#123;    return reject(new TypeError(&#39;Error&#39;))  &#125;  if (x instanceof MyPromise) &#123;    x.then(function (value) &#123;      resolutionProcedure(promise2, value, resolve, reject)    &#125;, reject)  &#125;  let called &#x3D; false  if (x !&#x3D;&#x3D; null &amp;&amp; (typeof x &#x3D;&#x3D;&#x3D; &#39;object&#39; || typeof x &#x3D;&#x3D;&#x3D; &#39;function&#39;)) &#123;    try &#123;      let then &#x3D; x.then      if (typeof then &#x3D;&#x3D;&#x3D; &#39;function&#39;) &#123;        then.call(          x,          (y) &#x3D;&gt; &#123;            if (called) return            called &#x3D; true            resolutionProcedure(promise2, y, resolve, reject)          &#125;,          (e) &#x3D;&gt; &#123;            if (called) return            called &#x3D; true            reject(e)          &#125;        )      &#125; else &#123;        resolve(x)      &#125;    &#125; catch (e) &#123;      if (called) return      called &#x3D; true      reject(e)    &#125;  &#125; else &#123;    resolve(x)  &#125;&#125;class MyPromise &#123;  constructor(fn) &#123;    this.state &#x3D; PENDING    &#x2F;&#x2F; æ”¶é›† .then ä¸­çš„ resolve çš„å›è°ƒå‡½æ•°    this.resolveCallbacks &#x3D; []    &#x2F;&#x2F; æ”¶é›† .then ä¸­çš„ reject çš„å›è°ƒå‡½æ•°    this.rejectCallbacks &#x3D; []    &#x2F;&#x2F; resolve(result)    this.result &#x3D; null    &#x2F;&#x2F; reject(reason)    this.reason &#x3D; null    &#x2F;&#x2F; ç”±äº fn æœ‰å¯èƒ½å¼‚å¸¸ï¼Œéœ€è¦æ•è·    try &#123;      &#x2F;&#x2F; Promise ä¸€å®ä¾‹åŒ–å°±æ‰§è¡Œä¼ å…¥çš„ fn      &#x2F;&#x2F; æ³¨æ„æ­¤å¤„å°†å‡½æ•°å½“ä½œå‚æ•°ä¼ å…¥ï¼Œéœ€è¦ bind ç»‘å®šä¸Šä¸‹æ–‡      &#x2F;&#x2F; æˆ–è€… resolve &#x2F; reject ç”¨ç®­å¤´å‡½æ•°å®ç°      fn(this.resolve.bind(this), this.reject.bind(this))    &#125; catch (error) &#123;      this.reject(error)    &#125;  &#125;  resolve(result) &#123;    setTimeout(() &#x3D;&gt; &#123;      if (this.state &#x3D;&#x3D;&#x3D; PENDING) &#123;        &#x2F;&#x2F; ä¿®æ”¹çŠ¶æ€        this.state &#x3D; RESOLVED        this.result &#x3D; result        &#x2F;&#x2F; æ‰§è¡Œ then ä¸­çš„ resolve å›è°ƒå‡½æ•°        this.resolveCallbacks.forEach((cb) &#x3D;&gt; cb(result))      &#125;    &#125;)  &#125;  reject(reason) &#123;    setTimeout(() &#x3D;&gt; &#123;      if (this.state &#x3D;&#x3D;&#x3D; PENDING) &#123;        &#x2F;&#x2F; ä¿®æ”¹çŠ¶æ€        this.state &#x3D; REJECTED        this.reason &#x3D; reason        &#x2F;&#x2F; æ‰§è¡Œ then ä¸­çš„ reject å›è°ƒå‡½æ•°        this.rejectCallbacks.forEach((cb) &#x3D;&gt; cb(reason))      &#125;    &#125;)  &#125;  then(onFulfilled, onRejected) &#123;    &#x2F;&#x2F; å¦‚æœä¸æ˜¯å‡½æ•°ï¼Œä¼ é€’ result    onFulfilled &#x3D;      typeof onFulfilled &#x3D;&#x3D;&#x3D; &#39;function&#39; ? onFulfilled : (result) &#x3D;&gt; result    &#x2F;&#x2F; å¦‚æœä¸æ˜¯å‡½æ•°ï¼ŒæŠ›å‡º reason    onRejected &#x3D;      typeof onRejected &#x3D;&#x3D;&#x3D; &#39;function&#39;        ? onRejected        : (reason) &#x3D;&gt; &#123;            throw reason          &#125;    &#x2F;&#x2F; è°ƒç”¨ .then æ—¶å¦‚æœè¿˜åœ¨ pending åˆ™å°†å›è°ƒå…ˆå­˜èµ·æ¥ï¼Œç­‰å¾… resolve åæ‰§è¡Œ    if (this.state &#x3D;&#x3D;&#x3D; PENDING) &#123;      const promise2 &#x3D; new MyPromise((resolve, reject) &#x3D;&gt; &#123;        const resolvedCallBack &#x3D; () &#x3D;&gt; &#123;          try &#123;            const x &#x3D; onFulfilled(this.result)            resolutionProcedure(promise2, x, resolve, reject)          &#125; catch (error) &#123;            reject(error)          &#125;        &#125;        const rejectCallBack &#x3D; () &#x3D;&gt; &#123;          try &#123;            const x &#x3D; onRejected(this.result)            resolutionProcedure(promise2, x, resolve, reject)          &#125; catch (error) &#123;            reject(error)          &#125;        &#125;        &#x2F;&#x2F; æ”¶é›†å›è°ƒ        this.resolveCallbacks.push(resolvedCallBack)        this.rejectCallbacks.push(onRejected)      &#125;)      return promise2    &#125;    &#x2F;&#x2F; å¦‚æœè°ƒç”¨ .then æ—¶å·²ç» resolve &#x2F; reject, é‚£ä¹ˆç›´æ¥æ‰§è¡Œå¯¹åº”çš„å›è°ƒ    if (this.state &#x3D;&#x3D;&#x3D; RESOLVED) &#123;      onFulfilled(this.result)    &#125;    if (this.state &#x3D;&#x3D;&#x3D; REJECTED) &#123;      onRejected(this.reason)    &#125;  &#125;&#125;</code></pre><p>è‡³æ­¤æˆ‘ä»¬å®Œæˆäº†ä¸€ä¸ª ç¬¦åˆ Promise / A+ çš„ Promiseï¼Œå®é™…ä¸Š Promise è¿˜ä¼šæä¾›ä¸€äº›å¦‚ <code>.all</code>, <code>.race</code> ä¹‹ç±»çš„ apiï¼Œè¿™é‡Œä¹Ÿå®ç°ä¸€ä¸‹ã€‚</p><h4 id="Promise-all"><a href="#Promise-all" class="headerlink" title="Promise.all"></a>Promise.all</h4><p>Promise.all æ¥æ”¶å¤šä¸ª Promise å®ä¾‹ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚ä¾‹å¦‚ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const p &#x3D; Promise.all([p1, p2, p3])</code></pre><p>ä¸Šè¿°çš„ p1, p2, p3 éƒ½æ˜¯ Promise å®ä¾‹ï¼Œå¦‚æœä¸æ˜¯åˆ™ä¼šç”¨ Promise.resolve è½¬æˆ promiseã€‚æ­¤å¤–ï¼Œ<code>Promise.all()</code>æ–¹æ³•çš„å‚æ•°å¯ä»¥ä¸æ˜¯æ•°ç»„ï¼Œä½†å¿…é¡»å…·æœ‰ Iterator æ¥å£ï¼Œä¸”è¿”å›çš„æ¯ä¸ªæˆå‘˜éƒ½æ˜¯ Promise å®ä¾‹ã€‚</p><p><code>p</code>çš„çŠ¶æ€ç”±<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>å†³å®šï¼Œåˆ†æˆä¸¤ç§æƒ…å†µã€‚</p><p>ï¼ˆ1ï¼‰åªæœ‰<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>çš„çŠ¶æ€éƒ½å˜æˆ<code>fulfilled</code>ï¼Œ<code>p</code>çš„çŠ¶æ€æ‰ä¼šå˜æˆ<code>fulfilled</code>ï¼Œæ­¤æ—¶<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>çš„è¿”å›å€¼ç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚</p><p>ï¼ˆ2ï¼‰åªè¦<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>ä¹‹ä¸­æœ‰ä¸€ä¸ªè¢«<code>rejected</code>ï¼Œ<code>p</code>çš„çŠ¶æ€å°±å˜æˆ<code>rejected</code>ï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªè¢«<code>reject</code>çš„å®ä¾‹çš„è¿”å›å€¼ï¼Œä¼šä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚</p><p>å®ç°å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class MyPromise &#123;  &#x2F;&#x2F; ...  all(arr) &#123;    &#x2F;&#x2F; ç”¨äºå­˜å‚¨è¿”å›å€¼    let list &#x3D; []    &#x2F;&#x2F; è®°å½• resolve äº†å¤šå°‘ä¸ª promise    let length &#x3D; 0    &#x2F;&#x2F; æ‰§è¡Œ promise çš„è¿‡ç¨‹ä¸­æ˜¯å¦æœ‰å¼‚å¸¸    let hasError &#x3D; false    &#x2F;&#x2F; è¿”å›ä¸€ä¸ªæ–°çš„ Promise    return new MyPromise((resolve, reject) &#x3D;&gt; &#123;      for (let i &#x3D; 0; i &lt; arr.length; i++) &#123;        &#x2F;&#x2F; åˆ¤æ–­å…ƒç´ æ˜¯å¦ä¸º MyPromiseï¼Œ å¦åˆ™ resolve        const p &#x3D;          arr[i] instanceof MyPromise ? arr[i] : MyPromise.resolve(arr[i])        p.then((data) &#x3D;&gt; &#123;          list[i] &#x3D; data          length++          if (length &#x3D;&#x3D;&#x3D; arr.length) &#123;            &#x2F;&#x2F; å¦‚æœå…¨éƒ¨ promise éƒ½ resolved            resolve(list)          &#125;        &#125;).catch((error) &#x3D;&gt; &#123;          if (!hasError) &#123;            &#x2F;&#x2F; ç¬¬ä¸€ä¸ªè¢« reject çš„å®ä¾‹çš„è¿”å›å€¼ï¼Œä¼šä¼ é€’ç»™ p çš„å›è°ƒå‡½æ•°            reject(error)          &#125;          hasErr &#x3D; true        &#125;)      &#125;    &#125;)  &#125;  &#x2F;&#x2F; ...&#125;</code></pre><h4 id="Promise-race"><a href="#Promise-race" class="headerlink" title="Promise.race"></a>Promise.race</h4><p>Promise.race()`æ–¹æ³•åŒæ ·æ˜¯å°†å¤šä¸ª Promise å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const p &#x3D; Promise.race([p1, p2, p3]);</code></pre><p>åªè¦<code>p1</code>ã€<code>p2</code>ã€<code>p3</code>ä¹‹ä¸­æœ‰ä¸€ä¸ªå®ä¾‹ç‡å…ˆæ”¹å˜çŠ¶æ€ï¼Œ<code>p</code>çš„çŠ¶æ€å°±è·Ÿç€æ”¹å˜ã€‚é‚£ä¸ªç‡å…ˆæ”¹å˜çš„ Promise å®ä¾‹çš„è¿”å›å€¼ï¼Œå°±ä¼ é€’ç»™<code>p</code>çš„å›è°ƒå‡½æ•°ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class MyPromise &#123;  &#x2F;&#x2F; ...  race(arr) &#123;    &#x2F;&#x2F; æ˜¯å¦æœ‰ç»“æœ    let hasResult &#x3D; false    &#x2F;&#x2F; è¿”å›ä¸€ä¸ªæ–°çš„ Promise    return new MyPromise((resolve, reject) &#x3D;&gt; &#123;      for (let i &#x3D; 0; i &lt; arr.length; i++) &#123;        &#x2F;&#x2F; åˆ¤æ–­å…ƒç´ æ˜¯å¦ä¸º MyPromiseï¼Œ å¦åˆ™ resolve        const p &#x3D;          arr[i] instanceof MyPromise ? arr[i] : MyPromise.resolve(arr[i])        p.then((data) &#x3D;&gt; &#123;          if (!hasResult) &#123;            resolve(data)          &#125;          hasResult &#x3D; true        &#125;).catch((error) &#x3D;&gt; &#123;          if (!hasResult) &#123;            reject(error)          &#125;          hasResult &#x3D; true        &#125;)      &#125;    &#125;)  &#125;  &#x2F;&#x2F; ...&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>svg å›¾ç‰‡çš„ä¸Šä¼ ä¸‹è½½</title>
      <link href="/2020/08/17/svg%20%E5%9B%BE%E7%89%87%E7%9A%84%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD/"/>
      <url>/2020/08/17/svg%20%E5%9B%BE%E7%89%87%E7%9A%84%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>æœ€è¿‘æœ‰ä¸ªéœ€æ±‚ï¼š</p><ol><li>æ ¹æ®ä¼ å…¥çš„ code ç”Ÿæˆæ¡å½¢ç  svg å›¾ç‰‡</li><li>å°† svg å›¾ç‰‡ä¸Šä¼ è‡³ cdn</li><li>å±•ç¤ºå›¾ç‰‡æ—¶éœ€è¦ç‚¹å‡»æŒ‰é’®åä¿å­˜è‡³æœ¬åœ°</li></ol><a id="more"></a><h4 id="ç”Ÿæˆæ¡å½¢ç "><a href="#ç”Ÿæˆæ¡å½¢ç " class="headerlink" title="ç”Ÿæˆæ¡å½¢ç "></a>ç”Ÿæˆæ¡å½¢ç </h4><p>è¿™é‡Œå€ŸåŠ©ä¸€ä¸ªå¼€æºçš„ä»“åº“</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">import JsBarcode from &#39;jsbarcode&#39;;const generateBarcode &#x3D; async (barcode, options &#x3D; &#123;&#125;) &#x3D;&gt; &#123;  &#x2F;&#x2F; åˆ›å»ºä¸€ä¸ª svg å…ƒç´   const svg &#x3D; document.createElementNS(&#39;http:&#x2F;&#x2F;www.w3.org&#x2F;2000&#x2F;svg&#39;, &#39;svg&#39;);  &#x2F;&#x2F; ç”šè‡³å®½é«˜  svg.setAttribute(&#39;width&#39;, &#96;$&#123;width&#125;px&#96;);  svg.setAttribute(&#39;height&#39;, &#96;$&#123;height&#125;px&#96;);  &#x2F;&#x2F; ç”Ÿæˆæ¡å½¢ç  svg çš„å›¾ç‰‡  JsBarcode(svg, barcode, options);  return svg&#125;</code></pre><h4 id="å›¾ç‰‡ä¸Šä¼ "><a href="#å›¾ç‰‡ä¸Šä¼ " class="headerlink" title="å›¾ç‰‡ä¸Šä¼ "></a>å›¾ç‰‡ä¸Šä¼ </h4><h5 id="svg-è½¬-canvas"><a href="#svg-è½¬-canvas" class="headerlink" title="svg è½¬ canvas"></a>svg è½¬ canvas</h5><p>ç”±äºæœåŠ¡ç«¯åŒå­¦æä¾›çš„æ¥å£åªæ”¯æŒ canvasï¼Œå› æ­¤é¦–å…ˆè¦å°† svg è½¬æˆ canvasï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const svgToCanvas &#x3D; (svg) &#x3D;&gt; &#123;  &#x2F;&#x2F; svg.outerHTML è·å– svg å…ƒç´ çš„ html å­—ç¬¦ä¸²  &#x2F;&#x2F; btoa å°† svg è½¬æˆ base64const href &#x3D; &#96;data:image&#x2F;svg+xml;base64,$&#123;window.btoa(    unescape(encodeURIComponent(svg.outerHTML)),  )&#125;&#96;;  &#x2F;&#x2F; æ„å»ºä¸€ä¸ª Image  const img &#x3D; new Image();  img.width &#x3D; width;  img.height &#x3D; height;    img.onload &#x3D; () &#x3D;&gt; &#123;    &#x2F;&#x2F; æ„å»ºä¸€ä¸ª canvas    const canvas &#x3D; document.createElement(&#39;canvas&#39;);    const ctx &#x3D; canvas.getContext(&#39;2d&#39;);    ctx.fillRect(0, 0, width, height);    &#x2F;&#x2F; å°† å›¾ç‰‡ç”»åˆ° canvas ä¸­    ctx.drawImage(img, 0, 0, width, height);    &#x2F;&#x2F; è½¬æˆ jpeg çš„ base64 const dataURI &#x3D; canvas.toDataURL(&#39;image&#x2F;jpeg&#39;);    &#x2F;&#x2F; ä¸Šä¼     upload(dataURI);  &#125;   img.src &#x3D; href;&#125;</code></pre><h5 id="Data-URL"><a href="#Data-URL" class="headerlink" title="Data URL"></a>Data URL</h5><p>é€šè¿‡ `canvas.toDataURL å°† canvas è½¬æˆ Data URLï¼Œä¸€æ®µ Data URL ç”± 4 ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">data:[&lt;mediatype&gt;][;base64],&lt;data&gt;&#x2F;&#x2F; ä¾‹å¦‚ï¼š &quot;data:image&#x2F;png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAADElEQVQImWNgoBMAAABpAAFEI8ARAAAAAElFTkSuQmCC&quot;</code></pre><h5 id="Base64çš„è§£ç ä¸ç¼–ç "><a href="#Base64çš„è§£ç ä¸ç¼–ç " class="headerlink" title="Base64çš„è§£ç ä¸ç¼–ç "></a>Base64çš„è§£ç ä¸ç¼–ç </h5><p><code>atob()</code> å‡½æ•°èƒ½å¤Ÿè§£ç é€šè¿‡base-64ç¼–ç çš„å­—ç¬¦ä¸²æ•°æ®ã€‚</p><p><code>btoa()</code> å‡½æ•°èƒ½å¤Ÿä»äºŒè¿›åˆ¶æ•°æ®â€œå­—ç¬¦ä¸²â€åˆ›å»ºä¸€ä¸ªbase-64ç¼–ç çš„ASCIIå­—ç¬¦ä¸²ã€‚</p><h5 id="Base64-è½¬-Blob"><a href="#Base64-è½¬-Blob" class="headerlink" title="Base64 è½¬ Blob"></a>Base64 è½¬ Blob</h5><p>ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶éœ€è¦å°† base64 è½¬æˆ Blob å¯¹è±¡ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><p>######Base64 è½¬ Blob ç¬¬ä¸€ç§æ–¹æ³•ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">function dataURItoBlob(dataURI: string) &#123;  &#x2F;&#x2F; é€šè¿‡ atob è½¬å› string  const byteString &#x3D; atob(dataURI.split(&#39;,&#39;)[1]);  &#x2F;&#x2F; è·å¾—æ–‡ä»¶ç±»å‹  const mimeString &#x3D; dataURI.split(&#39;,&#39;)[0].split(&#39;:&#39;)[1].split(&#39;;&#39;)[0];  &#x2F;&#x2F; è½¬æˆ   const ab &#x3D; new ArrayBuffer(byteString.length);  const ia &#x3D; new Uint8Array(ab);  for (let i &#x3D; 0; i &lt; byteString.length; i++) &#123;    ia[i] &#x3D; byteString.charCodeAt(i);  &#125;&#x2F;&#x2F; è½¬æˆ blob  const bb &#x3D; new Blob([ab], &#123; type: mimeString &#125;);  return bb;&#125;</code></pre><p> æ€è·¯ï¼š</p><ol><li>æ‹†è§£ data uriï¼Œé€šè¿‡ atob å°† base64 è§£ç æˆå­—ç¬¦ä¸²</li><li>æ‹†è§£ data uriï¼Œè·å¾—å›¾ç‰‡çš„æ ¼å¼</li><li>åˆ›å»ºä¸€ä¸ª arraybuffer</li><li>é€šè¿‡TypedArrayï¼ˆè¿™é‡Œä½¿ç”¨ Uint8Arrayï¼‰å°†å­—ç¬¦ä¸²çš„å†…å®¹å†™å…¥ arraybuffer </li><li>å°† array buffer è½¬æˆ blob</li></ol><h6 id="Base64-è½¬-Blob-ç¬¬äºŒç§æ–¹æ³•ï¼š"><a href="#Base64-è½¬-Blob-ç¬¬äºŒç§æ–¹æ³•ï¼š" class="headerlink" title="Base64 è½¬ Blob ç¬¬äºŒç§æ–¹æ³•ï¼š"></a>Base64 è½¬ Blob ç¬¬äºŒç§æ–¹æ³•ï¼š</h6><p>é€šè¿‡ <code>fetch</code> å°† dataURI è½¬æˆ blobï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">const bb &#x3D; await fetch(dataURI).then((res) &#x3D;&gt; res.blob())</code></pre><h5 id="ä¸Šä¼ å›¾ç‰‡"><a href="#ä¸Šä¼ å›¾ç‰‡" class="headerlink" title="ä¸Šä¼ å›¾ç‰‡"></a>ä¸Šä¼ å›¾ç‰‡</h5><p>æ„é€  FormData ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const upload &#x3D; (dataURI: string) &#x3D;&gt; &#123;  &#x2F;&#x2F; åˆ›å»ºformå¯¹è±¡const formData &#x3D; new FormData();  &#x2F;&#x2F; é€šè¿‡ append å‘ form å¯¹è±¡æ·»åŠ æ•°æ®  formData.append(&#39;file&#39;, dataURItoBlob(dataURI));  const &#123; data &#125; &#x3D; await axios.post(&#39;&#x2F;api&#x2F;upload&#39;, formData, &#123;    headers: &#123;      &#39;Content-Type&#39;: &#39;multipart&#x2F;form-data&#39;,      &#39;X-Requested-With&#39;: &#39;XMLHttpRequest&#39;,    &#125;,  &#125;);&#125;</code></pre><h5 id="ä¸‹è½½å›¾ç‰‡"><a href="#ä¸‹è½½å›¾ç‰‡" class="headerlink" title="ä¸‹è½½å›¾ç‰‡"></a>ä¸‹è½½å›¾ç‰‡</h5><p>ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const download &#x3D; (fileUrl, name) &#x3D;&gt; &#123;  const x &#x3D; new XMLHttpRequest();  x.open(&#39;GET&#39;, fileUrl, true);  x.responseType &#x3D; &#39;blob&#39;;  x.onload &#x3D; () &#x3D;&gt; &#123;    &#x2F;&#x2F; è½¬ä¸º objectUrl    const url &#x3D; window.URL.createObjectURL(x.response);    &#x2F;&#x2F; æ„å»ºä¸€ä¸ª a æ ‡ç­¾    const a &#x3D; document.createElement(&#39;a&#39;);    a.href &#x3D; url;    a.download &#x3D; name;    a.click();  &#125;;  x.send();&#125;;</code></pre><p>åˆ©ç”¨ a æ ‡ç­¾çš„ download å±æ€§å¯ä»¥å®ç°å›¾ç‰‡çš„ä¸‹è½½ï¼Œä½†æ˜¯æœ‰ä¸ªé™åˆ¶æ˜¯ href å¿…é¡»æ˜¯åŒæºçš„åœ°å€ï¼Œå¦åˆ™æ— æ³•ä¸‹è½½ã€‚</p><p>å› æ­¤è¿™é‡Œé€šè¿‡ get è¯·æ±‚è·å¾—å›¾ç‰‡çš„ Blob æ ¼å¼ï¼Œå¹¶ç”¨ window.URL.createObjectURL å°† Blob è½¬æˆ objectUrl è§£å†³äº†è·¨åŸŸé—®é¢˜ã€‚ä¹‹åå°±å¯ä»¥ç”¨ a æ ‡ç­¾çš„ download å±æ€§ä¸‹è½½æ–‡ä»¶ã€‚</p><h4 id="è¡¥å……å‡ ä¸ªæ¦‚å¿µ"><a href="#è¡¥å……å‡ ä¸ªæ¦‚å¿µ" class="headerlink" title="è¡¥å……å‡ ä¸ªæ¦‚å¿µ"></a>è¡¥å……å‡ ä¸ªæ¦‚å¿µ</h4><h5 id="blob"><a href="#blob" class="headerlink" title="blob"></a>blob</h5><p>ä¸Šä¼ å›¾ç‰‡æ—¶ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªå‡½æ•° dataURItoBlobï¼Œ é€šè¿‡è¿™ä¸ªå‡½æ•°æ¥å°† base64 è½¬ä¸º Blobï¼Œæœ€ç»ˆä¸Šä¼ ç»™æ¥å£çš„ formData ä¸­çš„ file ä¹Ÿæ˜¯ä¸€ä¸ª Blob å¯¹è±¡ã€‚</p><p>ä»€ä¹ˆæ˜¯ Blob å¯¹è±¡ï¼Ÿ</p><blockquote><p>ä¸€ä¸ª <strong>Blob</strong>å¯¹è±¡è¡¨ç¤ºä¸€ä¸ªä¸å¯å˜çš„, åŸå§‹æ•°æ®çš„ç±»ä¼¼æ–‡ä»¶å¯¹è±¡ã€‚Blob è¡¨ç¤ºçš„ä¸ä¸€å®šæ˜¯JavaScriptåŸç”Ÿæ ¼å¼çš„æ•°æ®ã€‚<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/File"><code>File</code></a> æ¥å£åŸºäº<code>Blob</code>ï¼Œç»§æ‰¿äº† blob çš„åŠŸèƒ½å¹¶å°†å…¶æ‰©å±•ä½¿å…¶æ”¯æŒç”¨æˆ·ç³»ç»Ÿä¸Šçš„æ–‡ä»¶ã€‚</p></blockquote><p>Blob å±äº web æä¾›çš„ apiï¼Œå› æ­¤ mdn ä¸Šè¯´çš„ Blob è¡¨ç¤ºçš„ä¸ä¸€å®šæ˜¯JavaScriptåŸç”Ÿæ ¼å¼çš„æ•°æ®ã€‚</p><h5 id="File"><a href="#File" class="headerlink" title="File"></a>File</h5><p>File ç»§æ‰¿è‡ª Blobï¼Œå¯ä»¥çœ‹ä½œæ˜¯ç‰¹æ®Šçš„ Blobã€‚å¸¸è§çš„è·å¾— File å¯¹è±¡çš„æ–¹æ³•æœ‰ <code>input</code> æ ‡ç­¾ä¸Šé€‰æ‹©æ–‡ä»¶åè¿”å›çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FileList"><code>FileList</code></a> å¯¹è±¡ã€‚</p><h5 id="Blob-è½¬-URL"><a href="#Blob-è½¬-URL" class="headerlink" title="Blob è½¬ URL"></a>Blob è½¬ URL</h5><p>åœ¨ä¸‹è½½æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡ get è¯·æ±‚è·å¾—äº†å›¾ç‰‡çš„ blob æ ¼å¼ï¼Œä¹‹åé€šè¿‡ URL.createObjectURL è½¬æˆ objectUrlï¼Œè¿™æ ·å°±å¯ä»¥åƒæ™®é€šçš„ urlï¼Œèµ‹å€¼ç»™ img çš„ src å±æ€§æˆ–è€… a æ ‡ç­¾çš„ href å±æ€§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æºç å±‚é¢è§£è¯»Vueå“åº”å¼åŸç†</title>
      <link href="/2020/08/11/%E6%BA%90%E7%A0%81%E5%B1%82%E9%9D%A2%E8%A7%A3%E8%AF%BBVue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86/"/>
      <url>/2020/08/11/%E6%BA%90%E7%A0%81%E5%B1%82%E9%9D%A2%E8%A7%A3%E8%AF%BBVue%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ Vueï¼ˆä»¥ä¸‹å‡æŒ‡çš„æ˜¯ 2.x ç‰ˆæœ¬ï¼‰ ä¸­ï¼Œæ•°æ®æ¨¡å‹ä»…ä»…æ˜¯æ™®é€šçš„ JavaScript å¯¹è±¡ï¼Œå½“ä½ ä¿®æ”¹å®ƒä»¬æ—¶ï¼Œè§†å›¾ä¼šè¿›è¡Œæ›´æ–°ï¼Œè¿™å°±æ˜¯ Vue çš„å“åº”å¼ç³»ç»Ÿï¼Œå…¶è®¾è®¡æ¨¡å¼å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ã€‚</p><a id="more"></a><h4 id="æ€è·¯æ¢³ç†"><a href="#æ€è·¯æ¢³ç†" class="headerlink" title="æ€è·¯æ¢³ç†"></a>æ€è·¯æ¢³ç†</h4><p>ä»¥ä¸‹ä¸ºé˜…è¯»æºç æ—¶ï¼Œå¯¹å“åº”å¼å®ç°åŸç†çš„ç†è§£ï¼Œä¸ºäº†æ€è·¯æ›´æ¸…æ™°ï¼Œä»…è€ƒè™‘æœ€ç®€å•çš„æƒ…å†µï¼Œå¹¶ä¸”å¯èƒ½ä¼šçœç•¥æˆ–ä¿®æ”¹éƒ¨åˆ†ä»£ç ã€‚</p><p>é¦–å…ˆï¼Œé¡ºç€ vue çš„ç”Ÿå‘½å‘¨æœŸå¼€å§‹ï¼š</p><h5 id="beforeCreate-ä¸-created"><a href="#beforeCreate-ä¸-created" class="headerlink" title="beforeCreate ä¸ created"></a>beforeCreate ä¸ created</h5><p>é¦–å…ˆ åœ¨ _init æ–¹æ³•ä¸­æ‰§è¡Œ beforeCreate ä¸ created ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Vue.prototype._init &#x3D; function (options?: Object) &#123;  &#x2F;&#x2F; ...  callHook(vm, &#39;beforeCreate&#39;)  &#x2F;&#x2F; ...  initState(vm)  &#x2F;&#x2F; ...  callHook(vm, &#39;created&#39;)  &#x2F;&#x2F; ...&#125;</code></pre><p>è®°ä½è¿™é‡Œæ‰§è¡Œäº†ä¸€ä¸ªæ–¹æ³•ï¼š <code>initState</code></p><p>#####initState</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">export function initState (vm: Component) &#123;&#x2F;&#x2F; ç•¥ï¼š...åˆå§‹åŒ– propsï¼Œmethods ç­‰  if (opts.data) &#123;    initData(vm)  &#125; else &#123;    observe(vm._data &#x3D; &#123;&#125;, true &#x2F;* asRootData *&#x2F;)  &#125;  &#x2F;&#x2F; ç•¥ï¼š...åˆå§‹åŒ– computedï¼Œwatch ç­‰&#125;</code></pre><p>è¿™é‡Œçš„ initData ä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">function initData (vm: Component) &#123;  &#x2F;&#x2F; ç•¥ï¼š...å°† data çš„æ¯ä¸ªå±æ€§éƒ½æŒ‚åœ¨ vm ä¸Š,è¿™æ ·å¯ä»¥é€šè¿‡ this.xx ç›´æ¥è®¿é—®åˆ°  &#x2F;&#x2F; observe data  observe(data, true &#x2F;* asRootData *&#x2F;)&#125;</code></pre><p>è®°ä½ <code>observe</code> è¿™ä¸ªæ–¹æ³•ã€‚</p><h5 id="observe"><a href="#observe" class="headerlink" title="observe"></a>observe</h5><p><code>observe</code>  ç”¨äºåˆ›å»ºä¸€ä¸ª observer å®ä¾‹ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">export function observe (value: any, asRootData: ?boolean): Observer | void &#123;  let ob: Observer | void  &#x2F;&#x2F; åˆ¤æ–­æ˜¯å¦å·²ç» observe è¿‡ï¼Œæ˜¯çš„è¯ç›´æ¥è¿”å›  if (hasOwn(value, &#39;__ob__&#39;) &amp;&amp; value.__ob__ instanceof Observer) &#123;    &#x2F;&#x2F; observer æœ€ç»ˆä¼šæŒ‚åœ¨ value çš„ __ob__ å±æ€§ä¸Šï¼Œå› æ­¤å¯ä»¥è¿™ä¹ˆåˆ¤æ–­æ˜¯å¦  observe è¿‡ï¼Œè¯¦æƒ…çœ‹ Observer çš„ä»£ç     ob &#x3D; value.__ob__  &#125; else if (...) &#123;    &#x2F;&#x2F; å¦åˆ™æ»¡è¶³ä¸€ç³»åˆ—æ¡ä»¶çš„æƒ…å†µä¸‹å°±ä¼šé‡æ–°å®ä¾‹åŒ–ä¸€ä¸ª observer    ob &#x3D; new Observer(value)  &#125;  return ob&#125;</code></pre><p>å®ä¾‹åŒ–  observer çš„è¿‡ç¨‹ä¸­å®é™…ä¸Šä¼šå°†ä¼ å…¥å¯¹è±¡çš„æ¯ä¸ªå±æ€§é€šè¿‡ <code>defineReactive</code> æ–¹æ³•è½¬æˆå“åº”å¼ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">export class Observer &#123;  constructor (value: any) &#123;    this.value &#x3D; value    &#x2F;&#x2F; åˆå§‹åŒ–æ•°æ®æ¨¡å‹çš„ dep å®ä¾‹    this.dep &#x3D; new Dep()    &#x2F;&#x2F; observer æœ€ç»ˆä¼šæŒ‚åœ¨ value çš„ __ob__ å±æ€§ä¸Š    def(value, &#39;__ob__&#39;, this)    if (Array.isArray(value)) &#123;      &#x2F;&#x2F; ç•¥ï¼š...é‡å†™ value çš„ä¸€äº›æ•°ç»„æ–¹æ³•      &#x2F;&#x2F; ç•¥ï¼š...éå†æ•°ç»„å…ƒç´ å¹¶ observe    &#125; else &#123;      this.walk(value)    &#125;  &#125;    walk (obj: Object) &#123;    const keys &#x3D; Object.keys(obj)    for (let i &#x3D; 0; i &lt; keys.length; i++) &#123;       &#x2F;&#x2F; éå†ä¼ å…¥çš„æ¯ä¸ªå±æ€§ï¼Œå¹¶ç”¨ defineReactive è½¬æˆå“åº”å¼      defineReactive(obj, keys[i])    &#125;  &#125;&#125;</code></pre><h5 id="defineReactive"><a href="#defineReactive" class="headerlink" title="defineReactive"></a>defineReactive</h5><p>ä¸Šé¢ä»£ç ä¸­æœ€æ ¸å¿ƒçš„ä¸€ä¸ªå‡½æ•°æ˜¯ <code>defineReactive</code>ï¼Œåšäº†ä»¥ä¸‹å‡ ä»¶äº‹æƒ…ï¼š</p><ol><li>åˆå§‹åŒ–ç›®æ ‡å±æ€§çš„ dep å®ä¾‹ï¼Œè¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªå‘å¸ƒè€…</li><li>å¯¹è¯¥å±æ€§çš„å­å¯¹è±¡é€’å½’è°ƒç”¨ observe</li><li>é€šè¿‡<code>Object.defineProperty</code>åŠ«æŒè¯¥å±æ€§çš„ getter ä¸ setterï¼š</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">export function defineReactive (  obj: Object,  key: string,  val: any,) &#123;  &#x2F;&#x2F; åˆå§‹åŒ–ç›®æ ‡å±æ€§çš„ dep å®ä¾‹  const dep &#x3D; new Dep()&#x2F;&#x2F; ç•¥ï¼š... ä¸€äº›å®¹é”™åˆ¤æ–­  &#x2F;&#x2F; ç•¥ï¼š... ä¸€äº›åˆå§‹åŒ–    &#x2F;&#x2F; é€’å½’ observe  let childOb &#x3D; !shallow &amp;&amp; observe(val)  &#x2F;&#x2F; åŠ«æŒ get ä¸ set  Object.defineProperty(obj, key, &#123;    enumerable: true,    configurable: true,    get: function reactiveGetter () &#123;      &#x2F;&#x2F; ...ä¸€æ—¦è·å–è¯¥å±æ€§å°±ä¼šè¿›è¡Œä¾èµ–æ”¶é›†    &#125;,    set: function reactiveSetter (newVal) &#123;      &#x2F;&#x2F; ...ä¸€æ—¦è®¾ç½®äº†æ–°å€¼å°±ä¼šæ´¾å‘æ›´æ–°    &#125;  &#125;)&#125;</code></pre><p>è¿™é‡Œå°±ç”¨åˆ°äº†è§‚å¯Ÿè€…æ¨¡å¼ï¼šå½“è¿™ä¸ªå±æ€§æ›´æ–°æ—¶ï¼Œä¼šé€šè¿‡å‘å¸ƒè€…é€šçŸ¥åˆ°è§‚å¯Ÿè€…ï¼Œè¿™äº›è§‚å¯Ÿè€…æ”¶åˆ°é€šçŸ¥åæ›´æ–°è§†å›¾ã€‚è¿™é‡Œå‘å¸ƒè€…å®é™…ä¸Šæ˜¯<code>Dep</code> å®ä¾‹ï¼Œè§‚å¯Ÿè€…å®é™…ä¸Šæ˜¯ <code>Watcher</code> å®ä¾‹ï¼Œå®ƒçš„ <code>update</code> æ–¹æ³•å¯ä»¥æ›´æ–°è§†å›¾ã€‚</p><p>æ‰€ä»¥ï¼Œä¾èµ–æ”¶é›†å®é™…ä¸Šå°±æ˜¯å°†<code>Wathcer</code> å®ä¾‹æ·»åŠ åˆ° <code>Dep</code> å®ä¾‹çš„è§‚å¯Ÿè€…åˆ—è¡¨ã€‚</p><p>reactiveGetter å’Œ reactiveSetter è¿™ä¸¤ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°æˆ‘ä»¬å…ˆæ”¾ä¸€è¾¹ï¼Œè¿™é‡Œåªéœ€è¦çŸ¥é“å¤§æ¦‚çš„ä½œç”¨å³å¯ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»ã€‚æˆ‘ä»¬ç°åœ¨æ¥çœ‹çœ‹ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘ get å‘¢ï¼Ÿç­”æ¡ˆæ˜¯åœ¨æŒ‚è½½ç»„ä»¶çš„æ—¶å€™ã€‚</p><h5 id="beforeMount-ä¸-mounted"><a href="#beforeMount-ä¸-mounted" class="headerlink" title="beforeMount ä¸ mounted"></a>beforeMount ä¸ mounted</h5><p>ç„¶åæ˜¯åœ¨ mountComponent ä¸­æ‰§è¡Œ  beforeMount ä»¥åŠ mountedï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">export function mountComponent (  vm: Component,  el: ?Element,  hydrating?: boolean): Component &#123;  &#x2F;&#x2F; ...  callHook(vm, &#39;beforeMount&#39;)  &#x2F;&#x2F; ç•¥ï¼š...è¿™é‡Œæœ‰ä¸ªéç”Ÿäº§ç¯å¢ƒçš„åˆ¤æ–­ï¼Œè¿™é‡Œä¸è€ƒè™‘ç®€åŒ–æˆå¦‚ä¸‹ï¼š  let updateComponent &#x3D; () &#x3D;&gt; &#123;      vm._update(vm._render(), hydrating)   &#125;  &#x2F;&#x2F; è¿™é‡Œå®ä¾‹åŒ– Watcherï¼šå¯ä»¥çœ‹ä½œæ˜¯æ›´æ–°è§†å›¾ç”¨çš„è§‚å¯Ÿè€…ï¼Œè¿™é‡Œçœç•¥ä¸€äº›å‚æ•°  new Watcher(vm, updateComponent)  &#x2F;&#x2F; ...ä»…è€ƒè™‘ new Vue çš„æƒ…å†µï¼Œä»£ç ç®€åŒ–å¦‚ä¸‹  callHook(vm, &#39;mounted&#39;)  return vm&#125;</code></pre><p>æŒ‚è½½ç»„ä»¶çš„æ—¶å€™å°±ä¼šå®ä¾‹åŒ–ä¸€ä¸ª <code>Watcher</code></p><h5 id="Watcher"><a href="#Watcher" class="headerlink" title="Watcher"></a>Watcher</h5><p>å½“æˆ‘ä»¬å®ä¾‹åŒ– Watcher çš„æ—¶å€™ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">let uid &#x3D; 0export default class Watcher &#123;  constructor (    vm: Component,    expOrFn: string | Function,  ) &#123;    &#x2F;&#x2F; ç•¥ï¼š...ä¸€äº›åˆå§‹åŒ–    this.deps &#x3D; []    this.newDeps &#x3D; []    this.depIds &#x3D; new Set()    this.newDepIds &#x3D; new Set()    &#x2F;&#x2F; ç•¥ï¼š...ä¸€äº›åˆå§‹åŒ–    &#x2F;&#x2F; ç•¥ï¼š...å¯¹ this.getter çš„ä¸€äº›åˆå§‹åŒ–    if (this.computed) &#123;      &#x2F;&#x2F; computed çš„æƒ…å†µï¼Œæœ¬æ–‡æš‚ä¸è€ƒè™‘    &#125; else &#123;      &#x2F;&#x2F; åˆå§‹åŒ–æ—¶å°±ä¼šæ‰§è¡Œ get æ–¹æ³•      this.value &#x3D; this.get()    &#125;  &#125;  get () &#123;    &#x2F;&#x2F; pushTarget ç”¨äºå°† watcher å®ä¾‹æŒ‚åˆ° Dep çš„ target è¿™ä¸ªé™æ€å±æ€§ä¸Š    pushTarget(this)    let value    const vm &#x3D; this.vm    try &#123;      &#x2F;&#x2F; æ­¤æ—¶çš„ this.getter å®é™…ä¸Šå°±æ˜¯ updateComponent      value &#x3D; this.getter.call(vm, vm)    &#125; catch (e) &#123;      &#x2F;&#x2F; ç•¥ï¼š...é”™è¯¯å¤„ç†    &#125; finally &#123;      &#x2F;&#x2F; ç•¥ï¼š...é€’å½’è®¿é—® valueï¼Œè§¦å‘å®ƒæ‰€æœ‰å­é¡¹çš„ getter      this.cleanupDeps()    &#125;    return value  &#125;  &#x2F;&#x2F; ...&#125;</code></pre><p><code>pushTarget</code> å°† <code>watcher</code> å®ä¾‹æŒ‚åˆ° <code>Dep</code> çš„ <code>target</code> è¿™ä¸ªé™æ€å±æ€§, ç”¨äº <code>Dep</code> å†…éƒ¨å¯ä»¥è®¿é—®åˆ°ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">function pushTarget (_target: ?Watcher) &#123;&#x2F;&#x2F; ...  Dep.target &#x3D; _target&#125;</code></pre><p>æ¥ç€è°ƒç”¨ <code>this.getter</code>, è¿™é‡Œçš„ <code>this.getter</code> å®é™…ä¸Šå°±æ˜¯ <code>updateComponent</code>:</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">vm._update(vm._render(), hydrating)</code></pre><p><code>vm._render()</code> ä¼šç”Ÿæˆ VNodeï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šè®¿é—® vm ä¸Šçš„æ•°æ®ï¼Œè‡³æ­¤å°±ä¼šè§¦å‘æ•°æ®å¯¹è±¡çš„ getterï¼Œè¿›è¡Œä¾èµ–æ”¶é›†ã€‚</p><h5 id="æ€è·¯å°ç»“"><a href="#æ€è·¯å°ç»“" class="headerlink" title="æ€è·¯å°ç»“"></a>æ€è·¯å°ç»“</h5><p>è‡³æ­¤æˆ‘ä»¬å…ˆæ¢³ç†ä¸€ä¸‹è¿™ä¸€æ•´ä¸ªè¿‡ç¨‹ï¼Œä»¥å…é—å¿˜ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">beforeCreate &#x3D;&gt; initState -&gt; observe -&gt; new Observer  -&gt; defineReactiveï¼šå®ä¾‹åŒ– Depï¼ŒåŠ«æŒå¯¹è±¡å±æ€§ getter ä¸ setter&#x3D;&gt; created&#x3D;&gt; beforeMount  å®ä¾‹åŒ– Watcher -&gt; å°† watcher å®ä¾‹ç»‘å®šåˆ° Dep.targetï¼Œå¹¶è§¦å‘å¯¹è±¡å±æ€§çš„ getterï¼Œæ”¶é›†ä¾èµ–&#x3D;&gt; mounted&#x3D;&gt; å½“æ•°æ®æ¨¡å‹å˜æ›´æ—¶ï¼Œè§¦å‘ setterï¼Œæ›´æ–°è§†å›¾</code></pre><p>åœ¨ defineReactive ä¸­æœ‰ä¸ªå…³é”®çš„æ­¥éª¤æ˜¯å®ä¾‹åŒ– <code>Dep</code>ã€‚</p><h5 id="Dep"><a href="#Dep" class="headerlink" title="Dep"></a>Dep</h5><p>ä¸Šé¢è¯´è¿‡ Dep å®ä¾‹æ˜¯ä¸€ä¸ªå‘å¸ƒè€…ï¼Œå…¶ä»£ç å…¶å®å¾ˆç®€å•ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">export default class Dep &#123;  constructor () &#123;    this.subs &#x3D; []  &#125;    addSub (sub: Watcher) &#123;    this.subs.push(sub)  &#125;  removeSub (sub: Watcher) &#123;    remove(this.subs, sub)  &#125;  depend () &#123;    if (Dep.target) &#123;      &#x2F;&#x2F; è¿™é‡Œå°† Dep.target å³ watcher æ·»åŠ åˆ° subs é‡Œ      Dep.target.addDep(this)    &#125;  &#125;  notify () &#123;    &#x2F;&#x2F; å‘å¸ƒé€šçŸ¥    const subs &#x3D; this.subs.slice()    for (let i &#x3D; 0, l &#x3D; subs.length; i &lt; l; i++) &#123;      subs[i].update()    &#125;  &#125;&#125;</code></pre><p>æˆ‘ä»¬æœ€ç»ˆè°ƒç”¨çš„æ˜¯ <code>depend</code>æ–¹æ³•æ¥æ·»åŠ è§‚å¯Ÿè€…ï¼Œå³<code>Dep.target.addDep</code>ï¼Œæˆ‘ä»¬çŸ¥é“æ­¤æ—¶ Dep.target å®é™…ä¸Šå°±æ˜¯ watcher å®ä¾‹ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; ...addDep (dep: Dep) &#123;  const id &#x3D; dep.id  if (!this.newDepIds.has(id)) &#123;    &#x2F;&#x2F; å°†å‘å¸ƒè€… id æ·»åŠ åˆ° this.newDepIds    this.newDepIds.add(id)    &#x2F;&#x2F; å°†å‘å¸ƒè€… æ·»åŠ åˆ° this.newDeps    this.newDeps.push(dep)    if (!this.depIds.has(id)) &#123;      &#x2F;&#x2F; å¦‚æœæ—§çš„ å‘å¸ƒè€…id åˆ—è¡¨ä¸­æ²¡æœ‰è¿™ä¸ªå‘å¸ƒè€… idï¼Œé‚£ä¹ˆå°±æ·»åŠ åˆ°å‘å¸ƒè€…çš„è§‚å¯Ÿè€…åˆ—è¡¨ä¸­      dep.addSub(this)    &#125;  &#125;&#125;&#x2F;&#x2F; ...</code></pre><p>è€Œåœ¨ watcher ä¸­ï¼Œæœ€ç»ˆè¿˜æ˜¯è°ƒç”¨äº†ä¼ å…¥çš„ dep å®ä¾‹çš„ addSub æ¥æ·»åŠ åˆ° dep çš„è§‚å¯Ÿè€…åˆ—è¡¨ä¸­ã€‚ä¹‹æ‰€ä»¥è¿™ä¹ˆè®¾è®¡ï¼Œå…¶åŸå› æ˜¯ä¸ºäº†èƒ½åœ¨ watcher ä¸­ç»´æŠ¤ä¸€ä¸ªè‡ªå·±è®¢é˜…çš„å‘å¸ƒè€…åˆ—è¡¨ã€‚</p><p>é‚£ä¹ˆ watcher ä¸­çš„å‘å¸ƒè€…åˆ—è¡¨æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿè¿˜è®°å¾— Watcher å®ä¾‹åŒ–çš„æœ€åä¼šè°ƒç”¨  <code>this.cleanupDeps()</code> å—ï¼Ÿ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">cleanupDeps () &#123;  let i &#x3D; this.deps.length  while (i--) &#123;    const dep &#x3D; this.deps[i]    if (!this.newDepIds.has(dep.id)) &#123;      dep.removeSub(this)    &#125;  &#125;  let tmp &#x3D; this.depIds  this.depIds &#x3D; this.newDepIds  this.newDepIds &#x3D; tmp  this.newDepIds.clear()  tmp &#x3D; this.deps  this.deps &#x3D; this.newDeps  this.newDeps &#x3D; tmp  this.newDeps.length &#x3D; 0&#125;</code></pre><p>è¿™ä¸ªå‡½æ•°å®é™…ä¸Šçš„ä½œç”¨æ˜¯ï¼š</p><ol><li><p>å¦‚æœæ— éœ€å†è§‚å¯Ÿï¼Œåˆ™ä»å‘å¸ƒè€…çš„è§‚å¯Ÿè€…åˆ—è¡¨ä¸­ç§»é™¤</p></li><li><p>å°†æœ¬æ¬¡çš„å‘å¸ƒè€… id åˆ—è¡¨è®°å½•åœ¨ this.depsIds ä¸­ï¼Œæ¸…ç©º this.newDepIds</p></li><li><p>å°†æœ¬æ¬¡çš„å‘å¸ƒè€…åˆ—è¡¨è®°å½•åœ¨ this.deps ä¸­ï¼Œæ¸…ç©º this.newDeps</p><p>é‚£ä¹ˆå…·ä½“æ˜¯å¦‚ä½•å°†å¯¹è±¡å±æ€§è½¬ä¸ºå“åº”å¼çš„å‘¢ï¼Œæˆ‘ä»¬çœ‹çœ‹å…¶å…·ä½“å®ç°ï¼š</p></li></ol><h5 id="reactiveGetter"><a href="#reactiveGetter" class="headerlink" title="reactiveGetter"></a>reactiveGetter</h5><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">function reactiveGetter () &#123;  &#x2F;&#x2F; ...  &#x2F;&#x2F; æ­¤æ—¶çš„ Dep.target å°±æ˜¯ watcherï¼Œå…³äº Dep åé¢ä¼šè¯¦ç»†è§£é‡Š  if (Dep.target) &#123;    &#x2F;&#x2F; è¿™é‡Œä¼šå°† watcher å®ä¾‹æ·»åŠ è¿› dep çš„ subs ä¸­ç»´æŠ¤ï¼Œå³æ”¶é›†ä¾èµ–    dep.depend()    if (childOb) &#123;      &#x2F;&#x2F; å­å¯¹è±¡çš„ä¾èµ–æ”¶é›†      childOb.dep.depend()      &#x2F;&#x2F; ç•¥ï¼š...å¯¹æ•°ç»„çš„ä¸€äº›å¤„ç†    &#125;  &#125;  &#x2F;&#x2F; è¿”å›å±æ€§å€¼  return value&#125;</code></pre><h5 id="reactiveSetter"><a href="#reactiveSetter" class="headerlink" title="reactiveSetter"></a>reactiveSetter</h5><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">function reactiveSetter (newVal) &#123;  &#x2F;&#x2F; valueï¼šå±æ€§å€¼  const value &#x3D; ...  &#x2F;&#x2F; ç•¥ï¼š...ä¸€äº›åˆ¤æ–­æ˜¯å¦è§¦å‘ setter çš„æ¡ä»¶  if (setter) &#123;    setter.call(obj, newVal)  &#125; else &#123;    val &#x3D; newVal  &#125;  &#x2F;&#x2F; è®¾ç½®æ–°å€¼åéœ€è¦é‡æ–° observe  childOb &#x3D; !shallow &amp;&amp; observe(newVal)  &#x2F;&#x2F; å‘å¸ƒé€šçŸ¥  dep.notify()&#125;</code></pre><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>æœ¬æ–‡ç®€åŒ–äº†ä¸€äº›ç»†èŠ‚ï¼Œä½†æ˜¯ Vue çš„å“åº”å¼åŸç†å¤§è‡´å¦‚æ­¤ã€‚å½“ç†è§£äº†åŸç†ä¹‹åï¼Œå¦‚æœåé¢é—å¿˜äº†çš„è¯ï¼Œä»¥ä¸‹ä¸ºé‡è¦çš„è®°å¿†ç‚¹ï¼š</p><ol><li>observeï¼šå®ä¾‹åŒ– Observeï¼Œå‚æ•°ä¸ºæ•°æ®æ¨¡å‹ï¼Œå®ä¾‹åŒ–è¿‡ç¨‹ä¼šè°ƒç”¨éå†å¯¹è±¡å±æ€§è°ƒç”¨ defineReactive</li><li>defineReactiveï¼šå®ä¾‹åŒ– Depï¼ŒåŠ«æŒå¯¹è±¡å±æ€§çš„ getter ä¸ setterï¼Œgetter æ—¶è¿›è¡Œä¾èµ–æ”¶é›†</li><li>åœ¨æŒ‚è½½ç»„ä»¶çš„æ—¶å€™ï¼Œä¼šå®ä¾‹åŒ– Watcherï¼Œæ­¤æ—¶ä¼šè§¦å‘ getter</li><li>å½“æ›´æ–°å¯¹è±¡å±æ€§æ—¶ï¼Œä¼šè°ƒç”¨ Dep å®ä¾‹çš„ notifyï¼Œè§¦å‘ watcher çš„ update</li></ol>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼-JSä¸­çš„è§‚å¯Ÿè€…æ¨¡å¼ä¸å‘å¸ƒè®¢é˜…æ¨¡å¼</title>
      <link href="/2020/08/08/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-JS%E4%B8%AD%E7%9A%84%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E4%B8%8E%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F/"/>
      <url>/2020/08/08/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-JS%E4%B8%AD%E7%9A%84%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E4%B8%8E%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ã€Šdebounceä¸throttleã€‹ ä¸­æåˆ°äº† RxJSï¼Œ RxJS ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µ: Observableï¼ˆå¯è¢«è§‚å¯Ÿè€…ï¼‰ å’Œ Observerï¼ˆè§‚å¯Ÿè€…ï¼‰ï¼ŒRxJS çš„ Observable å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼å’Œè¿­ä»£å™¨æ¨¡å¼çš„ç»„åˆã€‚</p><p>åœ¨ javascript ä¸­ï¼Œè§‚å¯Ÿè€…æ¨¡å¼å’Œå‘å¸ƒè®¢é˜…æ¨¡å¼æä¸ºç›¸ä¼¼ï¼Œå› æ­¤æœ¬æ–‡å°†æ¢è®¨è¿™ä¸¤ç§æ¨¡å¼ä»¥åŠå…¶åº”ç”¨ã€‚</p> <a id="more"></a><h4 id="è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver-patternï¼‰"><a href="#è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver-patternï¼‰" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver patternï¼‰"></a>è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver patternï¼‰</h4><blockquote><p>è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œè®©å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬æŸä¸€ä¸ªç›®æ ‡å¯¹è±¡ï¼Œå½“è¿™ä¸ªç›®æ ‡å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡ï¼Œä½¿å®ƒä»¬èƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°ã€‚ â€”â€” Graphic Design Patterns</p></blockquote><p>è§‚å¯Ÿè€…æ¨¡å¼æœ‰ä¸¤ä¸ªå¯¹è±¡ï¼šä¸€ä¸ªæ˜¯è§‚å¯Ÿè€…ï¼Œå¦ä¸€ä¸ªä¸Šé¢æåˆ°çš„ç›®æ ‡å¯¹è±¡å¯ä»¥ç§°ä¸ºæ˜¯å‘å¸ƒè€…ï¼ŒåŸºæœ¬çš„æµç¨‹ä¸ºï¼š</p><ol><li>å‘å¸ƒè€…ç»´æŠ¤ä¸€ä¸ªè§‚å¯Ÿè€…åˆ—è¡¨ï¼Œå¯ä»¥æ·»åŠ æˆ–è€…åˆ é™¤è§‚å¯Ÿè€…</li><li>å½“å‘å¸ƒè€…å‘å¸ƒé€šçŸ¥æ—¶ï¼Œéå†è§‚å¯Ÿè€…åˆ—è¡¨ï¼Œå¹¶è°ƒç”¨è§‚å¯Ÿè€…æä¾›çš„æ–¹æ³•</li></ol><p>å‘å¸ƒè€…çš„å®ç°å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; å‘å¸ƒè€…class Publisher &#123;  constructor() &#123;    &#x2F;&#x2F; ç»´æŠ¤ä¸€ä¸ªè§‚å¯Ÿè€…åˆ—è¡¨    this.observers &#x3D; []      &#125;      &#x2F;&#x2F; æ·»åŠ è§‚å¯Ÿè€…  addObserver(observer) &#123;    this.observers.push(observer)  &#125;  &#x2F;&#x2F; ç§»é™¤è§‚å¯Ÿè€…  removeObserver(observer) &#123;    this.observers &#x3D; this.observers.filter(item &#x3D;&gt; item !&#x3D;&#x3D; observer)  &#125;  &#x2F;&#x2F; å‘å¸ƒé€šçŸ¥  notify() &#123;    this.observers.forEach((item) &#x3D;&gt; &#123;      &#x2F;&#x2F; æ‰§è¡Œè§‚å¯Ÿè€…æä¾›çš„æ–¹æ³•ï¼Œè¿™é‡Œå‡è®¾ä¸º update      item.update()    &#125;)  &#125;&#125;</code></pre><p>è®¢é˜…è€…åˆ™æ¯”è¾ƒç®€å•ï¼Œå®ç°å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class Observer &#123;  constructor(name) &#123;    this.name &#x3D; name  &#125;  update() &#123;    &#x2F;&#x2F; æ›´æ–°çŠ¶æ€    console.log(&#96;observer $&#123;this.name&#125; update&#96;)  &#125;&#125;</code></pre><p>æœ€ç»ˆï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const a &#x3D; new Observer(&#39;a&#39;)const b &#x3D; new Observer(&#39;b&#39;)const c &#x3D; new Observer(&#39;c&#39;)const publisher &#x3D; new Publisher()publisher.addObserver(a)publisher.addObserver(b)publisher.addObserver(c)&#x2F;&#x2F; å‘å¸ƒé€šçŸ¥publisher.notify()&#x2F;&#x2F; a b c</code></pre><p>Vue çš„å“åº”å¼åŸç†å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼çš„ä¸€ä¸ªå…¸å‹åº”ç”¨ï¼Œå…³äº Vue çš„å“åº”å¼ç”±äºç¯‡å¹…åŸå› ï¼Œå°†ä¼šå¦èµ·ä¸€ç¯‡è¯¦ç»†åˆ†æã€‚</p><h4 id="å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆPub-sub-patternï¼‰"><a href="#å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆPub-sub-patternï¼‰" class="headerlink" title="å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆPub-sub patternï¼‰"></a>å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆPub-sub patternï¼‰</h4><p>å‘å¸ƒè®¢é˜…æ¨¡å¼æ˜¯ä»è§‚å¯Ÿè€…æ¨¡å¼å‘å±•è€Œæ¥ï¼Œä¸¤è€…çš„åŒºåˆ«åœ¨äºï¼šè§‚å¯Ÿè€…æ¨¡å¼ä¸­å‘å¸ƒè€…ä¸è§‚å¯Ÿè€…æ˜¯æ¾è€¦åˆï¼Œè€Œå‘å¸ƒè®¢é˜…åˆ™åœ¨å‘å¸ƒè€…ä¸è®¢é˜…è€…ä¸­åŠ å…¥äº†äº‹ä»¶ä¸­å¿ƒå®ç°å‘å¸ƒè€…ä¸è§‚å¯Ÿè€…çš„å®Œå…¨è§£è€¦ã€‚</p><p>ç”¨å‘å¸ƒè®¢é˜…æ¨¡å¼æ¨¡æ‹Ÿäº‹ä»¶ç»‘å®šï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class EventCenter &#123;  constructor() &#123;    this.observers &#x3D; &#123;&#125;  &#125;  addListener(type, fn) &#123;    this.observers[type] &#x3D; [...(this.observers[type] || []), fn]  &#125;  removeListener(type, fn) &#123;    let listeners &#x3D; this.observers[type];    if (!listeners || !listeners.length) return;    this.observers[type] &#x3D; listeners.filter(v &#x3D;&gt; v !&#x3D;&#x3D; fn);  &#125;  dispatchEvent(type) &#123;    let listeners &#x3D; this.observers[type];    if (!listeners || !listeners.length) return;    listeners.forEach(fn &#x3D;&gt; fn());          &#125;&#125;const evtCenter &#x3D; new EventCenter()function handleClick () &#123;  console.log(&#39;click&#39;)&#125;&#x2F;&#x2F; è®¢é˜… click äº‹ä»¶evtCenter.addListener(&#39;click&#39;, handleClick)&#x2F;&#x2F; å‘å¸ƒ click äº‹ä»¶evtCenter.dispatchEvent(&#39;click&#39;)&#x2F;&#x2F; å–æ¶ˆè®¢é˜…evtCenter.removeListener(&#39;click&#39;, handleClick)</code></pre><p>å¯ä»¥çœ‹åˆ°ä¸è§‚å¯Ÿè€…æ¨¡å¼ä¸åŒï¼Œåœ¨å‘å¸ƒè®¢é˜…æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬çš„å‘å¸ƒå’Œè®¢é˜…éƒ½æ˜¯é€šè¿‡äº‹ä»¶ä¸­å¿ƒæ¥è¿›è¡Œè°ƒåº¦çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>debounceä¸throttle</title>
      <link href="/2020/08/06/debounce%E4%B8%8Ethrottle/"/>
      <url>/2020/08/06/debounce%E4%B8%8Ethrottle/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>æµ‹è¯•åŒå­¦æäº†ä¸ª bugï¼Œåœ¨æœç´¢æ¡†ä¸­ç–¯ç‹‚è¾“å…¥æ–‡å­—ï¼Œä¸ä¸€ä¼šå„¿æ¥å£å°±æŠ¥é”™äº†ã€‚è¿™ä¸ª bug å®é™…ä¸Šå°±æ˜¯ç”±äºæ¯è¾“å…¥ä¸€ä¸ªå­—ç¬¦æ—¶ï¼Œå°±å»è¯·æ±‚æ¥å£å¼•èµ·çš„ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const handleSearch &#x3D; () &#x3D;&gt; &#123;&#x2F;&#x2F; ...è¯·æ±‚æ¥å£&#125;&lt;Input onChange&#x3D;&#123;handleSearch&#125; &#x2F;&gt;</code></pre><p>è§£å†³æ–¹æ³•æ˜¯é€šè¿‡ <code>debounce</code> æ¥æ§åˆ¶è¾“å…¥çš„é¢‘ç‡ã€‚</p><p>å®é™…ä¸Š <code>debounce</code> å’Œ <code>throttle</code> è¿™ä¸¤ä¸ªæ¦‚å¿µç»å¸¸æ˜¯ä¸€èµ·å‡ºç°ï¼Œåœ¨å·¥ä½œä¸­ä¹Ÿå¸¸å¸¸ä½¿ç”¨åˆ°ã€‚åœ¨æ—©å¹´æ¥è§¦å‰ç«¯çš„æ—¶å€™ï¼Œé¡¹ç›®é‡Œæœ‰ <code>lodash</code>ï¼Œå› æ­¤ç›´æ¥ä½¿ç”¨å…¶æä¾›çš„  <code>debounce</code> å’Œ <code>throttle</code> ã€‚è€Œåœ¨ä¸€äº›ç®€å•çš„é¡¹ç›®é‡Œï¼Œå¾€å¾€ä¸å¼•å…¥ <code>lodash</code>ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦è‡ªå·±å®ç°ï¼Œäºæ­¤åšä¸ªè®°å½•ã€‚</p><a id="more"></a><h4 id="debounce"><a href="#debounce" class="headerlink" title="debounce"></a>debounce</h4><p><code>debounce</code> ä¹Ÿå°±æ˜¯é˜²æŠ–ï¼Œçœ‹çœ‹ lodash ä¸­ debounce çš„å®šä¹‰ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">_.debounce(func, [wait&#x3D;0], [options&#x3D;&#123;&#125;])</code></pre><p>è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šè·ç¦»ä¸Šæ¬¡è°ƒç”¨åï¼Œå»¶è¿Ÿ <code>wait</code> æ¯«ç§’åè°ƒç”¨<code>func</code>ã€‚</p><p>åœ¨ä¸Šé¢çš„ bug ä¸­ï¼Œå¯¹åŸæœç´¢æ–¹æ³•è¿›è¡Œé˜²æŠ–å¤„ç†åï¼Œä»…å½“ç”¨æˆ·åœæ­¢è¾“å…¥ 300 æ¯«ç§’åï¼Œæ‰è¯·æ±‚æ¥å£è¿›è¡Œæœç´¢ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; åœæ­¢è¾“å…¥ 300 ms åï¼Œè¿›è¡Œæœç´¢_.debounce(handleSearch, 300)</code></pre><p>####throttle</p><p><code>throttle</code> æˆ‘ä»¬ç§°ä¹‹ä¸ºæˆªæµï¼ŒåŒæ ·çœ‹çœ‹ loads ä¸­ throttle çš„å®šä¹‰ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">_.throttle(func, [wait&#x3D;0], [options&#x3D;&#123;&#125;])</code></pre><p>è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æœ€å¤šæ¯ <code>wait</code> æ¯«ç§’è°ƒç”¨ä¸€æ¬¡ <code>func</code>ã€‚</p><p>å¦‚æœå¯¹æœç´¢æ–¹æ³•è¿›è¡Œæˆªæµï¼Œåˆ™æ— è®ºç”¨æˆ·è¾“å…¥å¤šå¿«ï¼Œæ¯ 1 ç§’ä»…è¯·æ±‚ä¸€æ¬¡ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; åœæ­¢è¾“å…¥ 300 ms åï¼Œè¿›è¡Œæœç´¢_.debounce(handleSearch, 1000)</code></pre><h4 id="æ‰‹å†™ä¸€ä¸ª-debounce"><a href="#æ‰‹å†™ä¸€ä¸ª-debounce" class="headerlink" title="æ‰‹å†™ä¸€ä¸ª debounce"></a>æ‰‹å†™ä¸€ä¸ª debounce</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">function debounce(func, wait &#x3D; 0) &#123;  let timeout  return function(...args) &#123;    if(timeout) &#123;      clearTimeout(timeout)    &#125;    timeout &#x3D; setTimeout(() &#x3D;&gt; func.call(this, ...args), wait)  &#125;&#125;</code></pre><p>ç”±äº func è¢«å½“ä½œæ˜¯å‚æ•°ä¼ é€’è¿›æ¥ï¼Œæ³¨æ„ä¸Šé¢çš„ func éœ€è¦ç»‘å®š thisã€‚å¹¶ä¸”åœ¨ä½¿ç”¨æ—¶å¦‚æœæœ‰ this æŒ‡å‘ï¼Œéœ€è¦æ˜¾å¼æŒ‡æ˜ thisï¼Œå¦‚ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const o &#x3D; &#123;  a: 1,  b: function() &#123;      console.log(this.a);  &#125;&#125;const c &#x3D; debounce(o.b).bind(o);</code></pre><p>å¯¹ debounce è¿›ä¸€æ­¥æ‹“å±•ï¼Œå¦‚æœéœ€è¦åœ¨è°ƒç”¨æ—¶ç«‹åˆ»æ‰§è¡Œä¸€æ¬¡ï¼Œåˆ™å¯ä»¥ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">function debounce(func, wait &#x3D; 0, head) &#123;  let timeout;  return function (...args) &#123;    const callNow &#x3D; head &amp;&amp; !timeout;    timeout &amp;&amp; clearTimeout(timeout);    timeout &#x3D; setTimeout(() &#x3D;&gt; &#123;      if(!callNow) &#123;        func.call(this, ...args);      &#125;      timeout &#x3D; null    &#125;, wait);    if (callNow) &#123;      func.call(this, ...args)    &#125;;  &#125;;&#125;</code></pre><h4 id="æ‰‹å†™ä¸€ä¸ª-throttle"><a href="#æ‰‹å†™ä¸€ä¸ª-throttle" class="headerlink" title="æ‰‹å†™ä¸€ä¸ª throttle"></a>æ‰‹å†™ä¸€ä¸ª throttle</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">function throttle(func, timeFrame &#x3D; 0) &#123;  let lastTime &#x3D; 0;  return function () &#123;      const now &#x3D; new Date();      if (now - lastTime &gt;&#x3D; timeFrame) &#123;          func.call(this, ...args);          lastTime &#x3D; now;      &#125;  &#125;;&#125;</code></pre><h4 id="whatâ€™s-more-rxjs"><a href="#whatâ€™s-more-rxjs" class="headerlink" title="whatâ€™s more: rxjs"></a>whatâ€™s more: rxjs</h4><p>æˆªæµå’Œé˜²æŠ–å¾ˆå¤šæ—¶å€™æ˜¯å‡ºç°åœ¨äº‹ä»¶ä¸­çš„ï¼Œä½¿ç”¨ rxjs åˆ™å¯ä»¥ä½¿ç”¨ debounceTime å’Œ throttleTimeï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">import &#123; fromEvent &#125; from &#39;rxjs&#39;;import &#123; debounceTime &#125; from &#39;rxjs&#x2F;operators&#39;;const inputEle &#x3D; document.getElementById(&#39;input&#39;)const inputs &#x3D; fromEvent(inputEle, &#39;input&#39;);const result &#x3D; inputs.pipe(debounceTime(1000));&#x2F;&#x2F; å¦‚æœæ˜¯èŠ‚æµå¯ä½¿ç”¨ throttleTime&#x2F;&#x2F; const result &#x3D; inputs.pipe(throttleTime(1000));result.subscribe(x &#x3D;&gt; console.log(x));</code></pre><h4 id="rxjs-react"><a href="#rxjs-react" class="headerlink" title="rxjs + react"></a>rxjs + react</h4><p>å¦‚æœæ˜¯ react ä¸­çš„äº‹ä»¶éœ€è¦é˜²æŠ–ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ <code>Subject</code> æ¥å®ç°ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import React, &#123; useEffect &#125; from &quot;react&quot;;import &#123; Subject &#125; from &quot;rxjs&quot;;import &quot;rxjs&#x2F;add&#x2F;operator&#x2F;debounceTime&quot;;const value$ &#x3D; new Subject().debounceTime(300);export default function App() &#123;  useEffect(() &#x3D;&gt; &#123;    const subscription &#x3D; value$.subscribe(console.log)      return () &#x3D;&gt; subscription.unsubscribe()  &#125;, [])  const onChange &#x3D; e &#x3D;&gt; &#123;    value$.next(e.target.value);  &#125;;  return (    &lt;div&gt;      &lt;input onChange&#x3D;&#123;onChange&#125; &#x2F;&gt;    &lt;&#x2F;div&gt;  );&#125;</code></pre>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å½“æˆ‘ä»¬è¯´åˆ°æ‰“åŒ…æ—¶ï¼Œæˆ‘ä»¬åœ¨è¯´ä»€ä¹ˆ</title>
      <link href="/2020/07/31/%E5%BD%93%E6%88%91%E4%BB%AC%E8%AF%B4%E5%88%B0%E6%89%93%E5%8C%85%E6%97%B6%EF%BC%8C%E6%88%91%E4%BB%AC%E5%9C%A8%E8%AF%B4%E4%BB%80%E4%B9%88/"/>
      <url>/2020/07/31/%E5%BD%93%E6%88%91%E4%BB%AC%E8%AF%B4%E5%88%B0%E6%89%93%E5%8C%85%E6%97%B6%EF%BC%8C%E6%88%91%E4%BB%AC%E5%9C%A8%E8%AF%B4%E4%BB%80%E4%B9%88/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>ä»æ—©æœŸçš„ grunt (æˆ‘æ¥è§¦å‰ç«¯å¼€å‘çš„æ—¶å€™è¿™ä¸ªå·²ç»è¶‹äºæ²¡è½) åˆ° gulpï¼Œå†åˆ°å¦‚ä»Šçš„ webpackï¼Œrollup ï¼Œparcelï¼Œä»¥åŠ snowpackï¼Œviteï¼Œå¦‚ä»Šçš„å‰ç«¯å·²ç»è„±ç¦»äº†åˆ€è€•ç«ç§çš„æ—¶ä»£ï¼Œå„ç§æ‰“åŒ…å·¥å…·å±‚å‡ºä¸ç©·ã€‚å‰ç«¯é¡¹ç›®åŸºæœ¬ç¦»ä¸å¼€æ‰“åŒ…è¿™ä¸ªè¿‡ç¨‹ã€‚é‚£ä¹ˆå½“æˆ‘ä»¬è¯´åˆ°æ‰“åŒ…ï¼ˆbundleï¼‰æ—¶ï¼Œæˆ‘ä»¬åœ¨è¯´çš„æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>è¿™é‡Œä¸å¯¹ webpack æˆ–è€…è¿™äº›æ‰“åŒ…å·¥å…·çš„ä½¿ç”¨è¿›è¡Œå…·ä½“è¯´æ˜ï¼Œæœ¬æ–‡æƒ³æ¢ç©¶çš„æ˜¯æ‰“åŒ…çš„æœ¬è´¨ã€‚</p><a id="more"></a><h4 id="ä»æ¨¡å—åŒ–è¯´èµ·"><a href="#ä»æ¨¡å—åŒ–è¯´èµ·" class="headerlink" title="ä»æ¨¡å—åŒ–è¯´èµ·"></a>ä»æ¨¡å—åŒ–è¯´èµ·</h4><p>åœ¨æ²¡æœ‰æ¨¡å—åŒ–ä¹‹å‰ï¼Œå‰ç«¯å¼€å‘æ—¶éœ€è¦æ ¼å¤–æ³¨æ„å‘½åå†²çªä»¥åŠæ–‡ä»¶ä¹‹é—´çš„ç›¸äº’ä¾èµ–ï¼Œå‚è€ƒ <a href="https://github.com/seajs/seajs/issues/547#issue-11105836ã€‚">https://github.com/seajs/seajs/issues/547#issue-11105836ã€‚</a></p><p>æ¨¡å—åŒ–å®é™…ä¸Šå°±æ˜¯å°†ç¨‹åºåˆ†è§£æˆç¦»æ•£çš„åŠŸèƒ½å—ï¼Œä½¿ä»£ç æ˜“äºå¤ç”¨ï¼Œç»´æŠ¤å’Œæµ‹è¯•ã€‚å¦‚ less ä¸­é€šè¿‡ @import å¼•å…¥çš„æ ·å¼ï¼ŒES6 Module / CommonJs å¼•å…¥çš„ Js ç­‰éƒ½å¯ä»¥ç§°ä¸ºæ¨¡å—ã€‚</p><p>ç„¶è€Œæµè§ˆå™¨ä¸æ”¯æŒæ¨¡å—åŒ–ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ‰“åŒ…å·¥å…·ï¼Œå°†ä»£ç ä¸­è¯¸å¦‚ require, @import, import è¿›æ¥çš„æ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæˆ–è€…å¤šä¸ªæ–‡ä»¶(å³ bundle)ã€‚</p><h4 id="æ‰“åŒ…çš„æœ¬è´¨"><a href="#æ‰“åŒ…çš„æœ¬è´¨" class="headerlink" title="æ‰“åŒ…çš„æœ¬è´¨"></a>æ‰“åŒ…çš„æœ¬è´¨</h4><p>å‚è€ƒ webpack çš„å®šä¹‰ï¼š</p><blockquote><p>æœ¬è´¨ä¸Šï¼Œ<em>webpack</em> æ˜¯ä¸€ä¸ªç°ä»£ JavaScript åº”ç”¨ç¨‹åºçš„<em>é™æ€æ¨¡å—æ‰“åŒ…å™¨(module bundler)</em>ã€‚å½“ webpack å¤„ç†åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šé€’å½’åœ°æ„å»ºä¸€ä¸ª<em>ä¾èµ–å…³ç³»å›¾(dependency graph)</em>ï¼Œå…¶ä¸­åŒ…å«åº”ç”¨ç¨‹åºéœ€è¦çš„æ¯ä¸ªæ¨¡å—ï¼Œç„¶åå°†æ‰€æœ‰è¿™äº›æ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæˆ–å¤šä¸ª <em>bundle</em>ã€‚</p></blockquote><p>è€Œè‡³äºè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¯¹ä»£ç è¿›è¡Œå‹ç¼©ï¼Œæ··æ·†ç­‰ç­‰åˆ™æ˜¯é”¦ä¸Šæ·»èŠ±çš„åŠŸèƒ½ã€‚</p><h4 id="æ‰“åŒ…çš„è¿‡ç¨‹"><a href="#æ‰“åŒ…çš„è¿‡ç¨‹" class="headerlink" title="æ‰“åŒ…çš„è¿‡ç¨‹"></a>æ‰“åŒ…çš„è¿‡ç¨‹</h4><p>è¿™é‡Œä»¥ webpack ä¸ºä¾‹ï¼š</p><ol><li>åˆå§‹åŒ–ï¼šä»é…ç½®æ–‡ä»¶å’Œ Shell è¯­å¥ä¸­è¯»å–å¹¶åˆå¹¶é…ç½®å‚æ•°</li><li>å¼€å§‹ç¼–è¯‘ï¼šæ ¹æ®ä¸Šé¢å¾—åˆ°çš„å‚æ•°åˆå§‹åŒ– Compilerï¼ŒåŠ è½½æ’ä»¶ï¼ˆPluginsï¼‰ï¼Œæ‰§è¡Œ Compiler çš„ run æ–¹æ³•å¼€å§‹ç¼–è¯‘</li><li>å…¥å£æ–‡ä»¶ï¼šé…ç½®çš„ entry</li><li>ä»å…¥å£æ–‡ä»¶å¼€å§‹ï¼Œé’ˆå¯¹ä¸åŒçš„æ¨¡å—ä½¿ç”¨å¯¹åº”çš„ Loader ç¼–è¯‘ï¼Œå†æ‰¾åˆ°è¯¥æ¨¡å—æ‰€ä¾èµ–çš„æ¨¡å—ï¼Œé€’å½’è¿™ä¸ªæ­¥éª¤</li><li>å®Œæˆç¼–è¯‘ï¼šç»è¿‡ä¸Šè¿°æ­¥éª¤åå¾—åˆ°æ¯ä¸ªæ¨¡å—ç¼–è¯‘åçš„å†…å®¹ä»¥åŠç›¸äº’ä¹‹é—´çš„ä¾èµ–å…³ç³»</li><li>è¾“å‡ºï¼šæ ¹æ®ä¾èµ–å…³ç³»ï¼Œå°†æ¨¡å—ç»„åˆæˆä¸€ä¸ªä¸ªä»£ç å—ï¼ˆChunkï¼‰ï¼Œæœ€åè¾“å‡ºæˆæ–‡ä»¶</li></ol><h4 id="å®ç°ä¸€ä¸ªç®€æ˜“çš„æ‰“åŒ…å·¥å…·"><a href="#å®ç°ä¸€ä¸ªç®€æ˜“çš„æ‰“åŒ…å·¥å…·" class="headerlink" title="å®ç°ä¸€ä¸ªç®€æ˜“çš„æ‰“åŒ…å·¥å…·"></a>å®ç°ä¸€ä¸ªç®€æ˜“çš„æ‰“åŒ…å·¥å…·</h4><p>å‚è€ƒ <a href="https://github.com/ronami">ronami</a>/<strong><a href="https://github.com/ronami/minipack">minipack</a></strong> å®ç°ä¸€ä¸ªæ”¯æŒ ES Module çš„ç®€æ˜“æ‰“åŒ…å·¥å…·ï¼ˆè¿™é‡Œä¸è€ƒè™‘å¾ªç¯ä¾èµ–ç­‰æƒ…å†µï¼‰ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const fs &#x3D; require(&#39;fs&#39;)const path &#x3D; require(&#39;path&#39;)const babylon &#x3D; require(&#39;babylon&#39;)const traverse &#x3D; require(&#39;babel-traverse&#39;).defaultconst &#123; transformFromAst &#125; &#x3D; require(&#39;babel-core&#39;)</code></pre><p>å¼•å…¥ä¸Šè¿°ç›¸å…³ä¾èµ–ï¼š</p><ul><li>babylonï¼šç”Ÿæˆ ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰</li><li>babel-traverseï¼šæ¥åˆ†ææ–‡ä»¶çš„ä¾èµ–</li><li>transformFromAstï¼šå°† AST è½¬ä¸º ES5</li></ul><p><strong>é¦–å…ˆ</strong> å®šä¹‰ä¸€ä¸ªå‡½æ•°ç”¨äºè¯»å–æ–‡ä»¶çš„å†…å®¹å’Œä¾èµ–ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;** * è¯»å–æ–‡ä»¶å†…å®¹å’Œä¾èµ– *&#x2F;function createAsset(filePath) &#123;&#x2F;&#x2F; è¯»å–æ–‡ä»¶å†…å®¹  const content &#x3D; fs.readFileSync(filePath, &#39;utf-8&#39;)  &#x2F;&#x2F; ç”Ÿæˆ AST  const ast &#x3D; babylon.parse(content, &#123;    sourceType: &#39;module&#39;,  &#125;)  &#x2F;&#x2F; å½“å‰æ–‡ä»¶çš„ä¾èµ–å…³ç³»  const dependencies &#x3D; []  traverse(ast, &#123;    &#x2F;&#x2F; å½“é‡åˆ°å¯¼å…¥çš„å£°æ˜æ—¶ï¼Œå°†å…¶å†…å®¹ push åˆ° dependencies é‡Œ    ImportDeclaration: (&#123; node &#125;) &#x3D;&gt; &#123;      dependencies.push(node.source.value)    &#125;,  &#125;)  &#x2F;&#x2F; å°† AST è½¬ä¸º ES5  const &#123; code &#125; &#x3D; transformFromAst(ast, null, &#123;    presets: [&#39;env&#39;],  &#125;)  return &#123;    filePath,    dependencies,    code,  &#125;&#125;</code></pre><p>Asset æ¥å£å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript">interface Assets &#123;&#x2F;&#x2F; æ–‡ä»¶è·¯å¾„  filePath: string;  &#x2F;&#x2F; æ–‡ä»¶çš„ä¾èµ–  dependencies: string[];  &#x2F;&#x2F; è½¬ä¸º ES5 åçš„æ–‡ä»¶å†…å®¹  code: string;  &#x2F;&#x2F; ç›¸å¯¹è·¯å¾„  relativePath?: string;&#125;</code></pre><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰ä¸ªæ–‡ä»¶ entry.js ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; entry.jsimport a from &#39;.&#x2F;a.js&#39;console.log(a)</code></pre><p>è¿è¡Œ <code>createAsset(&#39;./entry.js&#39;)</code> å°†ä¼šè¿”å›ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#123;  filePath: &#39;.&#x2F;entry.js&#39;,  dependencies: [ &#39;.&#x2F;a.js&#39; ],  code: &#96;&quot;use strict&quot;;var _a &#x3D; require(&quot;.&#x2F;a.js&quot;);var _a2 &#x3D; _interopRequireDefault(_a);function _interopRequireDefault(obj) &#123; return obj &amp;&amp; obj.__esModule ? obj : &#123; default: obj &#125;; &#125;console.log(_a2.default);&#96;&#125;</code></pre><p><strong>æ¥ç€</strong>å®šä¹‰ä¸€ä¸ªå‡½æ•°ç”¨äºæ„å»ºä¾èµ–å…³ç³»å›¾( dependency graph )ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;** * æ„å»ºä¾èµ–å…³ç³»å›¾ *&#x2F;function createGraph(entry) &#123;  &#x2F;&#x2F; ä»å…¥å£æ–‡ä»¶å¼€å§‹  const entryAsset &#x3D; createAsset(entry);  &#x2F;&#x2F; åˆå§‹æ—¶ï¼Œqueue ä¸­åªæœ‰ entryAsset, ä¹‹ååˆ†æä¾èµ–å…³ç³»ï¼Œä¼šå°†æ–°çš„ Asset push åˆ° queue ä¸­ç”¨äºåˆ†æï¼Œç›´åˆ°åˆ†æå®Œå…¨éƒ¨ä¾èµ–  const queue &#x3D; [entryAsset]  &#x2F;&#x2F; éå†æ‰€æœ‰æ–‡ä»¶ä¾èµ–å…³ç³»  for (const asset of queue) &#123;    &#x2F;&#x2F; è·å¾—æ–‡ä»¶ç›®å½•    const dirname &#x3D; path.dirname(asset.filePath)    &#x2F;&#x2F; éå†å½“å‰æ–‡ä»¶ä¾èµ–å…³ç³»    asset.dependencies.forEach((relativePath) &#x3D;&gt; &#123;      &#x2F;&#x2F; è·å¾—ç»å¯¹è·¯å¾„      const absolutePath &#x3D; path.join(dirname, relativePath)      const childAsset &#x3D; createAsset(absolutePath)      childAsset.relativePath &#x3D; relativePath      &#x2F;&#x2F; å°†å½“å‰æ–‡ä»¶æ‰€ä¾èµ–çš„æ–‡ä»¶çš„ Asset ä¹Ÿ push åˆ° queue ä¸­ç”¨äºéå†      queue.push(childAsset)    &#125;)  &#125;  return queue&#125;</code></pre><p>ä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šï¼Œæœ‰ä¸ª a.js ä»¥åŠ b.js æ–‡ä»¶, è¿è¡Œ <code>createGraph</code>ä¼šè¿”å›ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; a.jsimport b from &#39;.&#x2F;b.js&#39;const a &#x3D; &#39;1&#39;export default a&#x2F;&#x2F; b.jsconst b &#x3D; &#39;2&#39;export default b&#x2F;&#x2F; createGraph(&#39;.&#x2F;entry.js&#39;)[  &#123;    filePath: &#39;.&#x2F;entry.js&#39;,    dependencies: [ &#39;.&#x2F;a.js&#39; ],    code: &#96;&quot;use strict&quot;;var _a &#x3D; require(&quot;.&#x2F;a.js&quot;);var _a2 &#x3D; _interopRequireDefault(_a);function _interopRequireDefault(obj) &#123; return obj &amp;&amp; obj.__esModule ? obj : &#123; default: obj &#125;; &#125;console.log(_a2.default);&#96;  &#125;,  &#123;    filePath: &#39;a.js&#39;,    dependencies: [ &#39;.&#x2F;b.js&#39; ],    code: &#96;&quot;use strict&quot;;Object.defineProperty(exports, &quot;__esModule&quot;, &#123;  value: true&#125;);var _b &#x3D; require(&quot;.&#x2F;b.js&quot;);var _b2 &#x3D; _interopRequireDefault(_b);function _interopRequireDefault(obj) &#123; return obj &amp;&amp; obj.__esModule ? obj : &#123; default: obj &#125;; &#125;var a &#x3D; &#39;1&#39;;exports.default &#x3D; a;&#96;,    relativePath: &#39;.&#x2F;a.js&#39;  &#125;,  &#123;    filePath: &#39;b.js&#39;,    dependencies: [],    code: &#96;&quot;use strict&quot;;Object.defineProperty(exports, &quot;__esModule&quot;, &#123;  value: true&#125;);var b &#x3D; &#39;2&#39;;exports.default &#x3D; b;&#96;,    relativePath: &#39;.&#x2F;b.js&#39;  &#125;]</code></pre><p><strong>æœ€å</strong>å®ç°ä¸€ä¸ªæ‰“åŒ…å‡½æ•°ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">function bundle(entry) &#123;  const graph &#x3D; createGraph(entry)  let modules &#x3D; &#39;&#39;  &#x2F;&#x2F; æ„å»ºå‡½æ•°å‚æ•°  graph.forEach((mod) &#x3D;&gt; &#123;    const filePath &#x3D; mod.relativePath || entry    &#x2F;&#x2F; æ‹¼è£…æˆ modules    modules +&#x3D; &#96;&#39;$&#123;filePath&#125;&#39;: (      function (module, exports, require) &#123; $&#123;mod.code&#125; &#125;    ),&#96;  &#125;)  &#x2F;&#x2F; æœ€ç»ˆç»“æœ  const result &#x3D; &#96;    (function(modules) &#123;&#x2F;&#x2F; ast è½¬ es5 çš„ä»£ç æ˜¯ commonjs é£æ ¼ï¼Œè€Œæµè§ˆå™¨ä¸æ”¯æŒ commonjsï¼Œå› æ­¤è‡ªå®šä¹‰ requireï¼Œä»¥æ–‡ä»¶åä½œä¸º id      function require(id) &#123;        const module &#x3D; &#123; exports : &#123;&#125; &#125;        modules[id](module, module.exports, require)        return module.exports      &#125;&#x2F;&#x2F; å¼•å…¥å…¥å£æ–‡ä»¶ä»£ç       require(&#39;$&#123;entry&#125;&#39;)    &#125;)(&#123;$&#123;modules&#125;&#125;)  &#96;  &#x2F;&#x2F; å½“ç”Ÿæˆçš„å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ä¸­  fs.writeFileSync(&#39;.&#x2F;bundle.js&#39;, result)&#125;ã€€</code></pre><p>æœ€ç»ˆè¾“å‡ºä¸€ä¸ª IIFEï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">;(function (modules) &#123;  function require(id) &#123;    const module &#x3D; &#123; exports: &#123;&#125; &#125;    modules[id](module, module.exports, require)    return module.exports  &#125;  require(&#39;.&#x2F;entry.js&#39;)&#125;)(&#123;  &#39;.&#x2F;entry.js&#39;: function (module, exports, require) &#123;    &#39;use strict&#39;    var _a &#x3D; require(&#39;.&#x2F;a.js&#39;)    var _a2 &#x3D; _interopRequireDefault(_a)    function _interopRequireDefault(obj) &#123;      return obj &amp;&amp; obj.__esModule ? obj : &#123; default: obj &#125;    &#125;    console.log(_a2.default)  &#125;,  &#39;.&#x2F;a.js&#39;: function (module, exports, require) &#123;    &#39;use strict&#39;    Object.defineProperty(exports, &#39;__esModule&#39;, &#123;      value: true,    &#125;)    var _b &#x3D; require(&#39;.&#x2F;b.js&#39;)    var _b2 &#x3D; _interopRequireDefault(_b)    function _interopRequireDefault(obj) &#123;      return obj &amp;&amp; obj.__esModule ? obj : &#123; default: obj &#125;    &#125;    var a &#x3D; &#39;1&#39;    exports.default &#x3D; a  &#125;,  &#39;.&#x2F;b.js&#39;: function (module, exports, require) &#123;    &#39;use strict&#39;    Object.defineProperty(exports, &#39;__esModule&#39;, &#123;      value: true,    &#125;)    var b &#x3D; &#39;2&#39;    exports.default &#x3D; b  &#125;,&#125;)</code></pre>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‰ç«¯å·¥ç¨‹åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾è®¡æ¨¡å¼-JSä¸­çš„å•ä¾‹æ¨¡å¼</title>
      <link href="/2020/07/28/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-JS%E4%B8%AD%E7%9A%84%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
      <url>/2020/07/28/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-JS%E4%B8%AD%E7%9A%84%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>æ­¤å‰é¡¹ç›®æœ‰ä¸ª im  æ¨¡å—ï¼Œéœ€è¦ç”¨åˆ° websocketã€‚ä½¿ç”¨ websocket éœ€è¦å»ºç«‹è¿æ¥ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const initWs &#x3D; () &#x3D;&gt; &#123;  const ws &#x3D; new WebSocket(&#39;wss:&#x2F;&#x2F;xxx.com&#39;);  ws.onopen(() &#x3D;&gt; &#123;    console.log(&#39;opened&#39;)  &#125;)  ws.onmessage((evt) &#x3D;&gt; &#123;    console.log(&#39;Received evt&#39;, evt.data)  &#125;)  &#x2F;&#x2F;....  return ws&#125;</code></pre><p>æˆ‘ä»¬è‚¯å®šä¸å¸Œæœ›åœ¨æ¯ä¸ªç”¨åˆ° ws çš„åœ°æ–¹éƒ½é‡å¤åˆå§‹åŒ–ï¼Œå³æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ª WebSocket çš„å®ä¾‹ã€‚</p><a id="more"></a><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const wsA &#x3D; new SingleWs()const wsB &#x3D; new SingleWs()&#x2F;&#x2F; æœ‰æ²¡æœ‰åŠæ³•ä½¿å¾—:wsA instanceof WebSocket &amp;&amp; wsB instanceof WebSocket &amp;&amp; wsA &#x3D;&#x3D;&#x3D; wsB</code></pre><p>é‚£ä¹ˆè¦å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ï¼Ÿå®é™…ä¸Šå°±å¯ä»¥ç”¨åˆ°å•ä¾‹æ¨¡å¼ã€‚ä¸‹é¢åˆ—ä¸¾å‡ ä¸ªå®ç°çš„æ–¹æ³•ï¼š</p><h4 id="ä½¿ç”¨å…¨å±€å˜é‡"><a href="#ä½¿ç”¨å…¨å±€å˜é‡" class="headerlink" title="ä½¿ç”¨å…¨å±€å˜é‡"></a>ä½¿ç”¨å…¨å±€å˜é‡</h4><p>è¿™ä¸ªå¯èƒ½æ˜¯æœ€å®¹æ˜“æƒ³åˆ°çš„ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">window.ws &#x3D; window.ws || initWs()</code></pre><p>å°† ws æŒ‚åœ¨ window å¯¹è±¡ä¸Šï¼Œä½¿ç”¨æ—¶ä¹Ÿç”¨ window.wsï¼Œæ˜¾ç„¶è¿™ä¸ªè§£å†³æ–¹æ¡ˆæœ‰ä¸ªé—®é¢˜æ˜¯éœ€è¦å°å¿ƒ window.ws è¢«è¦†ç›–ã€‚</p><h4 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h4><p>é—­åŒ…å¯ä»¥ä¿æŒå±€éƒ¨å˜é‡ä¿æŒåœ¨å†…å­˜ä¸­ä¸è¢«é”€æ¯ï¼Œé€šè¿‡è¿™ä¸ªç‰¹æ€§å¯ä»¥å°±å¯ä»¥é¿å…æ±¡æŸ“å…¨å±€å˜é‡ï¼Œå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const SingleWs &#x3D; (function() &#123; let ws &#x3D; null; &#x2F;&#x2F; const initWs &#x3D; .... return &#123;   getWs() &#123;     if(!ws) &#123;       ws &#x3D; initWs()     &#125;     return ws   &#125;  &#125;&#125;)()const wsA &#x3D; SingleWs.getWs()const wsB &#x3D; SingleWs.getWs()console.log(wsA instanceof WebSocket &amp;&amp; wsB instanceof WebSocket &amp;&amp; wsA &#x3D;&#x3D;&#x3D; wsB)</code></pre><p>ç„¶è€Œä¸Šé¢çš„å†™æ³•ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œå¦‚ getWs å¯ä»¥è¢«æ”¹å†™ã€‚</p><p>å†™æ³•è¿˜å¯ä»¥è¿›ä¸€æ­¥æ”¹å†™ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const SingleWs &#x3D; (function() &#123; let ws &#x3D; null; &#x2F;&#x2F; const initWs &#x3D; ....  return () &#x3D;&gt; &#123;    if(!ws) &#123;      ws &#x3D; initWs()    &#125;    return ws  &#125;&#125;)()&#x2F;&#x2F; è¿™é‡Œçš„ new å¯ä»¥ä¸å†™const wsA &#x3D; new SingleWs()const wsB &#x3D; new SingleWs()wsA instanceof WebSocket &amp;&amp; wsB instanceof WebSocket &amp;&amp; wsA &#x3D;&#x3D;&#x3D; wsB</code></pre><h4 id="æ¨¡å—åŒ–"><a href="#æ¨¡å—åŒ–" class="headerlink" title="æ¨¡å—åŒ–"></a>æ¨¡å—åŒ–</h4><p>é€šè¿‡æ¨¡å—åŒ–ä¹Ÿèƒ½å®ç°ä¸Šè¿°çš„æ•ˆæœï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#x2F;&#x2F; ws.jslet ws &#x3D; null&#x2F;&#x2F; const initWs &#x3D; ....function SingleWs() &#123;  if (ws) &#123;    return ws  &#125;  ws &#x3D; initWs()  return ws&#125;export default SingleWs</code></pre><h4 id="é€šè¿‡-class-çš„é™æ€å±æ€§æ¥å®ç°"><a href="#é€šè¿‡-class-çš„é™æ€å±æ€§æ¥å®ç°" class="headerlink" title="é€šè¿‡ class çš„é™æ€å±æ€§æ¥å®ç°"></a>é€šè¿‡ class çš„é™æ€å±æ€§æ¥å®ç°</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">class SingleWs &#123;  constructor() &#123;    if (!SingleWs.instance) &#123;      SingleWs.instance &#x3D; this.initWs()    &#125;    return SingleWs.instance  &#125;  initWs() &#123;    &#x2F;&#x2F; ...      &#125;&#125;const wsA &#x3D; new SingleWs()const wsB &#x3D; new SingleWs()console.log(wsA instanceof WebSocket &amp;&amp; wsB instanceof WebSocket &amp;&amp; wsA &#x3D;&#x3D;&#x3D; wsB)</code></pre><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>JS ä¸­çš„å•ä¾‹æ¨¡å¼ï¼š</p><ol><li>å®ä¾‹åŒ–æ—¶ï¼Œåˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨å®ä¾‹ã€‚</li><li>å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆå§‹åŒ–ï¼Œå¹¶å°†ç”Ÿæˆçš„å®ä¾‹å­˜å‚¨èµ·æ¥ã€‚</li><li>å­˜å‚¨çš„æ–¹æ³•å¯ä»¥æ˜¯å…¨å±€å˜é‡ï¼Œé—­åŒ…ï¼Œæ¨¡å—ä»¥åŠç±»çš„é™æ€å±æ€§ã€‚</li><li>å¦‚æœå·²ç»å­˜åœ¨å®ä¾‹ï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å›è¯¥å®ä¾‹ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€è¯‘ã€‘ReactHooks-å¹¶éé»‘é­”æ³•ï¼Œæœ¬è´¨æ˜¯æ•°ç»„</title>
      <link href="/2020/07/26/%E3%80%90%E8%AF%91%E3%80%91ReactHooks-%E5%B9%B6%E9%9D%9E%E9%BB%91%E9%AD%94%E6%B3%95%EF%BC%8C%E6%9C%AC%E8%B4%A8%E6%98%AF%E6%95%B0%E7%BB%84/"/>
      <url>/2020/07/26/%E3%80%90%E8%AF%91%E3%80%91ReactHooks-%E5%B9%B6%E9%9D%9E%E9%BB%91%E9%AD%94%E6%B3%95%EF%BC%8C%E6%9C%AC%E8%B4%A8%E6%98%AF%E6%95%B0%E7%BB%84/</url>
      
        <content type="html"><![CDATA[<h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>æœ¬æ–‡ç¿»è¯‘è‡ª <a href="https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e">React hooks: not magic, just arrays</a>ï¼Œè¯¥æ–‡ç« å¾ˆå¥½çš„é˜é‡Šäº† react hooks åŸç†ï¼Œæˆ‘å°†ä¿æŒåŸæ–‡çš„æ„æ€è¿›è¡Œç¿»è¯‘ï¼Œå¦‚æœ‰è‡ªå·±æ„Ÿè§‰ä¸æ¸…æ¥šçš„åœ°æ–¹å°†ä¼šåœ¨æ‹¬å·ä¸­æ³¨æ˜ã€‚ä»¥ä¸‹ä¸ºç¿»è¯‘å†…å®¹ã€‚</p><p>æˆ‘æ˜¯ hooks api çš„å¿ å®ç²‰ä¸ã€‚ç„¶è€Œ hooks åœ¨ä½¿ç”¨æ—¶å´æœ‰ä¸€äº›<a href="https://reactjs.org/docs/hooks-rules.html">å¥‡æ€ªçš„çº¦æŸ</a>ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ç»™å°è¯•å»ç†è§£è¿™äº›è§„åˆ™ç”±æ¥çš„äººæä¾›ä¸€ä¸ªäº†æ¨¡å‹ï¼Œç”¨äºæ€è€ƒå¦‚ä½•å»ä½¿ç”¨è¿™äº›æ–° apiã€‚</p><a id="more"></a><h4 id="hooks-çš„è§„åˆ™"><a href="#hooks-çš„è§„åˆ™" class="headerlink" title="hooks çš„è§„åˆ™"></a>hooks çš„è§„åˆ™</h4><p>åœ¨ <a href="https://reactjs.org/docs/hooks-rules.html">hooks proposal documentation</a> çš„æçº²ä¸­ï¼ŒReact æ ¸å¿ƒå›¢é˜Ÿè§„å®šäº†ä¸¤æ¡å¼€å‘è€…åœ¨ä½¿ç”¨ hooks æ—¶éœ€è¦éµå®ˆçš„ä¸»è¦è§„åˆ™ï¼š</p><ul><li>ä¸è¦åœ¨å¾ªç¯ï¼Œæ¡ä»¶æˆ–è€…æ˜¯åµŒå¥—å‡½æ•°ä¸­ä½¿ç”¨ hooks</li><li>åªèƒ½åœ¨ React Functions ä¸­æ‰èƒ½ä½¿ç”¨ hooks</li></ul><p>åè€…æˆ‘è®¤ä¸ºæ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚è¦å°†è¡Œä¸ºé™„åŠ åˆ°å‡½æ•°å¼ç»„ä»¶ä¸Šï¼Œä½ éœ€è¦èƒ½å¤Ÿä»¥æŸç§æ–¹å¼å°†è¯¥è¡Œä¸ºä¸ç»„ä»¶å…³è”èµ·æ¥ã€‚ï¼ˆåŸæ–‡ä¸ºï¼š To attach behaviour to a functional component you need to be able to associate that behaviour with the component somehow. ä¸å¤ªç†è§£ä½œè€…æƒ³è¡¨è¾¾çš„æ„æ€ï¼‰</p><p>å‰è€…æˆ‘è®¤ä¸ºä¼šæ¯”è¾ƒè®©äººå›°æƒ‘ï¼Œå› ä¸ºåƒè¿™æ ·ä½¿ç”¨ api å¯èƒ½çœ‹èµ·æ¥ä¸å¤ªè‡ªç„¶ã€‚è€Œè¿™æ­£æ˜¯æˆ‘ä»Šå¤©æƒ³è¦æ¢è®¨çš„å†…å®¹ã€‚</p><h4 id="hooks-çš„çŠ¶æ€ç®¡ç†éƒ½æ˜¯åŸºäºæ•°ç»„"><a href="#hooks-çš„çŠ¶æ€ç®¡ç†éƒ½æ˜¯åŸºäºæ•°ç»„" class="headerlink" title="hooks çš„çŠ¶æ€ç®¡ç†éƒ½æ˜¯åŸºäºæ•°ç»„"></a>hooks çš„çŠ¶æ€ç®¡ç†éƒ½æ˜¯åŸºäºæ•°ç»„</h4><p>ä¸ºäº†æ›´æ¸…æ™°åœ°ç†è§£å¿ƒæ™ºæ¨¡å‹ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„ hooks apiã€‚</p><p><strong>æ³¨æ„è¿™åªæ˜¯ API çš„ä¸€ç§å¯èƒ½çš„å®ç°æ–¹å¼åŠçŒœæƒ³ï¼Œç”¨äºè®©ä½ ç†è§£ï¼Œè€Œé API çœŸæ­£çš„å†…éƒ¨å®ç°æ–¹å¼</strong></p><h4 id="æˆ‘ä»¬å¦‚ä½•å®ç°-useState"><a href="#æˆ‘ä»¬å¦‚ä½•å®ç°-useState" class="headerlink" title="æˆ‘ä»¬å¦‚ä½•å®ç° useState?"></a>æˆ‘ä»¬å¦‚ä½•å®ç° <code>useState</code>?</h4><p>è®©æˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªå®ä¾‹æ¥æ¼”ç¤ºå¦‚ä½•å®ç°ä¸€ä¸ª state hookã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç»„ä»¶ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">function RenderFunctionComponent() &#123;  const [firstName, setFirstName] &#x3D; useState(&quot;Rudi&quot;);  const [lastName, setLastName] &#x3D; useState(&quot;Yardley&quot;);  return (    &lt;Button onClick&#x3D;&#123;() &#x3D;&gt; setFirstName(&quot;Fred&quot;)&#125;&gt;Fred&lt;&#x2F;Button&gt;  );&#125;</code></pre><p>è¿™ä¸ª Hooks api èƒŒåçš„æ€æƒ³æ˜¯ï¼Œä½ å¯ä»¥ç”¨ hook å‡½æ•°è¿”å›çš„æ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ ä½œä¸º setter æ–¹æ³•ï¼Œè¿™ä¸ª setter æ–¹æ³•å¯ä»¥æ§åˆ¶è¢« hook ç®¡ç†çš„çŠ¶æ€ã€‚</p><h4 id="é‚£ä¹ˆ-React-æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸ªçš„å‘¢ï¼Ÿ"><a href="#é‚£ä¹ˆ-React-æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸ªçš„å‘¢ï¼Ÿ" class="headerlink" title="é‚£ä¹ˆ React æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸ªçš„å‘¢ï¼Ÿ"></a>é‚£ä¹ˆ React æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸ªçš„å‘¢ï¼Ÿ</h4><p>è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªåœ¨ React å†…éƒ¨æ˜¯å¦‚ä½•è¿ä½œçš„ã€‚ä»¥ä¸‹å†…å®¹å°†åœ¨ç‰¹å®šç»„ä»¶çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚è¿™å°±æ˜¯è¯´æ•°æ®å­˜å‚¨åœ¨è¦æ¸²æŸ“çš„ç»„ä»¶çš„ä¸Šä¸€å±‚ã€‚è¿™ä¸ª state ä¸ä¸å…¶ä»–ç»„ä»¶å…±äº«ï¼Œä½†æ˜¯ç»´æŠ¤åœ¨ä¸€ä¸ªå¯ä»¥ç”¨äºè¯¥ç»„ä»¶åç»­æ¸²æŸ“çš„ä½œç”¨åŸŸå†…ã€‚ï¼ˆåŸæ–‡ï¼šThe following would work within the execution context for rendering a particular component. That means that the data stored here lives one level outside of the component being rendered. This state is not shared with other components but it is maintained in a scope that is accessible to subsequent rendering of the specific componentï¼‰</p><ol><li><p>åˆå§‹åŒ–</p><p>åˆ›å»ºä¸¤ä¸ªç©ºæ•°ç»„ï¼š<code>setter</code> å’Œ <code>state</code></p><p>å°†æŒ‡é’ˆè®¾ç½®ä¸º 0</p><p><img src="https://miro.medium.com/max/1280/1*LAZDuAEm7nbcx0vWVKJJ2w.png" alt="Image for post"></p></li><li><p>é¦–æ¬¡æ¸²æŸ“</p><p>é¦–æ¬¡è¿è¡Œè¯¥ç»„ä»¶ã€‚</p><p>æ¯æ¬¡è°ƒç”¨ <code>useState</code> ï¼Œå¦‚æœæ˜¯é¦–æ¬¡è¿è¡Œï¼Œåˆ™ push ä¸€ä¸ª setter æ–¹æ³•ï¼ˆç»‘å®šåˆ°æŒ‡é’ˆçš„ä½ç½®ï¼‰åˆ° setters æ•°ç»„ä¸­ï¼Œå¹¶ä¸” push ä¸€äº› state åˆ° state æ•°ç»„ä¸­ã€‚</p><p><img src="https://miro.medium.com/max/1260/1*8TpWnrL-Jqh7PymLWKXbWg.png" alt="Image for post"></p></li><li><p>åç»­æ¸²æŸ“</p><p>æ¯æ¬¡åç»­æ¸²æŸ“ï¼ŒæŒ‡é’ˆå°†è¢«é‡ç½®ï¼Œç„¶åä»å„ä¸ªæ•°ç»„ä¸­è¯»å–å¯¹åº”çš„å€¼ã€‚</p><p><img src="https://miro.medium.com/max/1254/1*qtwvPWj-K3PkLQ6SzE2u8w.png" alt="Image for post"></p></li><li><p>äº‹ä»¶å¤„ç†</p><p>æ¯ä¸€ä¸ª setter éƒ½ä¿å­˜ä¸€ä¸ªå¯¹åº”çš„æŒ‡é’ˆä½ç½®çš„å¼•ç”¨ï¼Œå› æ­¤è§¦å‘ä»»æ„ä¸€ä¸ª <code>setter</code> éƒ½å¯ä»¥ä¿®æ”¹ state æ•°ç»„ä¸­å¯¹åº”æŒ‡é’ˆä½ç½®çš„ stateã€‚</p><p><img src="https://miro.medium.com/max/1260/1*3L8YJnn5eV5ev1FuN6rKSQ.png" alt="Image for post"></p></li></ol><h4 id="ç®€å•çš„å®ç°-And-the-naive-implementation"><a href="#ç®€å•çš„å®ç°-And-the-naive-implementation" class="headerlink" title="ç®€å•çš„å®ç°(And the naive implementation)"></a>ç®€å•çš„å®ç°(And the naive implementation)</h4><p>ä¸‹é¢æ˜¯ç®€å•çš„ä»£ç æ¼”ç¤ºï¼š</p><p><strong>æ³¨æ„ï¼šè¿™ä¸ä»£è¡¨ hooks çš„å®é™…å®ç°ï¼Œä½†æ˜¯åº”è¯¥èƒ½ç»™ä½ ä¸€ä¸ªç†è§£ hooks å·¥ä½œåŸç†çš„æ€è·¯ã€‚è¿™å°±æ˜¯æˆ‘ä¸ºä»€ä¹ˆä½¿ç”¨å—çº§å˜é‡çš„åŸå› ï¼ˆåŸæ–‡ï¼š That is why we are using module level vars etcï¼‰</strong></p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">let state &#x3D; [];let setters &#x3D; [];let firstRun &#x3D; true;let cursor &#x3D; 0;function createSetter(cursor) &#123;  return function setterWithCursor(newVal) &#123;    state[cursor] &#x3D; newVal;  &#125;;&#125;&#x2F;&#x2F; This is the pseudocode for the useState helperexport function useState(initVal) &#123;  if (firstRun) &#123;    state.push(initVal);    setters.push(createSetter(cursor));    firstRun &#x3D; false;  &#125;  const setter &#x3D; setters[cursor];  const value &#x3D; state[cursor];  cursor++;  return [value, setter];&#125;&#x2F;&#x2F; Our component code that uses hooksfunction RenderFunctionComponent() &#123;  const [firstName, setFirstName] &#x3D; useState(&quot;Rudi&quot;); &#x2F;&#x2F; cursor: 0  const [lastName, setLastName] &#x3D; useState(&quot;Yardley&quot;); &#x2F;&#x2F; cursor: 1  return (    &lt;div&gt;      &lt;Button onClick&#x3D;&#123;() &#x3D;&gt; setFirstName(&quot;Richard&quot;)&#125;&gt;Richard&lt;&#x2F;Button&gt;      &lt;Button onClick&#x3D;&#123;() &#x3D;&gt; setFirstName(&quot;Fred&quot;)&#125;&gt;Fred&lt;&#x2F;Button&gt;    &lt;&#x2F;div&gt;  );&#125;&#x2F;&#x2F; This is sort of simulating Reacts rendering cyclefunction MyComponent() &#123;  cursor &#x3D; 0; &#x2F;&#x2F; resetting the cursor  return &lt;RenderFunctionComponent &#x2F;&gt;; &#x2F;&#x2F; render&#125;console.log(state); &#x2F;&#x2F; Pre-render: []MyComponent();console.log(state); &#x2F;&#x2F; First-render: [&#39;Rudi&#39;, &#39;Yardley&#39;]MyComponent();console.log(state); &#x2F;&#x2F; Subsequent-render: [&#39;Rudi&#39;, &#39;Yardley&#39;]&#x2F;&#x2F; click the &#39;Fred&#39; buttonconsole.log(state); &#x2F;&#x2F; After-click: [&#39;Fred&#39;, &#39;Yardley&#39;]</code></pre><h4 id="ä¸ºä»€ä¹ˆé¡ºåºå¾ˆé‡è¦ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆé¡ºåºå¾ˆé‡è¦ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆé¡ºåºå¾ˆé‡è¦ï¼Ÿ"></a>ä¸ºä»€ä¹ˆé¡ºåºå¾ˆé‡è¦ï¼Ÿ</h4><p>ç°åœ¨å¦‚æœåœ¨ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸé‡Œï¼Œæˆ‘ä»¬åŸºäºå¤–éƒ¨çš„å› ç´ æˆ–è€…ç»„ä»¶çŠ¶æ€æ”¹å˜äº† hooks çš„é¡ºåºï¼Œå°†ä¼šå‘ç”Ÿä»€ä¹ˆäº‹æƒ…ï¼Ÿ</p><p>è®©æˆ‘ä»¬è¯•è¯•çœ‹ react ä¸å»ºè®®æˆ‘ä»¬åšçš„äº‹æƒ…ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">let firstRender &#x3D; true;function RenderFunctionComponent() &#123;  let initName;  if(firstRender)&#123;    [initName] &#x3D; useState(&quot;Rudi&quot;);    firstRender &#x3D; false;  &#125;  const [firstName, setFirstName] &#x3D; useState(initName);  const [lastName, setLastName] &#x3D; useState(&quot;Yardley&quot;);  return (    &lt;Button onClick&#x3D;&#123;() &#x3D;&gt; setFirstName(&quot;Fred&quot;)&#125;&gt;Fred&lt;&#x2F;Button&gt;  );&#125;</code></pre><p>æˆ‘ä»¬åœ¨ä¸€ä¸ªæ¡ä»¶è¯­å¥ä¸­ä½¿ç”¨äº† <code>useState</code>ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹é€ æˆäº†ä»€ä¹ˆæ ·çš„ç ´åï¼š</p><h4 id="åç»„ä»¶çš„ç¬¬ä¸€æ¬¡æ¸²æŸ“"><a href="#åç»„ä»¶çš„ç¬¬ä¸€æ¬¡æ¸²æŸ“" class="headerlink" title="åç»„ä»¶çš„ç¬¬ä¸€æ¬¡æ¸²æŸ“"></a>åç»„ä»¶çš„ç¬¬ä¸€æ¬¡æ¸²æŸ“</h4><p><img src="https://miro.medium.com/max/1270/1*C4IA_Y7v6eoptZTBspRszQ.png" alt="Image for post"></p><p>åœ¨è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬çš„å®ä¾‹å˜é‡ <code>firstName</code> å’Œ <code>lastName</code> æŒ‡å‘çš„æ­£ç¡®çš„æ•°æ®ï¼Œä½†æ˜¯æˆ‘ä»¬çœ‹çœ‹ç¬¬äºŒæ¬¡æ¸²æŸ“å‘ç”Ÿäº†ä»€ä¹ˆï¼š</p><h4 id="åç»„ä»¶çš„ç¬¬äºŒæ¬¡æ¸²æŸ“"><a href="#åç»„ä»¶çš„ç¬¬äºŒæ¬¡æ¸²æŸ“" class="headerlink" title="åç»„ä»¶çš„ç¬¬äºŒæ¬¡æ¸²æŸ“"></a>åç»„ä»¶çš„ç¬¬äºŒæ¬¡æ¸²æŸ“</h4><p><img src="https://miro.medium.com/max/1274/1*aK7jIm6oOeHJqgWnNXt8Ig.png" alt="Image for post"></p><p>ç°åœ¨æˆ‘ä»¬çš„ state å­˜å‚¨å‡ºç°å¼‚å¸¸ï¼Œ <code>firstName</code> å’Œ <code>lastName</code> éƒ½æŒ‡å‘ â€œRudiâ€ã€‚ä¸Šè¿°æ˜æ˜¾é”™è¯¯çš„æ“ä½œç»™äº†æˆ‘ä»¬ä¸€ä¸ªæ€è·¯ï¼šä¸ºä»€ä¹ˆ hooks è¦å¦‚æ­¤è§„å®šã€‚</p><blockquote><p>The React team are stipulating the usage rules because not following them will lead to inconsistent data</p></blockquote><h4 id="æƒ³æƒ³-hooks-æ“ä½œä¸€ç³»åˆ—çš„æ•°ç»„ï¼Œé‚£ä¹ˆä½ å°±ä¸ä¼šæ‰“ç ´è§„åˆ™äº†ï¼ˆThink-about-hooks-manipulating-a-set-of-arrays-and-you-wont-break-the-rulesï¼‰"><a href="#æƒ³æƒ³-hooks-æ“ä½œä¸€ç³»åˆ—çš„æ•°ç»„ï¼Œé‚£ä¹ˆä½ å°±ä¸ä¼šæ‰“ç ´è§„åˆ™äº†ï¼ˆThink-about-hooks-manipulating-a-set-of-arrays-and-you-wont-break-the-rulesï¼‰" class="headerlink" title="æƒ³æƒ³ hooks æ“ä½œä¸€ç³»åˆ—çš„æ•°ç»„ï¼Œé‚£ä¹ˆä½ å°±ä¸ä¼šæ‰“ç ´è§„åˆ™äº†ï¼ˆThink about hooks manipulating a set of arrays and you wont break the rulesï¼‰"></a>æƒ³æƒ³ hooks æ“ä½œä¸€ç³»åˆ—çš„æ•°ç»„ï¼Œé‚£ä¹ˆä½ å°±ä¸ä¼šæ‰“ç ´è§„åˆ™äº†ï¼ˆThink about hooks manipulating a set of arrays and you wont break the rulesï¼‰</h4><p>ç°åœ¨åº”è¯¥èƒ½å¾ˆæ¸…æ™°ç†è§£ä¸ºä»€ä¹ˆä¸èƒ½åœ¨æ¡ä»¶æˆ–è€…å¾ªç¯è¯­å¥ä¸­ä½¿ç”¨ <code>use</code> hook äº†ï¼šå› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†æŒ‡é’ˆæŒ‡å‘äº†æ•°ç»„ï¼Œå¦‚æœåœ¨ render çš„æ—¶å€™æ”¹å˜äº†é¡ºåºï¼Œé‚£ä¹ˆæŒ‡é’ˆå°±ä¸èƒ½å¯¹åº”æ­£ç¡®çš„æ•°æ®ï¼Œæ‰€ä»¥è°ƒç”¨ use ä¹Ÿä¸ä¼šæŒ‡å‘æ­£ç¡®çš„æ•°æ®å’Œ setterã€‚</p><p>å› æ­¤ï¼Œè¯€çªå°±æ˜¯å°† hooks æƒ³åƒæˆç”¨æ’å®šçš„æŒ‡é’ˆæ¥ç®¡ç†ä¸€ç³»åˆ—æ•°ç»„ã€‚å¦‚æœèƒ½åšåˆ°è¿™ä¸ªï¼Œé‚£ä¹ˆä¸€åˆ‡å°±èƒ½æŒ‰é¢„æœŸè¿›è¡Œã€‚</p><h4 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h4><p>å¸Œæœ›æˆ‘å·²ç»å°±å¦‚ä½•æ€è€ƒ hooks api çš„å·¥ä½œåŸç†æŒ‡å‡ºäº†ä¸€ä¸ªæ¸…æ™°çš„å¿ƒæ™ºæ¨¡å‹ã€‚ï¼ˆåé¢å°±å·ä¸ªæ‡’ä¸ç¿»è¯‘äº†ï¼ŒåŸºæœ¬æ˜¯ä¸Šè¿°è§‚ç‚¹çš„é‡å¤å¼ºè°ƒã€‚ï¼‰</p><p>Hopefully I have laid out a clearer mental model for how to think about what is going on under the hood with the new hooks API. Remember the true value here is being able to group concerns together so being careful about order and using the hooks API will have a high payoff.</p><p>Hooks is an effective plugin API for React Components. There is a reason why people are excited about this and if you think about this kind of model where state exists as a set of arrays then you should not find yourselves breaking the rules around their usage.</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‰ç«¯å¸¸è§çš„å®‰å…¨é—®é¢˜æ±‡æ€»</title>
      <link href="/2020/07/23/%E5%89%8D%E7%AB%AF%E5%B8%B8%E8%A7%81%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/"/>
      <url>/2020/07/23/%E5%89%8D%E7%AB%AF%E5%B8%B8%E8%A7%81%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h4 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h4><p>æœ€è¿‘å®‰å…¨éƒ¨é—¨çš„å°ä¼™ä¼´æäº†ä¸€ä¸ªå‰ç«¯å®‰å…¨çš„æ¼æ´ï¼Œæƒ³åˆ°å‰ç«¯å¼€å‘è¿‡ç¨‹ä¸­æœ‰æ—¶å€™å¾€å¾€è¿½æ±‚å¼€å‘æ•ˆç‡ï¼Œå¿½ç•¥æ‰ä¸€äº›å®‰å…¨é—®é¢˜ï¼Œä»¥ä¸‹ç®€å•æ€»ç»“ä¸€äº›è‡ªå·±é‡åˆ°è¿‡çš„ä»¥åŠä¸€äº›å¸¸è§çš„æ”»å‡»æ‰‹æ®µï¼Œä»¥è‡ªæŸ¥è‡ªçœã€‚</p><a id="more"></a><h4 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h4><p>å›åˆ°å®‰å…¨éƒ¨é—¨æå‡ºçš„æ¼æ´ï¼Œåœºæ™¯è¿˜åŸå¦‚ä¸‹ï¼š<br>è¿™æ˜¯ä¸€ä¸ªè€é¡¹ç›®ï¼Œå±•ç¤ºæ–‡ç« ç”¨ï¼Œé¡µé¢è·¯ç”±ä¸º <a href="http://xxx/article/:id?these-are-queriesï¼Œnode">http://xxx/article/:id?these-are-queriesï¼Œnode</a> å±‚æ”¶åˆ°è¿™ä¸ª url åï¼Œè¿”å›è¿”å›è¯¥æ–‡ç«  htmlï¼Œå†…å®¹åˆ™åŒ…æ‹¬äº†ã€æ¨èæ–‡ç« ã€‘ï¼Œ è€Œæ¨èæ–‡ç« çš„é“¾æ¥åˆ™æ˜¯æ ¹æ® url çš„å€¼æ¥çš„ï¼Œä»…å˜åŒ– idã€‚æ­¤æ—¶å¦‚æœåœ¨ url ä¸Šçš„ query ä¸Šæ„é€ ä¸€æ®µæ¶æ„è„šæœ¬ï¼Œç„¶åå¼•å¯¼ç”¨æˆ·æ‰“å¼€ï¼Œé‚£ä¹ˆç”¨æˆ·æ‰“å¼€é¡µé¢åå°±ä¼šè¿è¡Œè¯¥æ¶æ„è„šæœ¬ã€‚<br>ä¸Šè¿°æ­£æ˜¯ä¸€ä¸ªå…¸å‹çš„ XSS æ”»å‡»ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p><blockquote><p>XSSæ˜¯è·¨ç«™è„šæœ¬æ”»å‡»(Cross Site Scripting)ï¼Œä¸ºä¸å’Œå±‚å æ ·å¼è¡¨(Cascading Style Sheets, CSS)çš„ç¼©å†™æ··æ·†ï¼Œæ•…å°†è·¨ç«™è„šæœ¬æ”»å‡»ç¼©å†™ä¸ºXSSã€‚æ¶æ„æ”»å‡»è€…å¾€Webé¡µé¢é‡Œæ’å…¥æ¶æ„Scriptä»£ç ï¼Œå½“ç”¨æˆ·æµè§ˆè¯¥é¡µä¹‹æ—¶ï¼ŒåµŒå…¥å…¶ä¸­Webé‡Œé¢çš„Scriptä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ¶æ„æ”»å‡»ç”¨æˆ·çš„ç›®çš„ã€‚</p></blockquote><p>XSS çš„æœ¬è´¨æ˜¯ä¿¡ä»»äº†æŸäº›ä¸å®‰å…¨çš„è¾“å…¥ï¼Œå¯¼è‡´æ¶æ„ä»£ç æ··å…¥æ­£å¸¸ä»£ç ï¼Œè¿›è€Œå‘ç”Ÿçš„æ”»å‡»è¡Œä¸ºã€‚å¸¸è§çš„ä¸å®‰å…¨è¾“å…¥æœ‰ï¼š</p><ol><li>ä¸Šé¢æåˆ°çš„ url å‚æ•°ï¼Œè¿™ç§éœ€è¦è¯±å¯¼ç”¨æˆ·å–ç‚¹å‡»</li><li>ç”¨æˆ·è¾“å…¥çš„å†…å®¹ï¼Œæ¯”å¦‚ç”¨æˆ·å‘è¡¨è¯„è®º</li><li>ç¬¬ä¸‰æ–¹çš„é“¾æ¥ç­‰</li></ol><p>é˜²èŒƒçš„æ–¹æ³•é€šå¸¸æ˜¯ï¼šå¯¹ç”¨æˆ·è¾“å…¥å†…å®¹å’ŒæœåŠ¡ç«¯è¿”å›å†…å®¹è¿›è¡Œè¿‡æ»¤å’Œè½¬è¯‘ã€‚</p><h4 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h4><p>CSRF æ”»å‡»å¸¸è§çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>ç”¨æˆ·ç™»å½•ä½ çš„ç½‘ç«™ï¼Œäº§ç”Ÿç™»å½•å‡­è¯ï¼Œå¦‚ cookie</li><li>ç”¨æˆ·è¢«<strong>è¯±å¯¼</strong>ç™»å½•åˆ°æ¶æ„ç½‘ç«™</li><li>æ¶æ„ç½‘ç«™æºå¸¦åˆšåˆšåœ¨æµè§ˆå™¨äº§ç”Ÿçš„å‡­è¯å‘ä½ çš„æœåŠ¡å™¨å‘é€ä¸€ä¸ªæ¶æ„è¯·æ±‚</li><li>ä½ çš„æœåŠ¡å™¨æ— æ³•è¯†åˆ«æ˜¯å¦æ¶æ„è¯·æ±‚ï¼Œè¯·æ±‚å®Œæˆï¼Œç”¨æˆ·å—å®³ã€‚</li></ol><p>ä¸ä¸Šé¢æåˆ°çš„ XSS æ”»å‡»æœ‰ä¸ªæ˜æ˜¾çš„åŒºåˆ«åœ¨äºï¼šCSRF æ”»å‡»å‘ç”Ÿåœ¨æ¶æ„ç½‘ç«™ï¼Œè€Œä¸æ˜¯è¢«æ”»å‡»çš„ç½‘ç«™ã€‚è€Œè¿™ä¹Ÿä½¿å¾—æ”»å‡»è€…å¹¶ä¸èƒ½è·å–åˆ°å—å®³è€…çš„ç™»å½•å‡­è¯ï¼Œä»…ä»…åªèƒ½ä½¿ç”¨ã€‚<br>é˜²èŒƒçš„æ–¹æ³•é€šå¸¸æ˜¯ï¼š</p><ol><li>è¯·æ±‚ url æ·»åŠ  token æˆ–è€…æ˜¯åœ¨ http è¯·æ±‚å¤´è‡ªå®šä¹‰å±æ€§è¿›è¡ŒéªŒè¯</li><li>åŒæºæ£€æµ‹ï¼Œé€šè¿‡è§£æ è¯·æ±‚å¤´ä¸­çš„ referer åˆ¤æ–­è¯·æ±‚æ¥æº</li><li>Samesiteï¼ŒGoogle èµ·è‰äº†ä¸€ä»½è‰æ¡ˆæ¥æ”¹è¿› HTTP åè®®ï¼Œä¸º Set-Cookie å“åº”å¤´æ–°å¢ Samesite å±æ€§ï¼Œç”¨äºæ ‡æ˜ Cookie æ˜¯å¦èƒ½ä½œç”¨äºå…¶ä»–ç½‘ç«™ï¼Œç›®å‰å…¼å®¹æ€§è¿˜ä¸æ˜¯å¾ˆå¥½ã€‚</li></ol><h4 id="Iframe"><a href="#Iframe" class="headerlink" title="Iframe"></a>Iframe</h4><p>å½“æˆ‘ä»¬ä½¿ç”¨ iframe åŠ è½½ç¬¬ä¸‰æ–¹ç½‘ç«™æ—¶ï¼Œç¬¬ä¸‰æ–¹ç½‘ç«™å¯ä»¥å¯¹æˆ‘ä»¬çš„ç½‘ç«™æ‰§è¡Œæ¶æ„æ“ä½œï¼Œå¦‚æ“ä½œDOMï¼ŒåŠ è½½ js ç­‰ã€‚<br>é˜²èŒƒçš„æ–¹æ³•æ˜¯é€šè¿‡è®¾ç½® sandbox å±æ€§æ§åˆ¶ iframe çš„æ“ä½œæƒé™ã€‚</p><h4 id="opener"><a href="#opener" class="headerlink" title="opener"></a>opener</h4><p>æˆ‘ä»¬åœ¨é€šå¸¸é€šè¿‡ä»¥ä¸‹å†™æ³•åœ¨ æ–° tab ä¸‹æ‰“å¼€é“¾æ¥ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">1. &lt;a target&#x3D;&#39;_blank&#39; href&#x3D;&#39;new-site.com&#39;&gt;2. window.open(&#39;new-site.com&#39;)</code></pre><p>ä¸Šè¿°ä¸¤ç§å†™æ³•çš„é—®é¢˜åœ¨äºï¼Œ <code>new-site.com</code> æ˜¯å¯ä»¥é€šè¿‡ <code>window.opener</code> æ¥æ‹¿åˆ°æºé¡µé¢çš„ <code>window</code> å¯¹è±¡ï¼Œè¿›è€Œè¿›è¡Œæ¶æ„æ“ä½œã€‚<br>é˜²èŒƒçš„æ–¹æ³•é€šå¸¸æ˜¯ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">1. &lt;a target&#x3D;&quot;_blank&quot; href&#x3D;&quot;new-site.com&quot; rel&#x3D;&quot;noopener noreferrer nofollow&quot;&gt;aæ ‡ç­¾è·³è½¬url&lt;&#x2F;a&gt;2. function openurl(url) &#123;    var newTab &#x3D; window.open();    newTab.opener &#x3D; null;    newTab.location &#x3D; url;&#125;</code></pre><h5 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h5><ul><li><p><a href="https://tech.meituan.com/2018/09/27/fe-security.html">å‰ç«¯å®‰å…¨ç³»åˆ—ï¼ˆä¸€ï¼‰ï¼šå¦‚ä½•é˜²æ­¢XSSæ”»å‡»ï¼Ÿ</a></p></li><li><p><a href="https://tech.meituan.com/2018/10/11/fe-security-csrf.html">å‰ç«¯å®‰å…¨ç³»åˆ—ï¼ˆäºŒï¼‰ï¼šå¦‚ä½•é˜²æ­¢CSRFæ”»å‡»ï¼Ÿ</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RN é¿å‘æŒ‡åŒ—</title>
      <link href="/2020/07/21/RN%20%E9%81%BF%E5%9D%91%E6%8C%87%E5%8C%97/"/>
      <url>/2020/07/21/RN%20%E9%81%BF%E5%9D%91%E6%8C%87%E5%8C%97/</url>
      
        <content type="html"><![CDATA[<p>è®°å½•å¹³æ—¶å¼€å‘ rn æ—¶é‡åˆ°çš„é—®é¢˜ï¼Œç‰¹æŒ‡ 0.59 ç‰ˆæœ¬ï¼Œä¸åŒç‰ˆæœ¬å¯èƒ½æƒ…å†µä¸åŒï¼Œä»…ä¾›å‚è€ƒã€‚</p><a id="more"></a><h5 id="ä¸€åƒç´ é—®é¢˜"><a href="#ä¸€åƒç´ é—®é¢˜" class="headerlink" title="ä¸€åƒç´ é—®é¢˜"></a>ä¸€åƒç´ é—®é¢˜</h5><p>rn è§£å†³ä¸€åƒç´ å¾ˆç®€å•ï¼Œåªéœ€è¦  <code>StyleSheet.hairlineWidth</code> å³å¯è§£å†³ã€‚</p><h5 id="TextInput-ç»„ä»¶"><a href="#TextInput-ç»„ä»¶" class="headerlink" title="TextInput  ç»„ä»¶"></a>TextInput  ç»„ä»¶</h5><p>è‡ªå¸¦å†…è¾¹è·ï¼Œå¤šè¡Œæ–‡å­—æ—¶æ–‡å­—å±…ä¸­å±•ç¤ºï¼Œæƒ³è¦æ¶ˆé™¤éœ€è¦è®¾ç½®æ ·å¼å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-css" data-language="css"><code class="language-css">&#x2F;&#x2F; æ–‡å­—å‘ä¸Šå¯¹é½textAlignVertical: &#39;top&#39;&#x2F;&#x2F; æ¶ˆé™¤å†…è¾¹è·padding: 0</code></pre><p>Placeholder åœ¨ ios å’Œ android ä¸‹é»˜è®¤é¢œè‰²è¡¨ç°ä¸ä¸€è‡´ï¼Œå¯ä»¥é€šè¿‡ <code>placeholderTextColor</code>  å±æ€§è¿›è¡Œè®¾ç½®ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">placeholderTextColor&#x3D;&quot;#CCCCCC&quot;</code></pre><h5 id="é˜´å½±"><a href="#é˜´å½±" class="headerlink" title="é˜´å½±"></a>é˜´å½±</h5><p>å› ä¸ºè®¾è®¡ç†å¿µçš„é—®é¢˜ï¼Œandroid ä¸‹å‡ ä¹æ— æ³•å®ç°å’Œ ios ä¸€è‡´çš„é˜´å½±æ•ˆæœã€‚è€Œ flutter åŸºäº skia å¼•æ“æ¸²æŸ“ï¼Œåº”è¯¥ä¼šæœ‰æ¯”è¾ƒå¥½çš„è¡¨ç°ï¼Ÿæœ‰ç©ºå°è¯•ä¸‹ã€‚ ğŸ¤”</p><h5 id="border-è™šçº¿"><a href="#border-è™šçº¿" class="headerlink" title="border è™šçº¿"></a>border è™šçº¿</h5><p>border è™šçº¿ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜, android ä¸Šå®æµ‹æ— æ•ˆï¼Œè¯¦æƒ…çœ‹ <a href="https://github.com/facebook/react-native/issues/17251">issue</a>ã€‚è§£å†³æ–¹æ¡ˆæ˜¯å¾ªç¯ä¸€ä¸ª pattern ç„¶å overhidden æ‰ï¼Œåˆå¤šäº†ä¸€ä¸ªè®©æˆ‘æƒ³å°è¯• flutter çš„ç†ç”± ğŸ˜‚</p><h5 id="å¤šè¡Œæ–‡å­—"><a href="#å¤šè¡Œæ–‡å­—" class="headerlink" title="å¤šè¡Œæ–‡å­—"></a>å¤šè¡Œæ–‡å­—</h5><p>å¤šè¡Œæ–‡å­—åœ¨ android æœºå‹ä¸‹æœ‰å¯èƒ½ä¼šå‡ºç°é«˜åº¦ä¸å¤Ÿå¯¼è‡´æ–‡å­—è¢«æˆªæ‰çš„é—®é¢˜ï¼Œè§£å†³æ–¹æ³•ï¼šè®¾ç½®  <code>lineHeight</code></p><h5 id="å®ç°ä¸åŒå­—å·çš„æ–‡å­—åº•éƒ¨å¯¹é½"><a href="#å®ç°ä¸åŒå­—å·çš„æ–‡å­—åº•éƒ¨å¯¹é½" class="headerlink" title="å®ç°ä¸åŒå­—å·çš„æ–‡å­—åº•éƒ¨å¯¹é½"></a>å®ç°ä¸åŒå­—å·çš„æ–‡å­—åº•éƒ¨å¯¹é½</h5><p>ä¾‹å¦‚ Â¥500 æƒ³è¦ Â¥ å­—å·å°ä¸€ç‚¹ï¼Œè€Œ 500 å­—å·å¤§ä¸€ç‚¹ï¼Œä½†æ˜¯éœ€è¦åº•éƒ¨å¯¹é½ï¼Œåˆ™å¯ä»¥ç”¨ Text åŒ…è£¹èµ·æ¥ï¼Œå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">&lt;Text&gt;  &lt;Text style&#x3D;&#123;&#123; fontSize: 12 &#125;&#125;&gt;Â¥&lt;&#x2F;Text&gt;  &lt;Text style&#x3D;&#123;&#123; fontSize: 20 &#125;&#125;&gt;500&lt;&#x2F;Text&gt;&lt;&#x2F;Text&gt;</code></pre><h5 id="Text-ç»„ä»¶æ ·å¼ç»§æ‰¿"><a href="#Text-ç»„ä»¶æ ·å¼ç»§æ‰¿" class="headerlink" title="Text ç»„ä»¶æ ·å¼ç»§æ‰¿"></a>Text ç»„ä»¶æ ·å¼ç»§æ‰¿</h5><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œcss å¦‚æœæƒ³è®¾ç½®é»˜è®¤çš„å…¨å±€æ ·å¼ç›¸å½“ç®€å•ï¼Œæ¯”å¦‚å­—ä½“é¢œè‰²é»˜è®¤ä¸º â€˜#323232â€™ , åªè¦åœ¨ body ä¸Šè®¾ç½®ä¸€ä¸‹ <code>color: #323232</code> å³å¯ ï¼Œç„¶è€Œå¯¹äº RN æ¥è¯´åˆ™æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š</p><ol><li><p>å°†åŸç”Ÿ Text æ›¿æ¢æˆè‡ªå®šä¹‰ Text ç»„ä»¶ï¼ˆå®˜æ–¹æ¨èï¼‰</p><blockquote><p>The recommended way to use consistent fonts and sizes across your application is to create a component <code>MyAppText</code> that includes them and use this component across your app</p></blockquote><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import React from &#39;react&#39;;import &#123; TextProps, StyleSheet, Text &#125; from &#39;react-native&#39;;const styles &#x3D; StyleSheet.create(&#123;  defaultStyle: &#123;    color: &#39;#323232&#39;,  &#125;,&#125;);export default function CustomText(props: TextProps &amp; &#123; children?: any &#125;) &#123;  const &#123; style, ...restProps &#125; &#x3D; props;  return (    &lt;Text style&#x3D;&#123;[styles.defaultStyle, style]&#125; &#123;...restProps&#125;&gt;      &#123;props.children&#125;    &lt;&#x2F;Text&gt;  );&#125;</code></pre></li><li><p>å‚è€ƒ <a href="https://github.com/Ajackster">Ajackster</a>/<strong><a href="https://github.com/Ajackster/react-native-global-props">react-native-global-props</a></strong> çš„å®ç°ï¼Œåœ¨é¡¹ç›®å…¥å£ä½ç½®ï¼Œä¿®æ”¹ç»„ä»¶çš„ render æ–¹æ³•ã€‚</p></li></ol><p>æ–¹æ¡ˆäºŒè™½ç„¶æ–¹ä¾¿ï¼Œä½†ä¸æ˜¯å®˜æ–¹è§£æ³•ï¼Œä¸‡ä¸€æœ‰å‘å°± GG äº†ã€‚è€Œæ–¹æ¡ˆä¸€å¦‚æœæ˜¯å·²æœ‰é¡¹ç›®ï¼Œåˆ™éœ€è¦æ‰¹é‡ä¿®æ”¹ä»£ç ã€‚<br>è¿™é‡Œé¡ºä¾¿æä¸€ä¸‹åœ¨ vscode é‡Œæ‰¹é‡æ›¿æ¢çš„æ–¹æ³•ï¼š</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; å°†æ­£åˆ™ï¼Œå¤§å°å†™ï¼Œå…¨åŒ¹é… ä¸‰ä¸ªæŒ‰é’®ç‚¹äº®find: Text(,|\s)(.*react-native&#39;;)replace: $2\nimport Text from &#39;Your&#x2F;Text&#39;;</code></pre><p>ä¸€å¼€å§‹æˆ‘æ˜¯è¿™ä¹ˆå†™çš„ï¼Œåªè€ƒè™‘åˆ°äº†å•è¡Œï¼Œç»“æœä¸‹é¢è¿™ç§æƒ…å†µæ²¡æœ‰æ›¿æ¢æ‰ï¼š</p><pre class="line-numbers language-none"><code class="language-none">import &#123;  StyleSheet,  ViewStyle,  View,  Text,  Image,  TouchableOpacity,&#125; from &#39;react-native&#39;;</code></pre><p>åé¢æ¢æˆ <code>\sText[,|\s]\n?([\s\S]*&#39;react-native&#39;;)</code> åœ¨æµè§ˆå™¨é‡Œå¯ä»¥åŒ¹é…ä¸Šï¼Œä½†æ˜¯ vscode æ— æ³•åŒ¹é… ğŸ¤”ã€‚ æœ€åç®€å•å†™ä¸ªè„šæœ¬è¡¥å…¨ä¸Šé¢çš„æ¼ç½‘ä¹‹é±¼:</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">const fs &#x3D; require(&#39;fs&#39;);const util &#x3D; require(&#39;util&#39;);const path &#x3D; require(&#39;path&#39;);const glob &#x3D; require(&#39;glob&#39;);const replace &#x3D; async () &#x3D;&gt; &#123;  try &#123;    glob(&#39;src&#x2F;**&#x2F;*.tsx&#39;, &#123;&#125;, function (er, files) &#123;      const reg &#x3D; &#x2F;\sText[,|\s]\n?([\s\S]*&#39;react-native&#39;;)&#x2F;;      files.forEach(async (file) &#x3D;&gt; &#123;        const content &#x3D; await util.promisify(fs.readFile)(file, &#39;utf8&#39;);        const newContent &#x3D; content.replace(reg, (m, p1) &#x3D;&gt; &#123;          return &#96; $&#123;p1.trim()&#125;import Text from &#39;@&#x2F;components&#x2F;Text&#39;;&#96;;        &#125;);        await util.promisify(fs.writeFile)(file, newContent, &#39;utf8&#39;);      &#125;);    &#125;);  &#125; catch (error) &#123;    console.log(error);  &#125;&#125;;replace();</code></pre><p>ğŸ¤” ä¸Šé¢ CustomText çš„å†™æ³•æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå³åµŒå¥— Text çš„æ ·å¼å¦‚æœæ˜¯è‡ªå®šä¹‰ç»„ä»¶ä¸­é»˜è®¤çš„æ ·å¼ï¼Œå°†ä¸ä¼šè¢«ç»§æ‰¿:</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">&lt;Text style&#x3D;&#123;&#123; color: &#39;red&#39; &#125;&#125;&gt;  &lt;Text&gt;red&lt;&#x2F;Text&gt;  &lt;Text&gt;red&lt;&#x2F;Text&gt;&lt;&#x2F;Text&gt;&lt;CustomText style&#x3D;&#123;&#123; color: &#39;red&#39; &#125;&#125;&gt;  &lt;CustomText&gt;not red&lt;&#x2F;Text&gt;  &lt;CustomText&gt;not red&lt;&#x2F;Text&gt;&lt;&#x2F;CustomText&gt;</code></pre><p>æ”¹è‰¯ç‰ˆï¼š </p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx">import React, &#123; Children, isValidElement, cloneElement &#125; from &#39;react&#39;;import &#123; TextProps, StyleSheet, Text &#125; from &#39;react-native&#39;;const styles &#x3D; StyleSheet.create(&#123;  defaultStyle: &#123;    color: &#39;#323232&#39;,  &#125;,&#125;);export default function CustomText(  props: TextProps &amp; &#123; children?: any; useDefaultStyle?: boolean &#125;,) &#123;  const &#123; style, useDefaultStyle &#x3D; true, ...restProps &#125; &#x3D; props;  const newStyle &#x3D; useDefaultStyle ? [styles.defaultStyle, style] : style;  const childrenWithProps &#x3D; Children.map(props.children, (child) &#x3D;&gt; &#123;    if (isValidElement(child)) &#123;     &#x2F;&#x2F; å¦‚æœå­å…ƒç´ æ˜¯ä¸ªç»„ä»¶ï¼Œåˆ™å­ç»„ä»¶ä¸ä½¿ç”¨é»˜è®¤ style      return cloneElement(child as React.ReactElement&lt;any&gt;, &#123;        useDefaultStyle: false,      &#125;);    &#125;    return child;  &#125;);  return (    &lt;Text style&#x3D;&#123;newStyle&#125; &#123;...restProps&#125;&gt;      &#123;childrenWithProps&#125;    &lt;&#x2F;Text&gt;  );&#125;</code></pre><ul><li><p><a href="https://github.com/ptomasroos/react-native-scrollable-tab-view">react-native-scrollable-tab-view</a></p><p><a href="https://github.com/ptomasroos/react-native-scrollable-tab-view">react-native-scrollable-tab-view</a> ç»„ä»¶ä½œä¸º ScrollView çš„å­ç»„ä»¶æ—¶ä¸å¯ç”¨ï¼Œä¼šå‡ºç° tab é€‰ä¸­ä¸ä¸€è‡´ï¼Œtab content æ— æ³•æ’‘å¼€çš„ç°è±¡ï¼Œè¯¦æƒ…çœ‹ï¼š<a href="https://github.com/ptomasroos/react-native-scrollable-tab-view/issues/982">https://github.com/ptomasroos/react-native-scrollable-tab-view/issues/982</a></p></li><li><p>è®¾ç½®ç¯å¢ƒå˜é‡<br>é€šå¸¸æˆ‘ä»¬çš„ web é¡¹ç›®å¯ä»¥åœ¨ npm script é‡Œé€šè¿‡è®¾ç½® NODE_ENV æ¥è®¾ç½®ä¸åŒçš„ç¯å¢ƒå˜é‡ã€‚æ¯”å¦‚ <code>NODE_ENV=develope node index.js</code>, ä¹‹åå¯ä»¥åœ¨ä»£ç ä¸­é€šè¿‡ <code>process.env.NODE_ENV</code> æ¥åˆ¤æ–­å…·ä½“æ˜¯å“ªä¸ªç¯å¢ƒã€‚rn é¡¹ç›®è¦è¾¾åˆ°åŒæ ·çš„ç›®çš„ï¼Œåˆ™éœ€è¦é¢å¤–å®‰è£… babel æ’ä»¶ <a href="https://www.npmjs.com/package/babel-plugin-transform-inline-environment-variables">babel-plugin-transform-inline-environment-variables</a>ï¼ˆæˆ–è€…å¯ä»¥é€šè¿‡ <a href="https://github.com/luggit/react-native-config">react-native-config</a>ï¼Œä¸è¿‡è¿™ä¸ªæ–¹æ³•æ²¡æœ‰å»éªŒè¯ï¼Œå› ä¸ºä½äº 6.x ç‰ˆæœ¬çš„éœ€è¦å®¢æˆ·ç«¯ linkï¼‰</p></li></ul><h5 id="ScrollView-ä¸-Keyboard"><a href="#ScrollView-ä¸-Keyboard" class="headerlink" title="ScrollView ä¸ Keyboard"></a>ScrollView ä¸ Keyboard</h5><p>åœºæ™¯ï¼š å½“ ScrollView / FlatList / SectionList ä¸­åŒ…å«è¾“å…¥æ¡†æ—¶ï¼Œç‚¹å‡»è¾“å…¥æ¡†å”¤èµ·é”®ç›˜ã€‚å¦‚æœæ­¤æ—¶è¾“å…¥æ¡†å³ä¾§æœ‰æ¸…é™¤è¾“å…¥çš„æŒ‰é’®ï¼Œç‚¹å‡»æ—¶é¦–å…ˆä¼šå°†é”®ç›˜æ”¶èµ·ï¼Œä¹‹åå†æ¬¡ç‚¹å‡»æ‰ä¼šæ‰§è¡Œ onPressã€‚</p><p>æ–¹æ¡ˆï¼šå°† <code>keyboardShouldPersistTaps</code> å±æ€§è®¾ç½®ä¸º <code>always</code>ï¼Œç‚¹å‡»æ¸…é™¤è¾“å…¥çš„æŒ‰é’®ï¼Œé”®ç›˜ä¸ä¼šè‡ªåŠ¨æ”¶èµ·ã€‚</p><h5 id="iOS-Text"><a href="#iOS-Text" class="headerlink" title="iOS Text"></a>iOS Text</h5><p>ios çš„ Text ç»„ä»¶ <code>borderRadius</code> | <code>textAlignVertical</code> å±æ€§æ— æ•ˆï¼Œåªèƒ½å¤–å±‚å†åŒ…ä¸ª View</p><h5 id="Border"><a href="#Border" class="headerlink" title="Border"></a>Border</h5><p>RN çš„ç›’æ¨¡å‹æ˜¯ border-box, å³ å®½é«˜åŒ…æ‹¬äº† padding å’Œ borderã€‚</p><p>åœ¨å¼€å‘ä¸­å‘ç°å¦‚æœå®¹å™¨å…·æœ‰ backgroundColor ä¸ borderRadius åï¼Œè®¾ç½®ä¸€ä¸ªä¸åŒé¢œè‰²çš„ border, è¯¥å®¹å™¨å¤–å›´ä¼šæœ‰ä¸€å±‚æµ…æµ…çš„ backgroundColor æè¾¹ï¼ˆç›®å‰ä»… ios æœ‰è¿™ç§æƒ…å†µï¼‰è§£å†³æ–¹æ¡ˆï¼šåœ¨å®¹å™¨å¤–å±‚å†åŒ…ä¸€ä¸ª Viewï¼Œè®¾ç½® border æ ·å¼</p><h5 id="FlatList-çš„-onViewableItemsChanged"><a href="#FlatList-çš„-onViewableItemsChanged" class="headerlink" title="FlatList çš„ onViewableItemsChanged"></a>FlatList çš„ onViewableItemsChanged</h5><p>onViewableItemsChanged çš„æ–¹æ³•åœ¨ FlatList çš„ç”Ÿå‘½å‘¨æœŸä¸­ä¸å¯ä»¥æ”¹å˜ï¼Œå¦åˆ™æŠ¥é”™ï¼š</p><pre class="line-numbers language-none"><code class="language-none">Invariant Violation: Changing onViewableItemsChanged on the fly is not supported</code></pre><p>å¦‚æœæ˜¯ç±»ç»„ä»¶ï¼Œå¯ä»¥åœ¨ constructor ä¸­å®šä¹‰è¯¥æ–¹æ³•ï¼Œå¦‚æœæ˜¯å‡½æ•°ç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡ useRef åŒ…è£¹è¯¥æ–¹æ³•ã€‚</p><h5 id="ç­‰å®½å­—ä½“"><a href="#ç­‰å®½å­—ä½“" class="headerlink" title="ç­‰å®½å­—ä½“"></a>ç­‰å®½å­—ä½“</h5><p>å¦‚æœå­—ä½“ä¸æ˜¯ç­‰å®½çš„è¯ï¼Œå€’è®¡æ—¶ç»„ä»¶ä¼šäº§ç”Ÿå®½åº¦æŠ–åŠ¨ã€‚ios å’Œ å®‰å“å¹³å°çš„å­—ä½“å¹¶ä¸é€šç”¨ï¼Œå‚è€ƒ <a href="https://github.com/react-native-training/react-native-fontsã€‚">https://github.com/react-native-training/react-native-fontsã€‚</a> æƒ³è¦è®¾ç½®ç­‰å®½å­—ä½“å¯ä»¥è®¾ç½® Text å¦‚ä¸‹æ ·å¼å±æ€§ï¼š</p><pre class="line-numbers language-none"><code class="language-none">fontVariant: [&#39;tabular-nums&#39;] &#x2F;&#x2F; ä»… IOSfontFamily: Platform.OS &#x3D;&#x3D;&#x3D; &#39;android&#39; ? &#39;monospace&#39; : undefined &#x2F;&#x2F; å¦‚æœæ˜¯å®‰å“åˆ™è®¾ç½®å­—ä½“ä¸º monospace</code></pre><p>æ³¨æ„å¦‚æœ fontFamily æŒ‡å®šçš„å­—ä½“ä¸å­˜åœ¨ï¼Œåˆ™é¡µé¢å°†æŠ¥é”™</p><h5 id="è½®æ’­å›¾"><a href="#è½®æ’­å›¾" class="headerlink" title="è½®æ’­å›¾"></a>è½®æ’­å›¾</h5><p>è½®æ’­å›¾ä¸€å¼€å§‹ç”¨çš„æ˜¯ç¤¾åŒºé‡Œ star æ•°æ¯”è¾ƒé«˜çš„ <a href="https://github.com/leecade/react-native-swiper/issues/932">https://github.com/leecade/react-native-swiper/issues/932</a> ï¼Œ</p><p>â˜ ï¸ ä½†æ˜¯è¿™ä¸ªç»„ä»¶å­˜åœ¨ä¸€ä¸ªå‘ï¼šå¦‚æœ loop ä¸º trueï¼Œrerender çš„æ—¶å€™ï¼Œä¼šå…ˆå±•ç¤ºæœ€åä¸€é¡¹ï¼Œå†é—ªå›åˆ°ç¬¬ä¸€é¡¹ã€‚è¿™ä¸ª bug å­˜åœ¨å¥½å‡ å¹´äº†ï¼Œæäº†å¾ˆå¤š issueï¼Œéƒ½æ²¡æœ‰è§£å†³æ‰ï¼Œä¾‹å¦‚ <a href="https://github.com/leecade/react-native-swiper/issues/932">https://github.com/leecade/react-native-swiper/issues/932</a> </p><p>ç”±äºé¡¹ç›®æ¯”è¾ƒç´§å¼ ï¼Œåˆæ²¡æœ‰æ—¶é—´è‡ªå·±å»å®ç°ä¸€ä¸ªï¼Œåé¢å‘ç° <a href="https://github.com/f111fei/react-native-banner-carousel">https://github.com/f111fei/react-native-banner-carousel</a> è¿™ä¸ªä»“åº“ä¸å­˜åœ¨è¯¥é—®é¢˜ã€‚åç»­è¿˜æ˜¯éœ€è¦è‡ªå·±å»ç ”ç©¶ä¸€ä¸‹ rn çš„è½®æ’­å›¾å®ç°æ–¹æ¡ˆã€‚</p><h5 id="stickyHeaderIndices"><a href="#stickyHeaderIndices" class="headerlink" title="stickyHeaderIndices"></a>stickyHeaderIndices</h5><p>ScrollView æä¾› stickyHeaderIndices å¯ä»¥æŒ‡å®šæ»šåŠ¨æ—¶å¸é¡¶çš„ç»„ä»¶ç´¢å¼•</p><p>â˜ ï¸ è¿™ä¸ªå±æ€§å¦‚æœæ˜¯åŠ¨æ€çš„ä¼šå¯¼è‡´ ScrollView æ— æ³•æ­£å¸¸æ¸²æŸ“ï¼Œè§ // <a href="https://github.com/facebook/react-native/issues/25157">https://github.com/facebook/react-native/issues/25157</a> ï¼Œè§£å†³çš„æ–¹æ³•æ˜¯å°† removeClippedSubviews è®¾ç½®æˆ false </p><h5 id="å…³é—­å¼¹çª—ä¸è·³è½¬æ–°é¡µé¢"><a href="#å…³é—­å¼¹çª—ä¸è·³è½¬æ–°é¡µé¢" class="headerlink" title="å…³é—­å¼¹çª—ä¸è·³è½¬æ–°é¡µé¢"></a>å…³é—­å¼¹çª—ä¸è·³è½¬æ–°é¡µé¢</h5><p>åœ¨æˆ‘ä»¬çš„ ios å®¢æˆ·ç«¯å‘ç°ä¸€ä¸ªé—®é¢˜ï¼šç‚¹å‡»ä¸€ä¸ª Modal ä¸­çš„å†…å®¹åï¼Œå…³é—­è¯¥ modal å¹¶æ‰“å¼€ä¸€ä¸ªæ–°çš„ webviewï¼Œæ­¤æ—¶æœ‰å¾ˆå¤§æ¦‚ç‡æ— æ³•æ‰“å¼€æ–° webviewã€‚</p><p>çŒœæµ‹æ˜¯ç”±äºå…³é—­ modal çš„åŠ¨ç”»å½±å“åˆ°æ‰“å¼€æ–° webviewï¼ˆä¸æ¸…æ¥šæ˜¯å¦ ios åŸç”Ÿå°±æ˜¯å¦‚æ­¤ï¼‰</p><p>è§£å†³æ–¹æ¡ˆå°±æ˜¯å»¶è¿Ÿ 300ms åå†æ‰“å¼€æ–° webview</p><h4 id="SectionList-scrollToLocation"><a href="#SectionList-scrollToLocation" class="headerlink" title="SectionList scrollToLocation"></a>SectionList scrollToLocation</h4><p>åœ¨ stickySectionHeadersEnabled ä¸º true çš„æ—¶å€™ï¼Œä»¥ä¸‹ä»£ç çš„ä½œç”¨æ˜¯æ»šåŠ¨åˆ°ç¬¬ä¸€ä¸ª section çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ä½†æ˜¯åœ¨ ios å’Œ android å¹³å°è¡¨ç°ä¸ä¸€è‡´ï¼Œios ä¼šè®¤ä¸º sticky å…ƒç´ éœ€è¦å ä½ç½®ï¼Œè€Œå®‰å“åˆ™ä¸å ä½ï¼Œå¯¼è‡´å®‰å“ä¸‹åˆ—è¡¨ä¼šè¢«é®æŒ¡ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">sectionListRef.current.scrollToLocation(&#123;  sectionIndex: 0,  itemIndex: 0,&#125;);</code></pre><p>è§£å†³æ–¹æ¡ˆï¼šæ ¹æ®å¹³å°æ·»åŠ  viewOffset å±æ€§ï¼Œè®¾ç½®æ»šåŠ¨åç§»é‡ã€‚</p><h4 id="FlatList-æ€§èƒ½ä¼˜åŒ–"><a href="#FlatList-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="FlatList æ€§èƒ½ä¼˜åŒ–"></a>FlatList æ€§èƒ½ä¼˜åŒ–</h4><p>RN çš„é•¿åˆ—è¡¨æ€§èƒ½ä¸€å‘ä¸å¤ªå¥½ï¼Œå³ä½¿ç”¨äº† FlatList ä¾ç„¶è¦æ³¨æ„æ€§èƒ½ä¼˜åŒ–ã€‚æ¯”å¦‚åˆ—è¡¨é¡¹ä¸­å¦‚æœæœ‰å›¾ç‰‡ï¼Œé‚£ä¹ˆè¦æ³¨æ„å‹ç¼©å¤§å°ç­‰ã€‚</p><p>æœªå®Œå¾…ç»­ï½</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ReactNative </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°å½•ä¸€æ¬¡æ­å»º react é¡¹ç›®é‡åˆ°çš„å‘</title>
      <link href="/2020/07/20/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E6%90%AD%E5%BB%BA%20react%20%E9%A1%B9%E7%9B%AE%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/"/>
      <url>/2020/07/20/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E6%90%AD%E5%BB%BA%20react%20%E9%A1%B9%E7%9B%AE%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/</url>
      
        <content type="html"><![CDATA[<h5 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h5><p>ç”µå•†é¡¹ç›®éœ€è¦æ­å»ºä¸€ä¸ª h5 é¡¹ç›®ã€‚è¿™é‡Œç®€å•è®°å½•ä¸€ä¸‹æ­å»ºè¿‡ç¨‹é‡åˆ°çš„å‘ï¼Œä½œä¸ºæ€»ç»“ã€‚</p><a id="more"></a><p>ui æ¡†æ¶ï¼šä¸ºäº†ç»Ÿä¸€ ui æ¡†æ¶ï¼Œå› æ­¤é€‰æ‹©ä½¿ç”¨ antd-mobileã€‚<br>æ‰“åŒ…ï¼šparceljs åœ¨æ­¤å‰çš„é¡¹ç›®ä¸­å·²ç»ä½¿ç”¨è¿‡å¾ˆå¤šæ¬¡äº†ï¼Œæ‰“åŒ…é€Ÿåº¦è¾ƒ cra å¿«ï¼Œä¸”é…ç½®ç®€å•ï¼Œå› æ­¤æ‹Ÿç”¨ parcelã€‚<br>tsï¼šå¤šäººé¡¹ç›®è¿˜æ˜¯ä¸Š tsï¼Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ã€‚<br>å¾ˆå¿«å°±æ­å»ºå¥½ demoï¼Œæ¥ç€å°±å¼€å§‹é‡åˆ°ä¸€äº›é—®é¢˜ã€‚</p><h5 id="antd-mobile-æŒ‰éœ€åŠ è½½"><a href="#antd-mobile-æŒ‰éœ€åŠ è½½" class="headerlink" title="antd-mobile æŒ‰éœ€åŠ è½½"></a>antd-mobile æŒ‰éœ€åŠ è½½</h5><p>antd-mobile æŒ‰éœ€åŠ è½½æ¨èä½¿ç”¨ <a href="https://github.com/ant-design/babel-plugin-import">babel-plugin-import</a></p><pre class="line-numbers language-json" data-language="json"><code class="language-json">&#x2F;&#x2F; .babelrc or babel-loader option&#123;  &quot;plugins&quot;: [    [&quot;import&quot;, &#123; &quot;libraryName&quot;: &quot;antd-mobile&quot;, &quot;style&quot;: &quot;css&quot; &#125;] &#x2F;&#x2F; &#96;style: true&#96; ä¼šåŠ è½½ less æ–‡ä»¶  ]&#125;</code></pre><p>æ­¤å‰ parcel å®é™…ä¸Šå†…ç½®æ”¯æŒäº† tsï¼Œç›´æ¥è½¬æˆ es5 äº†ï¼Œå› æ­¤æ­¤å‰æ²¡æœ‰é¢å¤–å†é…ç½® babelã€‚<br>ğŸ¤” babel-plugin-import åªæ”¯æŒ es6 module å†™æ³•çš„ä»£ç ï¼Œçœ‹æ¥éœ€è¦å…ˆæŠŠ ts è½¬æˆ es6 ç„¶ååœ¨é€šè¿‡ babel è½¬æˆ es5ï¼Œ æ²¡é—®é¢˜ï¼Œå®‰æ’ï½ äºæ˜¯ï¼š</p><ol><li><p>æ–°å¢ .babelrc</p></li><li><p>ä¿®æ”¹ tsconfig çš„ module ä¸º <code>es6</code></p><pre class="line-numbers language-json" data-language="json"><code class="language-json">&#123;  &quot;compilerOptions&quot;: &#123;    &quot;module&quot;: &quot;ES6&quot;  &#125;&#125;</code></pre><p>é¡¹ç›®å¯åŠ¨ï¼Œæ²¡é—®é¢˜ã€‚ä½†æ˜¯ vscode å¼€å§‹æŠ¥é”™ï¼š</p></li></ol><pre class="line-numbers language-tsx" data-language="tsx"><code class="language-tsx">import React from &#39;react&#39;&#x2F;&#x2F; Module &#39;&quot;&#x2F;node_modules&#x2F;@types&#x2F;react&#x2F;index&quot;&#39; can only be default-imported using the &#39;allowSyntheticDefaultImports&#39; flag</code></pre><p>æ ¹æœ¬åŸå› æ˜¯ç”±äº react å¯¼å‡ºå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">module.exports &#x3D; require(&#39;react.development.js&#39;)</code></pre><p>è€Œé</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module.exports.default &#x3D; require(&#39;react.development.js&#39;)</code></pre><p>Babel ä¼šåœ¨ commonjs æ ¼å¼æ·»åŠ  default å¯¼å‡ºï¼Œé‚£æˆ‘ä»¬è¦åšçš„å°±æ˜¯è®© ts ä¸è¦æç¤ºè¿™ç§ç±»å‹çš„æŠ¥é”™ï¼š</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">&#123;  &quot;compilerOptions&quot;: &#123;    &quot;allowSyntheticDefaultImports&quot;: true    &#x2F;&#x2F; ...  &#125;&#125;</code></pre><p>ğŸ¤” ä¸è¿‡ä¸ºä»€ä¹ˆä¸€å¼€å§‹ parcel ä¸ä¼šæŠ¥é”™å‘¢ï¼Ÿ</p><p>æ¥ä¸‹æ¥è·¯ç”±åŠ¨æ€å¼•å…¥ç»„ä»¶å¼€å§‹æŠ¥é”™ï¼š</p><pre class="line-numbers language-tsx" data-language="tsx"><code class="language-tsx">import React, &#123; Suspense, lazy &#125; from &#39;react&#39;const List &#x3D; lazy(() &#x3D;&gt; import(&#39;.&#x2F;modules&#x2F;List&#39;))&#x2F;&#x2F; Dynamic imports are only supported when the &#39;--module&#39; flag is set to &#39;es2020&#39;, &#39;esnext&#39;, &#39;commonjs&#39;, &#39;amd&#39;, &#39;system&#39;, or &#39;umd&#39;.</code></pre><p>çœ‹æ¥ <code>es6</code> æ˜¯ä¸æ”¯æŒ import() è¯­æ³•, é‚£å¥½åŠï¼Œå°† module æ”¹æˆ <code>esnext</code>ï¼š</p><pre class="line-numbers language-none"><code class="language-none">&#123;&quot;compilerOptions&quot;: &#123;    &quot;module&quot;: &quot;ESNext&quot;,  &#125;&#125;</code></pre><p>æ¥ä¸‹æ¥å¼•å…¥ anti-mobile ç»„ä»¶</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">import &#123; List &#125; from &#39;antd-mobile&#39;&#x2F;&#x2F; Cannot find module &#39;antd-mobile&#39; or its corresponding type declarations.</code></pre><p>æ­¤æ—¶æç¤ºæ‰¾ä¸åˆ°å¯¹åº”çš„æ¨¡å—å£°æ˜ï¼Œ æ­¤æ—¶æˆ‘çš„å†…å¿ƒæ˜¯å´©æºƒçš„ï¼Œçœ‹èµ·æ¥åº”è¯¥æ˜¯æ¨¡å—è§£æè·¯å¾„ä¸å¯¹ï¼Œå› æ­¤åœ¨ tsconfig ä¸­æ˜¾å¼é…ç½® <code>moduleResolution</code>:</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">&#123;  &quot;compilerOptions&quot;: &#123;    &quot;moduleResolution&quot;: &quot;Node&quot;    &#x2F;&#x2F; ...  &#125;&#125;</code></pre><p>ä¸å†æŠ¥é”™äº†ï¼Œçœ‹çœ‹ ts æ–‡æ¡£çš„è§£é‡Šå§ï¼Œts å…±æœ‰ä¸¤ç§å¯ç”¨çš„æ¨¡å—è§£æç­–ç•¥ï¼š<a href="https://www.tslang.cn/docs/handbook/module-resolution.html#node">Node</a>å’Œ<a href="https://www.tslang.cn/docs/handbook/module-resolution.html#classic">Classic</a></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module &#x3D;&#x3D;&#x3D; &quot;AMD&quot; or &quot;System&quot; or &quot;ES6&quot; ? &quot;Classic&quot; : &quot;Node&quot;</code></pre><p>ğŸ¤” æŒ‰ç†è¯´ module ä¸º esnext çš„è¯å²‚ä¸æ˜¯åº”è¯¥æŒ‰ node ç­–ç•¥è§£æï¼Ÿä½†æ˜¯ç›®å‰çœ‹æ¥ä¼¼ä¹ä¸æ˜¯è¿™æ ·çš„ï¼Ÿ</p><h5 id="é…ç½®-antd-mobile-ä¸»é¢˜"><a href="#é…ç½®-antd-mobile-ä¸»é¢˜" class="headerlink" title="é…ç½® antd-mobile ä¸»é¢˜"></a>é…ç½® antd-mobile ä¸»é¢˜</h5><p>æ¥ä¸‹æ¥éœ€è¦é…ç½®ä¸»é¢˜ï¼Œanti-mobile æ¨èä½¿ç”¨ <a href="http://lesscss.org/usage/#using-less-in-the-browser-modify-variables">modifyVars</a> æ¥é…ç½®ä¸»é¢˜ã€‚<br>å°† .babelrc æ”¹æˆåšä¸€ä¸‹è°ƒæ•´ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">&#123;    ...    &quot;plugins&quot;: [        [&quot;import&quot;, &#123;&quot;libraryName&quot;: &quot;antd-mobile&quot;, &quot;style&quot;: true&#125;],        ...    ]&#125;</code></pre><p>æŒ‰ç…§ webpack çš„ç»éªŒï¼Œæ­¤æ—¶éœ€è¦å¼€å¯ <code>javascriptEnabled: true</code>é—®é¢˜æ¥äº† parcel å†…ç½®æ”¯æŒ less ï¼Œé‚£æˆ‘ä»¬è¦åœ¨å“ªé‡Œå»é…ç½® less å‘¢ï¼Ÿæ ¹æ® <a href="https://github.com/parcel-bundler/parcel/issues/907">issue</a> æåˆ°å¯ä»¥ç”¨ .lessrc æ–‡ä»¶æ¥é…ç½®ï¼Œä½†æ˜¯æˆ‘ç»è¿‡å°è¯•å‘ç°å…¶å®æ˜¯æ— æ•ˆçš„ã€‚ã€‚<br>è‡³æ­¤åŸºæœ¬æ”¾å¼ƒ parcelã€‚parcel åœ¨å¿«é€Ÿæ­å»ºå®éªŒæ€§é¡¹ç›®æ—¶ç¡®å®æœ‰ä¸€å®šçš„ä¼˜åŠ¿ï¼Œä¸è¿‡ç”Ÿæ€ç¡®å®ä¸å¦‚ webpackï¼Œç”±æ­¤è½¬å‘ä½¿ç”¨ create-react-app</p><h5 id="create-react-app"><a href="#create-react-app" class="headerlink" title="create-react-app"></a>create-react-app</h5><p>ä½¿ç”¨ cra å¾ˆå¿«ä¹Ÿå»ºå¥½ demoï¼Œè§£å†³å¦‚ä½•è®© cra åˆ›å»ºçš„é¡¹ç›®æ”¯æŒ less ï¼Œè¿™ä¸ªç®€å•ï¼š<br>é€šè¿‡ <code>customize-cra</code> æä¾›çš„ <code>addLessLoader</code> æ–¹æ³•å³å¯ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº† <code>fixBabelImports</code> å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ·»åŠ  babel-plugin-import é…ç½®ï¼š</p><pre class="line-numbers language-js" data-language="js"><code class="language-js">const &#123; override, fixBabelImports, addLessLoader &#125; &#x3D; require(&#39;customize-cra&#39;)module.exports &#x3D; override(  fixBabelImports(&#39;import&#39;, &#123;    libraryName: &#39;antd-mobile&#39;,    style: true,  &#125;),  addLessLoader(&#123;    lessOptions: &#123;      javascriptEnabled: true,      modifyVars: &#123;        &#39;@brand-primary&#39;: &#39;#ff74b9&#39;,        &#39;brand-primary-tap&#39;: &#39;#ff9cca&#39;,      &#125;,    &#125;,  &#125;))</code></pre><h5 id="åˆ«å"><a href="#åˆ«å" class="headerlink" title="åˆ«å"></a>åˆ«å</h5><p>æ¥ç€æ˜¯é…ç½®è·¯å¾„åˆ«åé‡åˆ°çš„é—®é¢˜ï¼Œé€šè¿‡ <code>customize-cra</code> æä¾›çš„ <code>addWebpackAlias</code> å¯ä»¥é…ç½®åˆ«åï¼Œä½†æ˜¯ typescript ä¸€ç›´æ— æ³•è§£æå¯¹åº”åˆ«åï¼Œé‚£ä¹ˆåº”è¯¥åªéœ€è¦é…ç½®å¥½ ts çš„ paths å°±è¡Œäº†å§ï¼š</p><pre class="line-numbers language-json" data-language="json"><code class="language-json">&#123;  &quot;compilerOptions&quot;: &#123;    &quot;baseUrl&quot;: &quot;.&quot;,    &quot;paths&quot;: &#123;      &quot;@&#x2F;*&quot;: [&quot;.&#x2F;src&#x2F;*&quot;]    &#125;    &#x2F;&#x2F; ...  &#125;&#125;</code></pre><p>vscode ä¸å†æŠ¥é”™äº†,æ¥ä¸‹æ¥å°±æ˜¯è§è¯å¥‡è¿¹çš„æ—¶åˆ»äº†<code>npm run start</code>ï¼š<br>æ§åˆ¶å°æ˜¾ç¤º <code>- compilerOptions.paths must not be set (aliased imports are not supported)</code> å¹¶ä¸” cra ä¼šè‡ªåŠ¨æŠŠ tscongfig ä¸­çš„ paths ç§»é™¤æ‰ ğŸ˜‚<br>æ ¹æ® <a href="https://github.com/timarney/react-app-rewired/issues/375">issue</a>ï¼Œä½¿ç”¨å°† baseUrl å’Œ paths çš„é…ç½®ç§»åŠ¨åˆ°å•ç‹¬çš„æ–‡ä»¶åï¼Œåœ¨ tsconfig é‡Œé€šè¿‡ extends çš„æ–¹å¼ç»§æ‰¿ï¼Œè™½ç„¶æ§åˆ¶å°ä¾ç„¶æç¤ºé”™è¯¯ï¼Œä½†æ˜¯åˆ«åå¯ä»¥ç”Ÿæ•ˆã€‚</p><h5 id="mini-css-extract-plugin"><a href="#mini-css-extract-plugin" class="headerlink" title="mini-css-extract-plugin"></a>mini-css-extract-plugin</h5><p>åœ¨ build æ—¶ï¼Œmini-css-extract-plugin æç¤º Conflicting orderï¼Œ é”™è¯¯ä½ç½®åœ¨ antd-mobile çš„æ ·å¼æ–‡ä»¶ã€‚æ ¹æ® <a href="https://github.com/ant-design/ant-design/issues/14895">issue</a> ä»¥åŠ <a href="https://github.com/webpack-contrib/mini-css-extract-plugin/issues/250"> issue </a>çœ‹æ¥è¿™ä¸ªé—®é¢˜ä¸»è¦æ˜¯ç”±äºæ‡’åŠ è½½åŠ ä¸Š antd ç»„ä»¶å¯¼å…¥é¡ºåºä¸ä¸€è‡´å¯¼è‡´çš„ï¼Œç›®å‰çœ‹æ¥æ— éœ€è§£å†³ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> webå‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
